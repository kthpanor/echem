
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Hartree–Fock theory &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuration interaction" href="ci.html" />
    <link rel="prev" title="Wave function theory" href="wft.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ir.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="raman.html">
     Raman spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ir_raman_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv-vis.html">
   UV/vis spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_cheat.html">
     Cheat sheet
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Electronic ground states
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals and basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Many-electron wave functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operators.html">
     Operators and matrix elements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="integrals.html">
     Integral evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="spin.html">
     Electron spin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="correlation.html">
     Electron correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="perturbation_theory.html">
     Rayleigh–Schrödinger perturbation theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kernel_integration.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dft_scf.html">
     SCF optimization of a closed-shell state
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Molecular structure and dynamics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="struct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="gradients.html">
   Gradients
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="energy_grad.html">
     Energy gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="property_grad.html">
     Property gradients
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="hess-vib.html">
   Hessians and vibrations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Molecular Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vibrations.html">
     Vibrational analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="structopt-overview.html">
   Structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="structopt.html">
     Optimization methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gsstructopt.html">
     Ground-state structure optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="transition_state.html">
     Transition state geometry optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="impes-overview.html">
   PES interpolation techniques
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="impes.html">
     Constructing the PES by interpolation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="md_ffs.html">
     Force field parameterization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_run.html">
     Running a simulation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spectra and properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="vibrot.html">
     Rovibronic states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tdmu_response.html">
     Responses to external fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="tddft.html">
   TDDFT
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_basics.html">
     Foundations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_rpa.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_ex.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="mr-response.html">
   Multireference response
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ci-response.html">
     CI response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sa-mcscf.html">
     State-averaged MCSCF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mr-response-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="adc.html">
   ADC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-pp.html">
     Polarization propagator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-isr.html">
     Intermediate state representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-cvs.html">
     Core–valence separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-hpc.html">
     HPC-QC implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="excoupl_impl.html">
     Implementation of the exciton coupling model
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="loprop.html">
     LoProp charges and polarisabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="pe_basics.html">
     General aspects
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vis_structure.html">
   Molecular structure and dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="struct_vis.html">
     Molecular structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_vis.html">
     MD trajectories
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="opt_vib_vis.html">
     Optimization and normal modes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elec_vis.html">
   Electronic structure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orb_vis.html">
     Orbitals and densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="exc_vis.html">
     Excited states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dens_vis.html">
     Reduced particle densities
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="cite.html">
   How to cite
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/hartree-fock.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/kthpanor/echem"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/hartree-fock.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docs/hartree-fock.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Hartree–Fock theory
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hartreefock-equation">
     Hartree–Fock equation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lagrangian">
       Lagrangian
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#canonical-form">
       Canonical form
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#in-ao-basis">
         In AO basis
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hartreefock-energy">
     Hartree–Fock energy
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#koopmans-theorem">
     Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brillouin-s-theorem">
     Brillouin’s theorem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scf-procedure">
     SCF procedure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rothaanhall-scheme">
       Rothaan–Hall scheme
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-your-own-scf-program">
   Writing your own SCF program
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-the-system">
     Setting up the system
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reference-calculation">
     Reference calculation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-integrals-in-the-ao-basis">
     Getting integrals in the AO basis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#orthogonalization-of-the-ao-basis">
     Orthogonalization of the AO basis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solving-the-hartreefock-equation">
     Solving the Hartree–Fock equation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scf-iterations">
     SCF iterations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convergence-acceleration">
   Convergence acceleration
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#direct-inversion-iterative-subspace">
     Direct inversion iterative subspace
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     SCF iterations
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Hartree–Fock theory</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Hartree–Fock theory
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hartreefock-equation">
     Hartree–Fock equation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lagrangian">
       Lagrangian
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#canonical-form">
       Canonical form
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#in-ao-basis">
         In AO basis
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hartreefock-energy">
     Hartree–Fock energy
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#koopmans-theorem">
     Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#brillouin-s-theorem">
     Brillouin’s theorem
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scf-procedure">
     SCF procedure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#rothaanhall-scheme">
       Rothaan–Hall scheme
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-your-own-scf-program">
   Writing your own SCF program
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-the-system">
     Setting up the system
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reference-calculation">
     Reference calculation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-integrals-in-the-ao-basis">
     Getting integrals in the AO basis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#orthogonalization-of-the-ao-basis">
     Orthogonalization of the AO basis
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solving-the-hartreefock-equation">
     Solving the Hartree–Fock equation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scf-iterations">
     SCF iterations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convergence-acceleration">
   Convergence acceleration
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#direct-inversion-iterative-subspace">
     Direct inversion iterative subspace
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     SCF iterations
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="hartreefock-theory">
<h1>Hartree–Fock theory<a class="headerlink" href="#hartreefock-theory" title="Permalink to this headline">#</a></h1>
<p>With the state of the system being described by a single Slater determinant, the Hartree–Fock wave function is given as that which minimizes the electronic energy in a variational sense with respect to variations in the spin orbitals. It represents a cornerstone in quantum chemistry and provides total electronic energies that are within 1% of the exact results and a wide range of molecular properties that are within 5–10% accuracy. Moreover, the Hartree–Fock method serves as starting points for the formulation of many other, more accurate, wave function methods as well as the Kohn–Sham formulation of density functional theory.</p>
<section id="hartreefock-equation">
<span id="hartree-fock-equation"></span><h2>Hartree–Fock equation<a class="headerlink" href="#hartreefock-equation" title="Permalink to this headline">#</a></h2>
<p>In the Hartree–Fock approximation, the many-electron wave function takes the form of a <a class="reference internal" href="slater.html#sec-slater"><span class="std std-ref">Slater determinant</span></a></p>
<div class="math notranslate nohighlight">
\[\begin{split}
    | \Phi \rangle =
    \frac{1}{\sqrt{N!}}
    \begin{vmatrix}
    \psi_{1}(\mathbf{r}_1) &amp; \cdots &amp; \psi_{N}(\mathbf{r}_1) \\
    \vdots &amp; \ddots &amp; \vdots \\
    \psi_{1}(\mathbf{r}_N) &amp; \cdots &amp; \psi_{N}(\mathbf{r}_N) \\
    \end{vmatrix} 
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\psi_i\)</span> are the single-electron wave functins known as <a class="reference internal" href="orbitals.html#sec-orbitals"><span class="std std-ref">spin orbitals</span></a>. The Hartree–Fock energy and the associated state is found by minimizing the energy functional</p>
<div class="math notranslate nohighlight">
\[
E_\mathrm{HF} =
\min_{\psi} E[\psi]
\]</div>
<p>under the constraint that the spin orbitals remain orthonormal. Here, <span class="math notranslate nohighlight">\(\psi\)</span> collectively refers to the entire set of <span class="math notranslate nohighlight">\(N\)</span> spin orbitals. Such a contrained minimization is conveniently performed by means of the technique of Lagrange multipliers.</p>
<section id="lagrangian">
<span id="id1"></span><h3>Lagrangian<a class="headerlink" href="#lagrangian" title="Permalink to this headline">#</a></h3>
<p>In Hartree–Fock theory, we introduce the real-valued Lagrangian</p>
<div class="math notranslate nohighlight">
\[
L[\psi] = E[\psi] - \sum_{i,j=1}^N
\varepsilon_{ji} \big(
\langle \psi_i | \psi_j \rangle - \delta_{ij}
\big)
\]</div>
<p>and search for the set of spin orbitals, <span class="math notranslate nohighlight">\(\psi\)</span>, that results in a first variation that vanishes</p>
<div class="math notranslate nohighlight">
\[
\delta L = 0
\]</div>
<p>Expressing the energy as the expectation value of the electronic Hamiltonian with respect to a Slater determinant and using the general expressions for <a class="reference internal" href="operators.html#sec-matrix-elements"><span class="std std-ref">matrix elements</span></a>, we arrive at</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\delta L &amp; =
\sum_{i=1}^N
\langle \delta \psi_i | \hat{h} | \psi_i \rangle +
\sum_{i,j=1}^N
\big(
\langle \delta \psi_i \psi_j | \hat{g} | \psi_i \psi_j\rangle -
\langle \delta \psi_i \psi_j | \hat{g} | \psi_j \psi_i\rangle
-
\varepsilon_{ji}
\langle \delta \psi_i | \psi_j \rangle
\big) +
\mbox{complex conjugate} \\
&amp;=
\sum_{i=1}^N
\langle \delta \psi_i | \big( 
\hat{f} | \psi_i \rangle -
\sum_{j=1}^N
\varepsilon_{ji} | \psi_j \rangle
\big) +
\mbox{complex conjugate}
\end{align*}\]</div>
<p>where we have introduced the <em>one-electron</em> Fock operator</p>
<div class="math notranslate nohighlight">
\[
\hat{f} = \hat{h} + \sum_{j=1}^N \big( \hat{J}_j - \hat{K}_j \big)
\]</div>
<p>with</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\hat{J}_j | \psi_i \rangle &amp; = 
\Big[ 
\int 
\frac{e^2 |\psi_j(\mathbf{r}')|^2}{4\pi\varepsilon_0 |\mathbf{r} - \mathbf{r}'|}
d^3\mathbf{r}'
\Big]
| \psi_i \rangle \\
%
\hat{K}_j | \psi_i \rangle &amp; = 
\Big[
\int
\frac{e^2 \psi_j^\dagger(\mathbf{r}')\psi_i(\mathbf{r}')}{4\pi\varepsilon_0 |\mathbf{r} - \mathbf{r}'|}
d^3\mathbf{r}'
\Big]
| \psi_j \rangle 
\end{align*}\]</div>
<p>Since the first-order variation in the Lagrangian is required to vanish for general variations in the spin orbitals, we have shown that the Hartree–Fock solution is given by</p>
<div class="math notranslate nohighlight">
\[
\hat{f} | \psi_i \rangle -
\sum_{j=1}^N
\varepsilon_{ji} | \psi_j \rangle = 0
\]</div>
<p>This equation is known as the Hartree–Fock equation and it to be solved for the spin orbitals and the associated Lagrange multipliers. We note that the matrix elements of the Fock operator equal the multipliers</p>
<div class="math notranslate nohighlight">
\[
f_{ki} =
\langle \psi_k | \hat{f} | \psi_i \rangle = 
\sum_{j=1}^N
\varepsilon_{ji} \langle \psi_k | \psi_j \rangle = \varepsilon_{ki}
\]</div>
</section>
<section id="canonical-form">
<span id="sec-canonical-hf"></span><h3>Canonical form<a class="headerlink" href="#canonical-form" title="Permalink to this headline">#</a></h3>
<p>Apart from a trivial overall phase factor, <a class="reference internal" href="slater.html#sec-unitary"><span class="std std-ref">unitary transformations among the occupied orbitals</span></a> are shown to leave the Hartree–Fock wave function unchanged. We introduce a unitary transformation that diagonalizes the Hermitian Fock matrix</p>
<div class="math notranslate nohighlight">
\[
f' = \langle \overline{\psi}' | \hat{f} | \overline{\psi}' \rangle 
= U^\dagger \langle \overline{\psi} | \hat{f} | \overline{\psi} \rangle  U =
U^\dagger f  U 
\]</div>
<p>We have here adopted the compact <a class="reference internal" href="orbitals.html#sec-lcao"><span class="std std-ref">overline notation</span></a> of orbitals. In this basis of <em>canonical spin orbitals</em>, the Hartree–Fock equation takes the form</p>
<div class="math notranslate nohighlight">
\[
\hat{f} | \psi_i \rangle =
\varepsilon_{i} | \psi_i \rangle
\]</div>
<p>which we recognize as an eigenvalue equation introducing the <em>orbital energies</em>, <span class="math notranslate nohighlight">\(\varepsilon_{i}\)</span>, as the eigenvalues of the Fock operator. With an infinite number of solutions to the Hartree–Fock equation, the Hartree–Fock ground state is given by employing the <span class="math notranslate nohighlight">\(N\)</span> spin orbitals with lowest orbital energies in the Slater determinant.</p>
<section id="in-ao-basis">
<h4>In AO basis<a class="headerlink" href="#in-ao-basis" title="Permalink to this headline">#</a></h4>
<p>The spatial parts of the spin orbitals, or molecular orbitals (MOs), are expanded as linear combination of atomic orbitals (<a class="reference internal" href="orbitals.html#sec-lcao"><span class="std std-ref">LCAO</span></a>). In the basis of spin atomic orbitals, the Fock matrix becomes block diagonal</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathbf{F} =
\begin{pmatrix}
\mathbf{F}^{\alpha\alpha} &amp;  \mathbf{0} \\
\mathbf{0} &amp; \mathbf{F}^{\beta\beta}
\end{pmatrix}
\end{split}\]</div>
<p>Using the <a class="reference internal" href="orbitals.html#sec-orbitals"><span class="std std-ref">bar notation</span></a> to distinguish <span class="math notranslate nohighlight">\(\alpha\)</span>- and <span class="math notranslate nohighlight">\(\beta\)</span>-spin atomic orbitals, we get</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F_{\mu\nu} &amp; = F^{\alpha\alpha}_{\mu\nu} =
h_{\mu\nu} + \sum_{\gamma\delta} \Big(
D_{\gamma\delta}(\mu\nu|\gamma\delta) -
D^\alpha_{\gamma\delta}(\mu\delta|\gamma\nu)
\Big)
\\
F_{\bar{\mu}\bar{\nu}} &amp; = F^{\beta\beta}_{\mu\nu} =
h_{\mu\nu} + \sum_{\gamma\delta} \Big(
D_{\gamma\delta}(\mu\nu|\gamma\delta) -
D^\beta_{\gamma\delta}(\mu\delta|\gamma\nu)
\Big)
\\
F_{\mu\bar{\nu}} &amp; = F_{\bar{\mu}\nu} = 0
\end{align*}\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
D_{\gamma\delta} &amp;= D^\alpha_{\gamma\delta} + D^\beta_{\gamma\delta} \\
D^\alpha_{\gamma\delta}&amp; =
\sum_{j=1}^{N_\alpha} \big[c_{\gamma j}^\alpha\big]^* c_{\delta j}^\alpha 
; \quad
D^\beta_{\gamma\delta} =
\sum_{j=1}^{N_\beta} \big[c_{\gamma j}^\beta\big]^* c_{\delta j}^\beta 
\\
\end{align*}\]</div>
<p>The canonical Hartree–Fock equation thereby takes the form</p>
<div class="math notranslate nohighlight">
\[
\mathbf{F C} = \mathbf{S C} \boldsymbol{\varepsilon} \, ,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{S}\)</span> is the <a class="reference internal" href="orbitals.html#sec-overlap"><span class="std std-ref">overlap matrix</span></a> and <span class="math notranslate nohighlight">\(\boldsymbol{\varepsilon}\)</span> is a diagonal matrix collecting the orbital energies.</p>
</section>
</section>
</section>
<section id="hartreefock-energy">
<h2>Hartree–Fock energy<a class="headerlink" href="#hartreefock-energy" title="Permalink to this headline">#</a></h2>
<p>For a given density <span class="math notranslate nohighlight">\(\mathbf{D}\)</span>, the Hartree–Fock energy becomes equal to</p>
<div class="math notranslate nohighlight">
\[
E_\mathrm{HF} =
\frac{1}{2}
\mathrm{tr}
\big[ (\mathbf{h} + \mathbf{F}) \mathbf{D} \big] + V^\mathrm{n-n} \, ,
\]</div>
<p>where <span class="math notranslate nohighlight">\(V^\mathrm{n-n}\)</span> is the nuclear repulsion energy.</p>
</section>
<section id="koopmans-theorem">
<h2>Koopmans’ theorem<a class="headerlink" href="#koopmans-theorem" title="Permalink to this headline">#</a></h2>
<p>The orbital energies of occupied and unoccupied orbitals, respectively, equal</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\varepsilon_i &amp; = \langle \psi_i |\hat{f} | \psi_i \rangle =
\langle \psi_i |\hat{h} | \psi_i \rangle +
\sum_{j\neq i}^N
\big(
\langle \psi_i | \hat{J}_j | \psi_i \rangle -
\langle \psi_i | \hat{K}_j | \psi_i \rangle 
\big) \\
\varepsilon_a &amp; = \langle \psi_a |\hat{f} | \psi_a \rangle =
\langle \psi_a |\hat{h} | \psi_a \rangle +
\sum_{j=1}^N
\big(
\langle \psi_a | \hat{J}_j | \psi_a \rangle -
\langle \psi_a | \hat{K}_j | \psi_a \rangle 
\big)
\end{align*}\]</div>
<p>where the cancellation between Coulomb and exchange terms for <span class="math notranslate nohighlight">\(j=i\)</span> has been used in the former case. It thus appears as if <span class="math notranslate nohighlight">\(\varepsilon_i\)</span> relates to the energy of an electron interacting with <span class="math notranslate nohighlight">\((N-1)\)</span> other electrons, whereas <span class="math notranslate nohighlight">\(\varepsilon_a\)</span> relates to the energy of an electron interacting with <span class="math notranslate nohighlight">\(N\)</span> other electrons. In accordance with these observations, it is readily shown from the expressions for <a class="reference internal" href="operators.html#sec-matrix-elements"><span class="std std-ref">matrix elements</span></a> that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\mathrm{IP} &amp;= 
E_i^{N-1} - E_\mathrm{HF}^N = - \varepsilon_i \qquad (\textsf{ionization potential}) \\
\mathrm{EA} &amp;= 
E_\mathrm{HF}^N - E_a^{N+1} = - \varepsilon_a \qquad (\textsf{electron affinity})
\end{align*}\]</div>
<p>where, in the frozen orbital approximation, <span class="math notranslate nohighlight">\(E_i^{N-1}\)</span> is the energy of the system after the removal of the electron in spin orbital <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(E_a^{N+1}\)</span> is the energy of the system after the addition of an electron in spin orbital <span class="math notranslate nohighlight">\(s\)</span>.</p>
</section>
<section id="brillouin-s-theorem">
<h2>Brillouin’s theorem<a class="headerlink" href="#brillouin-s-theorem" title="Permalink to this headline">#</a></h2>
<p>Based on the expressions for <a class="reference internal" href="operators.html#sec-matrix-elements"><span class="std std-ref">matrix elements</span></a>, we find</p>
<div class="math notranslate nohighlight">
\[
\langle \Phi_\mathrm{HF} | \hat{H} | \Phi_i^a \rangle = 
\langle \psi_i | \hat{f} | \psi_a \rangle = 0 
\]</div>
<p>which shows that there is no coupling between the Hartree–Fock ground state and singly excited determinants. This result is known as the <em>Brillouin theorem</em>.</p>
</section>
<section id="scf-procedure">
<span id="id2"></span><h2>SCF procedure<a class="headerlink" href="#scf-procedure" title="Permalink to this headline">#</a></h2>
<p>Due to the summation over occupied spin orbitals that expresses the effective electron interactions, the Fock operator depends on its eigenfunctions and the canonical Hartree–Fock equation is therefore solved iteratively by means of a self-consistent field (SCF) procedure as illustrated in <a class="reference internal" href="#rh-scf-fig"><span class="std std-numref">Fig. 17</span></a>.</p>
<figure class="align-default" id="rh-scf-fig">
<img alt="../_images/rh-scf.svg" src="../_images/rh-scf.svg" /><figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Self-consistent field solution of the Hatree–Fock equation by means of the Rothaan–Hall algorithm.</span><a class="headerlink" href="#rh-scf-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<section id="rothaanhall-scheme">
<h3>Rothaan–Hall scheme<a class="headerlink" href="#rothaanhall-scheme" title="Permalink to this headline">#</a></h3>
<p>In the following, we will consider the spin-restricted formulation where <span class="math notranslate nohighlight">\(\alpha\)</span>- and <span class="math notranslate nohighlight">\(\beta\)</span>-spin orbitals have identical spatial parts. We also restrict the situation to the common case of a closed-shell system such that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
N_\alpha &amp; = N_\beta = \frac{1}{2} N \\
D^\alpha_{\gamma\delta} &amp; = D^\beta_{\gamma\delta} = \frac{1}{2} D_{\gamma\delta} =
\sum_{j=1}^{N/2} c_{\gamma j}^* c_{\delta j}
\end{align*}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When referring to closed-shell systems it is customary to refer to the density matrix as that for either of the spin components.</p>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="writing-your-own-scf-program">
<h1>Writing your own SCF program<a class="headerlink" href="#writing-your-own-scf-program" title="Permalink to this headline">#</a></h1>
<p>Let us implement the presented Hartree–Fock SCF procedure. We will use the water molecule as an example and, as reference, we will first compute the Hartree–Fock energy using the built-in <code class="docutils literal notranslate"><span class="pre">compute</span></code> method in VeloxChem.</p>
<section id="setting-up-the-system">
<h2>Setting up the system<a class="headerlink" href="#setting-up-the-system" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mol_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O    0.000000000000        0.000000000000        0.000000000000</span>
<span class="s2">H    0.000000000000        0.740848095288        0.582094932012</span>
<span class="s2">H    0.000000000000       -0.740848095288        0.582094932012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">mol_str</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">)</span>

<span class="n">norb</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">get_dimensions_of_basis</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">molecule</span><span class="p">)</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_electrons</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">V_nuc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">nuclear_repulsion_energy</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of contracted basis functions:&#39;</span><span class="p">,</span> <span class="n">norb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of doubly occupied molecular orbitals:&#39;</span><span class="p">,</span> <span class="n">nocc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Nuclear repulsion energy (in a.u.): </span><span class="si">{</span><span class="n">V_nuc</span> <span class="si">:</span><span class="s1"> 14.12f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of contracted basis functions: 24
Number of doubly occupied molecular orbitals: 5
Nuclear repulsion energy (in a.u.):  9.343638157670
</pre></div>
</div>
</div>
</div>
</section>
<section id="reference-calculation">
<h2>Reference calculation<a class="headerlink" href="#reference-calculation" title="Permalink to this headline">#</a></h2>
<p>Let us first perform an reference calculation using the restricted closed-shell SCF driver in VeloxChem.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Final HF energy: </span><span class="si">{</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="si">:</span><span class="s1"> 12.8f</span><span class="si">}</span><span class="s1"> Hartree&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Final HF energy: -76.02698419 Hartree
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-integrals-in-the-ao-basis">
<h2>Getting integrals in the AO basis<a class="headerlink" href="#getting-integrals-in-the-ao-basis" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># overlap matrix</span>
<span class="n">overlap_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OverlapIntegralsDriver</span><span class="p">()</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">overlap_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># one-electron Hamiltonian</span>
<span class="n">kinetic_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">KineticEnergyIntegralsDriver</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">kinetic_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">nucpot_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">NuclearPotentialIntegralsDriver</span><span class="p">()</span>
<span class="n">V</span> <span class="o">=</span> <span class="o">-</span><span class="n">nucpot_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">V</span> 

<span class="c1"># two-electron Hamiltonian</span>
<span class="n">eri_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ElectronRepulsionIntegralsDriver</span><span class="p">()</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">norb</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">norb</span><span class="p">,</span> <span class="n">norb</span><span class="p">))</span>
<span class="n">eri_drv</span><span class="o">.</span><span class="n">compute_in_mem</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="orthogonalization-of-the-ao-basis">
<h2>Orthogonalization of the AO basis<a class="headerlink" href="#orthogonalization-of-the-ao-basis" title="Permalink to this headline">#</a></h2>
<p>In order to use the <code class="docutils literal notranslate"><span class="pre">np.linalg.eigh</span></code> function from NumPy to solve the Hartree–Fock equation, we first retrieve an <em>orthogonal</em> AO (OAO) basis by means of a non-unitary transformation matrix <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> such that</p>
<div class="math notranslate nohighlight">
\[
| \overline{\chi^\mathrm{OAO}} \rangle = | \overline{\chi} \rangle \mathbf{X}
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\mathbf{S}^\mathrm{OAO} = \mathbf{X}^\dagger \mathbf{S X} = \mathbf{I}
\]</div>
<p>In the absence of linear dependencies in the AO basis, the overlap matrix is symmetric (and positive-definite) and it can first be diagonalized by a unitary transformation</p>
<div class="math notranslate nohighlight">
\[
\mathbf{U}^{\dagger} \mathbf{S U} = \boldsymbol{\sigma}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{\sigma}\)</span> is a diagonal matrix collecting the eigenvalues. It is then straightfoward to contruct explicit forms of <span class="math notranslate nohighlight">\(\mathbf{X}\)</span>. There exist two common choices</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\mathbf{X} = \mathbf{U} \boldsymbol{\sigma}^{-\frac{1}{2}} \mathbf{U}^\dagger \qquad &amp; \textsf{symmetric, or Löwdin} \\
\mathbf{X} = \mathbf{U} \boldsymbol{\sigma}^{-\frac{1}{2}} \qquad &amp; \textsf{canonical}
\end{align*}\]</div>
<p>We can readily verify that both expression satisfy <span class="math notranslate nohighlight">\(\mathbf{X}^\dagger \mathbf{S X} = \mathbf{I}\)</span>. The expression for the associated transformation of MO coefficients is determined from the relation</p>
<div class="math notranslate nohighlight">
\[
| \overline{\phi} \rangle = | \overline{\chi} \rangle \mathbf{C} =
| \overline{\chi^\mathrm{OAO}} \rangle \mathbf{X}^{-1} \mathbf{C}
\]</div>
<p>We identify</p>
<div class="math notranslate nohighlight">
\[
\mathbf{C}^\mathrm{OAO} = \mathbf{X}^{-1} \mathbf{C}
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
\mathbf{C} = \mathbf{X C}^\mathrm{OAO}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># symmetric transformation</span>
<span class="n">sigma</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ik,k,jk-&gt;ij&#39;</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma</span><span class="p">),</span> <span class="n">U</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="solving-the-hartreefock-equation">
<h2>Solving the Hartree–Fock equation<a class="headerlink" href="#solving-the-hartreefock-equation" title="Permalink to this headline">#</a></h2>
<p>For a given Fock matrix, we solve the Hartree–Fock equation by the following steps:</p>
<ol class="simple">
<li><p>transform the Fock matrix to the OAO basis</p></li>
<li><p>diagonalize the Fock matrix</p></li>
<li><p>transform the MO coefficients back to AO basis</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_MO_coeff</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>

    <span class="n">F_OAO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,kl,lj-&gt;ij&#39;</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">epsilon</span><span class="p">,</span> <span class="n">C_OAO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">F_OAO</span><span class="p">)</span>    
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ik,kj-&gt;ij&quot;</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">C_OAO</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">C</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="scf-iterations">
<h2>SCF iterations<a class="headerlink" href="#scf-iterations" title="Permalink to this headline">#</a></h2>
<p>We form an initial guess for the density based on the core Hamiltonian and thereafter enter the SCF iterations. As a measure of convergence, we adopt the norm of the occupied–virtual block of the Fock matrix in MO basis. It is convenient to scatter the elements of this block into the format of a vector and which we refer to as the <em>error vector</em>. During the course of the SCF iterations, we form a sequence of error vectors, <span class="math notranslate nohighlight">\(\mathbf{e}_i\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_iter</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">conv_thresh</span> <span class="o">=</span> <span class="mf">1e-4</span>

<span class="c1"># initial guess from core Hamiltonian</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">get_MO_coeff</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;iter      SCF energy    Error norm&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
    
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ik,jk-&gt;ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">nocc</span><span class="p">],</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">nocc</span><span class="p">])</span>
        
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl,kl-&gt;ij&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ilkj,kl-&gt;ij&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">J</span> <span class="o">-</span> <span class="n">K</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ij-&gt;&#39;</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="n">F</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">V_nuc</span>

    <span class="c1"># compute convergence metric</span>
    <span class="n">F_MO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,kl,lj-&gt;ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">e_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">F_MO</span><span class="p">[:</span><span class="n">nocc</span><span class="p">,</span> <span class="n">nocc</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">e_vec</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">iter</span><span class="si">:</span><span class="s1">&gt;2d</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">E</span><span class="si">:</span><span class="s1">16.8f</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s1">10.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">conv_thresh</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SCF iterations converged!&#39;</span><span class="p">)</span>
        <span class="k">break</span>
    
    <span class="n">C</span> <span class="o">=</span> <span class="n">get_MO_coeff</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iter      SCF energy    Error norm
 0      -68.84975229    2.23e+00
 1      -69.95937641    1.79e+00
 2      -73.34743276    1.74e+00
 3      -73.46688910    1.36e+00
 4      -74.74058933    1.29e+00
 5      -75.55859127    7.91e-01
 6      -75.86908635    4.86e-01
 7      -75.97444165    2.74e-01
 8      -76.00992921    1.60e-01
 9      -76.02143957    8.99e-02
10      -76.02519173    5.15e-02
11      -76.02640379    2.92e-02
12      -76.02679653    1.67e-02
13      -76.02692347    9.45e-03
14      -76.02696455    5.38e-03
15      -76.02697784    3.06e-03
16      -76.02698213    1.74e-03
17      -76.02698352    9.89e-04
18      -76.02698397    5.63e-04
19      -76.02698412    3.20e-04
20      -76.02698416    1.82e-04
21      -76.02698418    1.04e-04
22      -76.02698418    5.89e-05
SCF iterations converged!
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="convergence-acceleration">
<h1>Convergence acceleration<a class="headerlink" href="#convergence-acceleration" title="Permalink to this headline">#</a></h1>
<section id="direct-inversion-iterative-subspace">
<h2>Direct inversion iterative subspace<a class="headerlink" href="#direct-inversion-iterative-subspace" title="Permalink to this headline">#</a></h2>
<p>The Rothaan–Hall scheme suffer from poor numerical convergence and in practice some version of convergence acceleration is adopted. In the method of direct inversion of the iterative subspace (DIIS) <span id="id3">[<a class="reference internal" href="refs.html#id33" title="P. Pulay. Convergence acceleration of iterative sequences. The case of SCF iteration. Chem. Phys. Lett., 73(2):393-398, 1980. doi:https://doi.org/10.1016/0009-2614(80)80396-4.">Pul80</a>, <a class="reference internal" href="refs.html#id32" title="P. Pulay. Improved SCF convergence acceleration. J. Comput. Chem., 3(4):556-560, 1982. doi:https://doi.org/10.1002/jcc.540030413.">Pul82</a>, <a class="reference internal" href="refs.html#id31" title="Harrell Sellers. The c2-diis convergence acceleration algorithm. Int. J. Quant. Chem., 45(1):31-41, 1993. doi:https://doi.org/10.1002/qua.560450106.">Sel93</a>]</span> information is used from not only the present but also previous iterations to form an <em>averaged</em> effective one-electron Hamiltonian, or Fock matrix, according to</p>
<div class="math notranslate nohighlight">
\[
\mathbf{F}_n^\mathrm{DIIS} = \sum_{i=1}^n w_i \mathbf{F}_i
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{F}_i\)</span> is the Fock matrix generated in SCF iteration <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(n\)</span> is present iteration, and the weights, <span class="math notranslate nohighlight">\(w_i\)</span>, are to be determined. To guarantee that the one-electron Hamiltonian is preserved in the effective Fock operator,  we impose the condition</p>
<div class="math notranslate nohighlight">
\[
\sum_{i=1}^n w_i = 1
\]</div>
<p>Under the assumption of a strict linearity between Fock matrices and error vectors, the averaged error vector would read</p>
<div class="math notranslate nohighlight">
\[
\mathbf{e}_n^\mathrm{DIIS} = \sum_{i=1}^n w_i \mathbf{e}_i
\]</div>
<p>As the molecular orbitals change from one iteration to the next, this is not strictly the case but it is a good approximation. We can then determine the weights by minimizing the squared norm of the averaged error vector under the imposed constraint. The squared norm becomes equal to</p>
<div class="math notranslate nohighlight">
\[
\| \mathbf{e}_n^\mathrm{DIIS} \|^2 =
\sum_{i,j=1}^n w_i B_{ij} w_j ; \quad
B_{ij} = \langle \mathbf{e}_i | \mathbf{e}_j \rangle
\]</div>
<p>and the constrained minimization is achieved by introducing a Lagrangian</p>
<div class="math notranslate nohighlight">
\[
L =
\| \mathbf{e}_n^\mathrm{DIIS} \|^2 - 2\lambda
\Big(
\sum_{i=1}^n w_i - 1
\Big)
\]</div>
<p>where the factor of <span class="math notranslate nohighlight">\(-2\)</span> multiplying the Lagrange multiplier <span class="math notranslate nohighlight">\(\lambda\)</span> is a mere convention as to arrive at an explicit matrix equation of the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
B_{11} &amp; \cdots &amp; B_{1n} &amp; -1 \\
\vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
B_{n1} &amp; \cdots &amp; B_{nn} &amp; -1 \\
-1 &amp; \cdots &amp; -1 &amp; 0
\end{pmatrix}
\begin{pmatrix}
w_1 \\ \vdots \\ w_n \\ \lambda
\end{pmatrix}
=
\begin{pmatrix}
0 \\ \vdots \\ 0 \\ -1
\end{pmatrix}
\end{split}\]</div>
<p>We solve this equation for the weights, <span class="math notranslate nohighlight">\(w_i\)</span>, and then determine the averaged Fock matrix, <span class="math notranslate nohighlight">\(\mathbf{F}_n^\mathrm{DIIS}\)</span>, and error vector, <span class="math notranslate nohighlight">\(\mathbf{e}_n^\mathrm{DIIS}\)</span>, which are both kept in storage for subsequent SCF iterations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_DIIS_fock</span><span class="p">(</span><span class="n">F_mats</span><span class="p">,</span> <span class="n">e_vecs</span><span class="p">):</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">e_vecs</span><span class="p">)</span>
    
    <span class="c1"># build DIIS matrix</span>
    <span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">B</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">e_vecs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">e_vecs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">B</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>

    <span class="n">F_ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">norb</span><span class="p">,</span> <span class="n">norb</span><span class="p">))</span>
    <span class="n">evec_ave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nocc</span> <span class="o">*</span> <span class="p">(</span><span class="n">norb</span> <span class="o">-</span> <span class="n">nocc</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">F_ave</span> <span class="o">+=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">F_mats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">evec_ave</span> <span class="o">+=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">e_vecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        
    <span class="n">F_mats</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">F_ave</span>
    <span class="n">e_vecs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">evec_ave</span>
    
    <span class="k">return</span> <span class="n">F_ave</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id4">
<h2>SCF iterations<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h2>
<p>In principle, the only needed modification in the SCF module to implement the DIIS scheme is a replacement of the original Fock matrix with the weighted averaged counterpart before the determination of the new MO coefficients. But it is also required to save Fock matrices and error vectors from previous SCF iteration. In practice, however, this extra storage requirement does not severely hamper applications, and in particular so as an optimum stabilitity in the DIIS scheme is experienced with the use of information from a limited number (about 10) of the previous iterations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e_vecs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">F_mats</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># initial guess from core Hamiltonian</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">get_MO_coeff</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;iter      SCF energy    Error norm&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
    
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ik,jk-&gt;ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">nocc</span><span class="p">],</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">nocc</span><span class="p">])</span>
        
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl,kl-&gt;ij&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ilkj,kl-&gt;ij&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">J</span> <span class="o">-</span> <span class="n">K</span>
    <span class="n">F_mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ij-&gt;&#39;</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="n">F</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">+</span> <span class="n">V_nuc</span>

    <span class="c1"># compute convergence metric</span>
    <span class="n">F_MO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,kl,lj-&gt;ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">e_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">F_MO</span><span class="p">[:</span><span class="n">nocc</span><span class="p">,</span> <span class="n">nocc</span><span class="p">:],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">e_vecs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">iter</span><span class="si">:</span><span class="s1">&gt;2d</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">E</span><span class="si">:</span><span class="s1">16.8f</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">error</span><span class="si">:</span><span class="s1">10.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">conv_thresh</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SCF iterations converged!&#39;</span><span class="p">)</span>
        <span class="k">break</span>
        
    <span class="n">F</span> <span class="o">=</span> <span class="n">get_DIIS_fock</span><span class="p">(</span><span class="n">F_mats</span><span class="p">,</span> <span class="n">e_vecs</span><span class="p">)</span>
    
    <span class="n">C</span> <span class="o">=</span> <span class="n">get_MO_coeff</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iter      SCF energy    Error norm
 0      -68.84975229    2.23e+00
 1      -69.95937641    1.79e+00
 2      -75.55244086    7.92e-01
 3      -75.98441968    2.55e-01
 4      -76.01359974    1.37e-01
 5      -76.02627504    3.17e-02
 6      -76.02602152    3.75e-02
 7      -76.02686952    1.26e-02
 8      -76.02697700    3.01e-03
 9      -76.02698332    8.67e-04
10      -76.02698394    5.41e-04
11      -76.02698416    1.39e-04
12      -76.02698418    5.89e-05
SCF iterations converged!
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="wft.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Wave function theory</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="ci.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Configuration interaction</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The eChem team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>