
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Force fields &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Gradients" href="gradients.html" />
    <link rel="prev" title="Choice of coordinates" href="coordinates.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Getting started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials/vib_ir.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/vib_ir_calc.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/vib_ir_raman.html">
     Raman spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/vib_ir_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials/uv_vis.html">
   UV/vis spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/uv_vis_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/uv_vis_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/uv_vis_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/uv_vis_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../tutorials/xray.html">
   X-ray spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_exercises.html">
     Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../tutorials/xray_cheatsheet.html">
     Cheat sheet
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Electronic ground states
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/elstruct_gen.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/orbitals.html">
     Orbitals and basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/slater.html">
     Many-electron wave functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/operators.html">
     Operators and matrix elements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/reduced_density.html">
     Reduced particle densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/integrals.html">
     Integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/spin.html">
     Electron spin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/correlation.html">
     Electron correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dispersion.html">
     Dispersion interactions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/pt.html">
     Rayleigh–Schrödinger perturbation theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/second_quant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/wft_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/kernel_int.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dft_scf.html">
     SCF optimization of a closed-shell state
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Molecular structure and dynamics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="molstruct_gen.html">
   General aspects
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="gradients.html">
   Gradients
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="energy_grad.html">
     Energy gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="property_grad.html">
     Property gradients
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="hessians_vib.html">
   Hessians and vibrations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Molecular Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vibrations.html">
     Vibrational analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="opt.html">
   Structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="opt_struct.html">
     Optimization methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="opt_gs.html">
     Ground-state structure optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="tst_gen.html">
     Transition state geometry optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="impes.html">
   PES interpolation techniques
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="impes_calc.html">
     Constructing the PES by interpolation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="md.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="md_ffs.html">
     Force field parameterization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_run.html">
     Running a simulation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spectra and properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/spectra_aspects.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/vibrot.html">
     Rovibronic states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/response.html">
     Responses to external fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/tddft.html">
   TDDFT
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_basics.html">
     Foundations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_rpa.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/mr_response.html">
   Multireference response
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/ci_response.html">
     CI response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/sa_mcscf.html">
     State-averaged MCSCF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/mclr.html">
     Multiconfigurational linear response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/mr_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/adc.html">
   ADC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_pp.html">
     Polarization propagator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_isr.html">
     Intermediate state representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_cvs.html">
     Core-valence separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_hpc.html">
     HPC-QC implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/excoupl.html">
   Exciton coupling model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/excoupl_impl.html">
     Implementation of the exciton coupling model
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../env/localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/loprop.html">
     LoProp charges and polarisabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../env/embedding.html">
   Embedding
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/nonpol_emb.html">
     Non-polarizable embedding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/pol_emb.html">
     Polarizable embedding
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/mol_struct.html">
   Molecular structure and dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/struct_vis.html">
     Molecular structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/md_vis.html">
     MD trajectories
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/opt_vib_vis.html">
     Optimization and normal modes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/elec_struct.html">
   Electronic structure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/orb_vis.html">
     Orbitals and densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/exc_vis.html">
     Excited states
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../cite.html">
   How to cite
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/mol_struct/forcefields.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/kthpanor/echem"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/mol_struct/forcefields.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/docs/mol_struct/forcefields.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonded-and-non-bonded-interactions">
   Bonded and non-bonded interactions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#force-field-terms">
   Force-field terms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bond-stretching">
   Bond stretching
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-fit">
     Harmonic fit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anharmonic-fit">
     Anharmonic fit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#angle-bending">
   Angle bending
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Harmonic fit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#torsion">
   Torsion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#electrostatic-interaction">
   Electrostatic interaction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#van-der-waals-interaction">
   van der Waals interaction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-terms">
   Additional terms
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Force fields</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonded-and-non-bonded-interactions">
   Bonded and non-bonded interactions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#force-field-terms">
   Force-field terms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bond-stretching">
   Bond stretching
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#harmonic-fit">
     Harmonic fit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anharmonic-fit">
     Anharmonic fit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#angle-bending">
   Angle bending
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Harmonic fit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#torsion">
   Torsion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#electrostatic-interaction">
   Electrostatic interaction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#van-der-waals-interaction">
   van der Waals interaction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-terms">
   Additional terms
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="force-fields">
<h1>Force fields<a class="headerlink" href="#force-fields" title="Permalink to this headline">#</a></h1>
<p>Even with all the approximations and optimizations of the last hundred years, first principles quantum chemical calculations are still very resource demanding, even for quite small systems. The upper limit for a geometry optimization is around a thousand atoms and a dynamics simulation is only possible for systems of a few hundred atoms, and even then only for very short time scales. This means that unless new approximations are introduced, many systems that are of interest will be far beyond the capabilities of today’s computers. A small piece of protein from the human body can consist of several thousand atoms, and even very small systems can increase by hundreds of atoms when a solvent is added. A popular way of dealing with this problem when simulating the motion of atoms is to use molecular mechanics (MM).</p>
<p>In electronic structure theory, the [Born–Oppenheimer] approximation is utilized to separate the Schrödinger equation into electronic and nuclear parts that can be solved separately. The electrons are approximated as responding instantly to any changes in the nuclear coordinates, allowing the electronic distribution to be found around stationary nuclei, after which the problem is solved for the nuclei moving in the effective potential generated by the electrons. MM takes this one step further and combines nuclei and electrons into a single unit, unsurprisingly referred to as atoms.</p>
<section id="bonded-and-non-bonded-interactions">
<h2>Bonded and non-bonded interactions<a class="headerlink" href="#bonded-and-non-bonded-interactions" title="Permalink to this headline">#</a></h2>
<p>The potential energy of the system is approximated as a simple analytical function of the atomic coordinates. This potential energy function is split into contributions from different kinds of interactions involving two or more atoms, such as bond stretching and angle bending. The specific form of the potential energy function as well as the parameters used in it are know as a force field. The included interactions and the functional form that they take can differ depending on the requirements of the force field, with some focused on describing specific groups of molecules well and some sacrificing accuracy for computational efficiency. A simple energy function can look like</p>
<div class="math notranslate nohighlight">
\[
E = {E_\mathrm{s}}  + {E_\theta} + {E_\omega} + {E_\mathrm{vdw}} + {E_\mathrm{el}}
\]</div>
<p>where each term is a sum, adding up all the contribution from a certain kind of bonded or non-bonded interaction in the system.</p>
<p>The potential energy function of the system has as its variables the atomic coordinates, but it also depends parametrically on how the atoms are bonded and the types of the involved atoms. In MM, atom type does not just mean which element the atom belongs to, but also its chemical environment. This concept of atom types contains one of the main ideas behind MM force fields, which is that molecular structures that exist in similar environments behave in a similar manner. As an example, the carbon–carbon bond found in ethane is very similar to the two found in propane. The bond lengths are similar and the changes in potential energy when the bonds are stretched or contracted are almost the same. The parameters used in the potential energy function describing these three bonds can therefore safely be approximated as being the same. This transferability is one of the main strengths of using force fields, as parameters developed for a certain structure in one system can be reused for similar structures in other systems. For example, the parameters needed to describe butane are all that is required to describe all linear and branched alkanes in a simple force field. The same cannot be said for the carbon–carbon triple bond in acetylene, where the bond length is much shorter and the bond strength is significantly higher. Using the same parameters for all these bonds would lead to a poor description, which indicates that a finer division of atom types is needed than to just have one for each element. How fine this division is depends on what is desired from the force field. Creating accurate parameters can be a difficult and time-consuming process, with fittings made either to experimental data or higher level quantum mechanical calculations. A larger number of atom types makes it possible to give a more nuanced description of the interactions in the system, but it also strips away the transferability advantages. With more atom types the number of parameters quickly increases, and with them the likelihood that some of them will have to be created when studying a new system.</p>
</section>
<section id="force-field-terms">
<h2>Force-field terms<a class="headerlink" href="#force-field-terms" title="Permalink to this headline">#</a></h2>
<p>The following section describes the most common force-field interactions, using the [CHARMM] and [MM3] force fields as examples. The two main categories of interaction terms are bonded and non-bonded. Bonded interactions exist for atoms that are part of the same molecule, the structure of which is defined at the start of the simulation by the user. There are also reactive force fields, such as [ReaxFF], where bonds can be formed and broken dynamically. Non-bonded terms appear between atoms in different molecules as well as between atoms in the same molecule, provided that they are separated by at least a certain number of bonds—usually three. For atom pairs connected by fewer bonds, the non-bonded interactions are incorporated into the bonded interactions.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">py3Dmol</span> <span class="k">as</span> <span class="nn">p3d</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="bond-stretching">
<h2>Bond stretching<a class="headerlink" href="#bond-stretching" title="Permalink to this headline">#</a></h2>
<p>Stretching or contracting a bond from its equilibrium position causes the energy of the system to rise.</p>
<figure class="align-default" id="fig-bondstretch">
<a class="reference internal image-reference" href="../../_images/MM_stretch.svg"><img alt="../../_images/MM_stretch.svg" src="../../_images/MM_stretch.svg" width="300px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Bond stretching.</span><a class="headerlink" href="#fig-bondstretch" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>This change in energy is approximated by the bond stretch terms, usually represented by a simple harmonic oscillator of the form</p>
<div class="math notranslate nohighlight" id="eq-bond-stretch-harm">
\[
{E_\mathrm{s}} = \frac{k_\text{s}}{2} (l - l_0)^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(k_\text{s}\)</span> is a force constant, defining the strength of the bond, <span class="math notranslate nohighlight">\(l\)</span> is the distance between the two bonded atoms and <span class="math notranslate nohighlight">\(l_0\)</span> is the equilibrium distance for the interaction. Both <span class="math notranslate nohighlight">\(k_\text{s}\)</span> and <span class="math notranslate nohighlight">\(l_0\)</span> are constants specific to the combination of atom types involved in the interaction. It should be noted that while <span class="math notranslate nohighlight">\(l_0\)</span> is the bond length that minimizes the equation, it is not necessarily the equilibrium distance found in a molecule. As the two bonded atoms are most likely also involved in several other interactions, the molecular equilibrium distance will be the one that minimizes the full potential.</p>
<p>We will now calculate the B3LYP potenteial energy surface of CO, and se how different fitted force fields can replicate the reference potential.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We will here consider a larger bond distance, in order to more clearly see how different choices of force field fittings affect the general shape of the resulting potential. For practical studies, these large distortions of the CO bond will not be sampled, as 10 kJ/mol corresponds to a temperatuer of about 1200 K. Any regions of the PES above this will thus hardly be sampled for most simulations.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">co_base</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0       0.0       0.0</span>
<span class="s2">C         x       0.0       0.0</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">bond_e</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bond_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.30</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">bond_l</span><span class="p">:</span>
    <span class="c1"># change C position</span>
    <span class="n">co_tmp</span> <span class="o">=</span> <span class="n">co_base</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    <span class="n">mol_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">co_tmp</span><span class="p">)</span>
    <span class="n">bas_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

    <span class="c1"># calculate B3LYP energy</span>
    <span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xcfun&quot;</span><span class="p">:</span> <span class="s2">&quot;b3lyp&quot;</span><span class="p">}</span>
    <span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
    <span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span> <span class="n">method_settings</span><span class="p">)</span>
    <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="n">bas_vlx</span><span class="p">)</span>
    <span class="n">bond_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>

<span class="c1"># index for minimal energy</span>
<span class="n">bond_indx</span> <span class="o">=</span> <span class="n">bond_e</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">bond_e</span><span class="p">))</span>
<span class="c1"># convert to kJ/mol and shift to zero</span>
<span class="n">bond_e</span> <span class="o">=</span> <span class="mf">2600.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bond_e</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">bond_e</span><span class="p">))</span>
</pre></div>
</div>
<p>Structures and B3LYP potential energy surface:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bond_l</span><span class="p">,</span> <span class="n">bond_e</span><span class="p">,</span> <span class="s2">&quot;o--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bond distance [Å]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">viewer</span> <span class="o">=</span> <span class="n">p3d</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">setViewStyle</span><span class="p">({</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;outline&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">addModelsAsFrames</span><span class="p">(</span><span class="n">bond_xyz</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">animate</span><span class="p">({</span><span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="s2">&quot;backAndForth&quot;</span><span class="p">})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s2">&quot;stick&quot;</span><span class="p">:</span> <span class="p">{}})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/forcefields_6_0.png" src="../../_images/forcefields_6_0.png" />
<div class="output text_html"><div id="3dmolviewer_16693048190039911"  style="position: relative; width: 550px; height: 300px">
        <p id="3dmolwarning_16693048190039911" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdn.jsdelivr.net/npm/3dmol@latest/build/3Dmol-min.min.js');
}

var viewer_16693048190039911 = null;
var warn = document.getElementById("3dmolwarning_16693048190039911");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16693048190039911 = $3Dmol.createViewer($("#3dmolviewer_16693048190039911"),{backgroundColor:"white"});
viewer_16693048190039911.zoomTo();
	viewer_16693048190039911.setViewStyle({"style": "outline", "color": "black", "width": 0.1});
	viewer_16693048190039911.addModelsAsFrames("2\n*\nO       0.0       0.0       0.0\nC         1.05       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.06       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.07       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.08       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.09       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.11       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.12       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1300000000000001       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1400000000000001       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1500000000000001       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1600000000000001       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1700000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1800000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.1900000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2000000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2100000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2200000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2300000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2400000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2500000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2600000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2700000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2800000000000002       0.0       0.0\n2\n*\nO       0.0       0.0       0.0\nC         1.2900000000000003       0.0       0.0\n");
	viewer_16693048190039911.animate({"loop": "backAndForth"});
	viewer_16693048190039911.setStyle({"stick": {}});
viewer_16693048190039911.render();
});
</script></div></div>
</div>
<section id="harmonic-fit">
<h3>Harmonic fit<a class="headerlink" href="#harmonic-fit" title="Permalink to this headline">#</a></h3>
<p>This will now be fitted using the using three different approaches:</p>
<ol class="simple">
<li><p>Using the full energy curve</p></li>
<li><p>Using an interval symmetric around the minima in terms of <strong>distance</strong></p></li>
<li><p>Using an interval symmetric around the minima in terms of <strong>energy</strong></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to be fitted to</span>
<span class="k">def</span> <span class="nf">harm_func</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">ks</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">ks</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="n">l0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>


<span class="c1"># feed with equilibrium distance and a stiff force constant</span>
<span class="c1"># fitting for full curve</span>
<span class="n">opt_harm1</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">harm_func</span><span class="p">,</span> <span class="n">bond_l</span><span class="p">,</span> <span class="n">bond_e</span><span class="p">,</span> <span class="p">[</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">],</span> <span class="mi">1000</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s from fit #1: </span><span class="si">{:04.3f}</span><span class="s2"> / </span><span class="si">{:06.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_harm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># fitting for minima +/-0.025 Å</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_l</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">bond_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.025</span><span class="p">:</span>
        <span class="n">i_min_d</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">if</span> <span class="n">bond_l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.025</span><span class="p">:</span>
        <span class="n">i_max_d</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">opt_harm2</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">harm_func</span><span class="p">,</span>
    <span class="n">bond_l</span><span class="p">[</span><span class="n">i_min_d</span><span class="p">:</span><span class="n">i_max_d</span><span class="p">],</span>
    <span class="n">bond_e</span><span class="p">[</span><span class="n">i_min_d</span><span class="p">:</span><span class="n">i_max_d</span><span class="p">],</span>
    <span class="p">[</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">],</span> <span class="mi">1000</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s from fit #2: </span><span class="si">{:04.3f}</span><span class="s2"> / </span><span class="si">{:06.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_harm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># fitting for minima +10 kJ/mol</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bond_e</span><span class="p">)):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bond_e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">bond_indx</span><span class="p">):</span>
        <span class="n">i_min_e</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bond_e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">bond_indx</span><span class="p">):</span>
        <span class="n">i_max_e</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">opt_harm3</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">harm_func</span><span class="p">,</span>
    <span class="n">bond_l</span><span class="p">[</span><span class="n">i_min_e</span><span class="p">:</span><span class="n">i_max_e</span><span class="p">],</span>
    <span class="n">bond_e</span><span class="p">[</span><span class="n">i_min_e</span><span class="p">:</span><span class="n">i_max_e</span><span class="p">],</span>
    <span class="p">[</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">],</span> <span class="mi">1000</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s from fit #3: </span><span class="si">{:04.3f}</span><span class="s2"> Å / </span><span class="si">{:06.1f}</span><span class="s2"> kJ/mol/Å&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_harm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;B3LYP bond distance: </span><span class="si">{:04.3f}</span><span class="s2"> Å&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.06</span><span class="p">,</span> <span class="mf">1.29</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">bond_l</span><span class="p">,</span> <span class="n">bond_e</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># splined B3LYP results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">harm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_harm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">harm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_harm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">harm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_harm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.275</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;B3LYP&quot;</span><span class="p">,</span> <span class="s2">&quot;Full&quot;</span><span class="p">,</span> <span class="s2">&quot;Distance symm.&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy symm.&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bond distance [Å]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>l_0 / k_s from fit #1: 1.167 / 9888.5
l_0 / k_s from fit #2: 1.157 / 10094.0
l_0 / k_s from fit #3: 1.158 Å / 10536.4 kJ/mol/Å
B3LYP bond distance: 1.160 Å
</pre></div>
</div>
<img alt="../../_images/forcefields_8_1.png" src="../../_images/forcefields_8_1.png" />
</div>
</div>
<p>It is clear that using the full SCF curve we calculated yield unrealistic fits, as it puts weight on parts of the PES that will no be sampled by most dynamics. Using fits with intervals symmetric in either energy or bond distance yield similar results, especially within the region of most interest (<span class="math notranslate nohighlight">\(&lt;10\)</span> kJ/mol).</p>
</section>
<section id="anharmonic-fit">
<h3>Anharmonic fit<a class="headerlink" href="#anharmonic-fit" title="Permalink to this headline">#</a></h3>
<p>Generally, contracting a bond produces a steeper rise in energy than stretching it. This is accounted for in some force fields, such as MM3, which introduce anharmonicity into the bond energy expression by including higher order terms based on the [Morse potential]. The MM3 bond stretching term has the form</p>
<div class="math notranslate nohighlight">
\[
{E_\mathrm{s}} = \frac{k_\text{s}}{2} (l - l_0)^2 \left( 1 - \alpha (l - l_0) + \alpha \frac{7}{12} (l - l_0)^2 \right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> is derived as 2.55 from the Morse potential, but could be taken as an additional parameter. Performing curve fits for <span class="math notranslate nohighlight">\(l_0\)</span>, <span class="math notranslate nohighlight">\(k_s\)</span>, and <span class="math notranslate nohighlight">\(\alpha\)</span> yield:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">anharm_func</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">ks</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">ks</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="n">l0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="n">l0</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="p">((</span><span class="mf">7.0</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="n">l0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="p">)</span>


<span class="c1"># feed with equilibrium distance, a stiff force constant, and a=2.55</span>
<span class="c1"># fitting for full curve</span>
<span class="n">opt_anharm1</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">anharm_func</span><span class="p">,</span> <span class="n">bond_l</span><span class="p">,</span> <span class="n">bond_e</span><span class="p">,</span> <span class="p">[</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">2.55</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s / alpha from fit #1: </span><span class="si">{:04.3f}</span><span class="s2"> Å / </span><span class="si">{:06.1f}</span><span class="s2"> kJ/mol/Å / </span><span class="si">{:04.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_anharm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">opt_anharm2</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">anharm_func</span><span class="p">,</span>
    <span class="n">bond_l</span><span class="p">[</span><span class="n">i_min_d</span><span class="p">:</span><span class="n">i_max_d</span><span class="p">],</span>
    <span class="n">bond_e</span><span class="p">[</span><span class="n">i_min_d</span><span class="p">:</span><span class="n">i_max_d</span><span class="p">],</span>
    <span class="p">[</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">2.55</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s / alpha from fit #2: </span><span class="si">{:04.3f}</span><span class="s2"> Å / </span><span class="si">{:06.1f}</span><span class="s2"> kJ/mol/Å / </span><span class="si">{:04.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_anharm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">opt_anharm3</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">anharm_func</span><span class="p">,</span>
    <span class="n">bond_l</span><span class="p">[</span><span class="n">i_min_e</span><span class="p">:</span><span class="n">i_max_e</span><span class="p">],</span>
    <span class="n">bond_e</span><span class="p">[</span><span class="n">i_min_e</span><span class="p">:</span><span class="n">i_max_e</span><span class="p">],</span>
    <span class="p">[</span><span class="n">bond_l</span><span class="p">[</span><span class="n">bond_indx</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">2.55</span><span class="p">],</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s / alpha from fit #3: </span><span class="si">{:04.3f}</span><span class="s2"> Å / </span><span class="si">{:06.1f}</span><span class="s2"> kJ/mol/Å / </span><span class="si">{:04.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># plot spline B3LYP results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">anharm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_anharm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">anharm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_anharm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">anharm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.275</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;B3LYP&quot;</span><span class="p">,</span> <span class="s2">&quot;Full&quot;</span><span class="p">,</span> <span class="s2">&quot;Distance symm.&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy symm.&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bond distance [Å]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>l_0 / k_s / alpha from fit #1: 1.157 Å / 10480.0 kJ/mol/Å / 2.234
l_0 / k_s / alpha from fit #2: 1.156 Å / 10026.5 kJ/mol/Å / 2.747
l_0 / k_s / alpha from fit #3: 1.156 Å / 10181.5 kJ/mol/Å / 2.671
</pre></div>
</div>
<img alt="../../_images/forcefields_10_1.png" src="../../_images/forcefields_10_1.png" />
</div>
</div>
<p>Comparing anharmonic and harmonic fits (fitted with energy-symmetric), as well as using force constant:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Calculation of force constant is to be added.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># splined B3LYP results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">harm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_harm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">anharm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">opt_anharm3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">1.11</span><span class="p">,</span> <span class="mf">1.21</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;B3LYP&quot;</span><span class="p">,</span> <span class="s2">&quot;Harmonic&quot;</span><span class="p">,</span> <span class="s2">&quot;Anharmonic&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bond distance [Å]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/forcefields_12_0.png" src="../../_images/forcefields_12_0.png" />
</div>
</div>
</section>
</section>
<section id="angle-bending">
<h2>Angle bending<a class="headerlink" href="#angle-bending" title="Permalink to this headline">#</a></h2>
<p>Same as for bond stretching, distorting an angle formed between two atoms bound to a common third atom from its equilibrium causes the energy of the system to rise. This too is commonly approximated by a harmonic oscillator of the form</p>
<div class="math notranslate nohighlight">
\[
{E_\theta} = \frac{k_\theta}{2} (\theta - \theta_0)^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(k_\theta\)</span> is a force constant, <span class="math notranslate nohighlight">\(\theta\)</span> is the angle formed by the atoms and <span class="math notranslate nohighlight">\(\theta_0\)</span> is the equilibrium angle.</p>
<figure class="align-default" id="fig-mm-bend">
<a class="reference internal image-reference" href="../../_images/MM_bend.svg"><img alt="../../_images/MM_bend.svg" src="../../_images/MM_bend.svg" width="300px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Angle bending.</span><a class="headerlink" href="#fig-mm-bend" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We do the fitting for the bond angle of water. As a scan creates output files which are then to be read, we instead “scan” one angle at a time and save the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the molecule and basis set</span>
<span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Create veloxchem mol and basis objects</span>
<span class="n">mol_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">bas_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xcfun&quot;</span><span class="p">:</span> <span class="s2">&quot;b3lyp&quot;</span><span class="p">}</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="n">bas_vlx</span><span class="p">)</span>

<span class="c1"># Set up the gradient and optimization dirvers:</span>
<span class="n">grad_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfGradientDriver</span><span class="p">(</span><span class="n">scf_drv</span><span class="p">)</span>
<span class="n">opt_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OptimizationDriver</span><span class="p">(</span><span class="n">grad_drv</span><span class="p">)</span>

<span class="n">angle_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">angle_e</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">angle_xyz</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angle_a</span><span class="p">:</span>
    <span class="n">angle_scan</span> <span class="o">=</span> <span class="s2">&quot;angle 2 1 3 </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="n">opt_drv</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$scan&quot;</span><span class="p">,</span> <span class="n">angle_scan</span><span class="p">]</span>

    <span class="c1"># Run the scan</span>
    <span class="n">opt_molecule</span> <span class="o">=</span> <span class="n">opt_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="n">bas_vlx</span><span class="p">)</span>
    <span class="n">angle_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt_molecule</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">())</span>
    <span class="n">angle_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>

<span class="c1"># index for minimal energy</span>
<span class="n">angle_indx</span> <span class="o">=</span> <span class="n">angle_e</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">angle_e</span><span class="p">))</span>
<span class="c1"># convert to kJ/mol and shift to zero</span>
<span class="n">angle_e</span> <span class="o">=</span> <span class="mf">2600.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angle_e</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">angle_e</span><span class="p">))</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle_a</span><span class="p">,</span> <span class="n">angle_e</span><span class="p">,</span> <span class="s2">&quot;o--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Bond angle&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">vlx2py3d</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
    <span class="c1"># convert the VeloxChem outpyt to a format readable by py3Dmol</span>
    <span class="n">structure</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">b2a</span> <span class="o">=</span> <span class="mf">0.5291772</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)):</span>
        <span class="n">structure</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">*</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">structure</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">element</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b2a</span> <span class="o">*</span> <span class="n">xyz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b2a</span> <span class="o">*</span> <span class="n">xyz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">b2a</span> <span class="o">*</span> <span class="n">xyz</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">structure</span>

<span class="n">structure</span> <span class="o">=</span> <span class="n">vlx2py3d</span><span class="p">([</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">angle_xyz</span><span class="p">)</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">p3d</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">setViewStyle</span><span class="p">({</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;outline&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">addModelsAsFrames</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">animate</span><span class="p">({</span><span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="s2">&quot;backAndFirth&quot;</span><span class="p">})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s2">&quot;stick&quot;</span><span class="p">:</span> <span class="p">{}})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/forcefields_15_0.png" src="../../_images/forcefields_15_0.png" />
<div class="output text_html"><div id="3dmolviewer_1669304819921948"  style="position: relative; width: 550px; height: 300px">
        <p id="3dmolwarning_1669304819921948" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdn.jsdelivr.net/npm/3dmol@latest/build/3Dmol-min.min.js');
}

var viewer_1669304819921948 = null;
var warn = document.getElementById("3dmolwarning_1669304819921948");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1669304819921948 = $3Dmol.createViewer($("#3dmolviewer_1669304819921948"),{backgroundColor:"white"});
viewer_1669304819921948.zoomTo();
	viewer_1669304819921948.setViewStyle({"style": "outline", "color": "black", "width": 0.1});
	viewer_1669304819921948.addModelsAsFrames("3\n*\nO -0.0 -0.0 0.3263\nH -0.52069 -0.0 -0.57557\nH 0.52069 -0.0 -0.57557\n3\n*\nO 0.0 0.0 0.30381\nH -0.55306 0.0 -0.56432\nH 0.55306 0.0 -0.56432\n3\n*\nO 0.0 -0.0 0.28186\nH -0.58482 -0.0 -0.55335\nH 0.58482 0.0 -0.55335\n3\n*\nO -0.0 -0.0 0.26007\nH -0.6158 -0.0 -0.54245\nH 0.6158 0.0 -0.54245\n3\n*\nO 0.0 -0.0 0.23811\nH -0.64576 -0.0 -0.53147\nH 0.64576 -0.0 -0.53147\n3\n*\nO 0.0 -0.0 0.2158\nH -0.67452 -0.0 -0.52032\nH 0.67452 0.0 -0.52032\n3\n*\nO -0.0 -0.0 0.19309\nH -0.70205 -0.0 -0.50896\nH 0.70205 -0.0 -0.50896\n3\n*\nO 0.0 0.0 0.16994\nH -0.72825 0.0 -0.49739\nH 0.72825 -0.0 -0.49739\n3\n*\nO 0.0 0.0 0.14631\nH -0.75304 -0.0 -0.48557\nH 0.75304 0.0 -0.48557\n3\n*\nO -0.0 0.0 0.1222\nH -0.77635 0.0 -0.47352\nH 0.77635 -0.0 -0.47352\n3\n*\nO -0.0 -0.0 0.09762\nH -0.79812 0.0 -0.46123\nH 0.79812 -0.0 -0.46123\n3\n*\nO -0.0 0.0 0.07261\nH -0.81834 0.0 -0.44872\nH 0.81834 -0.0 -0.44872\n3\n*\nO -0.0 0.0 0.0472\nH -0.83696 -0.0 -0.43602\nH 0.83696 0.0 -0.43602\n3\n*\nO -0.0 -0.0 0.0214\nH -0.85391 0.0 -0.42312\nH 0.85391 -0.0 -0.42312\n3\n*\nO 0.0 -0.0 -0.00477\nH -0.8691 0.0 -0.41003\nH 0.8691 -0.0 -0.41003\n3\n*\nO -0.0 0.0 -0.03123\nH -0.88256 -0.0 -0.3968\nH 0.88256 0.0 -0.3968\n3\n*\nO -0.0 -0.0 -0.05793\nH -0.89437 -0.0 -0.38345\nH 0.89437 0.0 -0.38345\n3\n*\nO 0.0 0.0 -0.08482\nH -0.90452 0.0 -0.37001\nH 0.90452 -0.0 -0.37001\n3\n*\nO 0.0 0.0 -0.11182\nH -0.91318 -0.0 -0.35651\nH 0.91318 0.0 -0.35651\n3\n*\nO 0.0 -0.0 -0.13892\nH -0.92034 -0.0 -0.34296\nH 0.92034 -0.0 -0.34296\n3\n*\nO -0.0 0.0 -0.16608\nH -0.9261 0.0 -0.32938\nH 0.9261 -0.0 -0.32938\n3\n*\nO 0.0 -0.0 -0.19327\nH -0.93056 0.0 -0.31578\nH 0.93056 -0.0 -0.31578\n3\n*\nO 0.0 0.0 -0.22048\nH -0.93376 0.0 -0.30218\nH 0.93376 0.0 -0.30218\n3\n*\nO 0.0 -0.0 -0.24771\nH -0.93564 -0.0 -0.28856\nH 0.93564 -0.0 -0.28856\n");
	viewer_1669304819921948.animate({"loop": "backAndFirth"});
	viewer_1669304819921948.setStyle({"stick": {}});
	viewer_1669304819921948.rotate(-90,"x");
viewer_1669304819921948.render();
});
</script></div></div>
</div>
<section id="id1">
<h3>Harmonic fit<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Fitting with a harmonic function, focusing on an interval with equal energy end-points:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fitting for minima +20 kJ/mol</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_e</span><span class="p">)):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">angle_e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">20.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">angle_indx</span><span class="p">):</span>
        <span class="n">i_min_a</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">angle_e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">20.0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">angle_indx</span><span class="p">):</span>
        <span class="n">i_max_a</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">opt_harm_angle</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
    <span class="n">harm_func</span><span class="p">,</span> <span class="n">angle_a</span><span class="p">[</span><span class="n">i_min_a</span><span class="p">:</span><span class="n">i_max_a</span><span class="p">],</span> <span class="n">angle_e</span><span class="p">[</span><span class="n">i_min_a</span><span class="p">:</span><span class="n">i_max_a</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;l_0 / k_s from fit: </span><span class="si">{:04.3f}</span><span class="s2"> / </span><span class="si">{:7f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">opt_harm_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;B3LYP angle: </span><span class="si">{:04.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angle_a</span><span class="p">[</span><span class="n">angle_indx</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">angle_a</span><span class="p">,</span> <span class="n">angle_e</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># plot spline B3LYP results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">harm_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">opt_harm_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_harm_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">90</span><span class="p">,</span> <span class="mi">135</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;B3LYP&quot;</span><span class="p">,</span> <span class="s2">&quot;Harmonic fit&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Angle&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>l_0 / k_s from fit: 108.814 / 0.126546
B3LYP angle: 110.0
</pre></div>
</div>
<img alt="../../_images/forcefields_17_1.png" src="../../_images/forcefields_17_1.png" />
</div>
</div>
<p>The real angle bending interaction is clearly not a harmonic oscillator, as exemplified by the potential energy curve in below Figure, showing the change in energy when distorting the H–O–H angle found in water. Compressing the angle causes the two hydrogen atoms to come close together, leading to a steep curve near <span class="math notranslate nohighlight">\(\theta = 0^\circ\)</span>, while increasing the angle leads to a cusp at <span class="math notranslate nohighlight">\(\theta = 180^\circ\)</span> due to symmetry. Again, some force fields account for this anharmonicity with additional terms, such as the MM3 angle bending term:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\begin{split}
{E_\theta} = \frac{k_\theta}{2} (\theta - \theta_0)^2 \bigl( 1 &amp;- \alpha (\theta - \theta_0) + \beta (\theta - \theta_0)^2  \\
 &amp; - \gamma (\theta - \theta_0)^3 + \delta (\theta - \theta_0)^4 \bigr)
\end{split}
\end{equation*}\]</div>
<p>where the constants have been fitted to experimental data but are the same for all bending interactions. This gives a better agreement with the actual angle bending behaviour, but again, for lower temperatures the harmonic oscillator is still a valid and computationally efficient approximation.</p>
</section>
</section>
<section id="torsion">
<h2>Torsion<a class="headerlink" href="#torsion" title="Permalink to this headline">#</a></h2>
<p>When two atoms are bonded to atoms on opposite sides of a central bond, as for the opposing hydrogen atoms in ethane, then twisting these around the central bond can cause a change in the potential energy. The torsional energy is thus a function of the dihedral angle, <span class="math notranslate nohighlight">\(\omega\)</span>, formed between the first and fourth atom, while looking through the bond between the second and third atoms:</p>
<figure class="align-default" id="fig-mm-torsion">
<a class="reference internal image-reference" href="../../_images/MM_torsion.svg"><img alt="../../_images/MM_torsion.svg" src="../../_images/MM_torsion.svg" width="300px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 22 </span><span class="caption-text">Torsion.</span><a class="headerlink" href="#fig-mm-torsion" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The torsion energy term is usually expressed in terms of a Fourier expansion of the form</p>
<div class="math notranslate nohighlight">
\[
{E_\omega} = k_\omega \left(1 + \cos(n\omega -\delta)\right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(k_\omega\)</span> is a force constant, <span class="math notranslate nohighlight">\(n\)</span> is the periodicity and <span class="math notranslate nohighlight">\(\delta\)</span> is a phase shift. Typically, several such terms are included for each set of four atoms in order to combine different multiplicities. The MM3 force field always includes terms of multiplicity 1, 2 and 3, with <span class="math notranslate nohighlight">\(\delta\)</span> set to zero for each, while the CHARMM force field allows a more varied combination of terms.</p>
<p>It should be noted that the torsional energy of the force field does not come from a single interaction in this case, but several. It is easy to see that torsional interactions can quickly become very complicated when there are many atom types involved. This is further complicated by the fact that most force field also include non-bonded interactions between atoms separated by more than two bonds, meaning that the true rotational barrier will be a sum of all torsional and non-bonded interactions. For calculations where both the conformations themselves as well as the transitions between them are important, it is necessary to recreate the full potential energy curve and not just focus on the regions around the minima, as was done for bond stretching and angle bending terms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up the molecule and basis set</span>
<span class="n">ethane_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">C       0.0000000000     0.0000000000     0.7616375820</span>
<span class="s2">C       0.0000000000     0.0000000000    -0.7616375820</span>
<span class="s2">H       1.0145603421     0.0000000000     1.1557300969</span>
<span class="s2">H      -0.5072801711    -0.8786350299     1.1557300969</span>
<span class="s2">H      -0.5072801711     0.8786350299     1.1557300969</span>
<span class="s2">H       0.5072801711    -0.8786350299    -1.1557300969</span>
<span class="s2">H       0.5072801711     0.8786350299    -1.1557300969</span>
<span class="s2">H      -1.0145603421    -0.0000000000    -1.1557300969</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Create veloxchem mol and basis objects</span>
<span class="n">mol_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">ethane_xyz</span><span class="p">)</span>
<span class="n">bas_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="s2">&quot;STO-3G&quot;</span><span class="p">)</span>

<span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="n">bas_vlx</span><span class="p">)</span>

<span class="c1"># Set up the gradient and optimization dirvers:</span>
<span class="n">grad_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfGradientDriver</span><span class="p">(</span><span class="n">scf_drv</span><span class="p">)</span>
<span class="n">opt_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OptimizationDriver</span><span class="p">(</span><span class="n">grad_drv</span><span class="p">)</span>

<span class="n">dihed_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">dihed_e</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dihed_xyz</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">dihedral</span> <span class="ow">in</span> <span class="n">dihed_a</span><span class="p">:</span>
    <span class="n">dihedral_scan</span> <span class="o">=</span> <span class="s2">&quot;dihedral 3 1 2 6 </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dihedral</span><span class="p">,</span> <span class="n">dihedral</span><span class="p">)</span>
    <span class="n">opt_drv</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$scan&quot;</span><span class="p">,</span> <span class="n">dihedral_scan</span><span class="p">]</span>

    <span class="c1"># Run the scan</span>
    <span class="n">opt_molecule</span> <span class="o">=</span> <span class="n">opt_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="n">bas_vlx</span><span class="p">)</span>
    <span class="n">dihed_xyz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt_molecule</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">())</span>
    <span class="n">dihed_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>

<span class="c1"># convert to kJ/mol and shift to zero</span>
<span class="n">dihed_e</span> <span class="o">=</span> <span class="mf">2600.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dihed_e</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">dihed_e</span><span class="p">))</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dihed_a</span><span class="p">,</span> <span class="n">dihed_e</span><span class="p">,</span> <span class="s2">&quot;o--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#1f77b4&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">dihed_a</span><span class="p">,</span> <span class="n">dihed_e</span><span class="p">,</span> <span class="s2">&quot;o--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#1f77b4&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Dihedral angle&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy [kJ/mol]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">structure</span> <span class="o">=</span> <span class="n">vlx2py3d</span><span class="p">([</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">dihed_xyz</span><span class="p">)</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">p3d</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">setViewStyle</span><span class="p">({</span><span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;outline&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">addModelsAsFrames</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">animate</span><span class="p">({</span><span class="s2">&quot;loop&quot;</span><span class="p">:</span> <span class="s2">&quot;backAndForth&quot;</span><span class="p">})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s2">&quot;stick&quot;</span><span class="p">:</span> <span class="p">{}})</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/forcefields_22_0.png" src="../../_images/forcefields_22_0.png" />
<div class="output text_html"><div id="3dmolviewer_16693048202934577"  style="position: relative; width: 600px; height: 300px">
        <p id="3dmolwarning_16693048202934577" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
      resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdn.jsdelivr.net/npm/3dmol@latest/build/3Dmol-min.min.js');
}

var viewer_16693048202934577 = null;
var warn = document.getElementById("3dmolwarning_16693048202934577");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16693048202934577 = $3Dmol.createViewer($("#3dmolviewer_16693048202934577"),{backgroundColor:"white"});
viewer_16693048202934577.zoomTo();
	viewer_16693048202934577.setViewStyle({"style": "outline", "color": "black", "width": 0.1});
	viewer_16693048202934577.addModelsAsFrames("8\n*\nC 2e-05 1e-05 0.77083\nC -2e-05 -4e-05 -0.77083\nH 0.87251 -0.50362 1.16997\nH -0.87233 -0.50387 1.16997\nH -0.00018 1.00743 1.16997\nH 0.87239 -0.50382 -1.16997\nH 0.00018 1.00738 -1.16997\nH -0.87257 -0.50358 -1.16996\n8\n*\nC 0.00076 0.00152 0.77071\nC -0.00095 -0.00144 -0.77071\nH 0.8949 -0.46287 1.16959\nH -0.84524 -0.54589 1.16988\nH -0.05021 1.0075 1.16967\nH 0.84828 -0.54358 -1.1696\nH 0.05011 1.00494 -1.16987\nH -0.89765 -0.46029 -1.16966\n8\n*\nC 0.00125 0.00296 0.77036\nC -0.00196 -0.00258 -0.77036\nH 0.9154 -0.42143 1.16852\nH -0.81666 -0.5862 1.16936\nH -0.09967 1.00512 1.16903\nH 0.82265 -0.58206 -1.16853\nH 0.09931 1.00034 -1.16935\nH -0.92032 -0.41626 -1.16902\n8\n*\nC 0.00147 0.00424 0.76982\nC -0.00296 -0.00341 -0.76982\nH 0.93398 -0.37948 1.16687\nH -0.78693 -0.62454 1.16841\nH -0.14812 1.00035 1.16814\nH 0.7956 -0.61911 -1.16688\nH 0.14737 0.99377 -1.16841\nH -0.94042 -0.37191 -1.16813\n8\n*\nC 0.00145 0.00522 0.76914\nC -0.00382 -0.00387 -0.76914\nH 0.95051 -0.3373 1.16484\nH -0.75656 -0.66062 1.16714\nH -0.19499 0.99331 1.16706\nH 0.76734 -0.65452 -1.16485\nH 0.19381 0.9855 -1.16713\nH -0.95775 -0.3278 -1.16705\n8\n*\nC 0.00122 0.00582 0.76838\nC -0.00445 -0.00398 -0.76838\nH 0.96502 -0.29501 1.16264\nH -0.72582 -0.6944 1.16563\nH -0.24001 0.98418 1.16584\nH 0.73797 -0.68822 -1.16265\nH 0.23843 0.97578 -1.16563\nH -0.97235 -0.28424 -1.16583\n8\n*\nC 0.00088 0.00602 0.76762\nC -0.00479 -0.00377 -0.76762\nH 0.97749 -0.2527 1.16048\nH -0.6949 -0.72594 1.16398\nH -0.2831 0.97316 1.16456\nH 0.70757 -0.72018 -1.1605\nH 0.2812 0.96477 -1.16398\nH -0.98435 -0.24141 -1.16455\n8\n*\nC 0.00049 0.0058 0.76688\nC -0.0048 -0.00333 -0.76688\nH 0.98797 -0.21039 1.15858\nH -0.66386 -0.75537 1.16231\nH -0.32427 0.96043 1.16324\nH 0.67617 -0.75041 -1.1586\nH 0.32221 0.95261 -1.16231\nH -0.99392 -0.19939 -1.16323\n8\n*\nC 0.00014 0.0052 0.76623\nC -0.00445 -0.00272 -0.76623\nH 0.99646 -0.16819 1.15709\nH -0.63277 -0.78278 1.16073\nH -0.36353 0.94618 1.16191\nH 0.64386 -0.77886 -1.15711\nH 0.36149 0.93939 -1.16072\nH -1.0012 -0.15826 -1.1619\n8\n*\nC -0.00012 0.00424 0.76569\nC -0.00375 -0.00201 -0.76569\nH 1.003 -0.12602 1.15615\nH -0.60152 -0.80839 1.15933\nH -0.40111 0.9305 1.16059\nH 0.61061 -0.80561 -1.15617\nH 0.3993 0.92513 -1.15932\nH -1.00641 -0.11787 -1.16058\n8\n*\nC -0.00025 0.003 0.76529\nC -0.00274 -0.00128 -0.76529\nH 1.00761 -0.08396 1.15581\nH -0.57002 -0.83229 1.1582\nH -0.43714 0.9135 1.15931\nH 0.5765 -0.83062 -1.15583\nH 0.43575 0.90981 -1.15819\nH -1.00971 -0.07817 -1.15929\n8\n*\nC -0.0002 0.00156 0.76504\nC -0.00147 -0.0006 -0.76504\nH 1.0103 -0.04192 1.15612\nH -0.53806 -0.85469 1.15741\nH -0.47191 0.89519 1.1581\nH 0.54143 -0.85398 -1.15613\nH 0.47114 0.89333 -1.15741\nH -1.01123 -0.0389 -1.15809\n8\n*\nC 0.0 0.0 0.76494\nC -0.0 -0.0 -0.76494\nH 1.0111 -0.0 1.15702\nH -0.50555 -0.87564 1.15703\nH -0.50555 0.87564 1.15703\nH 0.50555 -0.87564 -1.15703\nH 0.50555 0.87564 -1.15703\nH -1.0111 -0.0 -1.15702\n");
	viewer_16693048202934577.animate({"loop": "backAndForth"});
	viewer_16693048202934577.setStyle({"stick": {}});
	viewer_16693048202934577.rotate(25,"x");
	viewer_16693048202934577.rotate(25,"y");
viewer_16693048202934577.render();
});
</script></div></div>
</div>
</section>
<section id="electrostatic-interaction">
<h2>Electrostatic interaction<a class="headerlink" href="#electrostatic-interaction" title="Permalink to this headline">#</a></h2>
<p>The non-bonded force field interactions are divided into electrostatic interactions, caused by static multipoles, and van der Waals interactions, containing everything else. For most force fields, only point charges are used in the electrostatic interactions, resulting in an energy given simply by the Coulomb interaction</p>
<div class="math notranslate nohighlight">
\[
{E_\mathrm{el}} = \frac{q_i q_j}{4\pi \epsilon_0 r_{ij}},
\]</div>
<p>where <span class="math notranslate nohighlight">\(q_i\)</span> and <span class="math notranslate nohighlight">\(q_j\)</span> are the partial charges of the interacting atoms, <span class="math notranslate nohighlight">\(r_{ij}\)</span> is the distance between them and <span class="math notranslate nohighlight">\(\epsilon_0\)</span> is the vacuum permittivity. It is also possible to use higher order multipoles, an example of which can be found in the MM3 force field, where dipole moments are assigned to each bonded pair. This gives the advantage of a more flexible description, as the dipoles depend on the types of both involved atoms, but requires additional parametrization and has difficulty dealing with ionic systems.</p>
</section>
<section id="van-der-waals-interaction">
<h2>van der Waals interaction<a class="headerlink" href="#van-der-waals-interaction" title="Permalink to this headline">#</a></h2>
<p>The van der Waals interaction is typically represented by two terms. One due to exchange interaction, causing a strong repulsion at close distances, and one that is due to London dispersion, resulting in a weak attraction at longer distances. The most commonly used form is the [Lennard-Jones potential]:</p>
<div class="math notranslate nohighlight">
\[
{E_\mathrm{vdw}} = \epsilon \left[ \left( \frac{r_\text{min}}{r} \right)^{12} - 2 \left( \frac{r_\text{min}}{r} \right)^6 \right]
\]</div>
<p>\noindent where <span class="math notranslate nohighlight">\(\epsilon\)</span> is the depth of the potential well, usually created as the mean of two parameters specific to the two interacting atom types, <span class="math notranslate nohighlight">\(r_\text{min}\)</span> is the position of the bottom of the well and <span class="math notranslate nohighlight">\(r\)</span> is the interatomic distance. While it is possible to motivate the use of <span class="math notranslate nohighlight">\(r^{-6}\)</span> for the attractive part, the use of <span class="math notranslate nohighlight">\(r^{-12}\)</span> for the repulsive part is more pragmatic in origin, having that form simply because it is the square of <span class="math notranslate nohighlight">\(r^{-6}\)</span>, making its computation highly efficient. It can be argued[cite jensen2006] that an exponential form is more realistic, such as the [Buckingham potential]used in MM3:</p>
<div class="math notranslate nohighlight">
\[
{E_\mathrm{vdw}} = A e^{- B r} - \frac{C}{r^{-6}}
\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span>, <span class="math notranslate nohighlight">\(B\)</span>, and <span class="math notranslate nohighlight">\(C\)</span> are constants. Calculating this expression is more demanding than the Lennard-Jones (LJ) potential, but produces a repulsive force that is closer to what is found using \emph{ab initio} methods. For very short interatomic distances, however, the Buckingham potential becomes strongly attractive, which can lead to highly unphysical behaviour for systems in unfavourable starting positions.</p>
</section>
<section id="additional-terms">
<h2>Additional terms<a class="headerlink" href="#additional-terms" title="Permalink to this headline">#</a></h2>
<p>Depending on what the force field is intended for, many additional terms can be added to the potential energy function. Cross-terms are a common addition, accounting for more complex couplings between structural properties. Examples of these can be found in the MM3 force field, which contains stretch–bend, torsion–stretch and bend–bend interactions. As an example, the stretch–bend interaction accounts for the fact that compressing an angle formed by three bonded atoms will cause the repulsion between the two end atoms to increase, resulting in an elongation of their bonds to the middle atom. Another example of such structural corrections comes in the form of the out-of-plane term. If three or four atoms are bonded to a central atom with their equilibrium position in a plane, as for e.g.\ formaledehyde, the change in energy caused by a distortion of the central atom out of the plane is hard to model by just angle bending terms, as the individual angle distortions are small. The out-of-plane term instead depends on the angles formed between the plane and the bonds connecting the central and outer atoms. This is shown in below Figure, where the <span class="math notranslate nohighlight">\(\chi\)</span> is an example of an out-of-plane angle.</p>
<figure class="align-default" id="fig-mm-outofplane">
<a class="reference internal image-reference" href="../../_images/MM_outofplane.svg"><img alt="../../_images/MM_outofplane.svg" src="../../_images/MM_outofplane.svg" width="300px" /></a>
<figcaption>
<p><span class="caption-number">Fig. 23 </span><span class="caption-text">Out-of-plane bending.</span><a class="headerlink" href="#fig-mm-outofplane" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs/mol_struct"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="coordinates.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Choice of coordinates</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="gradients.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Gradients</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The eChem team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>