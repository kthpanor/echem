

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Exercises &#8212; Computational Chemistry from  Laptop to HPC</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-TX4YJ1J5XE"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TX4YJ1J5XE');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/elec_struct/wft_exercises';</script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Density functional theory" href="dft.html" />
    <link rel="prev" title="Multiconfigurational methods" href="mcscf.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../title.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics_notebook.html">Using Jupyter notebooks</a></li>







<li class="toctree-l2"><a class="reference internal" href="../units_notation.html">Units and notation</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Electronic ground states</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="elstruct_gen.html">General aspects</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="orbitals.html">Orbitals and basis sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="slater.html">Many-electron wave functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="operators.html">Operators and matrix elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="reduced_density.html">Reduced particle densities</a></li>
<li class="toctree-l2"><a class="reference internal" href="natural_orbitals.html">Natural orbitals</a></li>
<li class="toctree-l2"><a class="reference internal" href="integrals.html">Integrals</a></li>
<li class="toctree-l2"><a class="reference internal" href="spin.html">Electron spin</a></li>
<li class="toctree-l2"><a class="reference internal" href="correlation.html">Electron correlation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dispersion.html">Dispersion interactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="pt.html">Rayleigh–Schrödinger perturbation theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="second_quant.html">Second quantization</a></li>
<li class="toctree-l2"><a class="reference internal" href="group_theory.html">Group theory</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="wft.html">Wave function theory</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="hartree-fock.html">Hartree–Fock</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="hf_theory.html">Hartree–Fock theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="hf_scf.html">SCF optimization</a></li>

<li class="toctree-l3"><a class="reference internal" href="hf_example.html">HF in VeloxChem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ci.html">Configuration interaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="mp2.html">Møller–Plesset</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcscf.html">Multiconfigurational methods</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="dft.html">Density functional theory</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="hohenberg.html">Hohenberg–Kohn theorems</a></li>
<li class="toctree-l2"><a class="reference internal" href="kohn-sham.html">Kohn–Sham method</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_int.html">Kernel integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="dft_scf.html">SCF optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="dft_prop.html">First-order properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="available_xcfun.html">Available XC functionals</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Molecular structure and dynamics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/molstruct_gen.html">General aspects</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/coordinates.html">Choice of coordinates</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/gradients.html">Gradients</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/energy_grad.html">Energy gradients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/property_grad.html">Property gradients</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/hessians_vib.html">Hessians and vibrations</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/hessians.html">Molecular Hessians</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/vibrations.html">Vibrational analysis</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/opt.html">Structure optimization</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/opt_struct.html">Optimization methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/opt_gs.html">Ground-state structure optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/tst.html">Transition-state theory</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/tst_gen.html">Transition state geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/impes.html">PES interpolation techniques</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/impes_calc.html">Constructing the PES by interpolation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mol_struct/md.html">Molecular dynamics</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/forcefields.html">Force fields</a></li>


<li class="toctree-l2"><a class="reference internal" href="../mol_struct/reparameterize.html">Reparameterize force fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/md_setup.html">Ensembles and time integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mol_struct/md_run.html">Running a simulation</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Spectra and properties</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../spec_prop/spectra_aspects.html">General aspects</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/resp_external.html">Responses to external fields</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../spec_prop/mol_prop.html">Molecular properties</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../spec_prop/first_order.html">First-order properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec_prop/linear_resp.html">Linear Response</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec_prop/quad_resp.html">Quadratic response function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec_prop/cubic_resp.html">Cubic response function</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../spec_prop/elec_nuc.html">Electronic and nuclear contributions</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../spec_prop/rovib.html">Rovibronic states</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/selection_rules.html">Selection rules</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../spec_prop/expt_theory.html">Experiment to theory</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/opa.html">UV/vis absorption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/dichroism.html">Dichroism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/tpa.html">Two-photon absorption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/birefring.html">Birefringence</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../spec_prop/tddft.html">TDDFT</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/tddft_basics.html">Foundations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/tddft_rpa.html">Spectrum calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/tddft_exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../spec_prop/mr_response.html">Multireference response</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/ci_response.html">CI response</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/sa_mcscf.html">State-averaged MCSCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/mclr.html">Multiconfigurational linear response</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/mr_exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../spec_prop/adc.html">ADC</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/adc_pp.html">Polarization propagator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/adc_isr.html">Intermediate state representation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/adc_cvs.html">Core-valence separation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/adc_hpc.html">HPC-QC implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/adc_exercises_new.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../spec_prop/excoupl.html">Exciton coupling model</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec_prop/excoupl_impl.html">Implementation of the exciton coupling model</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Environment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../env/localprop.html">Localized properties</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../env/esp.html">ESP charges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env/resp.html">RESP charges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env/loprop.html">LoProp charges and polarisabilities</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../env/embedding.html">Embedding potentials</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../env/nonpol_emb.html">Non-polarizable embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../env/pol_emb.html">Polarizable embedding</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../visualize/mol_struct.html">Molecular structure and dynamics</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualize/struct_vis.html">Molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualize/md_vis.html">MD trajectories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualize/opt_vib_vis.html">Optimization and normal modes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../visualize/elec_struct.html">Electronic structure</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualize/orb_vis.html">Orbitals and densities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualize/exc_vis.html">Excited states</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../visualize/spec_prop.html">Spectra and properties</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-25"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualize/broadening.html">Spectrum broadening</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials and workflows</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/workflow.html">Constructing workflows</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-26"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/wf_build.html">Building systems</a></li>

<li class="toctree-l2"><a class="reference internal" href="../tutorials/wf_struct.html">Optimizing molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/wf_scf.html">Optimizing electronic structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/wf_construct.html">Assembling a full workflow</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/uv_vis.html">UV/vis spectroscopies</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-27"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/uv_vis_absorption.html">Absorption</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/uv_vis_fluorescence.html">Fluorescence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/uv_vis_analysis.html">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/uv_vis_rec.html">Recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/uv_vis_exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/vib_ir.html">Vibrational spectroscopies</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-28"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/vib_ir_calc.html">IR spectroscopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/vib_ir_raman.html">Raman spectroscopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/vib_ir_exercises.html">Exercises</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/openshells.html">Open shells</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-29"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/rest_unrest.html">Restricted versus unrestricted</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/correlation.html">Static versus dynamic correlation correlation</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials/xray.html">X-ray spectroscopies</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-30"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_calc.html">Spectrum calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_analysis.html">Spectrum analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_aspects.html">Special aspects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_large.html">Larger systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_nonstandard.html">Non-standard calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_rec.html">Recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/xray_cheatsheet.html">Cheat sheet</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bibliography</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cite.html">How to cite and contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/kthpanor/echem" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/elec_struct/wft_exercises.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/docs/elec_struct/wft_exercises.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Exercises</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hartree-fock">Hartree-Fock</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-interaction">Configuration interaction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-particle-density-matrix">One-particle density matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#several-states">Several states</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mp2">MP2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-closed-shell-mp2-energy-correction">Calculate the closed-shell MP2 energy correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-mp2-amplitudes">Calculate the MP2 amplitudes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-mp2-energy-correction-using-the-t-amplitudes">Calculate the MP2 energy correction using the <span class="math notranslate nohighlight">\(t\)</span> amplitudes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#o-h-dissociation-potential-energy-curve">O–H dissociation potential energy curve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dipole-moment">Dipole moment</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hf-dipole-moment">HF dipole moment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unrelaxed-mp2-dipole-moment">Unrelaxed MP2 dipole moment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#approximate-relaxed-mp2-dipole-moment">Approximate relaxed MP2 dipole moment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-hf-and-mp2-dipole-moment">Numerical HF and MP2 dipole moment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcscf">MCSCF</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ozone">Ozone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chromium-dimer">Chromium dimer</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="exercises">
<h1>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h1>
<section id="hartree-fock">
<h2>Hartree-Fock<a class="headerlink" href="#hartree-fock" title="Permalink to this heading">#</a></h2>
</section>
<section id="configuration-interaction">
<span id="sec-ci-exercises"></span><h2>Configuration interaction<a class="headerlink" href="#configuration-interaction" title="Permalink to this heading">#</a></h2>
<section id="one-particle-density-matrix">
<h3>One-particle density matrix<a class="headerlink" href="#one-particle-density-matrix" title="Permalink to this heading">#</a></h3>
<p>In this exercise, we are going to compute the one-particle density matrix for a CI wavefunction. The structure of the code is very similar to that of the energy, and actually, the energy can be computed directly from the one- and two-particle density matrix.</p>
<p>As a reminder, the density matrix (in molecular orbital basis) is defined in second quantization as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
D_{pq} = \langle 0 | \hat{a}_p^\dagger \hat{a}_q | 0 \rangle
\end{equation*}\]</div>
<p>This is indeed very similar to the one-electron part of the <span class="math notranslate nohighlight">\(\sigma\)</span> vector:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\sigma^{(1)} = \sum_{pq} \hat{a}_p^\dagger \hat{a}_q | 0 \rangle h_{pq}
\end{equation*}\]</div>
<p>The difference then with the sigma algorithm is that instead of adding the <span class="math notranslate nohighlight">\(h_{ia}\)</span> integral to the <span class="math notranslate nohighlight">\(\sigma\)</span> vector, we store the product of the coefficients (<code class="docutils literal notranslate"><span class="pre">vector[idet]</span></code> and <code class="docutils literal notranslate"><span class="pre">vector[excdet.index()]</span></code>) in the “i,a” position of the density matrix. Note that the diagonal term <span class="math notranslate nohighlight">\(D_{pp}\)</span> includes a loop over all occupied <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> orbitals.</p>
<p>First let’s initialize our calculations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">multipsi</span> <span class="k">as</span> <span class="nn">mtp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">O2_xyz</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;2</span>
<span class="s2">O2                                                                                                                         </span>
<span class="s2">O    0.000000000000        0.000000000000       -0.600000000000 </span>
<span class="s2">O    0.000000000000        0.000000000000        0.600000000000 </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_xyz_string</span><span class="p">(</span><span class="n">O2_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="s2">&quot;STO-3G&quot;</span><span class="p">)</span>

<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_results</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="n">molecule</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">space</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">OrbSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">space</span><span class="o">.</span><span class="n">cas</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">expansion</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">CIExpansion</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>

<span class="n">CI_drv</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">CIDriver</span><span class="p">()</span>
<span class="n">ci_results</span> <span class="o">=</span> <span class="n">CI_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
</pre></div>
</div>
<p>Now let’s implement the density matrix:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Den1</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
    <span class="n">DM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">space</span><span class="o">.</span><span class="n">n_active</span><span class="p">,</span><span class="n">space</span><span class="o">.</span><span class="n">n_active</span><span class="p">))</span>
    
    <span class="c1"># Loop over determinants</span>
    
    <span class="c1"># Diagonal term</span>
    
    <span class="c1"># Single excitations alpha</span>
    
    <span class="c1"># Single excitations beta</span>
    
    <span class="k">return</span> <span class="n">DM</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Check that the matrices match</span>
<span class="n">vec0</span> <span class="o">=</span> <span class="n">CI_drv</span><span class="o">.</span><span class="n">vecs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Dpq</span> <span class="o">=</span> <span class="n">Den1</span><span class="p">(</span><span class="n">vec0</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">Dpq</span><span class="p">,</span> <span class="n">CI_drv</span><span class="o">.</span><span class="n">get_active_density</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="several-states">
<h3>Several states<a class="headerlink" href="#several-states" title="Permalink to this heading">#</a></h3>
<p>Modify the direct CI algorithm to compute several states (defined by a variable nstates). For this example we will use 3 states. We initialize the calculation with the same code as in the CI section:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">multipsi</span> <span class="k">as</span> <span class="nn">mtp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">O2_xyz</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;2</span>
<span class="s2">O2                                                                                                                         </span>
<span class="s2">O    0.000000000000        0.000000000000       -0.600000000000 </span>
<span class="s2">O    0.000000000000        0.000000000000        0.600000000000 </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_xyz_string</span><span class="p">(</span><span class="n">O2_xyz</span><span class="p">)</span>
<span class="n">molecule</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;STO-3G&quot;</span><span class="p">)</span>

<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfUnrestrictedDriver</span><span class="p">()</span>
<span class="n">scf_results</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="n">space</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">OrbSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">space</span><span class="o">.</span><span class="n">fci</span><span class="p">(</span><span class="n">n_frozen</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">expansion</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">CIExpansion</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
<span class="n">CI_ham</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">CIOperator</span><span class="p">(</span><span class="n">expansion</span><span class="p">)</span> <span class="c1">#Contains integrals and functions using them</span>
<span class="n">CI_ham</span><span class="o">.</span><span class="n">compute_Hints</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="n">Ein</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">CI_ham</span><span class="o">.</span><span class="n">inEne</span><span class="p">)</span>
<span class="n">Ftu</span> <span class="o">=</span> <span class="n">CI_ham</span><span class="o">.</span><span class="n">Ftu</span>
<span class="n">tuvw</span> <span class="o">=</span> <span class="n">CI_ham</span><span class="o">.</span><span class="n">tuvw</span>

<span class="k">def</span> <span class="nf">SC_diag</span><span class="p">(</span><span class="n">occa</span><span class="p">,</span> <span class="n">occb</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The energy of a given SD, as a function of its list of occupied orbitals</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Hij</span> <span class="o">=</span> <span class="n">Ein</span> <span class="c1">#Inactive energy (inc. nuclear repulsion)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occa</span><span class="p">:</span>
        <span class="n">Hij</span> <span class="o">+=</span> <span class="n">Ftu</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="c1">#1-e term = inactive Fock matrix</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">occa</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">Hij</span> <span class="o">+=</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="c1">#Coulomb-Exchange</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">occb</span><span class="p">:</span>
            <span class="n">Hij</span> <span class="o">+=</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occb</span><span class="p">:</span>
        <span class="n">Hij</span> <span class="o">+=</span> <span class="n">Ftu</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">occb</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">Hij</span> <span class="o">+=</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Hij</span>

<span class="k">def</span> <span class="nf">SC_1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">ss_occ</span><span class="p">,</span> <span class="n">os_occ</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Slater-Condon between a SD and a singly excited determinant, depending on the excited orbitals (i,a)</span>
<span class="sd">    and the same-spin (compared to spin of the excitated electron) and opposite-spin occupation</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Hij</span> <span class="o">=</span> <span class="n">Ftu</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ss_occ</span><span class="p">:</span>
        <span class="n">Hij</span> <span class="o">+=</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">a</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">os_occ</span><span class="p">:</span>
        <span class="n">Hij</span> <span class="o">+=</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Hij</span>

<span class="k">def</span> <span class="nf">SC_ss1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Slater-Condon between a SD and a doubly excited determinant,</span>
<span class="sd">    with both excited electrons having the same spin</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">]</span><span class="o">-</span><span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">a</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">SC_os1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Slater-Condon between a SD and a doubly excited determinant,</span>
<span class="sd">    with the excited electrons having opposite spin</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">tuvw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="n">vector</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">expansion</span><span class="o">.</span><span class="n">n_determinants</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idet</span><span class="p">,</span> <span class="n">det</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">expansion</span><span class="o">.</span><span class="n">determinant_list</span><span class="p">()):</span>
        <span class="c1">#Diagonal term</span>
        <span class="n">result</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span> <span class="o">+=</span> <span class="n">SC_diag</span><span class="p">(</span><span class="n">det</span><span class="o">.</span><span class="n">occ_alpha</span><span class="p">(),</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_beta</span><span class="p">())</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span>
        <span class="c1">#Single excitations alpha</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_alpha</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">unocc_alpha</span><span class="p">():</span>
                <span class="n">phase</span><span class="p">,</span> <span class="n">excdet</span> <span class="o">=</span> <span class="n">det</span><span class="o">.</span><span class="n">excite_alpha</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">excdet</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">SC_1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_alpha</span><span class="p">(),</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_beta</span><span class="p">())</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span>
                <span class="c1">#alpha-alpha excitation</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_alpha</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">j</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">unocc_alpha</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">phase2</span><span class="p">,</span> <span class="n">exc2det</span><span class="o">=</span><span class="n">excdet</span><span class="o">.</span><span class="n">excite_alpha</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">exc2det</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">phase2</span> <span class="o">*</span> <span class="n">SC_ss1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span>
                <span class="c1">#alpha-beta excitation</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_beta</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">unocc_beta</span><span class="p">():</span>
                        <span class="n">phase2</span><span class="p">,</span> <span class="n">exc2det</span><span class="o">=</span><span class="n">excdet</span><span class="o">.</span><span class="n">excite_beta</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">exc2det</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">phase2</span> <span class="o">*</span> <span class="n">SC_os1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span>
        <span class="c1">#Single excitations beta</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_beta</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">unocc_beta</span><span class="p">():</span>
                <span class="n">phase</span><span class="p">,</span> <span class="n">excdet</span> <span class="o">=</span> <span class="n">det</span><span class="o">.</span><span class="n">excite_beta</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">excdet</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">SC_1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_beta</span><span class="p">(),</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_alpha</span><span class="p">())</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span>
                <span class="c1">#beta-beta excitation</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">occ_beta</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">j</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">det</span><span class="o">.</span><span class="n">unocc_beta</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">phase2</span><span class="p">,</span> <span class="n">exc2det</span> <span class="o">=</span> <span class="n">excdet</span><span class="o">.</span><span class="n">excite_beta</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">exc2det</span><span class="o">.</span><span class="n">index</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">phase2</span> <span class="o">*</span> <span class="n">SC_ss1exc</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[</span><span class="n">idet</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float_kind&#39;</span><span class="p">:</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">})</span>

</pre></div>
</div>
<p>Hints:</p>
<ul class="simple">
<li><p>for the starting guess: to obtain the indices of the nstates lowest elements of a numpy array A, you can use the command:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">A</span><span class="p">)[:</span><span class="n">nstates</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>for the most part, the difference is that we loop over nstates. The convergence is now based on the max of all residual norms. Finally, instead of only orthonormalizing with vec0, we need to make sure that all new vectors (“vec1”) are orthogonal with all previous vectors (“vec0”) and each others.</p></li>
</ul>
</section>
</section>
<section id="mp2">
<h2>MP2<a class="headerlink" href="#mp2" title="Permalink to this heading">#</a></h2>
<p>In this block, you will implement the MP2 correction to the energy yourself, the <span class="math notranslate nohighlight">\(t\)</span>-amplitudes,
look at the dissociation of one hydrogen atom in the water molecule, and calculate the dipole moment at the MP2 level of theory.</p>
<p>First, we define the water molecule and a corresponding basis set and run the SCF calculation.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Warning * Environment variable OMP_NUM_THREADS not set.
* Warning * Setting OMP_NUM_THREADS to 4.
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Molecule and basis set</span>
<span class="n">h2o_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;3</span>
<span class="s2">water</span>
<span class="s2">O    0.000000000000        0.000000000000        0.000000000000                         </span>
<span class="s2">H    0.000000000000        0.895700000000       -0.316700000000                         </span>
<span class="s2">H    0.000000000000        0.000000000000        1.100000000000</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_xyz_string</span><span class="p">(</span><span class="n">h2o_xyz</span><span class="p">)</span>

<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s2">&quot;cc-pvdz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Reading basis set from file: /home/thomas/miniconda3/envs/echem/lib/python3.10/site-packages/veloxchem/basis/CC-PVDZ
                                                                                                                          
                                              Molecular Basis (Atomic Basis)                                              
                                             ================================                                             
                                                                                                                          
                               Basis: CC-PVDZ                                                                             
                                                                                                                          
                               Atom Contracted GTOs           Primitive GTOs                                              
                                                                                                                          
                                O   (3S,2P,1D)                (17S,4P,1D)                                                 
                                H   (2S,1P)                   (4S,1P)                                                     
                                                                                                                          
                               Contracted Basis Functions : 24                                                            
                               Primitive Basis Functions  : 48                                                            
                                                                                                                          
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run SCF</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1e-8</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_dict</span><span class="p">)</span>
<span class="n">scf_results</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                            Self Consistent Field Driver Setup                                            
                                           ====================================                                           
                                                                                                                          
                   Wave Function Model             : Spin-Restricted Hartree-Fock                                         
                   Initial Guess Model             : Superposition of Atomic Densities                                    
                   Convergence Accelerator         : Two Level Direct Inversion of Iterative Subspace                     
                   Max. Number of Iterations       : 50                                                                   
                   Max. Number of Error Vectors    : 10                                                                   
                   Convergence Threshold           : 1.0e-08                                                              
                   ERI Screening Scheme            : Cauchy Schwarz + Density                                             
                   ERI Screening Mode              : Dynamic                                                              
                   ERI Screening Threshold         : 1.0e-12                                                              
                   Linear Dependence Threshold     : 1.0e-06                                                              
                                                                                                                          
* Info * Nuclear repulsion energy: 8.6203186612 a.u.                                                                      
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * SAD initial guess computed in 0.00 sec.                                                                          
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Starting Reduced Basis SCF calculation...                                                                        
* Info * ...done. SCF energy in reduced basis set: -75.967750958278 a.u. Time: 0.10 sec.                                  
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
               Iter. | Hartree-Fock Energy | Energy Change | Gradient Norm | Max. Gradient | Density Change               
               --------------------------------------------------------------------------------------------               
                  1       -76.005948791506    0.0000000000      0.08819569      0.00908510      0.00000000                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  2       -76.006788523866   -0.0008397324      0.01587875      0.00229123      0.02311808                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  3       -76.006822368240   -0.0000338444      0.00302392      0.00041159      0.00406423                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  4       -76.006824263501   -0.0000018953      0.00142432      0.00019179      0.00134617                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  5       -76.006824460225   -0.0000001967      0.00022897      0.00003053      0.00032047                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  6       -76.006824471637   -0.0000000114      0.00003192      0.00000359      0.00011275                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  7       -76.006824471899   -0.0000000003      0.00000424      0.00000052      0.00001731                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  8       -76.006824471904   -0.0000000000      0.00000133      0.00000018      0.00000221                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  9       -76.006824471905   -0.0000000000      0.00000031      0.00000005      0.00000096                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 10       -76.006824471905   -0.0000000000      0.00000003      0.00000001      0.00000026                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 11       -76.006824471905   -0.0000000000      0.00000001      0.00000000      0.00000002                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
               *** SCF converged in 11 iterations. Time: 1.79 sec.                                                        
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Spin-Restricted Hartree-Fock:                                                                              
               -----------------------------                                                                              
               Total Energy                       :      -76.0068244719 a.u.                                              
               Electronic Energy                  :      -84.6271431331 a.u.                                              
               Nuclear Repulsion Energy           :        8.6203186612 a.u.                                              
               ------------------------------------                                                                       
               Gradient Norm                      :        0.0000000081 a.u.                                              
                                                                                                                          
                                                                                                                          
               Ground State Information                                                                                   
               ------------------------                                                                                   
               Charge of Molecule            :  0.0                                                                       
               Multiplicity (2S+1)           :  1.0                                                                       
               Magnetic Quantum Number (M_S) :  0.0                                                                       
                                                                                                                          
                                                                                                                          
                                                 Spin Restricted Orbitals                                                 
                                                 ------------------------                                                 
                                                                                                                          
               Molecular Orbital No.   1:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.000 Energy:  -20.55817 a.u.                                                                  
               (   1 O   1s  :    -1.00)                                                                                  
                                                                                                                          
               Molecular Orbital No.   2:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.000 Energy:   -1.30651 a.u.                                                                  
               (   1 O   2s  :     0.45) (   1 O   3s  :     0.42) (   2 H   1s  :     0.20)                              
                                                                                                                          
               Molecular Orbital No.   3:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.000 Energy:   -0.67491 a.u.                                                                  
               (   1 O   1p-1:     0.34) (   1 O   1p0 :    -0.34) (   1 O   2p-1:     0.16)                              
               (   1 O   2p0 :    -0.17) (   2 H   1s  :     0.35) (   3 H   1s  :    -0.28)                              
                                                                                                                          
               Molecular Orbital No.   4:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.000 Energy:   -0.54267 a.u.                                                                  
               (   1 O   3s  :     0.30) (   1 O   1p-1:    -0.41) (   1 O   1p0 :    -0.35)                              
               (   1 O   2p-1:    -0.29) (   1 O   2p0 :    -0.25) (   2 H   1s  :    -0.16)                              
               (   3 H   1s  :    -0.23)                                                                                  
                                                                                                                          
               Molecular Orbital No.   5:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.000 Energy:   -0.48760 a.u.                                                                  
               (   1 O   1p+1:     0.63) (   1 O   2p+1:     0.50)                                                        
                                                                                                                          
               Molecular Orbital No.   6:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.000 Energy:    0.16910 a.u.                                                                  
               (   1 O   3s  :     0.90) (   1 O   1p0 :     0.19) (   1 O   2p-1:     0.19)                              
               (   1 O   2p0 :     0.32) (   2 H   2s  :    -0.58) (   3 H   2s  :    -0.96)                              
                                                                                                                          
               Molecular Orbital No.   7:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.000 Energy:    0.24659 a.u.                                                                  
               (   1 O   3s  :    -0.31) (   1 O   1p-1:    -0.18) (   1 O   1p0 :     0.22)                              
               (   1 O   2p-1:    -0.42) (   1 O   2p0 :     0.50) (   2 H   2s  :     1.50)                              
               (   3 H   2s  :    -1.06)                                                                                  
                                                                                                                          
               Molecular Orbital No.   8:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.000 Energy:    0.71803 a.u.                                                                  
               (   1 O   2s  :     0.16) (   1 O   3s  :    -0.23) (   1 O   1p0 :     0.29)                              
               (   1 O   2p0 :     0.15) (   2 H   2s  :    -0.20) (   3 H   1s  :    -1.27)                              
               (   3 H   2s  :     1.07) (   3 H   1p0 :    -0.19)                                                        
                                                                                                                          
               Molecular Orbital No.   9:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.000 Energy:    0.83056 a.u.                                                                  
               (   1 O   2s  :     0.18) (   1 O   1p-1:     0.28) (   1 O   2p-1:     0.26)                              
               (   1 O   2p0 :    -0.22) (   2 H   1s  :    -1.26) (   2 H   2s  :     0.82)                              
               (   2 H   1p-1:    -0.26) (   3 H   1p-1:     0.16)                                                        
                                                                                                                          
               Molecular Orbital No.  10:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.000 Energy:    1.15870 a.u.                                                                  
               (   1 O   3s  :    -0.63) (   1 O   1p-1:     0.72) (   1 O   1p0 :     0.29)                              
               (   1 O   2p-1:    -1.20) (   1 O   2p0 :    -0.24) (   2 H   1s  :     0.50)                              
               (   2 H   2s  :     0.37) (   2 H   1p-1:    -0.33) (   3 H   1s  :     0.26)                              
               (   3 H   1p-1:    -0.22)                                                                                  
                                                                                                                          
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some of the following variables will be useful later</span>

<span class="c1"># Number of orbitals, orbital energies, MO coefficients, ERIs in spatial MO basis (physicists&#39; notation)</span>
<span class="n">N_MO</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;C_alpha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">N_O</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">number_of_electrons</span><span class="p">()</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">N_V</span> <span class="o">=</span> <span class="n">N_MO</span> <span class="o">-</span> <span class="n">N_O</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">]</span>
<span class="c1"># epsilon_a - epsilon_i (as a 2D matrix)</span>
<span class="n">epsilon_ov</span> <span class="o">=</span> <span class="n">epsilon</span><span class="p">[</span><span class="n">N_O</span><span class="p">:]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">[:</span><span class="n">N_O</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># MO coefficients</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;C_alpha&quot;</span><span class="p">]</span>
<span class="n">C_occ</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span> <span class="p">:</span><span class="n">N_O</span><span class="p">]</span>
<span class="n">C_vir</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">N_O</span><span class="p">:]</span>

<span class="c1"># ERI</span>
<span class="n">moeridrv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MOIntegralsDriver</span><span class="p">()</span>
<span class="n">eri_oovv</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span> <span class="o">=</span> <span class="s2">&quot;chem_OOVV&quot;</span><span class="p">)</span>
<span class="n">eri_ooov</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span> <span class="o">=</span> <span class="s2">&quot;chem_OOOV&quot;</span><span class="p">)</span>
<span class="n">eri_ovvv</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span> <span class="o">=</span> <span class="s2">&quot;chem_OVVV&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="calculate-the-closed-shell-mp2-energy-correction">
<h3>Calculate the closed-shell MP2 energy correction<a class="headerlink" href="#calculate-the-closed-shell-mp2-energy-correction" title="Permalink to this heading">#</a></h3>
<ul>
<li><p>Implement the MP2 energy correction using the following equation valid for the closed-shell restricted case in spatial orbitals:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
    E_0^{(2)} = - \sum_{ijab} \frac{\langle ij | ab \rangle \langle ij | ab \rangle}{\varepsilon_a + \varepsilon_b - \varepsilon_i - \varepsilon_j}
    - \sum_{ijab} \frac{\langle ij | ab \rangle [ \langle ij | ab \rangle - \langle ij | ba \rangle]}{\varepsilon_a + \varepsilon_b - \varepsilon_i - \varepsilon_j} \, ,
  \end{equation*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\varepsilon_p\)</span> are HF orbital energies and <span class="math notranslate nohighlight">\(\langle pq | rs \rangle\)</span> are two-electron repulsion integrals in physicists’ notation.</p>
</li>
<li><p>The first term corresponds to the <em>opposite-spin</em>, the second one to the <em>same-spin</em> contribution.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_mp2_correction</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">sc_fdrv</span><span class="p">):</span>
    <span class="c1"># initialize energy contributions to zero</span>
    <span class="n">e_mp2_ss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">e_mp2_os</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># oovv integrals (spatial MO basis, physicists&#39; notation)</span>
    <span class="n">moeridrv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MOIntegralsDriver</span><span class="p">()</span>
    <span class="n">oovv</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span><span class="o">=</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span><span class="o">=</span><span class="s2">&quot;chem_OOVV&quot;</span><span class="p">)</span>
  
    <span class="c1"># extract the occupied subset of the orbital energies</span>
    <span class="n">e_ij</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][:</span><span class="n">N_O</span><span class="p">]</span>
    <span class="c1"># extract the virtual subset of the orbital energies</span>
    <span class="n">e_ab</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][</span><span class="n">N_O</span><span class="p">:]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_O</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_O</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_V</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_V</span><span class="p">):</span>
                    <span class="c1"># energy denominators</span>
                    <span class="n">e_ijab</span> <span class="o">=</span>  <span class="o">...</span>
                    
                    <span class="c1"># update opposite-spin component of the energy</span>
                    <span class="n">e_mp2_os</span> <span class="o">-=</span> <span class="o">...</span>
                    
                    <span class="c1"># update same-spin component of the energy</span>
                    <span class="n">e_mp2_ss</span> <span class="o">-=</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">e_mp2_ss</span><span class="p">,</span> <span class="n">e_mp2_os</span>

<span class="c1"># calculate the energy correction</span>
<span class="n">e_mp2_ss</span><span class="p">,</span> <span class="n">e_mp2_os</span> <span class="o">=</span> <span class="n">get_mp2_correction</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">)</span>

<span class="c1"># print and sum up the contributions</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Can you think of a way to make the calculation of <span class="math notranslate nohighlight">\(E_0^{(2)}\)</span> more efficient by avoiding the last two for-loops over <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> by using matrix algebra from Python or numpy?</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_mp2_correction</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">):</span>
    <span class="n">e_mp2_ss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">e_mp2_os</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># oovv integrals (spatial MO basis, physicists&#39; notation)</span>
    <span class="n">moeridrv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MOIntegralsDriver</span><span class="p">()</span>
    <span class="n">oovv</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span><span class="o">=</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span><span class="o">=</span><span class="s2">&quot;chem_OOVV&quot;</span><span class="p">)</span>
  
    <span class="c1"># extract the occupied subset of the orbital energies</span>
    <span class="n">e_occ</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][:</span><span class="n">N_O</span><span class="p">]</span>
    <span class="c1"># extract the virtual subset of the orbital energies</span>
    <span class="n">e_vir</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][</span><span class="n">N_O</span><span class="p">:]</span>
    <span class="n">e_ab</span> <span class="o">=</span> <span class="n">e_vir</span> <span class="o">+</span> <span class="n">e_vir</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># epsilon_a + epsilon_b (as 2D matrix)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_O</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_O</span><span class="p">):</span>
            <span class="n">e_mp2_os</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_ab</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">e_mp2_ss</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_ab</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    

    <span class="k">return</span> <span class="n">e_mp2_ss</span><span class="p">,</span> <span class="n">e_mp2_os</span>
</pre></div>
</div>
</div>
</details>
</div>
<ul class="simple">
<li><p>Compare your results to the one from VeloxChem</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># MP2 calculation using Vlx</span>
<span class="n">mp2driver</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">mp2driver</span><span class="o">.</span><span class="n">Mp2Driver</span><span class="p">()</span>
<span class="n">mp2driver</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">e_mp2_vlx</span> <span class="o">=</span> <span class="n">mp2driver</span><span class="o">.</span><span class="n">e_mp2</span>

<span class="c1"># calculate the (absolute) difference between the energy correction from Vlx and your own implementation</span>
<span class="o">...</span>
</pre></div>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MP2 calculation using Vlx</span>
<span class="n">mp2driver</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">mp2driver</span><span class="o">.</span><span class="n">Mp2Driver</span><span class="p">()</span>
<span class="n">mp2driver</span><span class="o">.</span><span class="n">ostream</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># turn off printing</span>
<span class="n">mp2driver</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">e_mp2_vlx</span> <span class="o">=</span> <span class="n">mp2driver</span><span class="o">.</span><span class="n">e_mp2</span>

<span class="n">e_mp2_ss</span><span class="p">,</span> <span class="n">e_mp2_os</span> <span class="o">=</span> <span class="n">get_mp2_correction</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Comparison to native VeloxChem routine:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opposite-spin MP2 energy: </span><span class="si">{</span><span class="n">e_mp2_os</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Same-spin MP2 energy:     </span><span class="si">{</span><span class="n">e_mp2_ss</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MP2 energy:               </span><span class="si">{</span><span class="n">e_mp2_os</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e_mp2_ss</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MP2 energy, vlx:          </span><span class="si">{</span><span class="n">e_mp2_vlx</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Comparison to native VeloxChem routine:

Opposite-spin MP2 energy:      -5.292550395109 H.
Same-spin MP2 energy:          -0.000000000000 H.
MP2 energy:                    -5.292550395109 H.
MP2 energy, vlx:               -0.208104435264 H.
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="calculate-the-mp2-amplitudes">
<span id="sec-calc-mp-t-amplitudes"></span><h3>Calculate the MP2 amplitudes<a class="headerlink" href="#calculate-the-mp2-amplitudes" title="Permalink to this heading">#</a></h3>
<p>The MP2 <span class="math notranslate nohighlight">\(t\)</span>-amplitudes, which are the <a class="reference internal" href="mp2.html#label-mp1-wf"><span class="std std-ref">expansion coefficients</span></a> of the first-order correction to the wave function and occur in many places,
are defined as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
t_{ijab} = \frac{\langle ij | ab \rangle - \langle ij | ba \rangle}{\varepsilon_a + \varepsilon_b - \varepsilon_i - \varepsilon_j}.
\end{align*}\]</div>
<p>In the following, we need to consider different spin blocks:</p>
<ul class="simple">
<li><p>For the <span class="math notranslate nohighlight">\(\alpha\alpha\alpha\alpha\)</span> block, both integrals survive.</p></li>
<li><p>For the <span class="math notranslate nohighlight">\(\alpha\beta\alpha\beta\)</span> block, only the first (“Coulomb”) integral survives.</p></li>
<li><p>For the <span class="math notranslate nohighlight">\(\alpha\beta\beta\alpha\)</span> block, only the second (“exchange”) integral survives.</p></li>
</ul>
<p>For a closed-shell system, the blocks with <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> exchanged are identical and do not have to be calculated separately.</p>
<ul class="simple">
<li><p>Implement the three different spin blocks of the <span class="math notranslate nohighlight">\(t\)</span> amplitudes.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_t_amplitudes</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">):</span>
     
    <span class="c1"># orbital energies and oovv integrals (spatial MO basis, physicists&#39; notation)</span>
    <span class="n">moeridrv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MOIntegralsDriver</span><span class="p">()</span>
    <span class="n">oovv</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span><span class="o">=</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span><span class="o">=</span><span class="s2">&quot;chem_OOVV&quot;</span><span class="p">)</span>
     
    <span class="c1"># extract the occupied subset of the orbital energies</span>
    <span class="n">e_ij</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][:</span><span class="n">N_O</span><span class="p">]</span>
    <span class="c1"># extract the virtual subset of the orbital energies</span>
    <span class="n">e_ab</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][</span><span class="n">N_O</span><span class="p">:]</span>

    <span class="c1"># initialize to zero (a=alpha, b=beta)</span>
    <span class="n">t_aaaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_O</span><span class="p">,</span> <span class="n">N_O</span><span class="p">,</span> <span class="n">N_V</span><span class="p">,</span> <span class="n">N_V</span><span class="p">))</span>
    <span class="n">t_abab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_O</span><span class="p">,</span> <span class="n">N_O</span><span class="p">,</span> <span class="n">N_V</span><span class="p">,</span> <span class="n">N_V</span><span class="p">))</span>
    <span class="n">t_abba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_O</span><span class="p">,</span> <span class="n">N_O</span><span class="p">,</span> <span class="n">N_V</span><span class="p">,</span> <span class="n">N_V</span><span class="p">))</span>
    
    <span class="c1"># calculate the t amplitudes using for-loops or numpy</span>
    <span class="o">...</span>
                        
    <span class="c1"># return a list/dictionary or similar with the different spin blocks                </span>
    <span class="k">return</span> <span class="o">...</span>
</pre></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_t_amplitudes</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">):</span>
    <span class="c1">#t_aaaa, t_abab, t_abba</span>
    <span class="c1">#t_bbbb, t_baba, t_baab</span>
     
    <span class="c1"># orbital energies and oovv integrals (spatial MO basis, physicists&#39; notation)</span>
    <span class="n">moeridrv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MOIntegralsDriver</span><span class="p">()</span>
    <span class="n">oovv</span> <span class="o">=</span> <span class="n">moeridrv</span><span class="o">.</span><span class="n">compute_in_memory</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mol_orbs</span><span class="o">=</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">moints_name</span><span class="o">=</span><span class="s2">&quot;chem_OOVV&quot;</span><span class="p">)</span>
     
    <span class="c1"># extract the occupied subset of the orbital energies</span>
    <span class="n">e_occ</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][:</span><span class="n">N_O</span><span class="p">]</span>
    <span class="c1"># extract the virtual subset of the orbital energies</span>
    <span class="n">e_vir</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s2">&quot;E_alpha&quot;</span><span class="p">][</span><span class="n">N_O</span><span class="p">:]</span>
    <span class="n">e_ab</span> <span class="o">=</span> <span class="n">e_vir</span> <span class="o">+</span> <span class="n">e_vir</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># epsilon_a + epsilon_b (as 2D matrix)</span>
          
    <span class="c1"># Different spin blocks (a=alpha, b=beta)</span>
    <span class="n">t2_aaaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_O</span><span class="p">,</span> <span class="n">N_O</span><span class="p">,</span> <span class="n">N_V</span><span class="p">,</span> <span class="n">N_V</span><span class="p">))</span>
    <span class="n">t2_abab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_O</span><span class="p">,</span> <span class="n">N_O</span><span class="p">,</span> <span class="n">N_V</span><span class="p">,</span> <span class="n">N_V</span><span class="p">))</span>
    <span class="n">t2_abba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_O</span><span class="p">,</span> <span class="n">N_O</span><span class="p">,</span> <span class="n">N_V</span><span class="p">,</span> <span class="n">N_V</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_O</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_O</span><span class="p">):</span>
            <span class="n">t2_aaaa</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">eri_oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_ab</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">t2_abab</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">oovv</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_ab</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">t2_abba</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">eri_oovv</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">e_ab</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">e_occ</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            
    <span class="n">t2_mp2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;aaaa&#39;</span><span class="p">:</span> <span class="n">t2_aaaa</span><span class="p">,</span> <span class="s1">&#39;abab&#39;</span><span class="p">:</span> <span class="n">t2_abab</span><span class="p">,</span> <span class="s1">&#39;abba&#39;</span><span class="p">:</span> <span class="n">t2_abba</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">t2_mp2</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="calculate-the-mp2-energy-correction-using-the-t-amplitudes">
<h3>Calculate the MP2 energy correction using the <span class="math notranslate nohighlight">\(t\)</span> amplitudes<a class="headerlink" href="#calculate-the-mp2-energy-correction-using-the-t-amplitudes" title="Permalink to this heading">#</a></h3>
<p>The MP2 energy correction can also be calculated in spin orbitals by using the <span class="math notranslate nohighlight">\(t\)</span> amplitudes as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
E_0^{(2)} = -\frac14\sum_{ijab} t_{ijab} \big( \langle ij | ab \rangle - \langle ij | ba \rangle \big).
\end{equation*}\]</div>
<ul class="simple">
<li><p>Use your function to get the <span class="math notranslate nohighlight">\(t\)</span> amplitudes and use them to calculate the MP2 energy correction.</p></li>
<li><p>Remember that you use spatial orbitals, so take care of the different spin blocks (which integrals survive?).</p></li>
<li><p>You only have <span class="math notranslate nohighlight">\(\alpha\)</span> spin blocks, but the corresponding <span class="math notranslate nohighlight">\(\beta\)</span> blocks are identical.</p></li>
<li><p>Check again that you get the correct result.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get t amplitudes</span>
<span class="n">t2</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1"># calculate energy correction</span>
<span class="n">e_mp2</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t2</span> <span class="o">=</span> <span class="n">get_t_amplitudes</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">)</span>

<span class="n">e_mp2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijab,ijab-&gt;&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;aaaa&#39;</span><span class="p">],</span> <span class="n">eri_oovv</span><span class="p">)</span>
          <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijab,ijba-&gt;&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;aaaa&#39;</span><span class="p">],</span> <span class="n">eri_oovv</span><span class="p">)</span>
          <span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijab,ijab-&gt;&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">eri_oovv</span><span class="p">)</span>
          <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijab,ijba-&gt;&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abba&#39;</span><span class="p">],</span> <span class="n">eri_oovv</span><span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Comparison to MP2 using same-spin, opposite-spin, and native VeloxChem routine:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MP2 energy, t-amplitudes: </span><span class="si">{</span><span class="n">e_mp2</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MP2 energy:               </span><span class="si">{</span><span class="n">e_mp2_os</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e_mp2_ss</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MP2 energy, vlx:          </span><span class="si">{</span><span class="n">e_mp2_vlx</span><span class="si">:</span><span class="s2">20.12f</span><span class="si">}</span><span class="s2"> H.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Comparison to MP2 using same-spin, opposite-spin, and native VeloxChem routine:

MP2 energy, t-amplitudes:      -5.292550395109 H.
MP2 energy:                    -5.292550395109 H.
MP2 energy, vlx:               -0.208104435264 H.
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="o-h-dissociation-potential-energy-curve">
<h3>O–H dissociation potential energy curve<a class="headerlink" href="#o-h-dissociation-potential-energy-curve" title="Permalink to this heading">#</a></h3>
<p>We want to look at the dissociation of one hydrogen atom in the water molecule.
MP2 represents a significant improvement over the HF energy around the equilibrium bond length.
At longer bond lengths, however, some occupied and virtual orbitals become closer in energy to each other.
This makes the orbital-energy denominator of the MP2 correction smaller, and hence <span class="math notranslate nohighlight">\(E_0^{(2)}\)</span> larger and larger (in magnitude).
The correlation energy will thus be overestimated at some point and the dissociation curve will become non-physical.</p>
<ul class="simple">
<li><p>Take the following molecule template and calculate the MP2 energy for a series of different bond lengths</p></li>
<li><p>Plot the potential energy curve for RHF and MP2</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mol_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;                                                                                                              </span>
<span class="s2">O    0.000000000000        0.000000000000        0.000000000000                         </span>
<span class="s2">H    0.000000000000        0.895700000000       -0.316700000000                         </span>
<span class="s2">H    0.000000000000        0.000000000000        OHdist</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># list of bond distances</span>
<span class="n">distlist</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.85</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">1.3</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">3.4</span><span class="p">,</span><span class="mf">4.1</span><span class="p">,</span><span class="mf">4.5</span><span class="p">]</span>

<span class="c1"># Empty list for HF and MP2 energies</span>
<span class="n">E_hf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">E_mp2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># SCF driver</span>
<span class="n">scf_drv_pec</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">max_iter</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># maximum number of iterations</span>
<span class="c1">#scf_drv_pec.ostream.state = False # To disable the printout</span>
<span class="k">for</span> <span class="n">oh</span> <span class="ow">in</span> <span class="n">distlist</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calculating the energies for... &quot;</span><span class="p">,</span> <span class="n">oh</span><span class="p">)</span>
    
    <span class="c1"># Create new molecule</span>
    <span class="n">mol_str</span> <span class="o">=</span> <span class="n">mol_template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OHdist&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">oh</span><span class="p">))</span>
    <span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_molecule_string</span><span class="p">(</span><span class="n">mol_str</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;cc-pvdz&quot;</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># Compute SCF energy</span>
    <span class="o">...</span>
    <span class="n">E_hf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>
    
    <span class="c1"># Compute MP2 energy</span>
    <span class="n">e_mp2_ss</span><span class="p">,</span> <span class="n">e_mp2_os</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">E_mp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">+</span> <span class="n">e_mp2_ss</span> <span class="o">+</span> <span class="n">e_mp2_os</span><span class="p">)</span>
    
<span class="c1"># Plot the results    </span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy during O-H dissociation&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distlist</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">E_mp2</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">E_hf</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MP2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RHF&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>You can compare these curves to the <a class="reference internal" href="mcscf.html#sec-static-correlation"><span class="std std-ref">FCI result</span></a></p></li>
</ul>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mol_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;                                                                                                              </span>
<span class="s2">O    0.000000000000        0.000000000000        0.000000000000                         </span>
<span class="s2">H    0.000000000000        0.895700000000       -0.316700000000                         </span>
<span class="s2">H    0.000000000000        0.000000000000        OHdist</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># list of bond distances</span>
<span class="n">distlist</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.85</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">1.3</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">4.3</span><span class="p">,</span><span class="mf">4.5</span><span class="p">]</span>

<span class="c1"># empty list for HF and MP2 energies</span>
<span class="n">E_hf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">E_mp2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># SCF driver</span>
<span class="n">scf_drv_pec</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">ostream</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># To disable the printout</span>

<span class="k">for</span> <span class="n">oh</span> <span class="ow">in</span> <span class="n">distlist</span><span class="p">:</span>
    <span class="c1"># Create new molecule</span>
    <span class="n">mol_str</span> <span class="o">=</span> <span class="n">mol_template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;OHdist&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">oh</span><span class="p">))</span>
    <span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_molecule_string</span><span class="p">(</span><span class="n">mol_str</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;cc-pvdz&quot;</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># Compute SCF energy</span>
    <span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
    <span class="n">E_hf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>
    
    <span class="c1">#print(&quot;Calculating the energies for... %5.2f&quot; % oh, &quot; Å; converged? &quot;, scf_drv_pec.is_converged)</span>
    
    <span class="c1"># Compute MP2 energy</span>
    <span class="n">e_mp2_ss</span><span class="p">,</span> <span class="n">e_mp2_os</span> <span class="o">=</span> <span class="n">get_mp2_correction</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv_pec</span><span class="p">)</span>
    <span class="n">E_mp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scf_drv_pec</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">+</span> <span class="n">e_mp2_ss</span> <span class="o">+</span> <span class="n">e_mp2_os</span><span class="p">)</span>

<span class="c1"># Plot the results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy during O-H dissociation&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distlist</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">E_mp2</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">E_hf</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MP2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RHF&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;O-H bond length (Å)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total energy (H)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../../_images/76ae536701032b1f10dd5fef08112ec8347fb0414f697dc43c4d03459c423c10.png" src="../../_images/76ae536701032b1f10dd5fef08112ec8347fb0414f697dc43c4d03459c423c10.png" />
</div>
</details>
</div>
</section>
<section id="dipole-moment">
<h3>Dipole moment<a class="headerlink" href="#dipole-moment" title="Permalink to this heading">#</a></h3>
<p>One often wants to characterize molecular systems beyond pure energetics.
As an example of another basic property, we look at the electric dipole moment <span class="math notranslate nohighlight">\(\boldsymbol{\mu}\)</span>, which is an important factor for long-range interaction between different molecules.
The dipole moment <span class="math notranslate nohighlight">\(\boldsymbol{\mu}\)</span> is an example of a <a class="reference internal" href="../mol_struct/energy_grad.html#sec-first-order-prop"><span class="std std-ref">first-order property</span></a>,
which can be calculated as a derivative of the energy with respect to an external electric field <span class="math notranslate nohighlight">\(\boldsymbol{\mathcal{F}}\)</span>.
As such, it can be calculated either <a class="reference internal" href="../mol_struct/energy_grad.html#sec-numerical-gradients"><span class="std std-ref">numerically</span></a> or <a class="reference internal" href="../mol_struct/energy_grad.html#sec-analytical-gradients"><span class="std std-ref">analytically</span></a>.
In the latter case, the calculation of the electronic contribution to <span class="math notranslate nohighlight">\(\boldsymbol{\mu}\)</span> is given by the contraction of the one-particle density matrix <span class="math notranslate nohighlight">\(\boldsymbol{\gamma}\)</span> with the dipole integrals (<span class="math notranslate nohighlight">\(\mu_{\kappa \lambda}\)</span>), either in the atomic-orbital (AO) or molecular-orbital (MO) basis.
Denoting MO indices with Latin letters and AO indices with Greek ones, this equivalence can be expressed as</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  \boldsymbol{\mu} = \sum_{pq} \gamma_{pq} \, \mu_{qp} = \sum_{\kappa \lambda} \gamma_{\kappa \lambda} \, \mu_{\lambda \kappa}
\end{equation*}\]</div>
<p>In order to avoid having to transform all property integrals to MO basis, one usually transforms the density matrix to AO:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  \gamma_{\kappa \lambda} = \sum_{pq} C_{\kappa p} \, \gamma_{pq} \, C_{\lambda q}
\end{equation*}\]</div>
<p>In the following, we want to look at the dipole moment calculated with different approximation schemes.</p>
<section id="hf-dipole-moment">
<h4>HF dipole moment<a class="headerlink" href="#hf-dipole-moment" title="Permalink to this heading">#</a></h4>
<p>In order to obtain the dipole moment at the HF level, we only have to get the total (zeroth-order) SCF density <span class="math notranslate nohighlight">\(\boldsymbol{\gamma}^{(0)}\)</span> and provide it to the <code class="docutils literal notranslate"><span class="pre">FirstOrderProperties</span></code> driver, which takes care of the rest (contraction with the dipole integrals and adding the nuclear contribution).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scf_density</span> <span class="o">=</span> <span class="n">scf_results</span><span class="p">[</span><span class="s1">&#39;D_alpha&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">scf_results</span><span class="p">[</span><span class="s1">&#39;D_beta&#39;</span><span class="p">]</span>
<span class="n">prop</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">firstorderprop</span><span class="o">.</span><span class="n">FirstOrderProperties</span><span class="p">()</span>
<span class="n">prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_density</span><span class="p">)</span>
<span class="n">hf_dipole_moment</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;dipole moment&#39;</span><span class="p">)</span>
<span class="n">prop</span><span class="o">.</span><span class="n">print_properties</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;HF dipole moment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                                     HF dipole moment                                                     
                                                    ------------------                                                    
                                                                                                                          
                                   X   :         0.000000 a.u.         0.000000 Debye                                     
                                   Y   :         0.627759 a.u.         1.595604 Debye                                     
                                   Z   :         0.498104 a.u.         1.266055 Debye                                     
                                 Total :         0.801367 a.u.         2.036872 Debye                                     
                                                                                                                          
</pre></div>
</div>
</div>
</div>
<p>This piece of code can be reused for the calculation of dipole moments, only the corresponding total density matrix needs to be changed.</p>
</section>
<section id="unrelaxed-mp2-dipole-moment">
<span id="sec-unrel-mp2-dipole"></span><h4>Unrelaxed MP2 dipole moment<a class="headerlink" href="#unrelaxed-mp2-dipole-moment" title="Permalink to this heading">#</a></h4>
<p>At the MP2 level, additional contributions to all blocks (occupied-occupied, virtual-virtual, and occupied-virtual) of the one-particle density matrix need to be taken into account.
The occupied-virtual block of the MP2 density matrix is related to orbital relaxation due to the perturbation
and has to be calculated iteratively (for more details, see <a class="reference internal" href="../mol_struct/energy_grad.html#sec-mp2-gradients"><span class="std std-ref">here</span></a>).
The occupied-occupied and virtual-virtual blocks of the second-order correction to the ground-state one-particle density matrix, on the other hand, can directly be calculated from the <span class="math notranslate nohighlight">\(t\)</span>-amplitudes as</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
  \gamma_{ij}^{(2)} &amp;= -\frac12 \sum_{kab} t_{ikab} \, t_{jkab} \\
  \gamma_{ab}^{(2)} &amp;= +\frac12 \sum_{ijc} t_{ijac} \, t_{ijbc}
\end{align*}\]</div>
<p>Considering only these two blocks (and hence neglecting orbital relaxation effects) is often referred to as the <em>unrelaxed density matrix</em>
and properties calculated with it as (orbital) unrelaxed.</p>
<ul class="simple">
<li><p>Implement the two blocks of the second-order correction <span class="math notranslate nohighlight">\(\boldsymbol{\gamma}^{(2)}\)</span> to the one-particle density matrix.</p></li>
<li><p>Transform them from the MO to the AO basis.</p></li>
<li><p>Add this density to the SCF density and calculate the dipole moment again.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Remember that there are different spin blocks in <span class="math notranslate nohighlight">\(t_{ijab}\)</span></p></li>
</ul>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># occ-occ block</span>
<span class="n">gamma_ij</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># vir-vir block</span>
<span class="n">gamma_ab</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Transform to AO basis</span>
<span class="n">gamma_ao</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Add SCF density and calculate dipole moment</span>
<span class="n">unrelaxed_density</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1"># Compute property with density</span>
<span class="o">...</span>
<span class="c1"># Get the unrelaxed dipole moment</span>
<span class="n">ur_mp2_dipole_moment</span> <span class="o">=</span> <span class="o">...</span>
<span class="c1"># Print it</span>
<span class="n">prop</span><span class="o">.</span><span class="n">print_properties</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s1">&#39;Unrelaxed MP2 dipole moment&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># occ-occ block</span>
<span class="n">gamma_ij</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ikab,jkab-&gt;ij&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;aaaa&#39;</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;aaaa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ikab,jkab-&gt;ij&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ikab,jkab-&gt;ij&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abba&#39;</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abba&#39;</span><span class="p">]))</span>

<span class="c1"># vir-vir block</span>
<span class="n">gamma_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijac,ijbc-&gt;ab&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;aaaa&#39;</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;aaaa&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijac,ijbc-&gt;ab&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijac,ijbc-&gt;ab&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abba&#39;</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abba&#39;</span><span class="p">])</span>

<span class="c1"># Transform to AO basis</span>
<span class="n">gamma_ao</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">C_occ</span><span class="p">,</span> <span class="n">gamma_ij</span><span class="p">,</span> <span class="n">C_occ</span><span class="o">.</span><span class="n">T</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">C_vir</span><span class="p">,</span> <span class="n">gamma_ab</span><span class="p">,</span> <span class="n">C_vir</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>

<span class="c1"># Add SCF density and calculate dipole moment</span>
<span class="n">unrelaxed_density</span> <span class="o">=</span> <span class="n">scf_density</span> <span class="o">+</span> <span class="n">gamma_ao</span>
<span class="n">prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">unrelaxed_density</span><span class="p">)</span>
<span class="n">ur_mp2_dipole_moment</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;dipole moment&#39;</span><span class="p">)</span>
<span class="n">prop</span><span class="o">.</span><span class="n">print_properties</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s1">&#39;Unrelaxed MP2 dipole moment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                               Unrelaxed MP2 dipole moment                                                
                                              -----------------------------                                               
                                                                                                                          
                                   X   :         0.000000 a.u.         0.000000 Debye                                     
                                   Y   :        -0.212789 a.u.        -0.540854 Debye                                     
                                   Z   :        -0.264849 a.u.        -0.673179 Debye                                     
                                 Total :         0.339741 a.u.         0.863535 Debye                                     
                                                                                                                          
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="approximate-relaxed-mp2-dipole-moment">
<h4>Approximate relaxed MP2 dipole moment<a class="headerlink" href="#approximate-relaxed-mp2-dipole-moment" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>In order to calculate the <a class="reference internal" href="../mol_struct/energy_grad.html#sec-mp2-gradients"><span class="std std-ref">gradient of the MP2 energy analytically</span></a>, orbital response equations need to be solved iteratively
in order to obtain the occupied-virtual block of the one-particle density matrix.</p></li>
<li><p>As an approximation to that, the following equation (in spin orbitals) can be used,</p></li>
</ul>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  \lambda_{ia} = \frac{1}{\varepsilon_{a} - \varepsilon_{i}} \bigg[ \frac12 \sum_{jkb} t_{jkab} \langle jk || ib \rangle + \frac12 \sum_{jbc} t_{ijbc} \langle ja || bc \rangle \bigg].
\end{equation*}\]</div>
<ul class="simple">
<li><p>For the closed-shell restricted case, the above equation can be written in spatial orbitals as,</p></li>
</ul>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
  \lambda_{ia} &amp;= \frac{1}{\varepsilon_{a} - \varepsilon_{i}} \bigg[ \sum_{jbc} \frac{\langle ij | bc \rangle}{\varepsilon_b + \varepsilon_c - \varepsilon_i - \varepsilon_j} \big( 2 \langle ja | cb \rangle - \langle ja | bc \rangle \big) \\
  &amp;\ \ - \sum_{jkb} \frac{\langle jk | ab \rangle}{\varepsilon_a + \varepsilon_b - \varepsilon_j - \varepsilon_k} \big( 2 \langle jk | ib \rangle - \langle kj | ib \rangle \big) \bigg].
\end{align*}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Note that the “<span class="math notranslate nohighlight">\(t\)</span>-amplitudes” in the closed-shell equation above (without anti-symmetrized integrals) correspond to the <span class="math notranslate nohighlight">\(\alpha\beta\alpha\beta\)</span> block of the normal ones</p></li>
<li><p>Both the occ-vir and vir-occ blocks of <span class="math notranslate nohighlight">\(\boldsymbol{\lambda}\)</span> are needed, but one is the transpose of the other</p></li>
</ul>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the first term</span>
<span class="n">term1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijbc,jacb-&gt;ia&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">eri_ovvv</span><span class="p">)</span> <span class="o">-</span> <span class="o">...</span>

<span class="c1"># Calculate the second term</span>
<span class="n">term2</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Calculate lambda (sum up the two terms and divide by orbital-energy difference)</span>
<span class="n">lambda_ov</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Transform lambda to AO (both the ov and the vo blocks)</span>
<span class="n">lambda_ao</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Compute the approximate relaxed dipole moment by adding lambda (alpha+beta) to the density</span>
<span class="o">...</span>
<span class="c1"># Get the approximate relaxed dipole moment</span>
<span class="n">rel_mp2_dipole_moment</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">prop</span><span class="o">.</span><span class="n">print_properties</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;Approx. relaxed MP2 dipole moment&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">term1</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jkab,jkib-&gt;ia&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">eri_ooov</span><span class="p">)</span>
            <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;jkab,kjib-&gt;ia&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">eri_ooov</span><span class="p">)</span>
         <span class="p">)</span>
<span class="n">term2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijbc,jacb-&gt;ia&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">eri_ovvv</span><span class="p">)</span>
           <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijbc,jabc-&gt;ia&#39;</span><span class="p">,</span> <span class="n">t2</span><span class="p">[</span><span class="s1">&#39;abab&#39;</span><span class="p">],</span> <span class="n">eri_ovvv</span><span class="p">)</span>
         <span class="p">)</span>

<span class="n">lambda_ov</span> <span class="o">=</span> <span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span><span class="p">)</span> <span class="o">/</span> <span class="n">epsilon_ov</span>

<span class="n">lambda_ao</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">C_occ</span><span class="p">,</span> <span class="n">lambda_ov</span><span class="p">,</span> <span class="n">C_vir</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
            <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">([</span><span class="n">C_vir</span><span class="p">,</span> <span class="n">lambda_ov</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">C_occ</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
            <span class="p">)</span>

<span class="n">prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">unrelaxed_density</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_ao</span><span class="p">)</span>
<span class="n">rel_mp2_dipole_moment</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;dipole moment&#39;</span><span class="p">)</span>
<span class="n">prop</span><span class="o">.</span><span class="n">print_properties</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;Approx. relaxed MP2 dipole moment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                            Approx. relaxed MP2 dipole moment                                             
                                           -----------------------------------                                            
                                                                                                                          
                                   X   :         0.000000 a.u.         0.000000 Debye                                     
                                   Y   :        -0.343346 a.u.        -0.872698 Debye                                     
                                   Z   :        -0.410976 a.u.        -1.044597 Debye                                     
                                 Total :         0.535525 a.u.         1.361170 Debye                                     
                                                                                                                          
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="numerical-hf-and-mp2-dipole-moment">
<h4>Numerical HF and MP2 dipole moment<a class="headerlink" href="#numerical-hf-and-mp2-dipole-moment" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Calculate the <span class="math notranslate nohighlight">\(z\)</span> component of the dipole moment as a numerical derivative with respect to an external electric field <span class="math notranslate nohighlight">\(\mathcal{F}_z\)</span> at the HF and MP2 levels.</p></li>
<li><p>Apply an electric field in <span class="math notranslate nohighlight">\(z\)</span> direction with a strength of <span class="math notranslate nohighlight">\(\mathcal{F}_z = 10^{-5}\)</span> a.u. for the SCF calculation, then calculate the MP2 energy with that result.</p></li>
<li><p>Then the dipole moment <span class="math notranslate nohighlight">\(\mu_z\)</span>
can be calculated approximately as,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
  \mu_z = -\frac{\Delta E}{\Delta \mathcal{F}_z} = -\frac{E(\mathcal{F}_z) - E(-\mathcal{F}_z)}{2 \mathcal{F}_z}.
\]</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># SCF driver for positive field direction</span>
<span class="n">scf_drv_p</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="c1"># Define external electric field</span>
<span class="n">method_dict_p</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;electric_field&#39;</span><span class="p">:</span> <span class="s1">&#39;0,0,0.00001&#39;</span><span class="p">}</span>
<span class="c1"># Update the settings with the electric field</span>
<span class="n">scf_drv_p</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_dict</span><span class="p">,</span> <span class="n">method_dict_p</span><span class="p">)</span>
<span class="c1"># Compute SCF energy in presence of external field</span>
<span class="n">scf_drv_p</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">hf_e_p</span> <span class="o">=</span> <span class="n">scf_drv_p</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span>
<span class="c1"># Use MP2 driver from Vlx</span>
<span class="n">mp2driver</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv_p</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="c1"># Sum up the energies</span>
<span class="n">mp2_e_p</span> <span class="o">=</span> <span class="n">hf_e_p</span> <span class="o">+</span> <span class="n">mp2driver</span><span class="o">.</span><span class="n">e_mp2</span>

<span class="c1"># Repeat with a field in negative z direction</span>
<span class="o">...</span>

<span class="c1"># Field strength as floating point number</span>
<span class="n">field_strength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">method_dict_p</span><span class="p">[</span><span class="s1">&#39;electric_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Calculate the z component dipole moment numerically</span>
<span class="n">hf_mu_z</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">mp2_mu_z</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Compare all the obtained values for the dipole moment</span>
<span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>If possible/desired, you can also calculate the other dipole components <span class="math notranslate nohighlight">\(\mu_x\)</span> and <span class="math notranslate nohighlight">\(\mu_y\)</span> numerically.</p></li>
</ul>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SCF driver for positive field direction</span>
<span class="n">scf_drv_p</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="c1"># Define external electric field</span>
<span class="n">method_dict_p</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;electric_field&#39;</span><span class="p">:</span> <span class="s1">&#39;0,0,0.00001&#39;</span><span class="p">}</span>
<span class="c1"># Update the settings with the electric field</span>
<span class="n">scf_drv_p</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_dict</span><span class="p">,</span> <span class="n">method_dict_p</span><span class="p">)</span>
<span class="n">scf_drv_p</span><span class="o">.</span><span class="n">ostream</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># Compute SCF energy in presence of external field</span>
<span class="n">scf_drv_p</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">hf_e_p</span> <span class="o">=</span> <span class="n">scf_drv_p</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span>
<span class="c1"># Use MP2 driver from Vlx</span>
<span class="n">mp2driver</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv_p</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="c1"># Sum up the energies</span>
<span class="n">mp2_e_p</span> <span class="o">=</span> <span class="n">hf_e_p</span> <span class="o">+</span> <span class="n">mp2driver</span><span class="o">.</span><span class="n">e_mp2</span>

<span class="c1"># Repeat with a field in negative z direction</span>
<span class="n">scf_drv_m</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">method_dict_m</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;electric_field&#39;</span><span class="p">:</span> <span class="s1">&#39;0,0,-0.00001&#39;</span><span class="p">}</span>
<span class="n">scf_drv_m</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_dict</span><span class="p">,</span> <span class="n">method_dict_m</span><span class="p">)</span>
<span class="n">scf_drv_m</span><span class="o">.</span><span class="n">ostream</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">scf_drv_m</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">hf_e_m</span> <span class="o">=</span> <span class="n">scf_drv_m</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span>
<span class="n">mp2driver</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv_m</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">mp2_e_m</span> <span class="o">=</span> <span class="n">hf_e_m</span> <span class="o">+</span> <span class="n">mp2driver</span><span class="o">.</span><span class="n">e_mp2</span>

<span class="c1"># Calculate the z component dipole moment numerically</span>
<span class="n">field_strength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">method_dict_p</span><span class="p">[</span><span class="s1">&#39;electric_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">hf_mu_z</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">hf_e_p</span> <span class="o">-</span> <span class="n">hf_e_m</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">field_strength</span><span class="p">)</span>
<span class="n">mp2_mu_z</span> <span class="o">=</span> <span class="o">-</span> <span class="p">(</span><span class="n">mp2_e_p</span> <span class="o">-</span> <span class="n">mp2_e_m</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">field_strength</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analytical HF mu_z: </span><span class="si">%10.5f</span><span class="s2"> a.u.&quot;</span> <span class="o">%</span> <span class="n">hf_dipole_moment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numerical HF  mu_z: </span><span class="si">%10.5f</span><span class="s2"> a.u.&quot;</span> <span class="o">%</span> <span class="n">hf_mu_z</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unrelaxed MP2   mu_z: </span><span class="si">%10.5f</span><span class="s2"> a.u.&quot;</span> <span class="o">%</span> <span class="n">ur_mp2_dipole_moment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Approximate MP2 mu_z: </span><span class="si">%10.5f</span><span class="s2"> a.u.&quot;</span> <span class="o">%</span> <span class="n">rel_mp2_dipole_moment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Numerical MP2   mu_z: </span><span class="si">%10.5f</span><span class="s2"> a.u.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">mp2_mu_z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analytical HF mu_z:    0.49810 a.u.
Numerical HF  mu_z:    0.49810 a.u.

Unrelaxed MP2   mu_z:   -0.26485 a.u.
Approximate MP2 mu_z:   -0.41098 a.u.
Numerical MP2   mu_z:    0.46787 a.u.
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
<section id="mcscf">
<h2>MCSCF<a class="headerlink" href="#mcscf" title="Permalink to this heading">#</a></h2>
<section id="ozone">
<h3>Ozone<a class="headerlink" href="#ozone" title="Permalink to this heading">#</a></h3>
<p>Compute the CASSCF energy of ozone with a cc-pVDZ basis, using a reasonable active space (that you can motivate). Use the orbital viewer to select the orbitals and at the end of the calculation to check the result. The geometry is provided below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span>         <span class="mf">0.00000</span>   <span class="o">-</span><span class="mf">0.00000</span>    <span class="mf">0.16276</span>
<span class="n">O</span>         <span class="mf">0.00000</span>    <span class="mf">1.09078</span>    <span class="mf">0.83863</span>
<span class="n">O</span>         <span class="mf">0.00000</span>   <span class="o">-</span><span class="mf">1.09078</span>    <span class="mf">0.83863</span>
</pre></div>
</div>
<p>Notice the natural orbitals occupation numbers. Ozone is a molecule that even in its equilibrium distance shows strong correlation.</p>
<p>Ozone exists in another isomer, which is more cyclic.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">O</span>         <span class="mf">0.00000</span>   <span class="o">-</span><span class="mf">0.00000</span>   <span class="o">-</span><span class="mf">0.16263</span>
<span class="n">O</span>         <span class="mf">0.00000</span>    <span class="mf">0.72155</span>    <span class="mf">1.08733</span>
<span class="n">O</span>         <span class="mf">0.00000</span>   <span class="o">-</span><span class="mf">0.72155</span>    <span class="mf">1.08733</span>
</pre></div>
</div>
<p>Compare the energies of the 2 isomers using Hartree-Fock and CASSCF (using the same active space for both isomers!).</p>
</section>
<section id="chromium-dimer">
<h3>Chromium dimer<a class="headerlink" href="#chromium-dimer" title="Permalink to this heading">#</a></h3>
<p>Design a CASSCF calculation for the Chromium dimer and look at the resulting natural orbitals.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Cr</span>    <span class="mf">0.0</span>    <span class="mf">0.0</span>   <span class="o">-</span><span class="mf">0.825</span>
<span class="n">Cr</span>    <span class="mf">0.0</span>    <span class="mf">0.0</span>    <span class="mf">0.825</span>
</pre></div>
</div>
<p>Here the situation is even worse than for ozone. Many transition metal complexes have strong correlation, with metal dimers usually the worst case scenario.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs/elec_struct"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="mcscf.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Multiconfigurational methods</p>
      </div>
    </a>
    <a class="right-next"
       href="dft.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Density functional theory</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hartree-fock">Hartree-Fock</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-interaction">Configuration interaction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#one-particle-density-matrix">One-particle density matrix</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#several-states">Several states</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mp2">MP2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-closed-shell-mp2-energy-correction">Calculate the closed-shell MP2 energy correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-mp2-amplitudes">Calculate the MP2 amplitudes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-the-mp2-energy-correction-using-the-t-amplitudes">Calculate the MP2 energy correction using the <span class="math notranslate nohighlight">\(t\)</span> amplitudes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#o-h-dissociation-potential-energy-curve">O–H dissociation potential energy curve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dipole-moment">Dipole moment</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hf-dipole-moment">HF dipole moment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#unrelaxed-mp2-dipole-moment">Unrelaxed MP2 dipole moment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#approximate-relaxed-mp2-dipole-moment">Approximate relaxed MP2 dipole moment</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-hf-and-mp2-dipole-moment">Numerical HF and MP2 dipole moment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcscf">MCSCF</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ozone">Ozone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chromium-dimer">Chromium dimer</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The eChem team
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>