
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>General aspects &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Larger systems" href="xray_large.html" />
    <link rel="prev" title="Spectrum analysis" href="xray_analysis.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="uv-vis.html">
   UV/vis absorption/emission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transmetal.html">
   Transition metals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nlo.html">
   Multi-photon interactions
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradhess.html">
     Gradients and Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="structopt.html">
   Molecular structure optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conint.html">
   Conical intersection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     SCF states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Molecular orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/xray_cons.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdocs/xray_cons.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/docs/xray_cons.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relaxation">
   Relaxation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relaxation-of-core-ionized-systems">
     Relaxation of core-ionized systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relaxation-of-core-excitation-or-de-excitation">
     Relaxation of core-excitation or de-excitation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-with-deltascf-methods">
     Including with
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     SCF methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-for-wave-function-methods">
     Including for wave-function methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-for-dft-based-methods">
     Including for DFT-based methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relativity">
   Relativity
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-relativistic-effects">
     Scalar relativistic effects
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-ionization-potentials">
       For ionization potentials
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-spectra-xas">
       For spectra (XAS)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spin-orbit-coupling">
     Spin-orbit coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basis-set-considerations">
   Basis set considerations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-interaction-error-in-dft">
   Self-interaction error in DFT
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#core-hole-localization">
   Core-hole localization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tailored-cvs">
   Tailored CVS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spurious-valence-mixing-in-xas">
   Spurious valence mixing in XAS
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="general-aspects">
<h1>General aspects<a class="headerlink" href="#general-aspects" title="Permalink to this headline">¶</a></h1>
<p>In this section we will discuss a number of issues and questions relating to core spectroscopies, ranging from the physical effect of a core-transitions, to technical aspects relating to lowering computational costs. Thew are ordered by approximate relevance, with some topics being pertient only for certain cases.</p>
<p><em>Loading modules and functions:</em></p>
<div class="cell tag_remove-output tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># standard Python modules and functions</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># QC software suites and functionalities</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">cc</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">gator</span>
<span class="kn">import</span> <span class="nn">adcc</span>
<span class="kn">from</span> <span class="nn">veloxchem.rsplinabscross</span> <span class="k">import</span> <span class="n">LinearAbsorptionCrossSection</span>

<span class="c1"># for vlx</span>
<span class="n">silent_ostream</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="k">import</span> <span class="n">MPI</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># au to eV conversion factor</span>
<span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>

<span class="c1"># Lorentzian broadening function</span>
<span class="c1">#   called with [energies, intensities, start energy, end energy, energy step, gamma]</span>
<span class="k">def</span> <span class="nf">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="relaxation">
<span id="sec-xray-topics-relax"></span><h2>Relaxation<a class="headerlink" href="#relaxation" title="Permalink to this headline">¶</a></h2>
<p>Core spectroscopies exhibit strong relaxation effects, originating in the significant change in shielding of the nuclear charge arising from the creation/annihilation of a core-hole. These effects need to be properly accounted for in order to get good absolute energies, as  the lack of this will mean that, <em>e.g.</em> an unrelaxed core-hole system is too high in energy. This explains the previously observed large error obtained from Koopmans’ theorem.</p>
<div class="section" id="relaxation-of-core-ionized-systems">
<h3>Relaxation of core-ionized systems<a class="headerlink" href="#relaxation-of-core-ionized-systems" title="Permalink to this headline">¶</a></h3>
<p>In <a class="reference internal" href="#relax-form"><span class="std std-numref">Fig. 13</span></a> we see the effects of relaxation for creating a core-hole in the oxygen/carbon 1s of formaldehyde:</p>
<div class="figure align-default" id="relax-form">
<img alt="../_images/relax_form.svg" src="../_images/relax_form.svg" /><p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">The total electron density of formaldehyde, featuring the neutral system and core-ionized at the carbon and oxygen 1s.</span><a class="headerlink" href="#relax-form" title="Permalink to this image">¶</a></p>
</div>
<p>We see that there are noticable attraction of electron density toward the core-holes, which is particularly visible when viewed from the side. These effects can be modeled with the <span class="math notranslate nohighlight">\(Z+1\)</span> approximation, within which the change in screening is modeled by substituting the ionized atom with the next element in the periodic table. This can be illustrated with the following radial distribution plot:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">water_fluorine_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">F       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">### Neutral and core-hole water</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="c1"># Create 1s core-hole by setting beta_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>   
<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1">### Fluorine-substituted water</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol_fl</span>        <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">atom</span>   <span class="o">=</span> <span class="n">water_fluorine_xyz</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">basis</span>  <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Closed-shell</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs_fl</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol_fl</span><span class="p">)</span>
<span class="n">scf_gs_fl</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">Ay</span> <span class="o">=</span> <span class="mf">0.0</span>                      <span class="c1"># oxygen y-position (in au)</span>
<span class="n">Az</span> <span class="o">=</span> <span class="mf">0.1178336003</span><span class="o">/</span><span class="mf">0.529177249</span> <span class="c1"># oxygen z-position (in au)</span>

<span class="c1"># Create coordinate object along x-axis (intersecting with O/F atom)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">):</span>
    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ix</span><span class="p">,</span><span class="n">Ay</span><span class="p">,</span><span class="n">Az</span><span class="p">))</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

<span class="c1"># AO values and MO values on given grids</span>
<span class="c1"># Neutral water</span>
<span class="n">ao_gs</span>  <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">eval_gto</span><span class="p">(</span><span class="s1">&#39;GTOval_sph&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">mo_gs</span>  <span class="o">=</span> <span class="n">ao_gs</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>

<span class="c1"># Water core-hole</span>
<span class="n">ao_ion</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">eval_gto</span><span class="p">(</span><span class="s1">&#39;GTOval_sph&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">mo_ion</span> <span class="o">=</span> <span class="n">ao_ion</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>

<span class="c1"># Z+1</span>
<span class="n">ao_Z1</span>  <span class="o">=</span> <span class="n">mol_fl</span><span class="o">.</span><span class="n">eval_gto</span><span class="p">(</span><span class="s1">&#39;GTOval_sph&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">mo_Z1</span>  <span class="o">=</span> <span class="n">ao_Z1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scf_gs_fl</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783203  &lt;S^2&gt; = 8.9110941e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.scf.uhf.UHF&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.1707263747173  &lt;S^2&gt; = 0.76785153  2S+1 = 2.0177726
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -100.169768736219  &lt;S^2&gt; = 4.3698378e-13  2S+1 = 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MO$_{\alpha 1}$ ($1a_1$)&#39;</span><span class="p">)</span>
<span class="n">mo_nr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">r</span><span class="p">,</span><span class="n">rho1</span><span class="p">,</span><span class="n">rho2</span><span class="p">,</span><span class="n">rho3</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_gs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_ion</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_Z1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Ground-state&#39;</span><span class="p">,</span><span class="s1">&#39;Core-hole&#39;</span><span class="p">,</span><span class="s1">&#39;Ground-state [Z+1]&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.75</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Radius [a.u.]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Density [$r^2 \rho$]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MO$_{\alpha 2}$ ($2a_1$)&#39;</span><span class="p">)</span>
<span class="n">mo_nr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r</span><span class="p">,</span><span class="n">rho1</span><span class="p">,</span><span class="n">rho2</span><span class="p">,</span><span class="n">rho3</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_gs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_ion</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_Z1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Radius [a.u.]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Density [$r^2 \rho$]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;MO$_{\beta 2}$ ($2a_1$)&#39;</span><span class="p">)</span>
<span class="n">mo_nr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r</span><span class="p">,</span><span class="n">rho1</span><span class="p">,</span><span class="n">rho2</span><span class="p">,</span><span class="n">rho3</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
        <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rho1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_gs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_ion</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rho3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">mo_Z1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">rho3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Radius [a.u.]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Density [$r^2 \rho$]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_4_0.png" src="../_images/xray_cons_4_0.png" />
</div>
</div>
<p>As can be seen, the radial distribution of particularly <span class="math notranslate nohighlight">\(\alpha_2\)</span> for the core-ionized system is closer to <span class="math notranslate nohighlight">\(Z+1\)</span> than to the neutral state, although this agreement is lower for <span class="math notranslate nohighlight">\(\alpha_1\)</span> and <span class="math notranslate nohighlight">\(\beta_2\)</span>. Also note the different x-scales.</p>
</div>
<div class="section" id="relaxation-of-core-excitation-or-de-excitation">
<h3>Relaxation of core-excitation or de-excitation<a class="headerlink" href="#relaxation-of-core-excitation-or-de-excitation" title="Permalink to this headline">¶</a></h3>
<p>For X-ray absorption and emission spectroscopy the influence of the relaxation is partially the opposite, with</p>
<ul class="simple">
<li><p>Relaxation in XAS leading to a more contracted final state, which lower absorption energies</p></li>
<li><p>Relaxation in XES leading to a more decontracted final state, which increase emission energies</p></li>
</ul>
<p>In addition to these strong changes in shielding, there are also additional couplings due to the population of a previous unoccupied stat (XAS) or the creation of a valence-hole (XES). These effects are smaller and partially counteract the stronger change due to change in shielding, leading to a total picture as follows:</p>
<div class="figure align-default" id="relax-processes">
<img alt="../_images/relax_processes.svg" src="../_images/relax_processes.svg" /><p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">Relaxation effects involved in X-ray absorption (left) and emission (right) spectroscopies. Showing which orbitals primarily contribute to the respective effects, as well as the result in MO energ (or electron density).</span><a class="headerlink" href="#relax-processes" title="Permalink to this image">¶</a></p>
</div>
<p>We here see the four main total effects:</p>
<ul class="simple">
<li><p>X-ray absorption spectroscopy</p>
<ol class="simple">
<li><p>A strong relaxation effect due to the creation of a core-hole, which leads to contraction of electron density and scales with element</p></li>
<li><p>A weak polarization effect due to coupling with the newly occupied valence state, which partially decontracts the outer valence density and does not scale appreciably with the element</p></li>
</ol>
</li>
<li><p>X-ray emission spectroscopy</p>
<ol class="simple">
<li><p>A strong repulsion effect due to the annihilation of a core-hole, which leads to decontraction of electron density and scales with element</p></li>
<li><p>A weaker outer relaxation effect due to the creation of a valence-hole, which leads to contraction of the (outer) valence density and scales with element</p></li>
</ol>
</li>
</ul>
<p>These effects balances in different manners, and the exact strength depends heavily on the element and which edge is being probed. As such, the accuracy of a particular scheme (<em>e.g.</em> ADC) depends on which spectroscopy, element, and edge is considered.</p>
</div>
<div class="section" id="including-with-deltascf-methods">
<h3>Including with <span class="math notranslate nohighlight">\(\Delta\)</span>SCF methods<a class="headerlink" href="#including-with-deltascf-methods" title="Permalink to this headline">¶</a></h3>
<p><span class="math notranslate nohighlight">\(\Delta\)</span>SCF methods provide the most direct way of including relaxation, as the core-hole state is explicitly optimized. However, this approach need to consider each transition explicitly, and will have difficulties in calculating both the transition moment and in properly converging higher excited states. As such, it is mainly useful for considering ionization potentials and for providing a reference state for XES calculations. Comparing the performance of IP:s from Koopmans’ theorem and <span class="math notranslate nohighlight">\(\Delta\)</span>SCF:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">methane_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">C       0.0000000000     0.0000000000     0.0000000000</span>
<span class="s2">H       0.6265918120     0.6265918120     0.6265918120</span>
<span class="s2">H      -0.6265918120    -0.6265918120     0.6265918120</span>
<span class="s2">H      -0.6265918120     0.6265918120    -0.6265918120</span>
<span class="s2">H       0.6265918120    -0.6265918120    -0.6265918120</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">ammonia_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">N       0.0000000000     0.0000000000     0.1175868000</span>
<span class="s2">H       0.9323800000     0.0000000000    -0.2743692000</span>
<span class="s2">H      -0.4661900000    -0.8074647660    -0.2743692000</span>
<span class="s2">H      -0.4661900000     0.8074647660    -0.2743692000</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">hydrofluoride_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">H       0.0000000000     0.0000000000    -0.8261856000</span>
<span class="s2">F       0.0000000000     0.0000000000     0.0917984000</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">neon_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Ne      0.0000000000     0.0000000000     0.0000000000</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">Koopman_vs_delta</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">ecp</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">molecule</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="k">if</span> <span class="n">ecp</span><span class="p">:</span> <span class="c1"># optional ECP - to be used later</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">ecp</span> <span class="o">=</span> <span class="n">ecp</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Perform unrestricted SCF calculation</span>
    <span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Return MO energy and deltaSCF</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">())</span>

<span class="c1"># Basis set and container for errors</span>
<span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">err_koopman</span><span class="p">,</span> <span class="n">err_delta</span> <span class="o">=</span> <span class="p">[],[]</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">290.76</span><span class="p">,</span> <span class="mf">0.11</span> <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">methane_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">);</span> <span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">405.52</span><span class="p">,</span> <span class="mf">0.21</span> <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span><span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ammonia_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">);</span> <span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">539.90</span><span class="p">,</span> <span class="mf">0.37</span> <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span><span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">);</span> <span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">694.10</span><span class="p">,</span> <span class="mf">0.61</span> <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span><span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">hydrofluoride_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">);</span> <span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">870.09</span><span class="p">,</span> <span class="mf">0.94</span> <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span><span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">neon_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">);</span> <span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -40.1824898255901  &lt;S^2&gt; = 1.2867929e-11  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -29.4958396253172  &lt;S^2&gt; = 0.78164491  2S+1 = 2.0313984
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.1650803806072  &lt;S^2&gt; = 4.4915183e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -41.2658591428905  &lt;S^2&gt; = 0.77538402  2S+1 = 2.0252249
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783204  &lt;S^2&gt; = 8.9102059e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.1707263747172  &lt;S^2&gt; = 0.76785148  2S+1 = 2.0177725
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -99.9883680524569  &lt;S^2&gt; = 1.8305357e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -74.5169382026287  &lt;S^2&gt; = 0.76048532  2S+1 = 2.010458
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -128.47753647693  &lt;S^2&gt; = -4.4408921e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -96.5451008872392  &lt;S^2&gt; = 0.7558045  2S+1 = 2.0057961
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Plot error from MO energies and delta-SCF</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">err_koopman</span><span class="p">,</span><span class="s1">&#39;bs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">err_delta</span><span class="p">,</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">5.5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Koopmans</span><span class="se">\&#39;</span><span class="s1"> theorem&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Delta$SCF&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error wrt experiment [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],(</span><span class="sa">r</span><span class="s1">&#39;CH$_4$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;NH$_3$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;H$_2$O&#39;</span><span class="p">,</span><span class="s1">&#39;HF&#39;</span><span class="p">,</span><span class="s1">&#39;Ne&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_7_0.png" src="../_images/xray_cons_7_0.png" />
</div>
</div>
<p>We see that the error from orbital energies is large (14.4-22.3 eV) and clearly scale with atomic number, while the error of <span class="math notranslate nohighlight">\(\Delta\)</span>SCF remains small (absolute error of 0.15-0.38 eV) and does not clearly scale with atomic number.</p>
</div>
<div class="section" id="including-for-wave-function-methods">
<h3>Including for wave-function methods<a class="headerlink" href="#including-for-wave-function-methods" title="Permalink to this headline">¶</a></h3>
<p>Considering the X-ray absorption and emission spectrum of water, the error wrt experiment for the ADC hierarchy can be considered as:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform CVS-ADC calculations</span>
<span class="n">xas_adc1</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xas_adc2</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xas_adc2x</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2x</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xas_adc3</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc3</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>

<span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform ADC calculations</span>
<span class="n">xes_adc1</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc1</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span><span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xes_adc2</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span><span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xes_adc2x</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2x</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span><span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xes_adc3</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc3</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span><span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783229
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     4       0.10573   14ms  [20.3034032  20.40318715]
  2     8      0.029309   25ms  [20.24463705 20.27156463]
  3    12    0.00022724   37ms  [20.24396663 20.26536094]
=== Converged ===
    Number of matrix applies:    12
    Total solver time:           79.870ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     4        2.7182  190ms  [20.32021518 20.4183277 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2     8        0.2748  126ms  [19.73738238 19.85025332]
  3    12     0.0065501  175ms  [19.72453857 19.80831836]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    16     0.0011148  181ms  [19.72393684 19.80695317]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    20    0.00012468  217ms  [19.72387817 19.80675888]
=== Converged ===
    Number of matrix applies:    20
    Total solver time:           903.425ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     4        2.7182  152ms  [20.32021518 20.4183277 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2     8       0.50135  170ms  [19.67341669 19.7822023 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    12      0.032376  221ms  [19.62437736 19.70883848]
  4    16     0.0026694  238ms  [19.62134632 19.70354934]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    20    0.00062428  250ms  [19.62092748 19.70273541]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6     8    0.00018444  298ms  [19.6209144  19.70260657]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             1s 342ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc3 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     4        2.0529   77ms  [20.29273463 20.3910156 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2     8       0.39616  228ms  [19.82796592 19.91387878]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    12       0.02035  231ms  [19.78931938 19.85480006]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    16     0.0052039  283ms  [19.7861078  19.84949286]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    20     0.0005282  279ms  [19.78568304 19.84840683]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6     8    9.7241e-05  277ms  [19.78567193 19.84830223]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             1s 387ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783204  &lt;S^2&gt; = 8.905765e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.1707263747173  &lt;S^2&gt; = 0.76785148  2S+1 = 2.0177725
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc1  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     4      0.049483   14ms  [-19.11819684 -19.02644396]
  2     8    1.3051e-05   25ms  [-19.11905858 -19.02755065]
=== Converged ===
    Number of matrix applies:    8
    Total solver time:           41.517ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     4         7.266   1.2s  [-19.07633391 -18.98282659]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2     8      0.028336  218ms  [-19.39301518 -19.31945214]
  3    12    1.5342e-05  194ms  [-19.39371908 -19.32028065]
=== Converged ===
    Number of matrix applies:    12
    Total solver time:             1s 645ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2x  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     4         7.266   1.5s  [-19.07633391 -18.98282659]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2     8         1.092  232ms  [-19.42248597 -19.35490846]
  3    12     0.0059957  266ms  [-19.45381273 -19.38228049]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    16    9.3044e-05  255ms  [-19.45398823 -19.38248508]
=== Converged ===
    Number of matrix applies:    16
    Total solver time:             2s 265ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc3  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     4        6.9216  183ms  [-19.07639784 -18.98297488]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2     8       0.88049  307ms  [-19.34067965 -19.26610519]
  3    12     0.0050128  273ms  [-19.36657392 -19.28949172]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    16     9.241e-05  306ms  [-19.36671855 -19.28965944]
=== Converged ===
    Number of matrix applies:    16
    Total solver time:             1s  78ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XAS energy&#39;</span><span class="p">)</span>
<span class="n">expt</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="mf">534.00</span><span class="p">,</span><span class="mf">0.37</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">xas_adc1</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">xas_adc2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">au2ev</span><span class="o">*</span><span class="n">xas_adc2x</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">xas_adc3</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error wrt experiment [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],(</span><span class="s1">&#39;ADC(1)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)-x&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(3/2)&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XAS oscillator strength&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xas_adc1</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xas_adc2</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">xas_adc2x</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">xas_adc3</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absolute oscillator strength&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],(</span><span class="s1">&#39;ADC(1)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)-x&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(3/2)&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XES energy&#39;</span><span class="p">)</span>
<span class="n">expt</span><span class="p">,</span><span class="n">rel</span> <span class="o">=</span> <span class="mf">527.10</span><span class="p">,</span><span class="mf">0.37</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">xes_adc1</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">xes_adc2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">xes_adc2x</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">xes_adc3</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rel</span><span class="o">-</span><span class="n">expt</span><span class="p">,</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error wrt experiment [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],(</span><span class="s1">&#39;ADC(1)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)-x&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(3/2)&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;XES oscillator strength&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xes_adc1</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xes_adc2</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">xes_adc2x</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">xes_adc3</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absolute oscillator strength&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],(</span><span class="s1">&#39;ADC(1)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(2)-x&#39;</span><span class="p">,</span><span class="s1">&#39;ADC(3/2)&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_10_0.png" src="../_images/xray_cons_10_0.png" />
</div>
</div>
<p>As can be seen, the smallest discrepancy for XAS is observed for CVS-ADC(2)-x, and for XES it is here noted to be for ADC(3/2). In general, it has been noted that CVS-ADC(2)-x performs best for <span class="xref myst">XAS</span>, and ADC(2) for <span class="xref myst">XES</span>. As ADC(3/2) is correct in higher order of perturbation theory and is <span class="xref myst">seen</span> to perform best for valence excitation, it could be expected to also perform best for core properties. The fact that this is not the case has been <span class="xref myst">noted</span> to be due to balancing in relaxation effects, which are highly influential for core properties and vary significantly between XAS and XES.</p>
<p>Furthermore, we see that the oscullator strengths are varies greatly for XAS <span class="math notranslate nohighlight">\(-\)</span> in particular when comparing CVS-ADC(1) to higher order of theory <span class="math notranslate nohighlight">\(-\)</span> but not very much for XES.</p>
</div>
<div class="section" id="including-for-dft-based-methods">
<h3>Including for DFT-based methods<a class="headerlink" href="#including-for-dft-based-methods" title="Permalink to this headline">¶</a></h3>
<p>When using a <span class="math notranslate nohighlight">\(\Delta\)</span>KS approach, relaxation is explicitly accounted for due to the optimization of the core-hole state. By contrast, TDDFT is a single-excitation theory which cannot properly account for relaxation (which requires doubly-excited configuration in a response theory framework), although it can be partially accounted for through some separate correction scheme. Here it will be counteracted by the self-interaction error, as is discussed <a class="reference internal" href="#sec-xray-topics-sie"><span class="std std-ref">below</span></a>.</p>
</div>
</div>
<div class="section" id="relativity">
<span id="sec-xray-topics-rel"></span><h2>Relativity<a class="headerlink" href="#relativity" title="Permalink to this headline">¶</a></h2>
<p>Relativistic effects are siginificantly stronger for core than valence MOs, on account of the strong potential experienced by the core orbitals. These effects mainly influences calculated properties in two separate manners:</p>
<ol class="simple">
<li><p>Scalar relativistic effects, which are always present and lead to a contraction (and thus increase in binding energy) of core orbitals. Higher lying orbitals (especially for <span class="math notranslate nohighlight">\(l&gt;1\)</span>) can become decontracted due to increasing screening from contracted MOs, but this effect is typically much smaller than for, <em>e.g.</em>, 1s</p></li>
<li><p>Spin-orbit coupling, which breaks degeneracies for MOs of <span class="math notranslate nohighlight">\(l&gt;0\)</span> and is thus negligible for, <em>e.g.</em>, the <span class="math notranslate nohighlight">\(K\)</span>- and <span class="math notranslate nohighlight">\(L_1\)</span>-edges (as the splitting for valence MOs is much smaller), but very important for, <em>e.g.</em>, the <span class="math notranslate nohighlight">\(L_{2,3}\)</span>-edge</p></li>
</ol>
<div class="section" id="scalar-relativistic-effects">
<h3>Scalar relativistic effects<a class="headerlink" href="#scalar-relativistic-effects" title="Permalink to this headline">¶</a></h3>
<p>Including scalar relativistic effects is relatively straight-forward, as a number of Hamiltonians are available which can include these effects in a 1-component framework. Furthermore, the effects are typically quite stable over the separate elements, and it can thus often be considered as a common absolute off-set in energy. It should be noted that the (scalar) relativistic effects are technically not additive with electron correlation, such that a proper consideration should account for both simultaneously. In practise, this discrepancy is small and relativistc shifts from lower level of theory is typically sufficient.</p>
<div class="section" id="for-ionization-potentials">
<span id="sec-xray-topics-rel-ip"></span><h4>For ionization potentials<a class="headerlink" href="#for-ionization-potentials" title="Permalink to this headline">¶</a></h4>
<p>The scalar relativistic effects for ionization potentials can be estimated from MO energies or using <span class="math notranslate nohighlight">\(\Delta\)</span>SCF:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Containers for atomic number, MO energy shift, delta-SCF shift, and delta-SCF IP</span>
<span class="n">z</span><span class="p">,</span> <span class="n">mo_diff</span><span class="p">,</span> <span class="n">delta_diff</span><span class="p">,</span> <span class="n">delta_ip</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>

<span class="c1"># Consider even-numbered elements fron helium to argon</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="c1"># Atomic calculation</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   0.0  0.0  0.0&#39;</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">struct</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Perform non-relativistic unrestricted SCF calculation</span>
    <span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Perform non-relativistic unrestricted SCF calculation</span>
    <span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span> <span class="c1"># Scalar relativistic effects with the X2C Hamiltonian</span>
    <span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Append atomic number</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Append MO energy shift</span>
    <span class="n">mo_diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># Copy molecular orbitals and change population of 1s</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Perform non-relativistic core-hole calculation</span>
    <span class="n">ion_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">ion_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Perform relativistic core-hole calculation (can use the same gues wave function)</span>
    <span class="n">ion_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_rel</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">ion_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Append delta energy and relativistic shift</span>
    <span class="n">delta_diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">((</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">ion_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)))</span>
    <span class="n">delta_ip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -2.85516042615488  &lt;S^2&gt; = 1.3322676e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -2.85525300822691  &lt;S^2&gt; = 1.110223e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -1.99426876611128  &lt;S^2&gt; = 0.75  2S+1 = 2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -1.99436899680469  &lt;S^2&gt; = 0.75  2S+1 = 2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.x2c.sfx2c1e.sfx2c1e.&lt;locals&gt;.SFX2C1E_SCF&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -14.5695044397229  &lt;S^2&gt; = -1.7763568e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -14.5720013914555  &lt;S^2&gt; = -2.220446e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -10.0436351801509  &lt;S^2&gt; = 0.75848247  2S+1 = 2.0084646
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -10.0457383213543  &lt;S^2&gt; = 0.75849935  2S+1 = 2.0084814
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -37.5910403939196  &lt;S^2&gt; = -2.220446e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -37.6059227998345  &lt;S^2&gt; = 2.6645353e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -26.6597884405474  &lt;S^2&gt; = 0.75752228  2S+1 = 2.0075082
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -26.671134300774  &lt;S^2&gt; = 0.75754084  2S+1 = 2.0075267
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -74.658565893707  &lt;S^2&gt; = -5.3290705e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -74.7104111450784  &lt;S^2&gt; = -1.7763568e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -54.587706038367  &lt;S^2&gt; = 0.75669834  2S+1 = 2.0066872
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -54.6258998929679  &lt;S^2&gt; = 0.75671779  2S+1 = 2.0067065
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -128.47753647693  &lt;S^2&gt; = -2.6645353e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -128.613589398693  &lt;S^2&gt; = 4.4408921e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -96.5451008872393  &lt;S^2&gt; = 0.7558045  2S+1 = 2.0057961
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -96.6441723559853  &lt;S^2&gt; = 0.75582486  2S+1 = 2.0058164
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -199.599964527342  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -199.904947912667  &lt;S^2&gt; = -2.6645353e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -151.501422326007  &lt;S^2&gt; = 0.753335  2S+1 = 2.0033322
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -151.726389870158  &lt;S^2&gt; = 0.75336228  2S+1 = 2.0033595
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -288.775708191847  &lt;S^2&gt; = 2.6645353e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -289.376057842852  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -220.965058272559  &lt;S^2&gt; = 0.75256466  2S+1 = 2.002563
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -221.408704675141  &lt;S^2&gt; = 0.75259131  2S+1 = 2.0025896
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -397.401239622075  &lt;S^2&gt; = 2.6645353e-15  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -398.478834595186  &lt;S^2&gt; = 1.7763568e-15  2S+1 = 1
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">57</span><span class="n">c2bbbe59a6</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">ion_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">30</span>     <span class="n">ion_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="c1"># Perform relativistic core-hole calculation (can use the same gues wave function)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>     <span class="n">ion_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/lib/misc.py</span> in <span class="ni">aliased_fn</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">596</span>     <span class="n">fname</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span>     <span class="k">def</span> <span class="nf">aliased_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">598</span>         <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span> 
<span class="g g-Whitespace">    </span><span class="mi">600</span>     <span class="k">if</span> <span class="n">alias_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/scf/hf.py</span> in <span class="ni">scf</span><span class="nt">(self, dm0, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1640</span>             <span class="bp">self</span><span class="o">.</span><span class="n">converged</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e_tot</span><span class="p">,</span> \
<span class="g g-Whitespace">   </span><span class="mi">1641</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mo_occ</span> <span class="o">=</span> \
<span class="ne">-&gt; </span><span class="mi">1642</span>                     <span class="n">kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_tol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_tol_grad</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1643</span>                            <span class="n">dm0</span><span class="o">=</span><span class="n">dm0</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1644</span>                            <span class="n">conv_check</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_check</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/scf/hf.py</span> in <span class="ni">kernel</span><span class="nt">(mf, conv_tol, conv_tol_grad, dump_chk, dm0, callback, conv_check, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>         <span class="n">fock</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">get_fock</span><span class="p">(</span><span class="n">h1e</span><span class="p">,</span> <span class="n">s1e</span><span class="p">,</span> <span class="n">vhf</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">cycle</span><span class="p">,</span> <span class="n">mf_diis</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>         <span class="n">mo_energy</span><span class="p">,</span> <span class="n">mo_coeff</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">fock</span><span class="p">,</span> <span class="n">s1e</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">173</span>         <span class="n">mo_occ</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">get_occ</span><span class="p">(</span><span class="n">mo_energy</span><span class="p">,</span> <span class="n">mo_coeff</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span>         <span class="n">dm</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">make_rdm1</span><span class="p">(</span><span class="n">mo_coeff</span><span class="p">,</span> <span class="n">mo_occ</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>         <span class="c1"># attach mo_coeff and mo_occ to dm to improve DFT get_veff efficiency</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/scf/addons.py</span> in <span class="ni">get_occ</span><span class="nt">(mo_energy, mo_coeff)</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>         <span class="n">nocc_a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">setocc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span>         <span class="n">nocc_b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">setocc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="ne">--&gt; </span><span class="mi">255</span>         <span class="n">s_a</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="p">(</span><span class="n">coef_occ_a</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">get_ovlp</span><span class="p">(),</span> <span class="n">mo_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span>         <span class="n">s_b</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="p">(</span><span class="n">coef_occ_b</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">get_ovlp</span><span class="p">(),</span> <span class="n">mo_coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span>         <span class="c1">#choose a subset of mo_coeff, which maximizes &lt;old|now&gt;</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/scf/hf.py</span> in <span class="ni">get_ovlp</span><span class="nt">(self, mol)</span>
<span class="g g-Whitespace">   </span><span class="mi">1496</span>     <span class="k">def</span> <span class="nf">get_ovlp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1497</span>         <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mol</span>
<span class="ne">-&gt; </span><span class="mi">1498</span>         <span class="k">return</span> <span class="n">get_ovlp</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1499</span> 
<span class="g g-Whitespace">   </span><span class="mi">1500</span>     <span class="n">get_fock</span> <span class="o">=</span> <span class="n">get_fock</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/scf/hf.py</span> in <span class="ni">get_ovlp</span><span class="nt">(mol)</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="sd">&#39;&#39;&#39;Overlap matrix</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span><span class="sd">     &#39;&#39;&#39;</span>
<span class="ne">--&gt; </span><span class="mi">330</span>     <span class="k">return</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor_symmetric</span><span class="p">(</span><span class="s1">&#39;int1e_ovlp&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span> 
<span class="g g-Whitespace">    </span><span class="mi">332</span> 

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/gto/mole.py</span> in <span class="ni">intor_symmetric</span><span class="nt">(self, intor, comp)</span>
<span class="g g-Whitespace">   </span><span class="mi">3290</span>          <span class="p">[</span> <span class="mf">0.00000000</span><span class="o">+</span><span class="mf">0.j</span> <span class="o">-</span><span class="mf">0.67146312</span><span class="o">+</span><span class="mf">0.j</span>  <span class="mf">0.00000000</span><span class="o">+</span><span class="mf">0.j</span> <span class="o">-</span><span class="mf">1.69771092</span><span class="o">+</span><span class="mf">0.j</span><span class="p">]]</span>
<span class="g g-Whitespace">   </span><span class="mi">3291</span>         <span class="s1">&#39;&#39;&#39;</span>
<span class="ne">-&gt; </span><span class="mi">3292</span><span class="s1">         return self.intor(intor, comp, 1, aosym=&#39;s4&#39;)</span>
<span class="g g-Whitespace">   </span><span class="mi">3293</span><span class="s1"> </span>
<span class="g g-Whitespace">   </span><span class="mi">3294</span><span class="s1">     def intor_asymmetric(self, intor, comp=None):</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/gto/mole.py</span> in <span class="ni">intor</span><span class="nt">(self, intor, comp, hermi, aosym, out, shls_slice)</span>
<span class="g g-Whitespace">   </span><span class="mi">3252</span><span class="s1">         else:</span>
<span class="g g-Whitespace">   </span><span class="mi">3253</span><span class="s1">             bas = self._bas</span>
<span class="ne">-&gt; </span><span class="mi">3254</span><span class="s1">         return moleintor.getints(intor, self._atm, bas, self._env,</span>
<span class="g g-Whitespace">   </span><span class="mi">3255</span><span class="s1">                                  shls_slice, comp, hermi, aosym, out=out)</span>
<span class="g g-Whitespace">   </span><span class="mi">3256</span><span class="s1"> </span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/gto/moleintor.py</span> in <span class="ni">getints</span><span class="nt">(intor_name, atm, bas, env, shls_slice, comp, hermi, aosym, ao_loc, cintopt, out)</span>
<span class="g g-Whitespace">    </span><span class="mi">228</span><span class="s1">         intor_name.startswith(&#39;ECP&#39;) or</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span><span class="s1">         intor_name.startswith(&#39;int2c2e&#39;)):</span>
<span class="ne">--&gt; </span><span class="mi">230</span><span class="s1">         return getints2c(intor_name, atm, bas, env, shls_slice, comp,</span>
<span class="g g-Whitespace">    </span><span class="mi">231</span><span class="s1">                          hermi, ao_loc, cintopt, out)</span>
<span class="g g-Whitespace">    </span><span class="mi">232</span><span class="s1">     elif intor_name.startswith(&#39;int2e&#39;) or intor_name.startswith(&#39;int4c1e&#39;):</span>

<span class="nn">~/.local/lib/python3.8/site-packages/pyscf/gto/moleintor.py</span> in <span class="ni">getints2c</span><span class="nt">(intor_name, atm, bas, env, shls_slice, comp, hermi, ao_loc, cintopt, out)</span>
<span class="g g-Whitespace">    </span><span class="mi">468</span><span class="s1"> </span>
<span class="g g-Whitespace">    </span><span class="mi">469</span><span class="s1">         fn = getattr(libcgto, drv_name)</span>
<span class="ne">--&gt; </span><span class="mi">470</span><span class="s1">         fn(getattr(libcgto, intor_name), mat.ctypes.data_as(ctypes.c_void_p),</span>
<span class="g g-Whitespace">    </span><span class="mi">471</span><span class="s1">            ctypes.c_int(comp), ctypes.c_int(hermi),</span>
<span class="g g-Whitespace">    </span><span class="mi">472</span><span class="s1">            (ctypes.c_int*4)(*(shls_slice[:4])),</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Plot absolute scalar relativistic effects</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Absolute relativistic effects&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">mo_diff</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">delta_diff</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;From MO energies&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;From $\Delta$SCF&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Atomic number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absolute shift [eV]&#39;</span><span class="p">)</span>

<span class="c1"># Plot percentage change</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Percentage change&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mo_diff</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_ip</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_diff</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_ip</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Atomic number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative shift [</span><span class="si">% o</span><span class="s1">f total energy]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_13_0.png" src="../_images/xray_cons_13_0.png" />
</div>
</div>
<p>Two things are immediatelly clear:</p>
<ol class="simple">
<li><p>The shift in 1s ionization potential is strickly non-linear with respect to the atomic number, and using a simple model for a hydrogen-like system the main effects are expected to scale as <span class="math notranslate nohighlight">\(Z^4\)</span>. Fitting to a power function, we obtain <span class="math notranslate nohighlight">\(Z^{4.6}\)</span> (with <span class="math notranslate nohighlight">\(R^2=0.997\)</span>) for the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF results, so some deviation from the hydrogenic systems</p></li>
<li><p>The relativistic shifts for MO energies and <span class="math notranslate nohighlight">\(\Delta\)</span>SCF IP:s are almost identical, with a discrepancy that increases with <span class="math notranslate nohighlight">\(Z\)</span> from 0.00 to 0.31 eV. Performing similar calculations with <span class="math notranslate nohighlight">\(\Delta\)</span>CCSD is expected to yield very similar values, such that the scalar relativistic effects for the 1s MO of the second and third row can be estimated from MO energies</p></li>
</ol>
</div>
<div class="section" id="for-spectra-xas">
<h4>For spectra (XAS)<a class="headerlink" href="#for-spectra-xas" title="Permalink to this headline">¶</a></h4>
<p>For spectrum calculations, scalar relativistic effects can be included merely by using an appropriate Hamiltonian for the SCF calculation, as here illustrated for the X-ray absorption spectrum of water:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="c1"># using a decontracted basis set to better describe contracted relativistic 1s</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform non-relativistic restricted SCF and CVS-ADC(2) calculations</span>
<span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_nr</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_nr</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Perform relativistic restricted SCF and CVS-ADC(2) calculations</span>
<span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>
<span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_rel</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_rel</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783229
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1    10        2.7777  293ms  [20.27588296 20.31155183 20.86140432 20.92171887 20.92996834]
  2    20      0.035824  522ms  [19.72872545 19.81092766 20.31040554 20.40470691 20.49837544]
  3    30    4.1402e-05  543ms  [19.72388013 19.80673445 20.3057139  20.39997868 20.49772007]
=== Converged ===
    Number of matrix applies:    30
    Total solver time:             1s 385ms
converged SCF energy = -76.0403950942124
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    10        2.7842  277ms  [20.29049204 20.32651304 20.87612706 20.93658562 20.9451677 ]
  2    20      0.036027  365ms  [19.74278629 19.82524258 20.32473443 20.41889866 20.51251234]
  3    30    4.1677e-05  438ms  [19.73792472 19.82102908 20.32001931 20.41414446 20.51185242]
=== Converged ===
    Number of matrix applies:    30
    Total solver time:             1s 104ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># Relativistic and non-relativistc spectra with custom broadening</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>  <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_nr</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_nr</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">534</span><span class="p">,</span><span class="mi">542</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>  <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rel</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rel</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">534</span><span class="p">,</span><span class="mi">542</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Non-relativistic&#39;</span><span class="p">,</span><span class="s1">&#39;Scalar relativistic&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy shift of the first feature:&#39;</span><span class="p">,</span>
      <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">adc_rel</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">adc_nr</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_16_0.png" src="../_images/xray_cons_16_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy shift of the first feature: 0.38 eV
</pre></div>
</div>
</div>
</div>
<p>We see that the spectrum is shifted upwards by <span class="math notranslate nohighlight">\(\sim\)</span>0.38 eV, due to the increase in core-electron binding energy. The same approach can be used for including these effects also for X-ray emission spectrum  calculations.</p>
</div>
</div>
<div class="section" id="spin-orbit-coupling">
<h3>Spin-orbit coupling<a class="headerlink" href="#spin-orbit-coupling" title="Permalink to this headline">¶</a></h3>
<p>Including the spin-orbit effects are more complicated, and can either be</p>
<ul class="simple">
<li><p>Included by using 4-component relativistic theory, where it does not need to explicitly addressed</p></li>
<li><p>Included in a non-relativistic scheme through a perturbative scheme, or through some <em>ad hoc</em> correction</p></li>
</ul>
<p>At the present stage, including spin-orbit effects is beyond the scope of this tutorial. As such, if the <span class="math notranslate nohighlight">\(L_{2,3}\)</span>edge (or higher-lying edges with <span class="math notranslate nohighlight">\(l&gt;0\)</span>) is to be considered, the interested reader will have to find this discussion elsewhere.</p>
</div>
</div>
<div class="section" id="basis-set-considerations">
<span id="sec-xray-topics-basis"></span><h2>Basis set considerations<a class="headerlink" href="#basis-set-considerations" title="Permalink to this headline">¶</a></h2>
<p>The basis set requirements of X-ray spectrum calculations depend on which spectroscopy is considered</p>
<ul class="simple">
<li><p>XPS and XES probes occupied states, and thus need a good description of those</p></li>
<li><p>XAS and RIXS probes excited states, and thus need an improved description of this region</p></li>
</ul>
<p>In all cases the relaxation due to the creation of a core-hole need to be accommodated, which yield requirements of reasonable flexibility of the core and inner valence region. This is not typically the case for standard basis sets, as they are typically constructed with valence properties in mind and thus have a minimal or close to minimal description of the core region. A number of approaches for improving such valence-focused basis sets have thus been developed:</p>
<ol class="simple">
<li><p>Augment the Dunning basis sets with core-polarizing functions, <em>e.g.</em> cc-pV<em>n</em>Z <span class="math notranslate nohighlight">\(\rightarrow\)</span> cc-pCV<em>n</em>Z</p></li>
<li><p>Adding extra flexibility by performing full or partial decontraction, such as</p>
<ol class="simple">
<li><p>Decontracting 1s of the probed element (<em>e.g.</em> u6-311++G**, which is based on 6-311++G**)</p></li>
<li><p>Fully decontracting the basis set (<em>e.g.</em> un6-311++G**, which is based on 6-311++G**)</p></li>
</ol>
</li>
<li><p>Use basis functions from the next element, as inspired by the <span class="math notranslate nohighlight">\(Z+1\)</span> approximation</p></li>
</ol>
<p>As an illustration, we consider the IP of water with different basis sets and levels of theory</p>
<p><em>Expand hidden cell for u6-311G**, un6-311G**, and 6-311G** (Z+1) basis sets.</em></p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">un6311gss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      9.628370               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      2.853320               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">z6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  0.00189515</span>
<span class="s1">   1297.230                  0.0143859</span>
<span class="s1">    299.2960                 0.0707320</span>
<span class="s1">     87.37710                0.2400010</span>
<span class="s1">     25.67890                0.5947970</span>
<span class="s1">      3.740040               0.2808020</span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">O    S</span>
<span class="s1">  11427.10                   0.00180093</span>
<span class="s1">   1722.350                  0.0137419</span>
<span class="s1">    395.7460                 0.0681334</span>
<span class="s1">    115.1390                 0.2333250</span>
<span class="s1">     33.60260                0.5890860</span>
<span class="s1">      4.919010               0.2995050</span>
<span class="s1">O    SP</span>
<span class="s1">     55.44410                0.114536               0.0354609</span>
<span class="s1">     12.63230                0.920512               0.237451</span>
<span class="s1">      3.717560              -0.00337804             0.820458</span>
<span class="s1">O    SP</span>
<span class="s1">      1.165450               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.321892               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.750                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Investigated basis sets</span>
<span class="n">basis_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6-311G**&#39;</span><span class="p">,</span><span class="n">u6311gss</span><span class="p">,</span><span class="n">un6311gss</span><span class="p">,</span><span class="n">z6311gss</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVTZ&#39;</span><span class="p">,</span><span class="s1">&#39;cc-pVQZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVQZ&#39;</span><span class="p">]</span>

<span class="c1"># Containers for IP calculated with four different delta calculations: HF, MP2, CCSD, and B3LYP</span>
<span class="n">ip_hf</span><span class="p">,</span> <span class="n">ip_mp2</span><span class="p">,</span> <span class="n">ip_ccsd</span><span class="p">,</span> <span class="n">ip_b3lyp</span><span class="p">,</span> <span class="n">n_bas</span> <span class="o">=</span> <span class="p">[],[],[],[],[]</span>

<span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_sets</span><span class="p">:</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Unrestricted SCF calculation of neutral</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals and change population of 1s</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Unrestricted HF calculation of core-hole and appending delta_HF IP</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_hf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="c1"># CCSD calculations of neutral and core-hole and appending delta_CCSD IP</span>
    <span class="n">ccsd_res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfres</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">ccsd_ion</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_cycle</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">ip_ccsd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
    <span class="c1"># Appending delta_MP2 IP</span>
    <span class="n">ip_mp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_hf</span><span class="o">+</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">emp2</span><span class="o">-</span><span class="p">(</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_hf</span><span class="o">+</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">emp2</span><span class="p">)))</span>
    <span class="c1"># Unrestricted KS-DFT calculation of neutral</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scfres</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
    <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals and change population of 1s</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Unrestricted KS-DFT calculation of core-hole and appending delta_DFT IP</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scfion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">;</span> <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_b3lyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="c1"># Append basis set size</span>
    <span class="n">n_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># Plot IP:s, with error as a function of basis set size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_hf</span><span class="p">,</span><span class="s1">&#39;r*&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_mp2</span><span class="p">,</span><span class="s1">&#39;bv&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_ccsd</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_b3lyp</span><span class="p">,</span><span class="s1">&#39;go&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;HF&#39;</span><span class="p">,</span><span class="s1">&#39;MP2&#39;</span><span class="p">,</span><span class="s1">&#39;CCSD&#39;</span><span class="p">,</span><span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span><span class="s1">&#39;Expt&#39;</span><span class="p">,</span><span class="s1">&#39;Expt - 0.37 eV&#39;</span><span class="p">))</span>

<span class="c1"># Experimental value as a dotted line, minus relativistic effect as dashed line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">],[</span><span class="mf">539.9</span><span class="p">,</span><span class="mf">539.9</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">],[</span><span class="mf">539.9</span><span class="o">-</span><span class="mf">0.37</span><span class="p">,</span><span class="mf">539.9</span><span class="o">-</span><span class="mf">0.37</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="c1"># Basis set label as x-ticks</span>
<span class="n">basis_set_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;u6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;un6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;6-311G** (Z+1)&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVTZ&#39;</span><span class="p">,</span><span class="s1">&#39;cc-pVQZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVQZ&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">basis_set_labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Labels and setting x-interval</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ionization potential [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The execution of which yields</p>
<div class="figure align-default" id="basis-xps">
<img alt="../_images/basis_xps.svg" src="../_images/basis_xps.svg" /></div>
<p>At the HF and KS-DFT levels of theory we see that some of the smaller basis sets have fortuitous error cancellations, such that both 6-311G** and cc-pVTZ yields results close to experimental values. However, augmenting these basis sets with more functions in the core region brings us away from experimental measurements (note that the calculations does not include relativistic effects, so the comparison would be toward experiment minus relativistic shift, <em>i.e.</em> the dashed line).</p>
<p>With MP2 and CCSD we note very similar results for the smaller basis sets, which then deviates significantly for cc-pVTZ and above. <span class="math notranslate nohighlight">\(\Delta\)</span>CCSD estimates using core-polarized cc-pVTZ and cc-pVQZ are well in line with experimental measurements. Augmenting 6-311G** basis sets with decontracted core region (u6-311G**) yields some improvement at a relatively low increase in computational cost, and further decontracting the full set (un6-311G**) or adding basis functions from <span class="math notranslate nohighlight">\(Z+1\)</span> (6-311G** (Z+1)) yields some additional improvement.</p>
</div>
<div class="section" id="self-interaction-error-in-dft">
<span id="sec-xray-topics-sie"></span><h2>Self-interaction error in DFT<a class="headerlink" href="#self-interaction-error-in-dft" title="Permalink to this headline">¶</a></h2>
<p>For a single-electron systems the following equality should hold for the two-electron terms:</p>
<div class="amsmath math notranslate nohighlight" id="equation-fe45712d-d6ac-408e-bfc2-5d83a77ff9ef">
<span class="eqno">(5)<a class="headerlink" href="#equation-fe45712d-d6ac-408e-bfc2-5d83a77ff9ef" title="Permalink to this equation">¶</a></span>\[\begin{equation}
J[\rho] + E_{xc} [\rho] = 0.0
\end{equation}\]</div>
<p>This cancellation is preserved within HF theory, but for any approximate functionals in KS-DFT the equality will no longer hold, resulting in the potentially significant errors due to spurious self-interactions. Reformulated, the Coulomb self-repulsion of each electron included in the Coulomb operator is exactly canceled by the nonlocal exchange self-attraction in Hartree-Fock, but this is no longer the case when the exchange operator is replaced by an approximate exchange functional.</p>
<p>As such, KS-DFT possess a self-interaction error (SIE), which shows a strong dependence on how compact the respective MOs are. This means that the self-interaction error is significantly more influential for core properties than for valence properties, and the tendency to decontract core orbitals due to the SIE has a opposite effect on transition energies as compared to relaxation effects.</p>
<p>Let us consider the ionization potential of water, as calculated with MO energy and <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> using two different exchange-correlation functionals with variable HF exchange:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using MO energies for TDHF and TDDFT yield the same IP as when addressing core-transition to extremely diffuse basis functions (due to the lack of relaxation), and is thus representative of the error for such XAS calculations.</p>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Investigated HF exchange and result containers</span>
<span class="n">hf_exc</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
<span class="n">hf_blyp</span><span class="p">,</span><span class="n">hf_pbe</span> <span class="o">=</span> <span class="p">[[],[]],</span> <span class="p">[[],[]]</span>

<span class="k">def</span> <span class="nf">dft_delta</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">xc</span><span class="p">):</span>
    <span class="c1"># Neutral calculation</span>
    <span class="n">dft_res</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Core-hole calculation</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">dft_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">dft_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">dft_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">dft_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">())</span>

<span class="k">for</span> <span class="n">h_x</span> <span class="ow">in</span> <span class="n">hf_exc</span><span class="p">:</span>
    <span class="c1"># BxLYP (Slater exchange 0.08, except when HF i 1.00)</span>
    <span class="k">if</span> <span class="n">h_x</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span> <span class="n">s_x</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">else</span><span class="p">:</span>          <span class="n">s_x</span> <span class="o">=</span> <span class="mf">0.08</span> 
    <span class="n">b_x</span>      <span class="o">=</span> <span class="mf">1.00</span> <span class="o">-</span> <span class="n">h_x</span> <span class="o">-</span> <span class="n">s_x</span>
    <span class="n">v_e</span><span class="p">,</span> <span class="n">v_l</span> <span class="o">=</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.81</span>
    <span class="n">xc</span>       <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{h_x:}</span><span class="s1"> * HF + </span><span class="si">{s_x:}</span><span class="s1"> * Slater + </span><span class="si">{b_x:}</span><span class="s1"> * B88, </span><span class="si">{v_l:}</span><span class="s1"> * LYP + </span><span class="si">{v_e:}</span><span class="s1"> * VWN&#39;</span>
    <span class="n">E_mo</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">dft_delta</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">xc</span><span class="p">)</span>
    <span class="n">hf_blyp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_mo</span><span class="p">)</span>
    <span class="n">hf_blyp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="p">)</span>
    <span class="c1"># PBEx</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">h_x</span>
    <span class="n">xc</span>  <span class="o">=</span> <span class="n">f</span><span class="s1">&#39;</span><span class="si">{h_x:}</span><span class="s1"> * HF + </span><span class="si">{p_x:}</span><span class="s1"> * PBE, PBE&#39;</span>
    <span class="n">E_mo</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">dft_delta</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span><span class="n">xc</span><span class="p">)</span>
    <span class="n">hf_pbe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_mo</span><span class="p">)</span>
    <span class="n">hf_pbe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -76.3570352138422  &lt;S^2&gt; = 9.9031894e-13  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.dft.uks.UKS&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.4237670553342  &lt;S^2&gt; = 0.75372494  2S+1 = 2.0037215
converged SCF energy = -76.2984404502067  &lt;S^2&gt; = 6.8922645e-13  2S+1 = 1
converged SCF energy = -56.3921764305246  &lt;S^2&gt; = 0.75419443  2S+1 = 2.00419
converged SCF energy = -76.3458605029087  &lt;S^2&gt; = 1.9792168e-11  2S+1 = 1
converged SCF energy = -56.4097695592283  &lt;S^2&gt; = 0.75459735  2S+1 = 2.0045921
converged SCF energy = -76.3012084721052  &lt;S^2&gt; = 3.3262282e-12  2S+1 = 1
converged SCF energy = -56.3896010586894  &lt;S^2&gt; = 0.7552122  2S+1 = 2.0052054
converged SCF energy = -76.3352647255065  &lt;S^2&gt; = 1.3764101e-11  2S+1 = 1
converged SCF energy = -56.3960927713704  &lt;S^2&gt; = 0.7556359  2S+1 = 2.005628
converged SCF energy = -76.304577252447  &lt;S^2&gt; = 2.934275e-11  2S+1 = 1
converged SCF energy = -56.3873473076527  &lt;S^2&gt; = 0.75643162  2S+1 = 2.0064213
converged SCF energy = -76.325199834941  &lt;S^2&gt; = 1.0940582e-11  2S+1 = 1
converged SCF energy = -56.3826985529724  &lt;S^2&gt; = 0.75686154  2S+1 = 2.0068498
converged SCF energy = -76.3084953868845  &lt;S^2&gt; = 7.457146e-12  2S+1 = 1
converged SCF energy = -56.3853783589997  &lt;S^2&gt; = 0.75788093  2S+1 = 2.0078655
converged SCF energy = -76.3853635207931  &lt;S^2&gt; = 1.0878587e-10  2S+1 = 1
converged SCF energy = -56.4195161721823  &lt;S^2&gt; = 0.75808069  2S+1 = 2.0080644
converged SCF energy = -76.3129197258738  &lt;S^2&gt; = 2.0943247e-12  2S+1 = 1
converged SCF energy = -56.383660960872  &lt;S^2&gt; = 0.75959312  2S+1 = 2.0095702
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># DFT ionization potentials, including scalar relativistic shift</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_blyp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.37</span><span class="p">,</span><span class="s1">&#39;bs--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_blyp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mf">0.37</span><span class="p">,</span><span class="s1">&#39;ro--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_pbe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mf">0.37</span><span class="p">,</span><span class="s1">&#39;d--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_pbe</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mf">0.37</span><span class="p">,</span><span class="s1">&#39;g^--&#39;</span><span class="p">)</span>

<span class="c1"># Experimental value and legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">],[</span><span class="mf">539.9</span><span class="p">,</span><span class="mf">539.9</span><span class="p">],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="sa">r</span><span class="s1">&#39;BxLYP ($\Delta$SCF)&#39;</span><span class="p">,</span><span class="s1">&#39;BxLYP (MO)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;PBEx ($\Delta$SCF)&#39;</span><span class="p">,</span><span class="s1">&#39;PBEx (MO)&#39;</span><span class="p">,</span><span class="s1">&#39;Expt&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.025</span><span class="p">,</span><span class="mf">1.025</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">508</span><span class="p">,</span><span class="mf">562.</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;HF exchange [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ionization potential [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_22_0.png" src="../_images/xray_cons_22_0.png" />
</div>
</div>
<p>We see that the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF error is quite constant between the two base functionals and amounts of HF exchange, while the MO energies strongly scale with HF exchange, but not the base functional. The total MO error is a function of two effects:</p>
<ol class="simple">
<li><p>Lack of relaxation, which generally leads to an overestimation of IP:s and core-excitation energies</p></li>
<li><p>Self-interaction, which by contrast leads to an underestimation of these energies</p></li>
</ol>
<p>For a typical exchange-correlation functiona (<span class="math notranslate nohighlight">\(\sim\)</span>20-25% HF exchange) the SIE thus dominates, and by tuning the (global) HF exchange to around 60% we achieve IP estimates in good agreement to experiment. We note that this is only acheieved by cancellation of above two errors, and does not mean that we have an appropriate description (or any description) of the core-excitation processes. Furthermore, a good exchange-correlation functional should possess good energies <em>and</em> densities, and focusing on only energies can push us away from such a goal. Nevertheless, a number of tailored functionals with good absolute energies have been constructed, tuning the HF exchange either in a global or range-separated manner. Note that the parameterization will have to depend on the spectroscopy, probed edge, and row of the periodic table, as the exact balance in relaxation terms and SIE varies.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Could add radial distribution/densities of functionals and compare to HF, and maybe explicitly calculate the SIE/above inequality.</p>
</div>
</div>
<div class="section" id="core-hole-localization">
<span id="sec-xray-topics-chloc"></span><h2>Core-hole localization<a class="headerlink" href="#core-hole-localization" title="Permalink to this headline">¶</a></h2>
<p>For <span class="math notranslate nohighlight">\(\Delta\)</span> SCF calculations (either for estimating IP:s or as a initial state for XES) a core-hole is created at some atomic site. For many systems, this is unproblematic, but if chemically equivalent atoms are present, the MOs are delocalized over these sites. Pefrorming a straightforward <span class="math notranslate nohighlight">\(\Delta\)</span>SCF calculation will then results in a delocalized core-hole, as illustrated below for ethene:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ethene_xyz</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">C0      0.6660048050     0.0000000000    -0.0000000000</span>
<span class="s1">C1     -0.6660048050    -0.0000000000     0.0000000000</span>
<span class="s1">H       1.2278735620     0.9228358077    -0.0000000000</span>
<span class="s1">H       1.2278735620    -0.9228358077    -0.0000000000</span>
<span class="s1">H      -1.2278735620     0.9228358077     0.0000000000</span>
<span class="s1">H      -1.2278735620    -0.9228358077     0.0000000000</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># All-electron calculation of IP</span>
<span class="n">delta_all</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ethene_xyz</span><span class="p">,</span> <span class="s1">&#39;unc-6-31G&#39;</span><span class="p">)</span>

<span class="c1"># IP calculation with ECP on one carbon</span>
<span class="n">delta_ecp</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ethene_xyz</span><span class="p">,</span> <span class="s1">&#39;unc-6-31G&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;C0&#39;</span><span class="p">:</span><span class="s1">&#39;stuttgart&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="mi">8</span><span class="n">bce28b55f90</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> 
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="c1"># All-electron calculation of IP</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="n">delta_all</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ethene_xyz</span><span class="p">,</span> <span class="s1">&#39;unc-6-31G&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> 
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1"># IP calculation with ECP on one carbon</span>

<span class="ne">NameError</span>: name &#39;Koopman_vs_delta&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># IP estimates with all-electron (delocalized core-hole)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="n">delta_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">,</span><span class="n">delta_all</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">],</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>

<span class="c1"># IP estimates with ECP (localized core-hole)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="n">delta_ecp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">,</span><span class="n">delta_ecp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.11</span><span class="p">],</span><span class="s1">&#39;bs&#39;</span><span class="p">)</span>

<span class="c1"># Experiment and figure settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],[</span><span class="mf">290.80</span><span class="p">,</span><span class="mf">290.80</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ionization potential [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],(</span><span class="s1">&#39;MO&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Delta$SCF&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_25_0.png" src="../_images/xray_cons_25_0.png" />
</div>
</div>
<p>As can be seen, the error from MO energies are very similar for the all-electron calculation (with a delocalized core-hole) and using ECP (delocalized core-hole). For the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF calculation, however, only approximately half the relaxation energy is accounted for using a delocalized core-hole. Such a discrepancy for delocalized calculations of IP:s have been noted in previously, and it has been associated with missing correlation effects which are required to properly correct the delocalized calculation. Within a full CI scheme, delocalization will no longer be an issue (and it will capture the small shift in energy between the gerade and ungerade core-hole).</p>
<p>Moving from theory, in experiment the localizatio/delocalization of core-holes is primarily relevant for diatomic systems, as other compounds will possess vibrational effects which breaks the symmetry. For diatomic systems the localized/delocalized nature of the core-hole has been seen to depend on the details of the measurement, such that both can be probed <span id="id1">[]</span>.</p>
<p>As such, for practical calculation we recommend that core-holes are localized for IP and XES calculations. For XAS it does not provide any issues for linear response methods (provided that both gerade and ungerade MOs are kept in the CVS space/equivalent), but for state-specific approaches this will again be an issue (<em>e.g.</em> STEX and TP-DFT).</p>
</div>
<div class="section" id="tailored-cvs">
<span id="sec-xray-topics-tailcvs"></span><h2>Tailored CVS<a class="headerlink" href="#tailored-cvs" title="Permalink to this headline">¶</a></h2>
<p>For large systems, it may become relevant to tailor the CVS space such that each chemically unique atom is probed in turn. While this the requires explicit consideration of each set of unique MOs in turn, it serves dual purposes which can make it worth it:</p>
<ol class="simple">
<li><p>It lower the dimensionality of the involved matrices, and thus decrease computational costs</p></li>
<li><p>The density-of-states decrease, which means that the same energy region can be resolved with a few states per unique MO, rather than having to converge a large number of eigenstates simultaneously</p></li>
</ol>
<p>While this technically does not fulfill one of foundations on which the CVS approximation is built (the MOs are not energetically well-separated), the spatial separation means that it will typically work. As an example, we consider ethene (which has delocalized MO:s) and vinylfluoride (which does not):</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ethene&#39;</span><span class="p">)</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">ethene_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># Perform CVS-ADC calculations</span>
<span class="n">ethene_adc1_0</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ethene_adc1_1</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ethene_adc1_01</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ethene_adc2_0</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ethene_adc2_1</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ethene_adc2_01</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vinylfluoride&#39;</span><span class="p">)</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">vinyl_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># Perform CVS-ADC calculations</span>
<span class="n">vinyl_adc1_1</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">vinyl_adc1_2</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">vinyl_adc1_12</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">vinyl_adc2_1</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">vinyl_adc2_2</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">vinyl_adc2_12</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For ethene
converged SCF energy = -78.0041367697306
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.03528  272ms  [10.9407699  11.18596003 11.18814426 11.23216937]
  2    15    0.00017832  225ms  [10.88951159 11.162916   11.17172328 11.21366663]
=== Converged ===
    Number of matrix applies:    15
    Total solver time:           512.348ms
Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8      0.035017  136ms  [10.93953818 11.18405836 11.18618601 11.23055868]
  2    15    0.00018157  122ms  [10.888685   11.1607163  11.16972747 11.21203137]
=== Converged ===
    Number of matrix applies:    15
    Total solver time:           266.526ms
Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8      0.047214  396ms  [10.93953818 10.9407699  11.12926169 11.12999659]
  2    16     0.0016423  209ms  [10.84929754 10.84932523 11.07667553 11.07801415]
  3    24    0.00024386  168ms  [10.84786316 10.84789401 11.06061153 11.06280944]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:           794.511ms
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.46875  934ms  [10.96962194 11.19539326 11.19813246 11.24199267]
  2    16       0.01885  537ms  [10.82607511 10.99335101 11.00900124 11.03766135]
  3    24    0.00017608  549ms  [10.82087017 10.99172102 11.0060083  11.03511322]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             2s  46ms
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.42736  697ms  [10.96840735 11.19350414 11.19617449 11.24039377]
  2    16      0.015589  624ms  [10.8273515  10.99255802 11.00920791 11.03974461]
  3    24    0.00015492  646ms  [10.82235902 10.99096187 11.00627899 11.03727462]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             1s 989ms
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.69086  680ms  [10.96833703 10.96956875 11.13843595 11.13917564]
  2    16      0.020704  618ms  [10.66526505 10.66614827 10.81485125 10.81670154]
  3    24     0.0011536  650ms  [10.65736753 10.6582511  10.80700636 10.80895365]
  4    32    0.00019452  854ms  [10.65713829 10.65802832 10.80638052 10.80833571]
=== Converged ===
    Number of matrix applies:    32
    Total solver time:             2s 842ms
For vinylfluoride
converged SCF energy = -176.826117974741
Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8      0.048568  202ms  [10.97938768 11.16334711 11.21410575 11.38038168]
  2    16     0.0024366  118ms  [10.91705523 11.05374607 11.14965916 11.36119453]
  3    21    3.4706e-27  157ms  [10.91705523 11.05313713 11.14944247 11.35820152]
=== Converged ===
    Number of matrix applies:    21
    Total solver time:           483.769ms
Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.04111  455ms  [10.89428986 11.12811248 11.14287023 11.27835715]
  2    16    0.00060759  274ms  [10.86468799 11.06200589 11.07780557 11.24651374]
  3    21     1.489e-27  162ms  [10.86468799 11.0617911  11.07771239 11.24593793]
=== Converged ===
    Number of matrix applies:    21
    Total solver time:           897.561ms
Starting cvs-adc1 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8      0.052183  151ms  [10.9528247  11.01338992 11.12977943 11.14434232]
  2    16     0.0030861  120ms  [10.86862651 10.91703423 11.06330173 11.08056491]
  3    24    0.00096911  458ms  [10.86467473 10.91703401 11.05389771 11.06190173]
  4    32    1.0544e-05  185ms  [10.86467465 10.91703401 11.05295685 11.06188324]
=== Converged ===
    Number of matrix applies:    32
    Total solver time:           924.521ms
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.85613  924ms  [11.01280902 11.18962352 11.22567785 11.39068711]
  2    16      0.016709  861ms  [10.7576604  10.88592128 10.9237228  10.96220778]
  3    24    0.00052922   1.1s  [10.75306827 10.87948574 10.91803053 10.95709811]
  4    32    5.8393e-05  785ms  [10.75281677 10.87921859 10.91784421 10.95670834]
=== Converged ===
    Number of matrix applies:    32
    Total solver time:             3s 686ms
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.83293   1.0s  [10.9354574  11.13817276 11.15476114 11.29386858]
  2    16      0.018179   1.2s  [10.67406002 10.80719897 10.82724328 10.8694888 ]
  3    24     0.0010969  999ms  [10.66855702 10.8013469  10.81943    10.86214448]
  4    32    0.00019307   1.5s  [10.66851146 10.8007993  10.81915943 10.86145949]
=== Converged ===
    Number of matrix applies:    32
    Total solver time:             4s 810ms
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.72916  828ms  [10.98757205 11.04813727 11.13994485 11.1556422 ]
  2    16       0.02669  914ms  [10.67899718 10.76273757 10.80751194 10.83028621]
  3    24     0.0012195  980ms  [10.66907079 10.75327984 10.8014676  10.82008355]
  4    32    0.00047162  816ms  [10.66863016 10.75291888 10.80085099 10.81939853]
  5    40    6.3976e-05  785ms  [10.66849366 10.75278303 10.80067242 10.81909725]
=== Converged ===
    Number of matrix applies:    40
    Total solver time:             4s 359ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1"># Ethene with CVS-ADC(1)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ethene&#39;</span><span class="p">)</span>
<span class="n">ethene_adc1_0</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MO #0&#39;</span><span class="p">)</span>
<span class="n">ethene_adc1_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MO #1&#39;</span><span class="p">)</span>
<span class="n">ethene_adc1_01</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MO:s #0-1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CVS-ADC(1)&#39;</span><span class="p">)</span>

<span class="c1"># Vinylfluoride with CVS-ADC(1)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Vinylfluoride&#39;</span><span class="p">)</span>
<span class="n">vinyl_adc1_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MO #1&#39;</span><span class="p">)</span>
<span class="n">vinyl_adc1_2</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MO #2&#39;</span><span class="p">)</span>
<span class="n">vinyl_adc1_12</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MO #1-2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Ethene with CVS-ADC(2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">ethene_adc2_0</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">ethene_adc2_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">ethene_adc2_01</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CVS-ADC(2)&#39;</span><span class="p">)</span>

<span class="c1"># Vinylfluoride with CVS-ADC(2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">vinyl_adc2_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">vinyl_adc2_2</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">vinyl_adc2_12</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_cons_28_0.png" src="../_images/xray_cons_28_0.png" />
</div>
</div>
<p>We see that considering each MO in turn works well for vinylfluoride, where the two carbon 1s are localized, but not for ethene, where they are delocalized. Including or not including fluorine here makes little difference, as that MO is both energetically and spatially well separated from the carbon 1s.</p>
<p>Note that the delocalization might not be immediatelly apparent, as just visually looking at the molecule and concluding which atoms are unique might not be sufficient. Care should be taken for larger systems, and explicitly looking at the MOs is adviced. Alternatively, using ECP:s to localize the core-hole and then restricting the CVS space accordingly will avoid this issue.</p>
</div>
<div class="section" id="spurious-valence-mixing-in-xas">
<span id="sec-xray-cons-spur-val"></span><h2>Spurious valence mixing in XAS<a class="headerlink" href="#spurious-valence-mixing-in-xas" title="Permalink to this headline">¶</a></h2>
<p>Within a damped response theory framwork or when performing explicit real-time propagation, a CVS-like scheme which separates core-transitions from the valence-continuum is usually not performed. If such calculations are run with a atom-centered basis set (as most are), this can then lead to spurious mixing with valence-excited states. What happens is that resonances in the valence-continuum occur close to core-excitations, leading to unphysical mixing which affects excitation energies and (more significantly) intensities. These issues occur both for methods featuring only single-excited configurations (<em>e.g.</em> TDDFT) and higher-excited configurations (<em>e.g.</em> ADC) and need to be avoided.</p>
<p>The issue has been observed for, <em>e.g.</em>, <span class="math notranslate nohighlight">\(L_{2,3}\)</span>-edge of silicon <span id="id2">[<a class="reference internal" href="refs.html#id6">FBN16</a>, <a class="reference internal" href="refs.html#id5">KKG+15</a>]</span>, and is usually more common at lower energies. They can be identified by studying the amplitudes and the <span class="math notranslate nohighlight">\(t^2\)</span> values for post-HF methods, and can be avoided by chosing appropriate basis set, freezing certain virtual orbitals, or by re-introducing the CVS approximation (or some other flavour) within the CPP/RT framework. The latter is noted to be recommended in any case for CPP-ADC, as converging the response vectors has otherwise been seen to be difficult <span id="id3">[<a class="reference internal" href="refs.html#id39">RRH+21</a>]</span>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="xray_analysis.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Spectrum analysis</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="xray_large.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Larger systems</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The eChem team<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>