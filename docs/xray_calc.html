
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spectrum calculation &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spectrum analysis" href="xray_analysis.html" />
    <link rel="prev" title="X-ray spectroscopies" href="xray.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv-vis.html">
   UV/vis absorption/emission
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_rec.html">
     Recommendations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ir.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="raman.html">
     Raman spectroscopy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kernel_integration.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dft_scf.html">
     SCF optimization of a closed-shell state
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradients.html">
     Gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Hessians and vibrations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="structopt.html">
   Molecular structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="gsstructopt.html">
     Ground state structure optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="impes.html">
   Potential Energy Surfaces by Interpolation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="md_ffs.html">
     Force field parameterization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_run.html">
     Running a simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_biased.html">
     Biased molecular dynamics
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci-response.html">
     CI response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     SCF states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="loprop.html">
     LoProp charges and polarizabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Structure and orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-excited.html">
   Visualizing excited states
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/xray_calc.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kthpanor/echem"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/xray_calc.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/xray_calc.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-photoemission-spectroscopy">
   X-ray photoemission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ie-s-from-koopmans-theorem">
     IE:s from Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-maximum-overlap-method">
     The maximum overlap method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ie-s-from-delta-textrm-scf">
     IE:s from
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-delta-textrm-scf">
     Spectra from
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-approaches">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-absorption-spectroscopy">
   X-ray absorption spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decoupling-from-the-valence-continuum">
     Decoupling from the valence continuum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cvs-adc-eigenstates">
     Spectra from CVS-ADC eigenstates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-tddft-eigenstates">
     Spectra from TDDFT eigenstates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cpp-dft">
     Spectra from CPP-DFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-emission-spectroscopy">
   X-ray emission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-adc">
     Spectra from ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-tddft">
     Spectra from TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-ground-state-mo-s">
     Spectra from ground state MO:s
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id20">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resonant-inelastic-x-ray-scattering">
   Resonant inelastic X-ray scattering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-step-approach-with-adc">
     Two-step approach with ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-step-approach-with-tddft">
     Two-step approach with TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dirac-kramer-heisenberg-with-adc">
     Dirac-Kramer-Heisenberg with ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#herfd">
     HERFD
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id22">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="spectrum-calculation">
<h1>Spectrum calculation<a class="headerlink" href="#spectrum-calculation" title="Permalink to this headline">¶</a></h1>
<p>This section focus on the calculation of XPS, XAS, XES, and RIXS, with focus on considering these spectroscopies with ADC and (TD)DFT. For a more general overview of the large number of methods available for considering these properties, see, <em>e.g.</em>, <span id="id1">[<a class="reference internal" href="refs.html#id114">ND18</a>]</span>.</p>
<p><em>Loading modules and functions:</em></p>
<div class="cell tag_remove-output tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># standard Python modules and functions</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># QC software suites and functionalities</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">cc</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">gator</span>
<span class="kn">import</span> <span class="nn">adcc</span>
<span class="kn">from</span> <span class="nn">veloxchem.rsplinabscross</span> <span class="kn">import</span> <span class="n">LinearAbsorptionCrossSection</span>

<span class="c1"># for vlx</span>
<span class="n">silent_ostream</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># au to eV conversion factor</span>
<span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="x-ray-photoemission-spectroscopy">
<span id="sec-xray-calc-xps"></span><h2>X-ray photoemission spectroscopy<a class="headerlink" href="#x-ray-photoemission-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>In XPS the photoemission of electrons is measured, yielding information on core-electron binding energies. Here we focus on the calculation of ionization energies (IE:s), from which the isotropic photoemission spectrum is formed by giving each IE the same intensity and then broadening with an appropriate convolution function. It is possible to go beyond such a simple approach using Dyson orbitals, but it typically does not make much of a difference <span id="id2">[<a class="reference internal" href="refs.html#id22">VKC19</a>]</span>.</p>
<div class="section" id="ie-s-from-koopmans-theorem">
<h3>IE:s from Koopmans’ theorem<a class="headerlink" href="#ie-s-from-koopmans-theorem" title="Permalink to this headline">¶</a></h3>
<p>A simple model for calculating ionization energies and electron affinities is from Koopmans’ theorem, where they are estimated from the MO energies. For water, we obtain a 1s IE of:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Create veloxchem mol and basis objects</span>
<span class="n">mol_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span> 
<span class="n">bas_vlx</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span> 

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_vlx</span><span class="p">,</span> <span class="n">bas_vlx</span><span class="p">)</span>

<span class="c1"># Extract orbital energies</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1s E from the Koopmans theorem:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">orbital_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1s E from the Koopmans theorem: -559.5
</pre></div>
</div>
</div>
</div>
<p>This can be compared to the experimental value, which is 539.9 eV. The overestimation of almost 20 eV is due to lack of <a class="reference internal" href="xray_aspects.html#sec-xray-topics-relax"><span class="std std-ref">relaxation</span></a>, which results from the reorganization of the valence electrons in response to a reduction in screening of the nuclei. By comparison, in valence spectroscopies the change in shielding is significantly smaller, yielding a far smaller error due to the lack of relaxation for, e.g., calculation of HOMO IE:s or LUMO EA:s.</p>
<p>An approach for including relaxation effects IE calculations is to instead use the <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> approach, in which the difference in total energy between the neutral and a core-hole system yields estimates of core-electron binding energies.</p>
</div>
<div class="section" id="the-maximum-overlap-method">
<h3>The maximum overlap method<a class="headerlink" href="#the-maximum-overlap-method" title="Permalink to this headline">¶</a></h3>
<p>In order to converge a core-hole state, an approach which avoid the convergence to a lower-energy valence-hole state is needed. This can be done using several approaches, but the focus here will be on the maximum overlap method (MOM), with which a SCF optimization with the constraint of maximizing the overlap to some initial guess <span id="id3">[<a class="reference internal" href="refs.html#id23">BS71</a>, <a class="reference internal" href="refs.html#id24">GBG08</a>]</span>. The guess is typically taken as the converged wave function of the neutral (no core-hole) system, and new occupied orbitals at each iteration is taken such that they overlap most with the span of old occupied orbitals. Defining the overlap matrix as</p>
<div class="amsmath math notranslate nohighlight" id="equation-26e9c0e5-b8c8-45c2-b5bc-8661848e8ace">
<span class="eqno">(7)<a class="headerlink" href="#equation-26e9c0e5-b8c8-45c2-b5bc-8661848e8ace" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\textbf{O} = 
\left( \textbf{C}^{\textrm{old}} \right)^{\dagger} \textbf{SC}^{\textrm{new}},
\end{equation}\]</div>
<p>with <span class="math notranslate nohighlight">\(O_{ij}\)</span> being the overlap between the <span class="math notranslate nohighlight">\(i\)</span>:th old and <span class="math notranslate nohighlight">\(j\)</span>:th new orbital, and <span class="math notranslate nohighlight">\(\textbf{C}\)</span> and <span class="math notranslate nohighlight">\(\textbf{S}\)</span> are the MO coefficient matrices and basis function overlap matrix, respectively. The projections of <span class="math notranslate nohighlight">\(j\)</span>:th new orbital onto the old space is then</p>
<div class="amsmath math notranslate nohighlight" id="equation-45f2d97f-136b-4bc3-98d0-0406ce7a4dbf">
<span class="eqno">(8)<a class="headerlink" href="#equation-45f2d97f-136b-4bc3-98d0-0406ce7a4dbf" title="Permalink to this equation">¶</a></span>\[\begin{equation}
p_j = \sum_i^n O_{ij} = 
\sum_a^N (
\sum_b^N (
\sum_i^n C_{ib}^{old} )
S_{bc} )
C_{cj}^{old}.
\end{equation}\]</div>
<p>The occupied orbitals are then selected by largest <span class="math notranslate nohighlight">\(p_j\)</span> values.</p>
<p>With this, a converged core-hole wave function is obtained with the following scheme:</p>
<ol class="simple">
<li><p>Calculate the wave-function of the original system (<em>e.g.</em> no core-hole).</p></li>
<li><p>Use above wave-function as a starting guess for a new wave function optimization, removing an electron from desired orbital (and potentially occupying some other virtual orbital).</p></li>
<li><p>Optimizing this state using the MOM restriction.</p></li>
</ol>
<p>This can then converge many unstable states, including core-ionized states and certain core-excited states. Some care should observed, though:</p>
<ul class="simple">
<li><p>If excited states are considered, check that the final state is reasonable close to what is investigated.</p></li>
<li><p>Delocalized core orbitals need to be localized, for example by employing ECP:s.</p></li>
<li><p>If post-HF methods are used, the ground state calculation can attempt to (partially) fill the core-hole, leading to a corrupt wave function which represents some intermediate between a core-hole/valence-hole state.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We currently use <code class="docutils literal notranslate"><span class="pre">pyscf</span></code> for the calculations involving explicit core-holes, as <code class="docutils literal notranslate"><span class="pre">veloxchem</span></code> presently lacks MOM.</p>
</div>
</div>
<div class="section" id="ie-s-from-delta-textrm-scf">
<h3>IE:s from <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span><a class="headerlink" href="#ie-s-from-delta-textrm-scf" title="Permalink to this headline">¶</a></h3>
<p>The IE of water using <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> is then computed as:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>

<span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    
<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># IE from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization energy:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827192  &lt;S^2&gt; = 6.3389294e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.scf.uhf.UHF&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.0754789470864  &lt;S^2&gt; = 0.76257805  2S+1 = 2.0125387
Ionization energy: 541.73 eV
</pre></div>
</div>
</div>
</div>
<p>This estimate is within 2 eV from experiment, and we can include electron correlation using MP2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run MP2 on neutral and core-hole wave functions</span>
<span class="n">mp_res</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mp_ion</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># IE from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">mp_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">mp_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>E(UMP2) = -76.1130483955489  E_corr = -0.1291780128297
E(UMP2) = -56.1523709631034  E_corr = -0.0768920160169647
Ionization potential: 543.16 eV
</pre></div>
</div>
</div>
</div>
<p>Alternatively, we can consider this with KS-DFT:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform unrestricted SCF calculation with a B3LYP</span>
<span class="n">scf_gs</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>

<span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    
<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># IE from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization energy:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -76.3480474320839  &lt;S^2&gt; = 2.5501379e-11  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.dft.uks.UKS&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
Ionization energy: 542.47 eV
</pre></div>
</div>
</div>
</div>
<p>MP2 and DFT currently brings us <em>away</em> from experiment when comparing to HF, but we note that the basis set is small and ill-suited for core properties. Using a cc-pCVTZ basis we obtain:</p>
<ul class="simple">
<li><p>HF: 538.93 eV</p></li>
<li><p>MP2: 540.26 eV</p></li>
<li><p>B3LYP: 539.19 eV</p></li>
</ul>
<p>So closer to experiment for the correlated methods (note that scalar-relativistic effects will shift these results upwards by <span class="math notranslate nohighlight">\(\sim\)</span>0.37 eV).</p>
</div>
<div class="section" id="spectra-from-delta-textrm-scf">
<h3>Spectra from <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span><a class="headerlink" href="#spectra-from-delta-textrm-scf" title="Permalink to this headline">¶</a></h3>
<p>The X-ray photoemission spectrum can be formed by computing all relavant core-electron binding energies (or IE:s), give each unique ionization equal intensity, and broaden over the result with an appropriate convolution function.</p>
<p>We here consider ethyl trifluoroacetate( (CF<span class="math notranslate nohighlight">\(_3\)</span>-CO-O-CH<span class="math notranslate nohighlight">\(_2\)</span>-CH<span class="math notranslate nohighlight">\(_3\)</span>), also known as the <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">‘ESCA’ molecule</a>, which possess very illustrative shifts in XPS features (IE:s) of the carbon <span class="math notranslate nohighlight">\(K\)</span>-edge due to interactions with the very electronegative oxygen and fluorine atoms. We calculate the four carbon 1s IE:s with <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">esca_xyz</span>   <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">C         1.1183780041   -0.3449927563    0.0140172822</span>
<span class="s1">C         0.2599020293    0.9430366372   -0.0248385056</span>
<span class="s1">F         2.4019839124   -0.0408200726   -0.0368443870</span>
<span class="s1">F         0.8399255955   -1.1560630574   -1.0169777359</span>
<span class="s1">F         0.8945563482   -1.0267696528    1.1485539196</span>
<span class="s1">O         0.7954196415    2.0187110930    0.0011424145</span>
<span class="s1">O        -1.0675509573    0.8144007049   -0.0614767265</span>
<span class="s1">C        -1.7486063992   -0.4602333713   -0.1739210991</span>
<span class="s1">C        -3.1986940727   -0.1850294900    0.1302033614</span>
<span class="s1">H        -1.3268717284   -1.1720377773    0.5289059043</span>
<span class="s1">H        -1.6185520565   -0.8344576449   -1.1859838788</span>
<span class="s1">H        -3.3116641442    0.1959612359    1.1419001202</span>
<span class="s1">H        -3.7716619472   -1.1057672384    0.0380096706</span>
<span class="s1">H        -3.6012985602    0.5468300237   -0.5651778685            </span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">esca_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform core-hole calculation for each carbon atom (MOs 5-8) and append resulting IE:s to a list</span>
<span class="n">esca_ies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="c1"># Copy molecular orbitals</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="c1"># Create 1s core-hole by setting alpha_n population to zero</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">esca_ies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
</pre></div>
</div>
<p>The choice of convolution function depends on the dominant broadening effect (lifetime of excited/ionized state, experimental resolution, Doppler effect, …). We generally focus on Lorentzian broadening, which is the type which naturally comes out of damped response calculations and which relates to the finite life-time of the excited/ionized state.</p>
<p>Giving each ionization energy equal weight, Lorentzian and Gaussian broadening are performed as below, for which the full-width at half-max (FWHM) is equal to <span class="math notranslate nohighlight">\(\gamma \)</span> and <span class="math notranslate nohighlight">\( 2\sqrt{2\ln{2}} \sigma\)</span>, respectively. If better correspondence to experiment is sought, a Voigt profile can be constructed from the convolution of a Lorentzian and a Gaussian.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Lorentzian broadening function</span>
<span class="sd">    </span>
<span class="sd">    Call: xi,yi = lorentzian(energies, intensities, start energy, end energy, energy step, gamma)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gaussian broadening function</span>
<span class="sd">    </span>
<span class="sd">    Call: xi,yi = gaussian(energies, intensities, start energy, end energy, energy step, gamma)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span> 
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>

<span class="c1"># IEP:s from above calculation</span>
<span class="n">esca_ies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">302.187</span><span class="p">,</span> <span class="mf">299.362</span><span class="p">,</span> <span class="mf">295.405</span><span class="p">,</span> <span class="mf">293.277</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lorentzian, FWHM = 0.4 eV&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">esca_ies</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">esca_ies</span><span class="p">)))</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian, FWHM = 0.4 eV&#39;</span><span class="p">)</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))));</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Both, peak max normalized&#39;</span><span class="p">)</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))));</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Both, area normalized&#39;</span><span class="p">)</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))));</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yi</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_calc_11_0.png" src="../_images/xray_calc_11_0.png" />
</div>
</div>
<p>For the comparison to <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">experiment</a> a cc-pVTZ basis set is selected, augmented with additional core-polarizing functions for the carbon atoms (i.e. cc-pCVTZ):</p>
<div class="figure align-default" id="esca-xps">
<img alt="../_images/esca_xps.svg" src="../_images/esca_xps.svg" /><p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Carbon 1s XPS of ESCA, comparing <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> results to experiment. Theoretical spectrum shifted by 0.11 eV (to account for relativistic effects) and broadened by 0.3 eV.</span><a class="headerlink" href="#esca-xps" title="Permalink to this image">¶</a></p>
</div>
<p>The features originate in, from low to high energy: -CH<span class="math notranslate nohighlight">\(_3\)</span>, -CH<span class="math notranslate nohighlight">\(_2\)</span>-, -CO-, and CF<span class="math notranslate nohighlight">\(_3\)</span>. We note a good agreement for the first two features, but the comparison deteriorates for higher energies. This is largely an effect of the more significant change in electronic structure imposed by the very electronegative fluorine and oxygen atoms, which the current level of theory is not capable of describing as well.</p>
</div>
<div class="section" id="other-approaches">
<h3>Other approaches<a class="headerlink" href="#other-approaches" title="Permalink to this headline">¶</a></h3>
<p>Alternative methods of considering XPS and IE:s include, among others:</p>
<ul class="simple">
<li><p>IP-ADC</p></li>
<li><p>IP-CC</p></li>
<li><p>…</p></li>
</ul>
</div>
</div>
<div class="section" id="x-ray-absorption-spectroscopy">
<span id="sec-xray-calc-xas"></span><h2>X-ray absorption spectroscopy<a class="headerlink" href="#x-ray-absorption-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>In XAS the energy-dependent photoabsorption of the sample is measured, probing excitation of core electrons to bound or continuum states. These two different final states then provide information on unoccupied states and local chemical environment, respectively, with a prototypical spectrum of a conjugated system:</p>
<div class="figure align-default" id="xafs">
<img alt="../_images/xafs.svg" src="../_images/xafs.svg" /><p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">Prototypical X-ray absorption spectrum of a conjugated system.</span><a class="headerlink" href="#xafs" title="Permalink to this image">¶</a></p>
</div>
<p>Above the spectrum we see two disctinct regions with different features and physical origins:</p>
<ul class="simple">
<li><p><strong>NEXAFS (near-edge X-ray absorption fine structure:</strong> the region in which transitions to bound states is probed (this region is also known as XANES, X-ray absorption near-edge structure).</p></li>
<li><p><strong>EXAFS (extended X-ray absorption fine structure):</strong> which consists of transitions to continuum states, as modulated by constructive or destructive interference between the emitted electron and the environment. This thus provide information on local chemical bonds.</p></li>
</ul>
<p>Included is also the position of the IE, as well assignment of typical features (<span class="math notranslate nohighlight">\(\pi^*\)</span>, Rydberg, and <span class="math notranslate nohighlight">\(\sigma^*\)</span>). Transitions to <span class="math notranslate nohighlight">\(\pi^*\)</span> states are typically low in energy and very intense, and thus easy to identify. Rydberg states are typically weak and converge to the ionization energy. Finally, transitions to <span class="math notranslate nohighlight">\(\sigma^*\)</span> states can be found above the ionization energy.</p>
<p>The total spectrum is referred to as the <strong>XAFS (X-ray absorption fine structure)</strong> region. For the remainder of this tutorial we will focus on NEXAFS, for which good starting points for modeling with ADC and TDDFT can be found in <span id="id4">[<a class="reference internal" href="refs.html#id19">BA10</a>, <a class="reference internal" href="refs.html#id114">ND18</a>, <a class="reference internal" href="refs.html#id18">WHWD15</a>]</span>.</p>
<div class="section" id="decoupling-from-the-valence-continuum">
<span id="sec-xray-calc-cvs"></span><h3>Decoupling from the valence continuum<a class="headerlink" href="#decoupling-from-the-valence-continuum" title="Permalink to this headline">¶</a></h3>
<p>A complication that arise when considering core excitations is the embedding of the core-excited states into the continuum of valence-ionized states. This means that the targetted core-excited states cannot easily be resolved with, <em>e.g.</em>, a Davidson approach, as a large number of valence-excited/-ionized states need to be converged first. A number of approaches have been developed to remove this issue, including:</p>
<ul class="simple">
<li><p>The core-valence separation (CVS) approximation <span id="id5">[<a class="reference internal" href="refs.html#id113">CDS80</a>, <a class="reference internal" href="refs.html#id7">VFE+19</a>, <a class="reference internal" href="refs.html#id18">WHWD15</a>]</span></p></li>
<li><p>Restricted energy window (which is largely a different flavour of CVS) <span id="id6">[<a class="reference internal" href="refs.html#id10">LvKKG12</a>]</span></p></li>
<li><p>Using the complex polarization propagator (CPP), where the response at arbitrary frequencies is directly probed <span id="id7">[<a class="reference internal" href="refs.html#id8">EkstromNCAAgren06</a>]</span></p></li>
<li><p>Real-time propagation of the electronic structure <span id="id8">[<a class="reference internal" href="refs.html#id10">LvKKG12</a>]</span></p></li>
<li><p>Methods which construct explicit excited states</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Within a damped response framework and using real-time propagation there can be spurious mixing with valene-ionized states, which will results in unphysical mixing to a discretized continuum. This is briefly dfiscussed <a class="reference internal" href="xray_aspects.html#sec-xray-cons-spur-val"><span class="std std-ref">here</span></a>.</p>
</div>
<p>The focus in this tutorial is the use of the CVS approximation and the CPP approach, with which interior eigenstates and response at arbitrary frequencies can be address, as illustrated in <a class="reference internal" href="#global-xray"><span class="std std-numref">Fig. 7</span></a>:</p>
<div class="figure align-default" id="global-xray">
<img alt="../_images/cvs_adc.svg" src="../_images/cvs_adc.svg" /><p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">Global spectrum of water, using the 6-311G basis set. Results obtained with ADC(1), CVS-ADC(1), ADC(2), CVS-ADC(2), and CPP-DFT. CPP-DFT results obtained using the B3LYP exchange-correlation functional and a large <span class="math notranslate nohighlight">\(\gamma\)</span> of 1 eV. ADC results shown as bar spectra.</span><a class="headerlink" href="#global-xray" title="Permalink to this image">¶</a></p>
</div>
<p>Here we see the global spectrum of water, using a rather limited basis set. Even so, ADC(1) requires more than 50 states to resolved the core-excitation region (situated at about 535 eV for water), and for ADC(2) 50 states brings us only to about 50 eV. With the CVS approximation we directly target the core-excitation region, but it should be noted that this also introduces a small error. However, this error has been shown to be relatively small (provided a reasonable basis set) and stable for AD <span id="id9">[<a class="reference internal" href="refs.html#id115">HF20</a>]</span>, and for TDHF and TDDFT it is all but negligible. Using CPP-DFT, this error is avoided all together (although CPP-ADC has been noted to be hard to converge for core-excited state <span id="id10">[<a class="reference internal" href="refs.html#id40">RRH+21</a>]</span>, so here CVS-CPP-ADC might instead be used - thus including this small error).</p>
</div>
<div class="section" id="spectra-from-cvs-adc-eigenstates">
<h3>Spectra from CVS-ADC eigenstates<a class="headerlink" href="#spectra-from-cvs-adc-eigenstates" title="Permalink to this headline">¶</a></h3>
<p>With CVS-ADC, the core-excitation spectra are calculate by specifying the index of the probed core orbitals(s):</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 6 lowest eigenstates with CVS restriction to MO #1 (oxygen 1s)</span>
<span class="n">adc_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Reading basis set from file: /home/thomas/Notebook/anaconda/envs/echem/lib/python3.9/site-packages/veloxchem/basis/6-31G
                                                                                                                          
                                                                                                                          
                                            Self Consistent Field Driver Setup                                            
                                           ====================================                                           
                                                                                                                          
                   Wave Function Model             : Spin-Restricted Hartree-Fock                                         
                   Initial Guess Model             : Superposition of Atomic Densities                                    
                   Convergence Accelerator         : Two Level Direct Inversion of Iterative Subspace                     
                   Max. Number of Iterations       : 50                                                                   
                   Max. Number of Error Vectors    : 10                                                                   
                   Convergence Threshold           : 1.0e-06                                                              
                   ERI Screening Scheme            : Cauchy Schwarz + Density                                             
                   ERI Screening Mode              : Dynamic                                                              
                   ERI Screening Threshold         : 1.0e-12                                                              
                   Linear Dependence Threshold     : 1.0e-06                                                              
                                                                                                                          
* Info * Nuclear repulsion energy: 9.1561447197 a.u.                                                                      
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
* Info * SAD initial guess computed in 0.00 sec.                                                                          
                                                                                                                          
* Info * Starting Reduced Basis SCF calculation...                                                                        
* Info * ...done. SCF energy in reduced basis set: -75.983870212262 a.u. Time: 0.05 sec.                                  
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
                                                                                                                          
               Iter. | Hartree-Fock Energy | Energy Change | Gradient Norm | Max. Gradient | Density Change               
               --------------------------------------------------------------------------------------------               
                  1       -75.983870380904    0.0000000000      0.00006826      0.00001638      0.00000000                
                  2       -75.983870382654   -0.0000000017      0.00002636      0.00000475      0.00006304                
                  3       -75.983870382717   -0.0000000001      0.00000396      0.00000061      0.00000524                
                  4       -75.983870382721   -0.0000000000      0.00000029      0.00000008      0.00000296                
                                                                                                                          
               *** SCF converged in 4 iterations. Time: 0.04 sec.                                                         
                                                                                                                          
               Spin-Restricted Hartree-Fock:                                                                              
               -----------------------------                                                                              
               Total Energy                       :      -75.9838703827 a.u.                                              
               Electronic Energy                  :      -85.1400151024 a.u.                                              
               Nuclear Repulsion Energy           :        9.1561447197 a.u.                                              
               ------------------------------------                                                                       
               Gradient Norm                      :        0.0000002874 a.u.                                              
                                                                                                                          
                                                                                                                          
               Ground State Information                                                                                   
               ------------------------                                                                                   
               Charge of Molecule            :  0.0                                                                       
               Multiplicity (2S+1)           :  1.0                                                                       
               Magnetic Quantum Number (M_S) :  0.0                                                                       
                                                                                                                          
                                                                                                                          
                                                 Spin Restricted Orbitals                                                 
                                                 ------------------------                                                 
                                                                                                                          
               Molecular Orbital No.   1:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:  -20.56128 a.u.                                                                    
               (   1 O   1s  :    -1.00)                                                                                  
                                                                                                                          
               Molecular Orbital No.   2:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -1.35434 a.u.                                                                    
               (   1 O   1s  :     0.21) (   1 O   2s  :    -0.47) (   1 O   3s  :    -0.48)                              
                                                                                                                          
               Molecular Orbital No.   3:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.70774 a.u.                                                                    
               (   1 O   1p+1:    -0.51) (   1 O   2p+1:    -0.27) (   2 H   1s  :     0.26)                              
               (   3 H   1s  :    -0.26)                                                                                  
                                                                                                                          
               Molecular Orbital No.   4:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.56024 a.u.                                                                    
               (   1 O   2s  :     0.18) (   1 O   3s  :     0.31) (   1 O   1p0 :     0.55)                              
               (   1 O   2p0 :     0.40)                                                                                  
                                                                                                                          
               Molecular Orbital No.   5:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.50122 a.u.                                                                    
               (   1 O   1p-1:    -0.64) (   1 O   2p-1:    -0.51)                                                        
                                                                                                                          
               Molecular Orbital No.   6:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.20280 a.u.                                                                    
               (   1 O   3s  :     1.17) (   1 O   1p0 :    -0.23) (   1 O   2p0 :    -0.48)                              
               (   2 H   2s  :    -0.99) (   3 H   2s  :    -0.99)                                                        
                                                                                                                          
               Molecular Orbital No.   7:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.29874 a.u.                                                                    
               (   1 O   1p+1:    -0.34) (   1 O   2p+1:    -0.82) (   2 H   2s  :    -1.38)                              
               (   3 H   2s  :     1.38)                                                                                  
                                                                                                                          
               Molecular Orbital No.   8:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    1.05548 a.u.                                                                    
               (   1 O   2p+1:     0.74) (   2 H   1s  :     0.97) (   2 H   2s  :    -0.50)                              
               (   3 H   1s  :    -0.97) (   3 H   2s  :     0.50)                                                        
                                                                                                                          
               Molecular Orbital No.   9:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    1.16442 a.u.                                                                    
               (   1 O   1p-1:    -0.96) (   1 O   2p-1:     1.04)                                                        
                                                                                                                          
               Molecular Orbital No.  10:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    1.18237 a.u.                                                                    
               (   1 O   2s  :     0.26) (   1 O   3s  :    -0.18) (   1 O   1p0 :    -0.67)                              
               (   1 O   2p0 :     0.22) (   2 H   1s  :    -0.84) (   2 H   2s  :     0.55)                              
               (   3 H   1s  :    -0.84) (   3 H   2s  :     0.55)                                                        
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 4 iterations.
Total Energy: -75.9838703827 au
Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8        1.2621  196ms  [20.27035914 20.30081846 20.86977788 20.91121543]
  2    16      0.038976  389ms  [19.72495603 19.8069198  20.5088101  20.51570002]
  3    24     0.0035541  594ms  [19.71673659 19.79707775 20.49577451 20.50503439]
  4    32    0.00029894  532ms  [19.71639076 19.79671173 20.49373735 20.50484025]
  5    40    3.1991e-05  423ms  [19.71637587 19.79669994 20.49353419 20.50482669]
=== Restart ===
  6    16    5.9779e-06  437ms  [19.71637537 19.79669924 20.49351334 20.50482475]
  7    24    1.1003e-06  372ms  [19.71637533 19.79669915 20.49350816 20.50482392]
  8    32    5.7208e-07  415ms  [19.71637533 19.79669914 20.49350772 20.50482382]
=== Converged ===
    Number of matrix applies:    64
    Total solver time:             3s 389ms
</pre></div>
</div>
</div>
</div>
<p>The resuls can be printed as a table, and convoluted and plotted using built-in functionalities or a custom broadening:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print information on eigenstates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_res</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># Convolute using functionalities available in gator and adcc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Built-in broadening&#39;</span><span class="p">)</span>
<span class="n">adc_res</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>

<span class="c1"># Convoluted using information on excitation energies and oscillator strengths</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Custom broadening (0.5 eV)&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>  <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_res</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_res</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">543</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| cvs-adc2x                               singlet ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      19.71638      536.5099   0.0175       0.8       0.2  |
|  1       19.7967      538.6956   0.0368    0.8087    0.1913  |
|  2      20.49351      557.6568   0.0098    0.7858    0.2142  |
|  3      20.50482      557.9647   0.1007    0.8441    0.1559  |
+--------------------------------------------------------------+
</pre></div>
</div>
<img alt="../_images/xray_calc_15_1.png" src="../_images/xray_calc_15_1.png" />
</div>
</div>
<p>The built-in functionality uses a small default broadening and plots the full region which is resolved, while we might want to focus on lower-energy and larger broadenings (as done in the lower panel). We note that high-energy features can often be a result of a discretized continuum region, as seen by the unphysically intense feature at <span class="math notranslate nohighlight">\(\sim\)</span>558 eV. A larger basis set will flatten out this region, but care should be taken for any analysis of that part of the spectrum.</p>
<p>Increasing the basis set to aug-cc-pCVTZ/cc-pVTZ (for oxygen and hydrogen, respectively), we obtain results in good agreement with <a class="reference external" href="https://doi.org/10.1103/PhysRevA.47.1136">experiment</a>:</p>
<div class="figure align-default" id="adc-water-xas">
<img alt="../_images/adc_water_xas.svg" src="../_images/adc_water_xas.svg" /><p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">CVS-ADC(2)-x calculation of the oxygen X-ray absorption spectrum of gaseous water, as compared to experiment. Theoretical spectra has been shifted by 0.37 eV (to account for relativistic effects) and broadened by 0.4 eV.</span><a class="headerlink" href="#adc-water-xas" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="spectra-from-tddft-eigenstates">
<h3>Spectra from TDDFT eigenstates<a class="headerlink" href="#spectra-from-tddft-eigenstates" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="spectra-from-cpp-dft">
<h3>Spectra from CPP-DFT<a class="headerlink" href="#spectra-from-cpp-dft" title="Permalink to this headline">¶</a></h3>
<p>With the complex polarization propagator (CPP), also called the damped linear response function, the absorption and dispersion spectrum can be evaluated at arbitrary energies <span id="id11">[<a class="reference internal" href="refs.html#id9">NBJO01</a>]</span>. With this, the X-ray absorption spectrum can then be directly calculated. For this, we need to decide on which energy/frequency region to use, which can be estimated by, <em>e.g.</em></p>
<ul class="simple">
<li><p>Screen extended energy regions with large step size. This could potentially be done using a smaller basis set.</p></li>
<li><p>With a method lacking relaxation: start the region a few eV below the IE from Koopmans’ theorem. This will not work for methods capable of including relaxation, where IE:s from <span class="math notranslate nohighlight">\(\Delta\)</span>SCF could instead be considered as a first rough estimate (noting that it will work better or worse for different levels of, e.g., ADC theory).</p></li>
</ul>
<p>Choosing an energy region of 514-525 eV, using a step length of 0.1 eV and a damping factor of 0.3 eV, we calculate the CPP-DFT (with the B3LYP functional) water spectrum as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and calculation</span>
<span class="n">scf_drv</span>         <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>    <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Define spectrum region to be resolved</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">515.0</span><span class="p">,</span><span class="mf">525.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span>
<span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>

<span class="c1"># Calculate the response</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">au2ev</span><span class="p">},</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>

<span class="c1"># Extract the imaginary part of the complex response function and convert to absorption cross section</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>
    <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
<p>Resulting spectra can be plotted as raw, or splined for smoother figures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make figure with panels of 3:1 width</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 

<span class="c1"># Raw results for the full region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx-&#39;</span><span class="p">)</span>

<span class="c1"># Raw results for a zoomed in region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">519.5</span><span class="p">,</span><span class="mf">520.5</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.10</span><span class="p">))</span>

<span class="c1"># Raw and splined spectra for the full region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Raw&#39;</span><span class="p">,</span><span class="s1">&#39;Splined&#39;</span><span class="p">))</span>

<span class="c1"># Zoomed in raw and splined spectra for the full region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">519.5</span><span class="p">,</span><span class="mf">520.5</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="xray-cpp-dft">
<img alt="../_images/cpp_dft.svg" src="../_images/cpp_dft.svg" /></div>
<p>Increasing the basis set size and comparing to [experiment] we get:</p>
<div class="figure align-default" id="dft-water-xas">
<img alt="../_images/dft_water_xas.svg" src="../_images/dft_water_xas.svg" /><p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">CPP-DFT (B3LYP) X-ray absorption spectrum of water, as compared to experiment. Theoretical spectra shifted by 14.5 eV and broadened by 0.4 eV.</span><a class="headerlink" href="#dft-water-xas" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Change above results to aug-cc-pCVTZ/cc-pVTZ.</p>
</div>
<p>As can be seen, the absolute excitation energies are significantly of, with a shift of 14.5 eV required to yield an approximate alignment to experiment. Part of this shift is due to lack of relativistic effects (~0.37 eV), and a small discrepancy can be expected due to the use of a limited basis set, but the main part of the error is due to two different effects:</p>
<ol class="simple">
<li><p>Lack of <a class="reference internal" href="xray_aspects.html#sec-xray-topics-relax"><span class="std std-ref">relaxation</span></a>, which yield a final state too high in energy and thus shift theoretical spectra upwards in energy.</p></li>
<li><p>The <a class="reference internal" href="xray_aspects.html#sec-xray-topics-sie"><span class="std std-ref">self-interaction error</span></a>, which yield an erroneous self-repulsion of the dense core orbitals, and results in too low core-excitation energies.</p></li>
</ol>
<p>For B3LYP the final effect of these two errors results in too low transition energies, meaning that the SIE dominates. By changing the amount of HF exchange this balance will shift and the error eventually becomes positive.</p>
<p>Nevertheless, the obtained CPP-DFT spectrum is in reasonable agreement with experiment once it has been shifted.</p>
</div>
<div class="section" id="id12">
<h3>Other approaches<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Alternative methods of considering XAS include, among others:</p>
<ul class="simple">
<li><p>STEX</p></li>
<li><p>TP-DFT</p></li>
<li><p>RAS</p></li>
<li><p>NOCIS</p></li>
<li><p>…</p></li>
</ul>
</div>
</div>
<div class="section" id="x-ray-emission-spectroscopy">
<span id="sec-xray-calc-xes"></span><h2>X-ray emission spectroscopy<a class="headerlink" href="#x-ray-emission-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>Following the creating of a core-hole, the system will rapidly (<span class="math notranslate nohighlight">\(\sim\)</span>fs) decay to a valence-hole or valence-excited state, depending on whether the system is core-ionized or core-excited. These two different intermediate states  are probed when the X-ray pulse is in resonance (excited regime) or not (ionized regime), yieldig resonant/non-resonant X-ray emission spectroscopy. This section will focus on the latter, with the former following in the next section.</p>
<p>In the decay process the system gain large amounts of energy which need to be discarded, as can occur by emission of high-energy photon (fluorescence) or high-lying electron (Auger), with relative probability depending on edge and element. For the <em>K</em>-edge the relative probabilities are:</p>
<div class="figure align-default" id="auger-vs-fluorescent">
<img alt="../_images/auger_vs_fluorescent.png" src="../_images/auger_vs_fluorescent.png" />
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">Fluorescence and Auger electron yields as a function of atomic number for <em>K</em>-edge core-holes. Figure taken from wikipedia.org, as <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Auger_xray_wiki_in_png_format.png">published</a> under CC BY-SA 4.0.</span><a class="headerlink" href="#auger-vs-fluorescent" title="Permalink to this image">¶</a></p>
</div>
<p>Auger decay thus dominates for light elements, which has impact on both our ability of obtaining well-resolved spectra for these elements, as well as the impact of X-ray damage on biological matter.</p>
<p>In non-resonant XES we measure the fluorescent decay of core-ionized states, through which we probe the (element-specific) nature of the local chemical environment. For light elements the valence space is probed directly, but for heavier elements we obtain a number of different decay channels from the valence region and the outer core region. These lines vary considerably in energy, intensity, and information content <span id="id13">[<a class="reference internal" href="refs.html#id11">KLP+16</a>]</span>:</p>
<ol class="simple">
<li><p>The <span class="math notranslate nohighlight">\(2p \rightarrow 1s\)</span> (<span class="math notranslate nohighlight">\(K\alpha_1\)</span> and <span class="math notranslate nohighlight">\(K\alpha_2\)</span>) is the most intense (due to the large overlap) and of lowest energy, and is relatively insensitive to the valence region</p></li>
<li><p>The <span class="math notranslate nohighlight">\(3p \rightarrow 1s\)</span> (<span class="math notranslate nohighlight">\(K\beta ' \)</span> and <span class="math notranslate nohighlight">\(K\beta_{1,3}\)</span>) is about an order of magnitude weaker and of higher energy, but more sensitive to the environment</p></li>
<li><p>Transitions from the ligand MO:s (<span class="math notranslate nohighlight">\(K\beta '' \)</span> and <span class="math notranslate nohighlight">\(K\beta_{2,5}\)</span>), or valence-to-core (VtC), is the weakest, high-energy features which is most sensitive to the local environment</p></li>
</ol>
<p>This tutorial focus on spectra of light elements, as modelled by (TD)DFT and ADC. A good starting point for learning about such modeling can be found in <span id="id14">[<a class="reference internal" href="refs.html#id15">Bes21</a>, <a class="reference internal" href="refs.html#id19">BA10</a>, <a class="reference internal" href="refs.html#id14">FD19</a>]</span>.</p>
<div class="section" id="spectra-from-adc">
<h3>Spectra from ADC<a class="headerlink" href="#spectra-from-adc" title="Permalink to this headline">¶</a></h3>
<p>One approach for considering X-ray emission spectra is to converge the core-hole state and use this core-ionized system as the reference state for a normal excited state calculation <span id="id15">[<a class="reference internal" href="refs.html#id19">BA10</a>, <a class="reference internal" href="refs.html#id14">FD19</a>]</span>. The core-decay transitions are then the first negative eigenstates of the system, such that a standard Davidson calculation can be run on top.</p>
<p>Considering water with ADC(2), the oxygen X-ray emission spectrum is calculated as:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span>        <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span>       <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>

<span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform ADC calculation of first four states</span>
<span class="n">adc_xes</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827192  &lt;S^2&gt; = 6.3398176e-12  2S+1 = 1
converged SCF energy = -56.0754789470864  &lt;S^2&gt; = 0.76257805  2S+1 = 2.0125387
Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8       0.77768   1.7s  [-19.29082067 -19.19940205 -18.96181907 -18.3637012 ]
  2    16     0.0010764  136ms  [-19.44427093 -19.36689642 -19.16826546 -18.57947501]
  3    24    4.4301e-07  189ms  [-19.44429764 -19.3669284  -19.16831914 -18.57954987]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             2s  42ms
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There will be convergence issues if including transitions from very different types, <em>e.g.</em> resolving transitions into the core and out to the unoccupied valence region simultaneously. As such, the number of resolved states should remain limited to the number of potential decay channels.</p>
</div>
<p>The resuls can be printed as a table, and convoluted and plotted using built-in functionalities or a custom broadening. Note that the eigenvalues are negative, and a sign change is thus appropriate when constructing the spectra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print information on eigenstates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># Convolute using functionalities available in gator and adcc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Built-in broadening [note negative energies]&#39;</span><span class="p">)</span>
<span class="n">adc_xes</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>

<span class="c1"># Convoluted using information on excitation energies and oscillator strengths</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Custom broadening&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xes</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">519</span><span class="p">,</span><span class="mi">531</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| adc2                                        any ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      -19.4443     -529.1063   0.0568    0.9548    0.0452  |
|  1     -19.36693      -527.001   0.0458    0.9503   0.04966  |
|  2     -19.16832     -521.5965   0.0419    0.9376   0.06245  |
|  3     -18.57955     -505.5753   0.0031    0.9335   0.06655  |
+--------------------------------------------------------------+
</pre></div>
</div>
<img alt="../_images/xray_calc_22_1.png" src="../_images/xray_calc_22_1.png" />
</div>
</div>
<p>Using cc-pCVTZ/cc-pVTZ and comparing to experiment <span id="id16">[<a class="reference internal" href="refs.html#id16">WBM+12</a>]</span>:</p>
<div class="figure align-default" id="adc-water-xes">
<img alt="../_images/adc_water_xes.svg" src="../_images/adc_water_xes.svg" /><p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">ADC(2) water X-ray emission spectrum, as compared to experiment. Theoretical spectra shifted by 0.37 eV (to account for relativistic effects) and broadened by 0.3 eV.</span><a class="headerlink" href="#adc-water-xes" title="Permalink to this image">¶</a></p>
</div>
<p>While the broadening between the different lines is noticably different, it is clear that the energy spacing and integrated intensities of the features are in good agreement with experiment. Note that the theoretical spectrum is obtained at the ADC(2) level of theory, which has been to be in better agreement than ADC(2)-x and ADC(3/2) for XES <span id="id17">[<a class="reference internal" href="refs.html#id14">FD19</a>]</span>.</p>
</div>
<div class="section" id="spectra-from-tddft">
<h3>Spectra from TDDFT<a class="headerlink" href="#spectra-from-tddft" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="spectra-from-ground-state-mo-s">
<h3>Spectra from ground state MO:s<a class="headerlink" href="#spectra-from-ground-state-mo-s" title="Permalink to this headline">¶</a></h3>
<p>While we have previously seen that Koopmans’ theorem is in significant disagreement with experimental ionization energies (due to lack of relaxation), it has been noted that the <em>relative</em> position of the (valence) MO energies can still be quite reasonable. As such, a computationally very simple approach for modeling X-ray emission spectra has been used, in which transition energies are estimated from</p>
<div class="amsmath math notranslate nohighlight" id="equation-09d9a0a1-0f09-42cc-aa8a-bb1a855ba165">
<span class="eqno">(9)<a class="headerlink" href="#equation-09d9a0a1-0f09-42cc-aa8a-bb1a855ba165" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\Delta E = \epsilon_v - \epsilon_c
\end{equation}\]</div>
<p><em>i.e.</em> the difference in ground state MO energies. The intensities are taken to be proportional to the dipole moment:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8ec10ebf-9caa-4e62-ab99-898dbdc3304c">
<span class="eqno">(10)<a class="headerlink" href="#equation-8ec10ebf-9caa-4e62-ab99-898dbdc3304c" title="Permalink to this equation">¶</a></span>\[\begin{equation}
f \propto \left| \langle \phi_i \left| \hat{\mu} \right| \phi_c \rangle \right| ^2
\end{equation}\]</div>
<p>This method is very attractive in its simplicity, requiring only a single ground state calculation and the construction of some transition dipole moments for a full spectrum calculation. However, the absolute energies are significantly off, and any differences in relaxation between the different channels will not be included.</p>
<p>Nevertheless, this approach has been noted to yield good (relative) agreement to experimental measurements <span id="id18">[<a class="reference internal" href="refs.html#id15">Bes21</a>]</span>, and it is capable of considering even massive molecular systems.</p>
<p>The calculation of an emission spectra requires the calculation of the ground state wave function and all relevant transition dipole moments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and calculation</span>
<span class="n">scf_drv</span>          <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>     <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Extract orbital energies and number of occupied MOs</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Occupied MO energies:&#39;</span><span class="p">,</span><span class="n">au2ev</span><span class="o">*</span><span class="n">orbital_energies</span><span class="p">[:</span><span class="n">nocc</span><span class="p">])</span>

<span class="c1"># Define probed core MO and calculate energy differences</span>
<span class="n">n_core</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">energy_diff</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n_mo</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_mo</span> <span class="o">!=</span> <span class="n">n_core</span><span class="p">:</span>
        <span class="n">energy_diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">n_mo</span><span class="p">]</span><span class="o">-</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">n_core</span><span class="p">]))</span>

<span class="c1"># Extract MO coefficients</span>
<span class="n">mo_C</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
         
<span class="c1"># Load drivers for transition dipole moment</span>
<span class="n">dipole_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ElectricDipoleIntegralsDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>

<span class="c1"># Calculated transition dipole moments and convert to MO basis</span>
<span class="n">dipole_matrices</span> <span class="o">=</span> <span class="n">dipole_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">x_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">x_to_numpy</span><span class="p">();</span> <span class="n">x_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mo_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x_ao</span><span class="p">,</span> <span class="n">mo_C</span><span class="p">))</span>
<span class="n">y_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">y_to_numpy</span><span class="p">();</span> <span class="n">y_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mo_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">y_ao</span><span class="p">,</span> <span class="n">mo_C</span><span class="p">))</span>
<span class="n">z_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">z_to_numpy</span><span class="p">();</span> <span class="n">z_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mo_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">z_ao</span><span class="p">,</span> <span class="n">mo_C</span><span class="p">))</span>

<span class="c1"># Construct oscillator strengths</span>
<span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">sigma</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
<span class="k">for</span> <span class="n">n_mo</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_mo</span> <span class="o">!=</span> <span class="n">n_core</span><span class="p">:</span>
        <span class="n">x_tmp</span><span class="p">,</span><span class="n">y_tmp</span><span class="p">,</span><span class="n">z_tmp</span> <span class="o">=</span> <span class="n">x_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span><span class="n">n_mo</span><span class="p">],</span><span class="n">y_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span><span class="n">n_mo</span><span class="p">],</span><span class="n">z_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span><span class="n">n_mo</span><span class="p">]</span>
        <span class="n">xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">);</span> <span class="n">yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">);</span> <span class="n">zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">)</span>
        <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_tmp</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_tmp</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_tmp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Occupied MO energies: [-520.65710169  -27.68789316  -14.39952914   -9.70377585   -7.94953008]
</pre></div>
</div>
</div>
</div>
<p>The resuls can be printed as a table, and convoluted and plotted using a custom broadening. We here focus on the high-energy for the latter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print results as a table</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy   Osc. str.   x-component   y-component   z-component&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_diff</span><span class="p">)):</span>
    <span class="n">e</span><span class="p">,</span><span class="n">os</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">energy_diff</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">  </span><span class="si">{:8.5f}</span><span class="s1">     </span><span class="si">{:8.5f}</span><span class="s1">      </span><span class="si">{:8.5f}</span><span class="s1">      </span><span class="si">{:8.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">os</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>

<span class="c1"># Plot X-ray emission spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">energy_diff</span><span class="p">,</span><span class="n">sigma</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">504</span><span class="p">,</span><span class="mi">514</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy   Osc. str.   x-component   y-component   z-component
492.969   0.00022      0.00000      -0.00000      -0.01478
506.258   0.00238      0.04878      -0.00000       0.00000
510.953   0.00255     -0.00000      -0.00000       0.05050
512.708   0.00342      0.00000       0.05848       0.00000
</pre></div>
</div>
<img alt="../_images/xray_calc_27_1.png" src="../_images/xray_calc_27_1.png" />
</div>
</div>
<p>Using a cc-pCVTZ/cc-pVTZ basis set and comparing to experiment <span id="id19">[<a class="reference internal" href="refs.html#id16">WBM+12</a>]</span>:</p>
<div class="figure align-default" id="overlap-water-xes">
<img alt="../_images/overlap_water_xes.svg" src="../_images/overlap_water_xes.svg" /><p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">DFT (B3LYP) overlap X-ray emission spectrum of water, as compared to experiment. Theoretical spectra shifted to approximately align the high-energy feature, and broadened by 0.3 eV.</span><a class="headerlink" href="#overlap-water-xes" title="Permalink to this image">¶</a></p>
</div>
<p>The resulting spectrum is very much off in energy, but the relative agreement to experiment is quite impressive.</p>
</div>
<div class="section" id="id20">
<h3>Other approaches<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>Alternative methods of considering XES include, among others:</p>
<ul class="simple">
<li><p>CC</p></li>
<li><p>…</p></li>
</ul>
</div>
</div>
<div class="section" id="resonant-inelastic-x-ray-scattering">
<span id="sec-xray-calc-rixs"></span><h2>Resonant inelastic X-ray scattering<a class="headerlink" href="#resonant-inelastic-x-ray-scattering" title="Permalink to this headline">¶</a></h2>
<p>We here focus on the electronic part of the RIXS plane. Can also go close to the Rayleigh line, which probe local vibrational modes.</p>
<div class="section" id="two-step-approach-with-adc">
<h3>Two-step approach with ADC<a class="headerlink" href="#two-step-approach-with-adc" title="Permalink to this headline">¶</a></h3>
<p>An approximate treatment of the RIXS plane can be achieved by considering it as a two-step process <span id="id21">[<a class="reference internal" href="refs.html#id17">FPB18</a>]</span>, with:</p>
<ol class="simple">
<li><p>A core-excitation as modeled like a normal X-ray absorption spectrum</p></li>
<li><p>A core-decay process from the core-hole system with an electron put in each relevant final state probed in (1), modeled as a (non-resonant) X-ray emission spectrum</p></li>
</ol>
<p>{\bf Note and discuss:} Spin-contamination, with &lt;S^2&gt; = 1</p>
<p>The RIXS plane is then constructed from above absorption and emission energies, with RIXS intensity from the multiplication of respective oscillator strength.</p>
<p>Note that this approach is an approximation, as it disregards potentially important detuning effects, and in the example given below we also ignore existing coupling between the polarization in the incoming and outgoing photon. Furthermore, it requires the convergence of core-ionized states, which is much trickier than core-ionized, and will likely only work for the first few core-excited states.</p>
<p>Nevertheless, the scheme is quite easy to understand, and introducing core-excited dynamics is relatively straightforward. As such, we here illustrate how the RIXS plane of water can be constructed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Calculate X-ray absorption spectrum</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Calculate resonant X-ray emission spectrum</span>
<span class="c1">#   for states where the core-electron is moved to LUMO or LUMO+1</span>
<span class="n">adc_rxes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
    <span class="c1"># Copy molecular orbitals</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="c1"># Move 1s electron to LUMO / LUMO+1</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Calculate resonant X-ray emission spectrum</span>
    <span class="n">adc_rxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Now the correct combinations of transition energies and intensities need to be constructed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">adc_rixs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Probing LUMO and LUMO+1</span>
<span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
    <span class="c1"># From XAS calculation</span>
    <span class="n">E_xas</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="n">I_xas</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="c1"># From XES calculation</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_rxes</span><span class="p">[</span><span class="n">indx</span><span class="p">])):</span>
        <span class="n">E_xes</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rxes</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">I_xes</span> <span class="o">=</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">adc_rixs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">E_xas</span><span class="p">,</span> <span class="n">E_xes</span><span class="p">,</span> <span class="n">I_xas</span><span class="o">*</span><span class="n">I_xes</span><span class="p">])</span>
</pre></div>
</div>
<p>And the RIXS plane can then be constructed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot absorption spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span><span class="n">xi</span><span class="p">)</span>

<span class="c1"># Plot emission specta, with vertical shift from absorbed energy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="c1"># LUMO</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">5.</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">+</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># LUMO+1</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">5.</span><span class="o">*</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">+</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Plot RIXS plane, here with marker size scaling with intensity</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_rixs</span><span class="p">)):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">adc_rixs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10000</span><span class="o">*</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    
<span class="c1"># Zooming in to region spanned by XAS and XES projections</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">519</span><span class="p">,</span><span class="mi">530</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">536</span><span class="p">,</span><span class="mi">544</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="adc-2st-rixs">
<img alt="../_images/adc_2st_rixs.svg" src="../_images/adc_2st_rixs.svg" /></div>
</div>
<div class="section" id="two-step-approach-with-tddft">
<h3>Two-step approach with TDDFT<a class="headerlink" href="#two-step-approach-with-tddft" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="dirac-kramer-heisenberg-with-adc">
<h3>Dirac-Kramer-Heisenberg with ADC<a class="headerlink" href="#dirac-kramer-heisenberg-with-adc" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="herfd">
<h3>HERFD<a class="headerlink" href="#herfd" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Discuss briefly - could add illustration.</p>
</div>
</div>
<div class="section" id="id22">
<h3>Other approaches<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>Alternative methods of considering RIXS include, among others:</p>
<ul class="simple">
<li><p>…</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="xray.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">X-ray spectroscopies</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="xray_analysis.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Spectrum analysis</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The eChem team<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>