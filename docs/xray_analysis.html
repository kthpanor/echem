
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spectrum analysis &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Special aspects" href="xray_aspects.html" />
    <link rel="prev" title="Spectrum calculation" href="xray_calc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv-vis.html">
   UV/vis spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ir.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="raman.html">
     Raman spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ir_raman_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kernel_integration.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dft_scf.html">
     SCF optimization of a closed-shell state
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradients.html">
     Gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Hessians and vibrations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="structopt-overview.html">
   Molecular structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="structopt.html">
     Optimization Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gsstructopt.html">
     Ground state structure optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="structopt-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="transition_state.html">
     Transition state geometry optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="impes.html">
   Potential energy surfaces by interpolation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="md_ffs.html">
     Force field parameterization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_run.html">
     Running a simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_biased.html">
     Biased molecular dynamics
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci-response.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     Hartree–Fock
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft.html">
     TDDFT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="response_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="excoupl_impl.html">
     Implementation of the exciton coupling model
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="loprop.html">
     LoProp charges and polarisabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Structure and orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-excited.html">
   Excited states
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/xray_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kthpanor/echem"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/xray_analysis.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/xray_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amplitudes-of-resulting-vectors">
   Amplitudes of resulting vectors
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eigenvectors">
     Eigenvectors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#response-vectors">
     Response vectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decomposition-of-spectra">
   Decomposition of spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-contributions">
     Atomic contributions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polarization-dependence">
     Polarization dependence
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualization">
   Visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#descriptors">
   Descriptors
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Spectrum analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amplitudes-of-resulting-vectors">
   Amplitudes of resulting vectors
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eigenvectors">
     Eigenvectors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#response-vectors">
     Response vectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decomposition-of-spectra">
   Decomposition of spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-contributions">
     Atomic contributions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polarization-dependence">
     Polarization dependence
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualization">
   Visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#descriptors">
   Descriptors
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="spectrum-analysis">
<h1>Spectrum analysis<a class="headerlink" href="#spectrum-analysis" title="Permalink to this headline">¶</a></h1>
<p>For the analysis of obtained spectra we will focus on the carbon X-ray absorption spectrum of vinylfluoride. Some analysis on the water X-ray emission spectrum will also be included, but as emission spectra is generally easier to understand (fewer states, probing occupied state of relatively large energy shifts, …), focus will be on XAS.</p>
<p>Vinulfluride (C<span class="math notranslate nohighlight">\(_2\)</span>H<span class="math notranslate nohighlight">\(_3\)</span>F) is a fluorine-substituted ethene derivate, which possess large shifts in features for the -CHF site due to interaction with the very electronegative fluorine. This <em>chemical shift</em> is significant and a strong indicator of the local chemical environment. This can be seen in the <a class="reference external" href="https://doi.org/10.1103/PhysRevA.36.1683">experimental</a> spectra of ethene, vinylfluoride, and 1,1-difluoroethene:</p>
<div class="figure align-default" id="expt-ethene">
<img alt="../_images/expt_ethene.svg" src="../_images/expt_ethene.svg" /><p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">Carbon X-ray absorption spectra of ethene and two substituted derivates. Marking position (and number of contributing carbon sites) of strong <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> transitions.</span><a class="headerlink" href="#expt-ethene" title="Permalink to this image">¶</a></p>
</div>
<p>We see that a single substitution yield a shift of about 2 eV, and double substitution (at the same site) of about 4 eV.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Add more references</p></li>
<li><p>Fix figure</p></li>
</ul>
</div>
<p>Calculating the vinylfluoride spectrum using CVS-ADC(2)-x and CPP-DFT (with the B3LYP functional):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 10 lowest eigenstates with CVS restriction to MOs #1-#3 (fluorine and carbon 1s)</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and calculation</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">);</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Define spectrum region to be resolved</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">272.0</span><span class="p">,</span><span class="mf">285.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span>
<span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>

<span class="c1"># Calculate the response</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="o">/</span><span class="n">au2ev</span><span class="p">},</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>

<span class="c1"># Extract the imaginary part of the complex response function and convert to absorption cross section</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>
    <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting spectra are shown below, and look very similar (although with a large difference in absolute energy):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># CPP-DFT results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CPP-DFT (B3LYP)&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">)</span>

<span class="c1"># CVS-ADC(2)-x results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CVS-ADC(2)-x&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span><span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="xray-vinyl-calc">
<a class="reference internal image-reference" href="../_images/vinyl_calc.svg"><img alt="../_images/vinyl_calc.svg" height="345" src="../_images/vinyl_calc.svg" width="552" /></a>
</div>
<div class="section" id="amplitudes-of-resulting-vectors">
<h2>Amplitudes of resulting vectors<a class="headerlink" href="#amplitudes-of-resulting-vectors" title="Permalink to this headline">¶</a></h2>
<div class="section" id="eigenvectors">
<h3>Eigenvectors<a class="headerlink" href="#eigenvectors" title="Permalink to this headline">¶</a></h3>
<p>For eigenstates we can study the amplitudes of the eigenvectors to see the MO contributions in the different excited states. For CPP, a similar analysis on response vectors can be conducted, but this can be made more difficult if the density of states is high and the mixing of contributions to the response at investigated frequencies is thus significant.</p>
<p>From the ADC calculations there is the function <code class="docutils literal notranslate"><span class="pre">state.describe_amplitudes</span></code>, which print the amplitudes using one of three formats, controlled by <code class="docutils literal notranslate"><span class="pre">index_format</span></code>. The amplitudes are printed when above a <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> threshold, and splitting the returning string according to <code class="docutils literal notranslate"><span class="pre">state</span></code> and printing the first two states, we get:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">hf</span><span class="se">\&#39;</span><span class="s1"> format, which yield MO number:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;hf&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span> <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">hf_exc1</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">hf_exc2</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">adcc</span><span class="se">\&#39;</span><span class="s1"> format, with indexing as used in adcc:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;adcc&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span> <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">adcc_exc1</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">homolumo</span><span class="se">\&#39;</span><span class="s1"> format, which use HOMO/LUMO/HOCO format:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;homolumo&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="n">homo_exc1</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">hf_exc1</span> <span class="o">=</span> <span class="s1">&#39;+---------------------------------------+</span><span class="se">\n</span><span class="s1">| State   1 ,      10.63675 au          |</span><span class="se">\n</span><span class="s1">+---------------------------------------+</span><span class="se">\n</span><span class="s1">|   1     -&gt;  12      a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s1">|   1     -&gt;  22      a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s1">|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |&#39;</span>
<span class="n">hf_exc2</span> <span class="o">=</span> <span class="s1">&#39;+---------------------------------------+</span><span class="se">\n</span><span class="s1">| State   1 ,      10.63675 au          |</span><span class="se">\n</span><span class="s1">+---------------------------------------+</span><span class="se">\n</span><span class="s1">|   1     -&gt;  12      a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s1">|   1     -&gt;  22      a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s1">|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |&#39;</span>
<span class="n">adcc_exc1</span> <span class="o">=</span> <span class="s1">&#39;+-------------------------------------------------------+</span><span class="se">\n</span><span class="s1">| State   1 ,      10.63675 au,      289.4407 eV        |</span><span class="se">\n</span><span class="s1">+-------------------------------------------------------+</span><span class="se">\n</span><span class="s1">| (o2  1)         -&gt; (v1  0)          a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s1">| (o2  1)         -&gt; (v1 10)          a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s1">| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     +0.149 |&#39;</span>
<span class="n">homo_exc1</span> <span class="o">=</span> <span class="s1">&#39;+-------------------------------------------------------+</span><span class="se">\n</span><span class="s1">| State   1 ,      10.63675 au,      289.4407 eV        |</span><span class="se">\n</span><span class="s1">+-------------------------------------------------------+</span><span class="se">\n</span><span class="s1">| HOCO -1         -&gt; LUMO             a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s1">| HOCO -1         -&gt; LUMO+10          a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s1">| HOMO    HOCO -1 -&gt; LUMO    LUMO     ab-&gt;ab     +0.149 |&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">hf</span><span class="se">\&#39;</span><span class="s1"> format, which yield MO number:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hf_exc1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hf_exc2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">adcc</span><span class="se">\&#39;</span><span class="s1"> format, with indexing as used in adcc:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adcc_exc1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">homolumo</span><span class="se">\&#39;</span><span class="s1"> format, which use HOMO/LUMO/HOCO format:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">homo_exc1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>From &#39;hf&#39; format, which yield MO number:
+---------------------------------------+
| State   1 ,      10.63675 au          |
+---------------------------------------+
|   1     -&gt;  12      a -&gt;a      -0.601 |
|   1     -&gt;  22      a -&gt;a      -0.105 |
|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |
+---------------------------------------+
| State   1 ,      10.63675 au          |
+---------------------------------------+
|   1     -&gt;  12      a -&gt;a      -0.601 |
|   1     -&gt;  22      a -&gt;a      -0.105 |
|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |


First transition from &#39;adcc&#39; format, with indexing as used in adcc:
+-------------------------------------------------------+
| State   1 ,      10.63675 au,      289.4407 eV        |
+-------------------------------------------------------+
| (o2  1)         -&gt; (v1  0)          a -&gt;a      -0.601 |
| (o2  1)         -&gt; (v1 10)          a -&gt;a      -0.105 |
| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     +0.149 |


First transition from &#39;homolumo&#39; format, which use HOMO/LUMO/HOCO format:
+-------------------------------------------------------+
| State   1 ,      10.63675 au,      289.4407 eV        |
+-------------------------------------------------------+
| HOCO -1         -&gt; LUMO             a -&gt;a      -0.601 |
| HOCO -1         -&gt; LUMO+10          a -&gt;a      -0.105 |
| HOMO    HOCO -1 -&gt; LUMO    LUMO     ab-&gt;ab     +0.149 |
</pre></div>
</div>
</div>
</div>
<p>From this, it is clear that the two first transitions originates in two different MOs, which corresponds to the -<strong>C</strong>H<span class="math notranslate nohighlight">\(_2\)</span> and -<strong>C</strong>HF atoms, respectively. The transitions are dominated by single-excitations to the LUMO and LUMO+1, with largest relaxation contributions coming from the HOMO.</p>
</div>
<div class="section" id="response-vectors">
<h3>Response vectors<a class="headerlink" href="#response-vectors" title="Permalink to this headline">¶</a></h3>
<p>Maybe include example with CPP.</p>
</div>
</div>
<div class="section" id="decomposition-of-spectra">
<h2>Decomposition of spectra<a class="headerlink" href="#decomposition-of-spectra" title="Permalink to this headline">¶</a></h2>
<p>For a more visual illustration, we can plot the spectra as decomposed according to atomic contributions and polarization of incoming radiation.</p>
<div class="section" id="atomic-contributions">
<h3>Atomic contributions<a class="headerlink" href="#atomic-contributions" title="Permalink to this headline">¶</a></h3>
<p>Decomposing according to atomic contributions provides information on which core orbitals that contribute to the various features. For vinylfluoride, this can be done by performing CVS calculations with tailored CVS spaces for each carbon site:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 6 lowest eigenstates with CVS restriction to MOs #2 and #3 (two carbons)</span>
<span class="n">adc_chf</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">adc_ch2</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>From which the spectrum can be decomposed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Spectrum from -CHF </span>
<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_chf</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_chf</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x1i</span><span class="p">,</span><span class="n">y1i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Spectrum from -CH2</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_ch2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_ch2</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x2i</span><span class="p">,</span><span class="n">y2i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plotting line spectra for full, area spectra for contributions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span><span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="s1">&#39;-CH2&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span><span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="xray-adc-decomp">
<a class="reference internal image-reference" href="../_images/adc_decomp.svg"><img alt="../_images/adc_decomp.svg" height="276" src="../_images/adc_decomp.svg" width="483" /></a>
</div>
<p>This manner of decomposing the atomic contributions should be taken with some care, as it involves explicit calculation of all atomic sites, which:</p>
<ol class="simple">
<li><p>Requires a larger number of calculations, and care should be taken so that a region in which some states (e.g. for -CHF) are converged into, but not other (e.g. -CH<span class="math notranslate nohighlight">\(_2\)</span>).</p></li>
<li><p>Does not strictly fit with the CVS philosophy, which uses the large separation in energy and spatial extend as a basis for separation. Energy separation can now be rather small, and for some systems degeneracies and near-degeneracies may lead to delocalized core orbitals (see <a class="reference internal" href="xray_aspects.html#sec-xray-topics-chloc"><span class="std std-ref">here</span></a> and <a class="reference internal" href="xray_aspects.html#sec-xray-topics-tailcvs"><span class="std std-ref">here</span></a>). If so, all delocalized sites must be included in the same CVS space.</p></li>
</ol>
<p>Nevertheless, the lower computational cost per calculation of doing this decomposition may make it worth it.</p>
<p>An alternatively is using the full space eigenvectors, from which the atomic decomposition can be performed as follows:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do full space eigenvector decomposition and compare to above.</p>
<ul class="simple">
<li><p>Either check how eigenstates are constructed, or just split and divide describe_amplitude results.</p></li>
</ul>
</div>
<p>Performing the same analysis with CPP-DFT, we decompose the response vectors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of occupied and unoccupied (alpha) MOs</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="n">nvirt</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="o">.</span><span class="n">number_mos</span><span class="p">()</span> <span class="o">-</span> <span class="n">nocc</span>

<span class="c1"># Extract solution vectors</span>
<span class="n">solution_vecs</span> <span class="o">=</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;solutions&#39;</span><span class="p">)</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">x_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
    <span class="n">y_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
    <span class="n">z_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_solution</span><span class="p">)</span>

<span class="c1"># Extract polarization-resolved response</span>
<span class="n">sX</span><span class="p">,</span><span class="n">sY</span><span class="p">,</span><span class="n">sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">axx</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">ayy</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">azz</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>

<span class="c1"># Create empty object of dimension nocc (to add spectrum contributions from each occupied orbital)</span>
<span class="n">spec_comp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nocc</span><span class="p">):</span> <span class="n">spec_comp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    
<span class="c1"># Appending spec_comp object with decomposed response</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">z_tmp</span> <span class="o">=</span> <span class="n">z_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
        <span class="n">comp_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[:])))</span>
        <span class="n">spec_comp</span><span class="p">[</span><span class="n">occ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_X</span><span class="o">*</span><span class="n">sX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Y</span><span class="o">*</span><span class="n">sY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Z</span><span class="o">*</span><span class="n">sZ</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1"># Extract contribution of two carbon atoms, as well as the full spectrum</span>
<span class="n">cont_chf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cont_ch2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">cont_full</span> <span class="o">=</span> <span class="n">sigma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Create splined spectra for each component</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">ychf</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_chf</span><span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">ych2</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_ch2</span><span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yfull</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_full</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="c1"># Spectrum from the non-carbon atoms</span>
<span class="n">yrest</span> <span class="o">=</span> <span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># Plot full spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Plot components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;-CH$_2$&#39;</span><span class="p">,</span><span class="s1">&#39;Rest&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="xray-dft-decomp">
<a class="reference internal image-reference" href="../_images/dft_decomp.svg"><img alt="../_images/dft_decomp.svg" height="276" src="../_images/dft_decomp.svg" width="483" /></a>
</div>
<p>Just as from the MO analysis found above, we see that the first two strong features corresponds to transitions from two different MOs, which here corresponds to <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> from -CH<span class="math notranslate nohighlight">\(_2\)</span> and -CHF. Features at around <span class="math notranslate nohighlight">\(\sim\)</span>279 and <span class="math notranslate nohighlight">\(\sim\)</span>281 eV are resonances to <span class="math notranslate nohighlight">\(\sigma^{\ast}\)</span>.</p>
</div>
<div class="section" id="polarization-dependence">
<h3>Polarization dependence<a class="headerlink" href="#polarization-dependence" title="Permalink to this headline">¶</a></h3>
<p>Information on the structure of the molecular sample can be obtained by considering any polarization-dependence of the measured spectrum. This may not work for gas phase samples, as the isotropic signal will be observed, but it can provide very useful information on, <em>e.g.</em>, the orientation and structuring of self-assembly monolayers.</p>
<p>Resolving the polarization-dependence from ADC and CPP-DFT calculations is straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract excitation energies</span>
<span class="n">adc_freq</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span>

<span class="c1"># Extract Cartesian components from the ADC state (here skipping the prefactors)</span>
<span class="n">adc_sX</span><span class="p">,</span><span class="n">adc_sY</span><span class="p">,</span><span class="n">adc_sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">)):</span>
    <span class="n">tmp_tms</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">transition_dipole_moment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">adc_sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Resolved spectrum region</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="mi">284</span><span class="p">,</span><span class="mi">296</span>

<span class="c1"># Broadened spectra for each component</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sX</span>
<span class="n">xX</span><span class="p">,</span><span class="n">yX</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sY</span>
<span class="n">xY</span><span class="p">,</span><span class="n">yY</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sZ</span>
<span class="n">xZ</span><span class="p">,</span><span class="n">yZ</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plot total spectrum (line) and Cartesian contributions (area)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span><span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="xray-adc-pol">
<a class="reference internal image-reference" href="../_images/adc_pol.svg"><img alt="../_images/adc_pol.svg" height="276" src="../_images/adc_pol.svg" width="483" /></a>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Extract frequencies</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Spline spectra for each Cartesian contribution</span>
<span class="n">yX</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sX</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yY</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yZ</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sZ</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

<span class="c1"># Plot total spectrum (line) and Cartesian contributions (area)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="xray-dft-pol">
<a class="reference internal image-reference" href="../_images/dft_pol.svg"><img alt="../_images/dft_pol.svg" height="276" src="../_images/dft_pol.svg" width="483" /></a>
</div>
<p>We see that the first two transitions are out-of-plane, as they correspond to <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span>.</p>
<p>Using a larger basis set of aug-cc-pCVT/cc-pVTZ (for C and H/F) and comparing to experiment, we obtain:</p>
<div class="figure align-default" id="vinyl-decomp">
<img alt="../_images/vinyl_decomp.svg" src="../_images/vinyl_decomp.svg" /><p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">ADC and TDDFT, atomic and polarization</span><a class="headerlink" href="#vinyl-decomp" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fix this. Maybe use CAM100%-B3LYP.</p>
</div>
</div>
</div>
<div class="section" id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>MOs</p></li>
<li><p>NTO:s</p></li>
<li><p>Electron/hole densities…</p></li>
<li><p>Attachment/detachment densities…</p>
<ul>
<li><p>Compare to electron/hole - difference due to relaxation</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="descriptors">
<h2>Descriptors<a class="headerlink" href="#descriptors" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Electron/hole sizes…</p></li>
<li><p>Attachment/detachment sizes…</p></li>
<li><p>v2, R, …</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="xray_calc.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Spectrum calculation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="xray_aspects.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Special aspects</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By The eChem team<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>