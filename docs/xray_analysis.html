
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spectrum analysis &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="General aspects" href="xray_cons.html" />
    <link rel="prev" title="Spectrum calculation" href="xray_calc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="uv-vis.html">
   UV/vis absorption/emission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transmetal.html">
   Transition metals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nlo.html">
   Multi-photon interactions
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_cons.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradients.html">
     Gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="structopt.html">
   Molecular structure optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conint.html">
   Conical intersection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     SCF states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="loprop.html">
     LoProp charges and polarizabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Molecular orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/xray_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdocs/xray_analysis.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/docs/xray_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#amplitudes-of-eigen-vectors">
   Amplitudes of (eigen)vectors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decomposition-of-spectra">
   Decomposition of spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-contributions">
     Atomic contributions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polarization-dependence">
     Polarization dependence
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualization">
   Visualization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#descriptors">
   Descriptors
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="spectrum-analysis">
<h1>Spectrum analysis<a class="headerlink" href="#spectrum-analysis" title="Permalink to this headline">¶</a></h1>
<p>For the analysis of obtained spectra we will focus on the carbon X-ray absorption spectrum of vinylfluoride. Some analysis on the water X-ray emission spectrum will also be included, but as emission spectra is generally easier to understand (fewer states, probing occupied state of relatively large energy shifts, …), focus will be on XAS.</p>
<p>Vinulfluride (C<span class="math notranslate nohighlight">\(_2\)</span>H<span class="math notranslate nohighlight">\(_3\)</span>F) is a fluorine-substituted ethene derivate, which possess large shifts in features for the -CHF site due to interaction with the very electronegative fluorine. This <em>chemical shift</em> is significant and a strong indicator of the local chemical environment. This can be seen in the <a class="reference external" href="https://doi.org/10.1103/PhysRevA.36.1683">experimental</a> spectra of ethene, vinylfluoride, and 1,1-difluoroethene:</p>
<div class="figure align-default" id="expt-ethene">
<img alt="../_images/expt_ethene.svg" src="../_images/expt_ethene.svg" /><p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">Carbon X-ray absorption spectra of ethene and two substituted derivates. Marking position (and number of contributing carbon sites) of strong <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> transitions.</span><a class="headerlink" href="#expt-ethene" title="Permalink to this image">¶</a></p>
</div>
<p>We see that a single substitution yield a shift of about 2 eV, and double substitution (at the same site) of about 4 eV.</p>
<p><em>Loading modules and functions:</em></p>
<div class="cell tag_remove-output tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># standard Python modules and functions</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># QC software suites and functionalities</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">cc</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">gator</span>
<span class="kn">import</span> <span class="nn">adcc</span>
<span class="kn">from</span> <span class="nn">veloxchem.rsplinabscross</span> <span class="kn">import</span> <span class="n">LinearAbsorptionCrossSection</span>

<span class="c1"># for vlx</span>
<span class="n">silent_ostream</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># au to eV conversion factor</span>
<span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>

<span class="c1"># Lorentzian broadening function</span>
<span class="c1"># called with [energies, intensities, start energy, end energy, energy step, broadening]</span>
<span class="k">def</span> <span class="nf">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>
</pre></div>
</div>
</div>
</div>
<p>Calculating the vinylfluoride spectrum using CVS-ADC(2)-x and CPP-DFT (with the B3LYP functional):</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 10 lowest eigenstates with CVS restriction to MOs #1-#3 (fluorine and carbon 1s)</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Reading basis set from file: /opt/anaconda3/envs/echem/lib/python3.7/site-packages/veloxchem/basis/6-31G         
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                            Self Consistent Field Driver Setup                                            
                                           ====================================                                           
                                                                                                                          
                   Wave Function Model             : Spin-Restricted Hartree-Fock                                         
                   Initial Guess Model             : Superposition of Atomic Densities                                    
                   Convergence Accelerator         : Two Level Direct Inversion of Iterative Subspace                     
                   Max. Number of Iterations       : 50                                                                   
                   Max. Number of Error Vectors    : 10                                                                   
                   Convergence Threshold           : 1.0e-06                                                              
                   ERI Screening Scheme            : Cauchy Schwarz + Density                                             
                   ERI Screening Mode              : Dynamic                                                              
                   ERI Screening Threshold         : 1.0e-12                                                              
                   Linear Dependence Threshold     : 1.0e-06                                                              
                                                                                                                          
* Info * Nuclear repulsion energy: 67.8158072523 a.u.                                                                     
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * SAD initial guess computed in 0.00 sec.                                                                          
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Starting Reduced Basis SCF calculation...                                                                        
* Info * ...done. SCF energy in reduced basis set: -176.826109136861 a.u. Time: 0.09 sec.                                 
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
               Iter. | Hartree-Fock Energy | Energy Change | Gradient Norm | Max. Gradient | Density Change               
               --------------------------------------------------------------------------------------------               
                  1      -176.826117754901    0.0000000000      0.00086035      0.00011437      0.00000000                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  2      -176.826117905409   -0.0000001505      0.00054076      0.00006709      0.00051539                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  3      -176.826117959258   -0.0000000538      0.00005460      0.00000748      0.00040400                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  4      -176.826117960104   -0.0000000008      0.00002171      0.00000220      0.00003865                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  5      -176.826117960194   -0.0000000001      0.00000418      0.00000060      0.00001516                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  6      -176.826117960197   -0.0000000000      0.00000211      0.00000022      0.00000274                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  7      -176.826117960197   -0.0000000000      0.00000029      0.00000005      0.00000144                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
* Info * SCF tensors written to file: scf.tensors.h5                                                                      
                                                                                                                          
               *** SCF converged in 7 iterations. Time: 0.14 sec.                                                         
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Spin-Restricted Hartree-Fock:                                                                              
               -----------------------------                                                                              
               Total Energy                       :     -176.8261179602 a.u.                                              
               Electronic Energy                  :     -244.6419252125 a.u.                                              
               Nuclear Repulsion Energy           :       67.8158072523 a.u.                                              
               ------------------------------------                                                                       
               Gradient Norm                      :        0.0000002867 a.u.                                              
                                                                                                                          
                                                                                                                          
               Ground State Information                                                                                   
               ------------------------                                                                                   
               Charge of Molecule            :  0.0                                                                       
               Multiplicity (2S+1)           :  1.0                                                                       
               Magnetic Quantum Number (M_S) :  0.0                                                                       
                                                                                                                          
                                                                                                                          
                                                 Spin Restricted Orbitals                                                 
                                                 ------------------------                                                 
                                                                                                                          
               Molecular Orbital No.   8:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.68035 a.u.                                                                    
               (   2 C   1p+1:     0.16) (   3 F   1p+1:     0.62) (   3 F   2p+1:     0.43)                              
                                                                                                                          
               Molecular Orbital No.   9:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.67862 a.u.                                                                    
               (   1 C   3s  :    -0.18) (   1 C   1p-1:     0.24) (   1 C   1p0 :     0.21)                              
               (   2 C   1p0 :    -0.28) (   3 F   1p-1:    -0.38) (   3 F   2p-1:    -0.26)                              
               (   5 H   1s  :    -0.18)                                                                                  
                                                                                                                          
               Molecular Orbital No.  10:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.58693 a.u.                                                                    
               (   1 C   1p-1:    -0.18) (   1 C   1p0 :     0.35) (   1 C   2p0 :     0.15)                              
               (   3 F   1p-1:     0.25) (   3 F   1p0 :     0.29) (   3 F   2p-1:     0.18)                              
               (   3 F   2p0 :     0.22) (   4 H   1s  :    -0.25) (   4 H   2s  :    -0.19)                              
                                                                                                                          
               Molecular Orbital No.  11:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.55524 a.u.                                                                    
               (   1 C   1p-1:     0.31) (   1 C   2p-1:     0.18) (   2 C   1p-1:    -0.30)                              
               (   3 F   1p-1:     0.33) (   3 F   2p-1:     0.26) (   5 H   1s  :    -0.20)                              
               (   5 H   2s  :    -0.15) (   6 H   1s  :    -0.23) (   6 H   2s  :    -0.19)                              
                                                                                                                          
               Molecular Orbital No.  12:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.38481 a.u.                                                                    
               (   1 C   1p+1:    -0.39) (   1 C   2p+1:    -0.33) (   2 C   1p+1:    -0.37)                              
               (   2 C   2p+1:    -0.26) (   3 F   1p+1:     0.23) (   3 F   2p+1:     0.21)                              
                                                                                                                          
               Molecular Orbital No.  13:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.17195 a.u.                                                                    
               (   1 C   1p+1:     0.34) (   1 C   2p+1:     0.74) (   2 C   1p+1:    -0.42)                              
               (   2 C   2p+1:    -0.74) (   3 F   1p+1:     0.15) (   3 F   2p+1:     0.20)                              
                                                                                                                          
               Molecular Orbital No.  14:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.25967 a.u.                                                                    
               (   1 C   3s  :     0.74) (   1 C   1p0 :    -0.19) (   1 C   2p0 :    -0.71)                              
               (   2 C   3s  :     1.23) (   2 C   1p-1:     0.26) (   2 C   2p-1:     0.71)                              
               (   4 H   2s  :    -1.41) (   6 H   2s  :    -1.57)                                                        
                                                                                                                          
               Molecular Orbital No.  15:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.27844 a.u.                                                                    
               (   1 C   3s  :    -2.01) (   1 C   1p-1:     0.18) (   1 C   2p-1:     0.73)                              
               (   1 C   2p0 :     0.18) (   2 C   3s  :     0.22) (   2 C   2p0 :    -0.38)                              
               (   3 F   3s  :     0.23) (   4 H   2s  :     0.62) (   5 H   2s  :     1.95)                              
               (   6 H   2s  :    -0.39)                                                                                  
                                                                                                                          
               Molecular Orbital No.  16:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.30718 a.u.                                                                    
               (   1 C   3s  :    -0.60) (   1 C   2p-1:    -0.88) (   1 C   2p0 :     0.57)                              
               (   2 C   3s  :     1.65) (   2 C   1p0 :     0.17) (   2 C   2p-1:     0.69)                              
               (   2 C   2p0 :     0.33) (   3 F   3s  :    -0.42) (   3 F   1p0 :     0.19)                              
               (   3 F   2p-1:    -0.21) (   3 F   2p0 :     0.28) (   4 H   2s  :     1.47)                              
               (   5 H   2s  :    -0.62) (   6 H   2s  :    -1.60)                                                        
                                                                                                                          
               Molecular Orbital No.  17:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.39551 a.u.                                                                    
               (   1 C   3s  :     0.78) (   1 C   1p-1:     0.22) (   1 C   2p-1:     1.65)                              
               (   1 C   2p0 :    -0.37) (   2 C   3s  :    -0.35) (   2 C   1p0 :     0.19)                              
               (   2 C   2p-1:    -0.82) (   2 C   2p0 :     1.66) (   3 F   3s  :    -1.04)                              
               (   3 F   2p-1:    -0.23) (   3 F   2p0 :     0.42) (   4 H   2s  :    -1.26)                              
               (   5 H   2s  :     1.45) (   6 H   2s  :     0.58)                                                        
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 7 iterations.
Total Energy: -176.8261179602 au
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/anaconda3/envs/echem/lib/python3.7/site-packages/pyscf/dft/numint.py:33: UserWarning: XC functional libraries (libxc or XCfun) are not available.
  warnings.warn(&#39;XC functional libraries (libxc or XCfun) are not available.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1    20       0.88677  439ms  [10.90469027 11.01274785 11.12186874 11.13574563 11.15427188 11.22366097
 11.28574905]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    40       0.10942  949ms  [10.57167327 10.67944033 10.72922156 10.7505297  10.81315151 10.81350354
 10.84327277]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    60     0.0061628   1.3s  [10.55764312 10.63999171 10.70167121 10.72094129 10.76303714 10.7808043
 10.81309454]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    80    0.00093831   1.6s  [10.55645575 10.63713122 10.69940848 10.71922898 10.76010939 10.77787268
 10.81040258]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5   100    0.00016657   2.0s  [10.55636508 10.63679052 10.6989825  10.71909288 10.75971215 10.77735299
 10.81004023]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    40    2.6361e-05   1.7s  [10.55635993 10.63676655 10.69893864 10.71907707 10.75967903 10.77729954
 10.81000825]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    60    7.2461e-06   1.3s  [10.55635926 10.63676365 10.69893843 10.71906122 10.75968085 10.77729447
 10.81001075]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    80    1.5009e-06   1.7s  [10.55636257 10.63676552 10.69892956 10.71908107 10.75966866 10.77729224
 10.81000241]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9   100    2.9462e-07   2.0s  [10.55636098 10.63676023 10.69892701 10.71906398 10.75968239 10.77729779
 10.8100042 ]
=== Converged ===
    Number of matrix applies:    180
    Total solver time:            13s  91ms
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and calculation</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">);</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Define spectrum region to be resolved</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">272.0</span><span class="p">,</span><span class="mf">285.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span>
<span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>

<span class="c1"># Calculate the response</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="o">/</span><span class="n">au2ev</span><span class="p">},</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>

<span class="c1"># Extract the imaginary part of the complex response function and convert to absorption cross section</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>
    <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting spectra are shown below, and look very similar (although with a large difference in absolute energy):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># CPP-DFT results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CPP-DFT (B3LYP)&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">)</span>

<span class="c1"># CVS-ADC(2)-x results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CVS-ADC(2)-x&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span><span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_analysis_6_0.png" src="../_images/xray_analysis_6_0.png" />
</div>
</div>
<div class="section" id="amplitudes-of-eigen-vectors">
<h2>Amplitudes of (eigen)vectors<a class="headerlink" href="#amplitudes-of-eigen-vectors" title="Permalink to this headline">¶</a></h2>
<p>For eigenstates we can study the amplitudes of the eigenvectors to see the MO contributions in the different excited states. For CPP, a similar analysis on response vectors can be conducted, but this can be made more difficult if the density of states is high and the mixing of contributions to the response at investigated frequencies is thus significant.</p>
<p>From the ADC calculations there is the function <code class="docutils literal notranslate"><span class="pre">state.describe_amplitudes</span></code>, which print the amplitudes using one of three formats, controlled by <code class="docutils literal notranslate"><span class="pre">index_format</span></code>. The amplitudes are printed when above a <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> threshold, and splitting the returning string according to <code class="docutils literal notranslate"><span class="pre">state</span></code> and printing the first two states, we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">hf</span><span class="se">\&#39;</span><span class="s1"> format, which yield MO number:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;hf&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">adcc</span><span class="se">\&#39;</span><span class="s1"> format, with indexing as used in adcc:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;adcc&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">homolumo</span><span class="se">\&#39;</span><span class="s1"> format, which use HOMO/LUMO/HOCO format:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;homolumo&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>From &#39;hf&#39; format, which yield MO number:
+---------------------------------------+
| State   1 ,      10.63676 au          |
+---------------------------------------+
|   1     -&gt;  12      a -&gt;a      -0.601 |
|   1     -&gt;  22      a -&gt;a      -0.105 |
|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |
+---------------------------------------+
| State   2 ,      10.69893 au          |
+---------------------------------------+
|   2     -&gt;  13      a -&gt;a        -0.5 |
|   2     -&gt;  15      a -&gt;a      +0.273 |
|   2     -&gt;  14      a -&gt;a       -0.22 |


First transition from &#39;adcc&#39; format, with indexing as used in adcc:
+-------------------------------------------------------+
| State   1 ,      10.63676 au,       289.441 eV        |
+-------------------------------------------------------+
| (o2  1)         -&gt; (v1  0)          a -&gt;a      -0.601 |
| (o2  1)         -&gt; (v1 10)          a -&gt;a      -0.105 |
| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     +0.149 |


First transition from &#39;homolumo&#39; format, which use HOMO/LUMO/HOCO format:
+-------------------------------------------------------+
| State   1 ,      10.63676 au,       289.441 eV        |
+-------------------------------------------------------+
| HOCO -1         -&gt; LUMO             a -&gt;a      -0.601 |
| HOCO -1         -&gt; LUMO+10          a -&gt;a      -0.105 |
| HOMO    HOCO -1 -&gt; LUMO    LUMO     ab-&gt;ab     +0.149 |
</pre></div>
</div>
</div>
</div>
<p>From this, it is clear that the two first transitions originates in two different MOs, which corresponds to the -<strong>C</strong>H<span class="math notranslate nohighlight">\(_2\)</span> and -<strong>C</strong>HF atoms, respectively. The transitions are dominated by single-excitations to the LUMO and LUMO+1, with largest relaxation contributions coming from the HOMO.</p>
</div>
<div class="section" id="decomposition-of-spectra">
<h2>Decomposition of spectra<a class="headerlink" href="#decomposition-of-spectra" title="Permalink to this headline">¶</a></h2>
<p>For a more visual illustration, we can plot the spectra as decomposed according to atomic contributions and polarization of incoming radiation.</p>
<div class="section" id="atomic-contributions">
<h3>Atomic contributions<a class="headerlink" href="#atomic-contributions" title="Permalink to this headline">¶</a></h3>
<p>Decomposing according to atomic contributions provides information on which core orbitals that contribute to the various features. For vinylfluoride, this can be done by performing CVS calculations with tailored CVS spaces for each carbon site:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 6 lowest eigenstates with CVS restriction to MOs #2 and #3 (two carbons)</span>
<span class="n">adc_chf</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">adc_ch2</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_gs</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Reading basis set from file: /opt/anaconda3/envs/echem/lib/python3.7/site-packages/veloxchem/basis/6-31G         
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                            Self Consistent Field Driver Setup                                            
                                           ====================================                                           
                                                                                                                          
                   Wave Function Model             : Spin-Restricted Hartree-Fock                                         
                   Initial Guess Model             : Superposition of Atomic Densities                                    
                   Convergence Accelerator         : Two Level Direct Inversion of Iterative Subspace                     
                   Max. Number of Iterations       : 50                                                                   
                   Max. Number of Error Vectors    : 10                                                                   
                   Convergence Threshold           : 1.0e-06                                                              
                   ERI Screening Scheme            : Cauchy Schwarz + Density                                             
                   ERI Screening Mode              : Dynamic                                                              
                   ERI Screening Threshold         : 1.0e-12                                                              
                   Linear Dependence Threshold     : 1.0e-06                                                              
                                                                                                                          
* Info * Nuclear repulsion energy: 67.8158072523 a.u.                                                                     
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * SAD initial guess computed in 0.00 sec.                                                                          
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Starting Reduced Basis SCF calculation...                                                                        
* Info * ...done. SCF energy in reduced basis set: -176.826109136861 a.u. Time: 0.09 sec.                                 
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
               Iter. | Hartree-Fock Energy | Energy Change | Gradient Norm | Max. Gradient | Density Change               
               --------------------------------------------------------------------------------------------               
                  1      -176.826117754901    0.0000000000      0.00086035      0.00011437      0.00000000                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  2      -176.826117905409   -0.0000001505      0.00054076      0.00006709      0.00051539                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  3      -176.826117959258   -0.0000000538      0.00005460      0.00000748      0.00040400                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  4      -176.826117960104   -0.0000000008      0.00002171      0.00000220      0.00003865                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  5      -176.826117960194   -0.0000000001      0.00000418      0.00000060      0.00001516                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  6      -176.826117960196   -0.0000000000      0.00000211      0.00000022      0.00000274                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  7      -176.826117960197   -0.0000000000      0.00000029      0.00000005      0.00000144                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
* Info * SCF tensors written to file: scf.tensors.h5                                                                      
                                                                                                                          
               *** SCF converged in 7 iterations. Time: 0.14 sec.                                                         
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Spin-Restricted Hartree-Fock:                                                                              
               -----------------------------                                                                              
               Total Energy                       :     -176.8261179602 a.u.                                              
               Electronic Energy                  :     -244.6419252125 a.u.                                              
               Nuclear Repulsion Energy           :       67.8158072523 a.u.                                              
               ------------------------------------                                                                       
               Gradient Norm                      :        0.0000002867 a.u.                                              
                                                                                                                          
                                                                                                                          
               Ground State Information                                                                                   
               ------------------------                                                                                   
               Charge of Molecule            :  0.0                                                                       
               Multiplicity (2S+1)           :  1.0                                                                       
               Magnetic Quantum Number (M_S) :  0.0                                                                       
                                                                                                                          
                                                                                                                          
                                                 Spin Restricted Orbitals                                                 
                                                 ------------------------                                                 
                                                                                                                          
               Molecular Orbital No.   8:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.68035 a.u.                                                                    
               (   2 C   1p+1:     0.16) (   3 F   1p+1:     0.62) (   3 F   2p+1:     0.43)                              
                                                                                                                          
               Molecular Orbital No.   9:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.67862 a.u.                                                                    
               (   1 C   3s  :    -0.18) (   1 C   1p-1:     0.24) (   1 C   1p0 :     0.21)                              
               (   2 C   1p0 :    -0.28) (   3 F   1p-1:    -0.38) (   3 F   2p-1:    -0.26)                              
               (   5 H   1s  :    -0.18)                                                                                  
                                                                                                                          
               Molecular Orbital No.  10:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.58693 a.u.                                                                    
               (   1 C   1p-1:    -0.18) (   1 C   1p0 :     0.35) (   1 C   2p0 :     0.15)                              
               (   3 F   1p-1:     0.25) (   3 F   1p0 :     0.29) (   3 F   2p-1:     0.18)                              
               (   3 F   2p0 :     0.22) (   4 H   1s  :    -0.25) (   4 H   2s  :    -0.19)                              
                                                                                                                          
               Molecular Orbital No.  11:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.55524 a.u.                                                                    
               (   1 C   1p-1:     0.31) (   1 C   2p-1:     0.18) (   2 C   1p-1:    -0.30)                              
               (   3 F   1p-1:     0.33) (   3 F   2p-1:     0.26) (   5 H   1s  :    -0.20)                              
               (   5 H   2s  :    -0.15) (   6 H   1s  :    -0.23) (   6 H   2s  :    -0.19)                              
                                                                                                                          
               Molecular Orbital No.  12:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.38481 a.u.                                                                    
               (   1 C   1p+1:    -0.39) (   1 C   2p+1:    -0.33) (   2 C   1p+1:    -0.37)                              
               (   2 C   2p+1:    -0.26) (   3 F   1p+1:     0.23) (   3 F   2p+1:     0.21)                              
                                                                                                                          
               Molecular Orbital No.  13:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.17195 a.u.                                                                    
               (   1 C   1p+1:     0.34) (   1 C   2p+1:     0.74) (   2 C   1p+1:    -0.42)                              
               (   2 C   2p+1:    -0.74) (   3 F   1p+1:     0.15) (   3 F   2p+1:     0.20)                              
                                                                                                                          
               Molecular Orbital No.  14:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.25967 a.u.                                                                    
               (   1 C   3s  :     0.74) (   1 C   1p0 :    -0.19) (   1 C   2p0 :    -0.71)                              
               (   2 C   3s  :     1.23) (   2 C   1p-1:     0.26) (   2 C   2p-1:     0.71)                              
               (   4 H   2s  :    -1.41) (   6 H   2s  :    -1.57)                                                        
                                                                                                                          
               Molecular Orbital No.  15:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.27844 a.u.                                                                    
               (   1 C   3s  :    -2.01) (   1 C   1p-1:     0.18) (   1 C   2p-1:     0.73)                              
               (   1 C   2p0 :     0.18) (   2 C   3s  :     0.22) (   2 C   2p0 :    -0.38)                              
               (   3 F   3s  :     0.23) (   4 H   2s  :     0.62) (   5 H   2s  :     1.95)                              
               (   6 H   2s  :    -0.39)                                                                                  
                                                                                                                          
               Molecular Orbital No.  16:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.30718 a.u.                                                                    
               (   1 C   3s  :    -0.60) (   1 C   2p-1:    -0.88) (   1 C   2p0 :     0.57)                              
               (   2 C   3s  :     1.65) (   2 C   1p0 :     0.17) (   2 C   2p-1:     0.69)                              
               (   2 C   2p0 :     0.33) (   3 F   3s  :    -0.42) (   3 F   1p0 :     0.19)                              
               (   3 F   2p-1:    -0.21) (   3 F   2p0 :     0.28) (   4 H   2s  :     1.47)                              
               (   5 H   2s  :    -0.62) (   6 H   2s  :    -1.60)                                                        
                                                                                                                          
               Molecular Orbital No.  17:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.39551 a.u.                                                                    
               (   1 C   3s  :     0.78) (   1 C   1p-1:     0.22) (   1 C   2p-1:     1.65)                              
               (   1 C   2p0 :    -0.37) (   2 C   3s  :    -0.35) (   2 C   1p0 :     0.19)                              
               (   2 C   2p-1:    -0.82) (   2 C   2p0 :     1.66) (   3 F   3s  :    -1.04)                              
               (   3 F   2p-1:    -0.23) (   3 F   2p0 :     0.42) (   4 H   2s  :    -1.26)                              
               (   5 H   2s  :     1.45) (   6 H   2s  :     0.58)                                                        
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 7 iterations.
Total Energy: -176.8261179602 au
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1    12       0.83785  251ms  [10.95566733 11.09723182 11.22363272 11.38716485 11.45153006 11.46601884]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    24       0.20471  437ms  [10.65381826 10.80467823 10.83595474 10.9257176  11.0325688  11.14749477]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    36      0.010314  561ms  [10.63810268 10.78046749 10.81248196 10.8495807  10.93906208 11.0113499 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    48     0.0013401  681ms  [10.63692712 10.77791772 10.81036147 10.84604706 10.93143416 11.00481378]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    60    0.00017729  803ms  [10.63684726 10.77744917 10.81013062 10.84551407 10.93046528 11.00389724]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    24    5.7805e-05  702ms  [10.63684207 10.77741421 10.81011193 10.84546374 10.93034204 11.0037554 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    36    3.3294e-05  575ms  [10.6368407  10.77740446 10.81009357 10.84544931 10.93031178 11.00367725]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    48    1.3396e-05  696ms  [10.63684069 10.77740341 10.81010695 10.84544997 10.93029358 11.00364232]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9    60    3.1434e-06  819ms  [10.63683777 10.77740511 10.81009654 10.84544131 10.93030085 11.003633  ]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10    24    1.0596e-06  703ms  [10.6368401  10.77740155 10.81010119 10.84544418 10.93030384 11.00362527]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11    36    3.5372e-07  576ms  [10.63683914 10.77739268 10.8100946  10.84545312 10.93030987 11.0036267 ]
=== Converged ===
    Number of matrix applies:    132
    Total solver time:             6s 847ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1    12       0.86303  245ms  [10.90478785 11.13511323 11.15327838 11.2845098  11.33440601 11.38128688]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    24      0.077898  439ms  [10.57188242 10.72802202 10.75000963 10.81485427 10.87556184 10.95732928]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    36     0.0044654  553ms  [10.55786964 10.70111802 10.72117396 10.76301968 10.8303618  10.92820431]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    48    0.00059429  680ms  [10.55668777 10.69941614 10.71946277 10.76021551 10.82772403 10.92599682]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    60    7.7526e-05  797ms  [10.5565908  10.69921609 10.71931536 10.75991885 10.82730458 10.92562711]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    24    1.2799e-05  694ms  [10.55658717 10.69922298 10.71932237 10.75989094 10.8272482  10.92558718]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    36    2.9175e-06  569ms  [10.55658571 10.69919879 10.71931704 10.7598878  10.8272413  10.92558713]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    48    8.1768e-07  690ms  [10.55658493 10.69921967 10.71931931 10.75988935 10.82724088 10.92556779]
=== Converged ===
    Number of matrix applies:    96
    Total solver time:             4s 718ms
</pre></div>
</div>
</div>
</div>
<p>From which the spectrum can be decomposed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Spectrum from -CHF </span>
<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_chf</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_chf</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x1i</span><span class="p">,</span><span class="n">y1i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Spectrum from -CH2</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_ch2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_ch2</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x2i</span><span class="p">,</span><span class="n">y2i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plotting line spectra for full, area spectra for contributions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span><span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="s1">&#39;-CH2&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span><span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_analysis_12_0.png" src="../_images/xray_analysis_12_0.png" />
</div>
</div>
<p>This manner of decomposing the atomic contributions should be taken with some care, as it involves explicit calculation of all atomic sites, which:</p>
<ol class="simple">
<li><p>Requires a larger number of calculations, and care should be taken so that a region in which some states (e.g. for -CHF) are converged into, but not other (e.g. -CH<span class="math notranslate nohighlight">\(_2\)</span>).</p></li>
<li><p>Does not strictly fit with the CVS philosophy, which uses the large separation in energy and spatial extend as a basis for separation. Energy separation can now be rather small, and for some systems degeneracies and near-degeneracies may lead to delocalized core orbitals (see <a class="reference internal" href="xray_cons.html#sec-xray-topics-chloc"><span class="std std-ref">here</span></a> and <a class="reference internal" href="xray_cons.html#sec-xray-topics-tailcvs"><span class="std std-ref">here</span></a>). If so, all delocalized sites must be included in the same CVS space.</p></li>
</ol>
<p>Nevertheless, the lower computational cost per calculation of doing this decomposition may make it worth it.</p>
<p>An alternatively is using the full space eigenvectors, from which the atomic decomposition can be performed as follows:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do full space eigenvector decomposition and compare to above.</p>
<ul class="simple">
<li><p>Either learn how eigenstates are constructed, or just split and divide describe_amplitude results.</p></li>
</ul>
</div>
<p>Performing the same analysis with CPP-DFT, we decompose the response vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of occupied and unoccupied (alpha) MOs</span>
<span class="n">nocc</span>  <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="n">nvirt</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="o">.</span><span class="n">number_mos</span><span class="p">()</span> <span class="o">-</span> <span class="n">nocc</span>

<span class="c1"># Extract solution vectors</span>
<span class="n">solution_vecs</span> <span class="o">=</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;solutions&#39;</span><span class="p">)</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">x_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
    <span class="n">y_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
    <span class="n">z_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_solution</span><span class="p">)</span>

<span class="c1"># Extract polarization-resolved response</span>
<span class="n">sX</span><span class="p">,</span><span class="n">sY</span><span class="p">,</span><span class="n">sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">axx</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">ayy</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">azz</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>

<span class="c1"># Create empty object of dimension nocc (to add spectrum contributions from each occupied orbital)</span>
<span class="n">spec_comp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nocc</span><span class="p">):</span> <span class="n">spec_comp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    
<span class="c1"># Appending spec_comp object with decomposed response</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">z_tmp</span> <span class="o">=</span> <span class="n">z_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
        <span class="n">comp_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[:])))</span>
        <span class="n">spec_comp</span><span class="p">[</span><span class="n">occ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_X</span><span class="o">*</span><span class="n">sX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Y</span><span class="o">*</span><span class="n">sY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Z</span><span class="o">*</span><span class="n">sZ</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1"># Extract contribution of two carbon atoms, as well as the full spectrum</span>
<span class="n">cont_chf</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cont_ch2</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">cont_full</span> <span class="o">=</span> <span class="n">sigma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Create splined spectra for each component</span>
<span class="n">x</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">ychf</span>  <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_chf</span><span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">ych2</span>  <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_ch2</span><span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yfull</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_full</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="c1"># Spectrum from the non-carbon atoms</span>
<span class="n">yrest</span> <span class="o">=</span> <span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># Plot full spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Plot components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;-CH$_2$&#39;</span><span class="p">,</span><span class="s1">&#39;Rest&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_analysis_14_0.png" src="../_images/xray_analysis_14_0.png" />
</div>
</div>
<p>Just as from the MO analysis found above, we see that the first two strong features corresponds to transitions from two different MOs, which here corresponds to <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> from -CH<span class="math notranslate nohighlight">\(_2\)</span> and -CHF. Features at around <span class="math notranslate nohighlight">\(\sim\)</span>279 and <span class="math notranslate nohighlight">\(\sim\)</span>281 eV are resonances to <span class="math notranslate nohighlight">\(\sigma^{\ast}\)</span>.</p>
</div>
<div class="section" id="polarization-dependence">
<h3>Polarization dependence<a class="headerlink" href="#polarization-dependence" title="Permalink to this headline">¶</a></h3>
<p>Information on the structure of the molecular sample can be obtained by considering any polarization-dependence of the measured spectrum. This may not work for gas phase samples, as the isotropic signal will be observed, but it can provide very useful information on, <em>e.g.</em>, the orientation and structuring of self-assembly monolayers.</p>
<p>Resolving the polarization-dependence from ADC and CPP-DFT calculations is straightforward:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract excitation energies</span>
<span class="n">adc_freq</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span>

<span class="c1"># Extract Cartesian components from the ADC state (here skipping the prefactors)</span>
<span class="n">adc_sX</span><span class="p">,</span><span class="n">adc_sY</span><span class="p">,</span><span class="n">adc_sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">)):</span>
    <span class="n">tmp_tms</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">transition_dipole_moment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">adc_sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Resolved spectrum region</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="mi">284</span><span class="p">,</span><span class="mi">296</span>

<span class="c1"># Broadened spectra for each component</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sX</span>
<span class="n">xX</span><span class="p">,</span><span class="n">yX</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sY</span>
<span class="n">xY</span><span class="p">,</span><span class="n">yY</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sZ</span>
<span class="n">xZ</span><span class="p">,</span><span class="n">yZ</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plot total spectrum (line) and Cartesian contributions (area)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span><span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_analysis_16_0.png" src="../_images/xray_analysis_16_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># Extract frequencies</span>
<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Spline spectra for each Cartesian contribution</span>
<span class="n">yX</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sX</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yY</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yZ</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sZ</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

<span class="c1"># Plot total spectrum (line) and Cartesian contributions (area)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_analysis_17_0.png" src="../_images/xray_analysis_17_0.png" />
</div>
</div>
<p>We see that the first two transitions are out-of-plane, as they correspond to <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span>.</p>
<p>Using a larger basis set of aug-cc-pCVT/cc-pVTZ (for C and H/F) and comparing to experiment, we obtain:</p>
<div class="figure align-default" id="vinyl-decomp">
<img alt="../_images/vinyl_decomp.svg" src="../_images/vinyl_decomp.svg" /><p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">ADC and TDDFT, atomic and polarization</span><a class="headerlink" href="#vinyl-decomp" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fix this.</p>
<p>Might improve with CAM-B3LYP (or even CAM100%-B3LYP), so could potentially change that later.</p>
</div>
</div>
</div>
<div class="section" id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Electron/hole densities…</p></li>
<li><p>Attachment/detachment densities…</p>
<ul>
<li><p>Compare to electron/hole - difference due to relaxation</p></li>
</ul>
</li>
<li><p>NTO:s?</p></li>
<li><p>MOs?</p></li>
</ul>
</div>
</div>
<div class="section" id="descriptors">
<h2>Descriptors<a class="headerlink" href="#descriptors" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Electron/hole sizes…</p></li>
<li><p>Attachment/detachment sizes…</p></li>
<li><p>v2, R, …?</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="xray_calc.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Spectrum calculation</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="xray_cons.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">General aspects</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The eChem team<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>