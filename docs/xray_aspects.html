
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Special aspects &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Larger systems" href="xray_large.html" />
    <link rel="prev" title="Spectrum analysis" href="xray_analysis.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ir.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="raman.html">
     Raman spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ir_raman_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv-vis.html">
   UV/vis spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_cheat.html">
     Cheat sheet
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Electronic ground states
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals and basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Many-electron wave functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operators.html">
     Operators and matrix elements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="integrals.html">
     Integral evaluation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="spin.html">
     Electron spin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="correlation.html">
     Electron correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="perturbation_theory.html">
     Rayleigh–Schrödinger perturbation theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kernel_integration.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dft_scf.html">
     SCF optimization of a closed-shell state
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Molecular structure and dynamics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="struct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="gradients.html">
   Gradients
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="energy_grad.html">
     Energy gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="property_grad.html">
     Property gradients
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="hess-vib.html">
   Hessians and vibrations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Molecular Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vibrations.html">
     Vibrational analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="structopt-overview.html">
   Structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="structopt.html">
     Optimization Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gsstructopt.html">
     Ground-state structure optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="structopt-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="transition_state.html">
     Transition state geometry optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="impes-overview.html">
   PES interpolation techniques
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="impes.html">
     Constructing the PES by interpolation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="md_ffs.html">
     Force field parameterization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_run.html">
     Running a simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_biased.html">
     Biased molecular dynamics
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spectra and properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="response.html">
   General aspects
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="tddft.html">
   TDDFT
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_basics.html">
     Foundations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_rpa.html">
     RPA equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_tda.html">
     Tamm-Dancoff approximation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft_challenge.html">
     Challenges
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mr-response.html">
   Multi-reference
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="adc.html">
   ADC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-pp.html">
     Polarization propagator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-isr.html">
     Intermediate state representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-cvs.html">
     Core–valence separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-hpc.html">
     HPC-QC implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="adc-exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="excoupl_impl.html">
     Implementation of the exciton coupling model
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="loprop.html">
     LoProp charges and polarisabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="vis_structure.html">
   Molecular structure and dynamics
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elec_vis.html">
   Electronic structure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orb_vis.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="exc_vis.html">
     Excited states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dens_vis.html">
     Reduced particle densities
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/xray_aspects.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/kthpanor/echem"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/xray_aspects.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/docs/xray_aspects.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relaxation">
   Relaxation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relaxation-of-core-ionized-systems">
     Relaxation of core-ionized systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relaxation-of-core-de-excitation">
     Relaxation of core-(de)excitation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-relaxation-with-deltascf-methods">
     Including relaxation with
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     SCF methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-relaxation-with-wave-function-methods">
     Including relaxation with wave-function methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-relaxation-with-dft-based-methods">
     Including relaxation with DFT-based methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relativity">
   Relativity
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-relativistic-effects">
     Scalar relativistic effects
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-ionization-energies">
       For ionization energies
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-spectra-xas">
       For spectra (XAS)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spin-orbit-coupling">
     Spin-orbit coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basis-set-considerations">
   Basis set considerations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-interaction-error-in-dft">
   Self-interaction error in DFT
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#core-hole-localization">
   Core-hole localization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tailored-cvs">
   Tailored CVS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#post-hf-on-a-non-aufbau-reference">
   Post-HF on a non-Aufbau reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spurious-valence-mixing-in-xas">
   Spurious valence mixing in XAS
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Special aspects</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relaxation">
   Relaxation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relaxation-of-core-ionized-systems">
     Relaxation of core-ionized systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relaxation-of-core-de-excitation">
     Relaxation of core-(de)excitation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-relaxation-with-deltascf-methods">
     Including relaxation with
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     SCF methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-relaxation-with-wave-function-methods">
     Including relaxation with wave-function methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-relaxation-with-dft-based-methods">
     Including relaxation with DFT-based methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relativity">
   Relativity
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-relativistic-effects">
     Scalar relativistic effects
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-ionization-energies">
       For ionization energies
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-spectra-xas">
       For spectra (XAS)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spin-orbit-coupling">
     Spin-orbit coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basis-set-considerations">
   Basis set considerations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-interaction-error-in-dft">
   Self-interaction error in DFT
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#core-hole-localization">
   Core-hole localization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tailored-cvs">
   Tailored CVS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#post-hf-on-a-non-aufbau-reference">
   Post-HF on a non-Aufbau reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spurious-valence-mixing-in-xas">
   Spurious valence mixing in XAS
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="special-aspects">
<h1>Special aspects<a class="headerlink" href="#special-aspects" title="Permalink to this headline">#</a></h1>
<p>In this section we will discuss a number of issues and questions relating to core spectroscopies, ranging from the physical effect of a core-transition, to technical aspects relating to lowering computational costs. They are ordered by approximate relevance, with some topics being pertient only for certain cases.</p>
<section id="relaxation">
<span id="sec-xray-topics-relax"></span><h2>Relaxation<a class="headerlink" href="#relaxation" title="Permalink to this headline">#</a></h2>
<p>Core spectroscopies exhibit strong relaxation effects, originating in the significant change in shielding of the nuclear charge arising from the creation/annihilation of a core-hole. These effects need to be properly accounted for in order to get good absolute energies, as  the lack of this will mean that, <em>e.g.</em> an unrelaxed core-hole system is too high in energy. This explains the previously <a class="reference internal" href="xray_calc.html#sec-xray-calc-iekoop"><span class="std std-ref">observed</span></a> large error obtained using Koopmans’ theorem.</p>
<section id="relaxation-of-core-ionized-systems">
<h3>Relaxation of core-ionized systems<a class="headerlink" href="#relaxation-of-core-ionized-systems" title="Permalink to this headline">#</a></h3>
<p>In <a class="reference internal" href="#relax-form"><span class="std std-numref">Fig. 14</span></a> we see the effects of relaxation for creating a core-hole in the oxygen/carbon 1s of formaldehyde:</p>
<figure class="align-default" id="relax-form">
<img alt="../_images/relax_form.svg" src="../_images/relax_form.svg" /><figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">The total electron density of formaldehyde, featuring the neutral system and core-ionized at the carbon and oxygen 1s.</span><a class="headerlink" href="#relax-form" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We see that there is a noticable attraction of electron density toward the core-holes, as marked with a <strong>+</strong>. These effects can be modeled with the <span class="math notranslate nohighlight">\(Z+1\)</span> approximation, within which the change in screening is modeled by substituting the ionized atom with the next element in the periodic table. This can be illustrated with the following radial distribution plots (using uncontracted 6-31G basis sets, in order to increase flexibility in the core region):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">water_fluorine_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">F       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1">### SCF of neutral and core-hole water</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;unc-6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="c1"># Create 1s core-hole by setting beta_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1">### SCF of FO2 (Z+1 model)</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol_fl</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_fluorine_xyz</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;unc-6-31G&quot;</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Closed-shell</span>
<span class="n">mol_fl</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs_fl</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol_fl</span><span class="p">)</span>
<span class="n">scf_gs_fl</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">Ay</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># oxygen y-position (in au)</span>
<span class="n">Az</span> <span class="o">=</span> <span class="mf">0.1178336003</span> <span class="o">/</span> <span class="mf">0.529177249</span>  <span class="c1"># oxygen z-position (in au)</span>

<span class="c1"># Create coordinate object along x-axis (intersecting with O/F atom)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">):</span>
    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ix</span><span class="p">,</span> <span class="n">Ay</span><span class="p">,</span> <span class="n">Az</span><span class="p">))</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

<span class="c1"># AO values and MO values on given grids</span>
<span class="c1"># Neutral water</span>
<span class="n">ao_gs</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">eval_gto</span><span class="p">(</span><span class="s2">&quot;GTOval_sph&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">mo_gs</span> <span class="o">=</span> <span class="n">ao_gs</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>

<span class="c1"># Water core-hole</span>
<span class="n">ao_ion</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">eval_gto</span><span class="p">(</span><span class="s2">&quot;GTOval_sph&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">mo_ion</span> <span class="o">=</span> <span class="n">ao_ion</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>

<span class="c1"># FO2</span>
<span class="n">ao_Z1</span> <span class="o">=</span> <span class="n">mol_fl</span><span class="o">.</span><span class="n">eval_gto</span><span class="p">(</span><span class="s2">&quot;GTOval_sph&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="n">mo_Z1</span> <span class="o">=</span> <span class="n">ao_Z1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scf_gs_fl</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;MO$_{\alpha 1}$ ($1a_1$)&quot;</span><span class="p">)</span>
<span class="n">mo_nr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">r</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">rho3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rho1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_gs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rho2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_ion</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rho3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_Z1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Ground-state&quot;</span><span class="p">,</span> <span class="s2">&quot;Core-hole&quot;</span><span class="p">,</span> <span class="s2">&quot;Ground-state [Z+1]&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [a.u.]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Density [$r^2 \rho$]&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;MO$_{\alpha 2}$ ($2a_1$)&quot;</span><span class="p">)</span>
<span class="n">mo_nr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">rho3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rho1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_gs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rho2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_ion</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rho3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_Z1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [a.u.]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Density [$r^2 \rho$]&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;MO$_{\beta 2}$ ($2a_1$)&quot;</span><span class="p">)</span>
<span class="n">mo_nr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">r</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">rho2</span><span class="p">,</span> <span class="n">rho3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rho1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_gs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rho2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_ion</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">rho3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mo_Z1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_nr</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">rho3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Radius [a.u.]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Density [$r^2 \rho$]&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-radial">
<a class="reference internal image-reference" href="../_images/radial.svg"><img alt="../_images/radial.svg" height="414" src="../_images/radial.svg" width="691" /></a>
</figure>
<p>As can be seen, the radial distribution of particularly <span class="math notranslate nohighlight">\(\alpha_2\)</span> for the core-ionized system is closer to <span class="math notranslate nohighlight">\(Z+1\)</span> than to the neutral state, while for <span class="math notranslate nohighlight">\(\alpha_1\)</span> and <span class="math notranslate nohighlight">\(\beta_2\)</span> it is closer to that of the ground state. Also note the differences in the x-scales, with <span class="math notranslate nohighlight">\(\alpha_1\)</span> being more compressed and thus having a larger peak max.</p>
</section>
<section id="relaxation-of-core-de-excitation">
<h3>Relaxation of core-(de)excitation<a class="headerlink" href="#relaxation-of-core-de-excitation" title="Permalink to this headline">#</a></h3>
<p>For X-ray absorption and emission spectroscopy the influence of the relaxation is more complex, on account of the interaction with the created singly-occupied state. Comparing the two spectroscopies, the relaxation processes are partially inverse to each other, with</p>
<ul class="simple">
<li><p>Relaxation in XAS leading to a more contracted final state, which lowers absorption energies</p></li>
<li><p>Relaxation in XES leading to a more decontracted final state, which increases emission energies</p></li>
</ul>
<p>In addition to these strong changes in shielding, there are also additional couplings due to the population of a previous unoccupied state (XAS) or the creation of a valence-hole (XES). These effects are smaller and partially counteract the stronger change in shielding from the occupied/unoccupied core orbital, leading to a total picture as <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.8b01046">follows</a>:</p>
<figure class="align-default" id="relax-processes">
<img alt="../_images/relax_processes.svg" src="../_images/relax_processes.svg" /><figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Relaxation effects involved in X-ray absorption (left) and emission (right) spectroscopies. Showing which orbitals primarily contribute to the respective effects, as well as the result in MO energies (or electron densities).</span><a class="headerlink" href="#relax-processes" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We here see the four main effects:</p>
<ul class="simple">
<li><p>X-ray absorption spectroscopy</p>
<ol class="simple">
<li><p>A strong relaxation effect due to the creation of a core-hole, which leads to the contraction of electron density and scales with element</p></li>
<li><p>A weak polarization effect due to coupling with the newly occupied valence state, which partially decontracts the outer valence density and does not scale appreciably with the element</p></li>
</ol>
</li>
<li><p>X-ray emission spectroscopy</p>
<ol class="simple">
<li><p>A strong repulsion effect due to the annihilation of a core-hole, which leads to decontraction of electron density and scales with element</p></li>
<li><p>A weaker outer relaxation effect due to the creation of a valence-hole, which leads to contraction of the (outer) valence density and scales with element</p></li>
</ol>
</li>
</ul>
<p>These effects balances in different manners, and the exact strength depends heavily on the element and which edge is being probed. As such, the accuracy of a particular method depends on which spectroscopy, element, and edge is considered.</p>
</section>
<section id="including-relaxation-with-deltascf-methods">
<span id="sec-xray-delta-rel"></span><h3>Including relaxation with <span class="math notranslate nohighlight">\(\Delta\)</span>SCF methods<a class="headerlink" href="#including-relaxation-with-deltascf-methods" title="Permalink to this headline">#</a></h3>
<p><span class="math notranslate nohighlight">\(\Delta\)</span>SCF methods provide the most direct way of including relaxation, as the core-hole state is explicitly optimized. However, these approaches need to consider each transition explicitly, and will have difficulties in calculating intensities and in properly converging higher excited states. As such, they are mainly useful for considering ionization energies and for providing a reference state for XES calculations. Comparing the performance of calculating IE:s of the ten-electron series using Koopmans’ theorem and <span class="math notranslate nohighlight">\(\Delta\)</span>SCF:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">methane_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">C       0.0000000000     0.0000000000     0.0000000000</span>
<span class="s2">H       0.6265918120     0.6265918120     0.6265918120</span>
<span class="s2">H      -0.6265918120    -0.6265918120     0.6265918120</span>
<span class="s2">H      -0.6265918120     0.6265918120    -0.6265918120</span>
<span class="s2">H       0.6265918120    -0.6265918120    -0.6265918120</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">ammonia_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">N       0.0000000000     0.0000000000     0.1175868000</span>
<span class="s2">H       0.9323800000     0.0000000000    -0.2743692000</span>
<span class="s2">H      -0.4661900000    -0.8074647660    -0.2743692000</span>
<span class="s2">H      -0.4661900000     0.8074647660    -0.2743692000</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">hydrofluoride_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">H       0.0000000000     0.0000000000    -0.8261856000</span>
<span class="s2">F       0.0000000000     0.0000000000     0.0917984000</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">neon_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Ne      0.0000000000     0.0000000000     0.0000000000</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">Koopman_vs_delta</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">):</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">molecule</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Perform unrestricted SCF calculation</span>
    <span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Return MO energy and deltaSCF</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span>
    <span class="p">)</span>


<span class="c1"># Basis set and container for errors</span>
<span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;unc-6-31G&quot;</span>
<span class="n">err_koopman</span><span class="p">,</span> <span class="n">err_delta</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">290.76</span><span class="p">,</span> <span class="mf">0.11</span>  <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">methane_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>
<span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">405.52</span><span class="p">,</span> <span class="mf">0.21</span>  <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ammonia_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>
<span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">539.90</span><span class="p">,</span> <span class="mf">0.37</span>  <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>
<span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">694.10</span><span class="p">,</span> <span class="mf">0.61</span>  <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">hydrofluoride_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>
<span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>

<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">870.09</span><span class="p">,</span> <span class="mf">0.94</span>  <span class="c1"># experimental IP and scalar-relativistic effects</span>
<span class="n">E_Koopman</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">neon_xyz</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">err_koopman</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_Koopman</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>
<span class="n">err_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Plot error from MO energies and delta-SCF</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">err_koopman</span><span class="p">,</span> <span class="s2">&quot;bs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">err_delta</span><span class="p">,</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Koopmans&#39; theorem&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\Delta$SCF&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error wrt experiment [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;CH$_4$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;NH$_3$&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;H$_2$O&quot;</span><span class="p">,</span> <span class="s2">&quot;HF&quot;</span><span class="p">,</span> <span class="s2">&quot;Ne&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-relax-scf">
<a class="reference internal image-reference" href="../_images/relax_scf.svg"><img alt="../_images/relax_scf.svg" height="276" src="../_images/relax_scf.svg" width="483" /></a>
</figure>
<p>We see that the error from orbital energies is large (14.4-22.3 eV) and clearly scales with atomic number, while the error of <span class="math notranslate nohighlight">\(\Delta\)</span>SCF remains small (absolute error of 0.15-0.38 eV).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Could do: add <a class="reference external" href="https://doi.org/10.3384/lic.diva-102177">simple model</a> to estimate scaling of relaxation with <em>Z</em>.</p>
</div>
</section>
<section id="including-relaxation-with-wave-function-methods">
<h3>Including relaxation with wave-function methods<a class="headerlink" href="#including-relaxation-with-wave-function-methods" title="Permalink to this headline">#</a></h3>
<p>Considering the X-ray absorption and emission spectrum of water, the error of ADC(<em>n</em>) calculations with respect to experimental measurements can be considered:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;unc-6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform CVS-ADC calculations</span>
<span class="n">xas_adc1</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xas_adc2</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xas_adc2x</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2x</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xas_adc3</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc3</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy molecular orbitals</span>
<span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>

<span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform ADC calculations</span>
<span class="n">xes_adc1</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc1</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xes_adc2</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xes_adc2x</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2x</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">xes_adc3</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc3</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Plotting the errors compared to experiment (given as a dashed line), and the variations in oscillator strength:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;XAS energy&quot;</span><span class="p">)</span>
<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">534.00</span><span class="p">,</span> <span class="mf">0.37</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">xas_adc1</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">xas_adc2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">xas_adc2x</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">xas_adc3</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error wrt experiment [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;ADC(1)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)-x&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(3/2)&quot;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;XAS oscillator strength&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xas_adc1</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xas_adc2</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xas_adc2x</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">xas_adc3</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absolute oscillator strength&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;ADC(1)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)-x&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(3/2)&quot;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;XES energy&quot;</span><span class="p">)</span>
<span class="n">expt</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="mf">527.10</span><span class="p">,</span> <span class="mf">0.37</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">xes_adc1</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">xes_adc2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">xes_adc2x</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">xes_adc3</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rel</span> <span class="o">-</span> <span class="n">expt</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Error wrt experiment [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;ADC(1)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)-x&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(3/2)&quot;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;XES oscillator strength&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xes_adc1</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">xes_adc2</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">xes_adc2x</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">xes_adc3</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absolute oscillator strength&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;ADC(1)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(2)-x&quot;</span><span class="p">,</span> <span class="s2">&quot;ADC(3/2)&quot;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-adc">
<a class="reference internal image-reference" href="../_images/xray_adc.svg"><img alt="../_images/xray_adc.svg" height="414" src="../_images/xray_adc.svg" width="691" /></a>
</figure>
<p>As can be seen, the smallest discrepancy for XAS is observed for CVS-ADC(2)-x, and for XES it is here noted to be for ADC(3/2). In general, it has been noted that CVS-ADC(2)-x performs best for <a class="reference external" href="https://aip.scitation.org/doi/10.1063/1.4921841">XAS</a>, and ADC(2) for <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.8b01046">XES</a> (in terms of absolute energies - for relative features ADC(2)-x performs a bit <a class="reference external" href="https://doi.org/10.26434/chemrxiv-2022-vllwh-v2">better</a>). As ADC(3/2) is correct in higher order of perturbation theory and performs well for valence excitations, it could be expected to also perform best for core properties. The fact that this is not the case has <a class="reference external" href="https://aip.scitation.org/doi/10.1063/1.4921841">been</a> <a class="reference external" href="https://pubs.acs.org/doi/10.1021/acs.jctc.8b01046">noted</a> to be due to balancing in relaxation effects, which are highly influential for core properties and vary significantly between XAS and XES.</p>
<p>Furthermore, we see that the oscillator strengths vary greatly for XAS <span class="math notranslate nohighlight">\(-\)</span> in particular when comparing CVS-ADC(1) to higher orders of theory <span class="math notranslate nohighlight">\(-\)</span> but not very much for XES.</p>
</section>
<section id="including-relaxation-with-dft-based-methods">
<h3>Including relaxation with DFT-based methods<a class="headerlink" href="#including-relaxation-with-dft-based-methods" title="Permalink to this headline">#</a></h3>
<p>When using a <span class="math notranslate nohighlight">\(\Delta\)</span>KS approach, relaxation is explicitly accounted for, as discussed <a class="reference internal" href="#sec-xray-delta-rel"><span class="std std-ref">above</span></a>. By contrast, TDDFT is a single-excitation theory which cannot properly account for relaxation (which requires doubly-excited configuration in a response theory framework), although it can be partially accounted for through some separate correction scheme. The error introduced by a lack of relaxation will furthermore be counteracted by the self-interaction error, as is discussed <a class="reference internal" href="#sec-xray-topics-sie"><span class="std std-ref">below</span></a>.</p>
</section>
</section>
<section id="relativity">
<span id="sec-xray-topics-rel"></span><h2>Relativity<a class="headerlink" href="#relativity" title="Permalink to this headline">#</a></h2>
<p>Relativistic effects are siginificantly stronger for core than valence MOs, on account of the strong potential experienced by the core orbitals. These effects mainly influences calculated properties in two separate manners:</p>
<ol class="simple">
<li><p>Scalar relativistic effects, which are always present and lead to a contraction (and thus increase in binding energy) of core orbitals. Higher lying orbitals (especially for <span class="math notranslate nohighlight">\(l&gt;1\)</span>) can become decontracted due to increasing screening from contracted MOs, but this effect is typically much smaller than for, <em>e.g.</em>, 1s orbitals</p></li>
<li><p>Spin-orbit coupling, which breaks degeneracies for MOs of <span class="math notranslate nohighlight">\(l&gt;0\)</span> and is thus negligible for, <em>e.g.</em>, the <span class="math notranslate nohighlight">\(K\)</span>- and <span class="math notranslate nohighlight">\(L_1\)</span>-edges (as the splitting for valence MOs is much smaller), but very important for, <em>e.g.</em>, the <span class="math notranslate nohighlight">\(L_{2,3}\)</span>-edge</p></li>
</ol>
<section id="scalar-relativistic-effects">
<h3>Scalar relativistic effects<a class="headerlink" href="#scalar-relativistic-effects" title="Permalink to this headline">#</a></h3>
<p>Including scalar relativistic effects is relatively straightforward, as a number of Hamiltonians are available which can include these effects in a 1-component framework. Furthermore, the effects are typically quite stable over the separate elements, and can thus often be considered as a common absolute off-set in energy. It should be noted that the (scalar) relativistic effects are technically not additive with electron correlation, such that a proper consideration should account for both simultaneously. In practise, this discrepancy is small and relativistc shifts from lower levels of theory are typically sufficient.</p>
<section id="for-ionization-energies">
<span id="sec-xray-topics-rel-ip"></span><h4>For ionization energies<a class="headerlink" href="#for-ionization-energies" title="Permalink to this headline">#</a></h4>
<p>The scalar relativistic effects for ionization energies can be estimated from MO energies or using <span class="math notranslate nohighlight">\(\Delta\)</span>SCF:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Containers for atomic number, MO energy shift, delta-SCF shift, and delta-SCF IP</span>
<span class="n">z</span><span class="p">,</span> <span class="n">mo_diff</span><span class="p">,</span> <span class="n">delta_diff</span><span class="p">,</span> <span class="n">delta_ip</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="c1"># Consider even-numbered elements fron helium to argon</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
    <span class="c1"># Atomic calculation</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;   0.0  0.0  0.0&quot;</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">struct</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;unc-6-31G&quot;</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Perform non-relativistic unrestricted SCF calculation</span>
    <span class="n">scf_nr</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Perform relativistic unrestricted SCF calculation</span>
    <span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span>
        <span class="n">mol</span>
    <span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>  <span class="c1"># Scalar relativistic effects with the X2C Hamiltonian</span>
    <span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Append atomic number</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Append MO energy shift</span>
    <span class="n">mo_diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># Copy molecular orbitals and change population of 1s</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Perform non-relativistic core-hole calculation</span>
    <span class="n">ion_nr</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">ion_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Perform relativistic core-hole calculation (can use the same gues wave function)</span>
    <span class="n">ion_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_rel</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">ion_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Append delta energy and relativistic shift</span>
    <span class="n">delta_diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">au2ev</span> <span class="o">*</span> <span class="p">((</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">ion_nr</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">scf_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">delta_ip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Plot absolute scalar relativistic effects</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Absolute relativistic effects&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">mo_diff</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">delta_diff</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;From MO energies&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;From $\Delta$SCF&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Atomic number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absolute shift [eV]&quot;</span><span class="p">)</span>

<span class="c1"># Plot percentage change</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Percentage change&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mo_diff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_ip</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_diff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">delta_ip</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Atomic number&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Relative shift [</span><span class="si">% o</span><span class="s2">f total energy]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;foo.svg&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-scalar-rel">
<a class="reference internal image-reference" href="../_images/scalar_rel.svg"><img alt="../_images/scalar_rel.svg" height="276" src="../_images/scalar_rel.svg" width="691" /></a>
</figure>
<p>Two things are immediatelly clear:</p>
<ol class="simple">
<li><p>The shift in 1s ionization energy is strickly non-linear with respect to the atomic number, and using a simple model for a hydrogen-like system the main effects are expected to scale as <span class="math notranslate nohighlight">\(Z^4\)</span>. Fitting to a power function, we obtain <span class="math notranslate nohighlight">\(Z^{4.6}\)</span> (with <span class="math notranslate nohighlight">\(R^2=0.997\)</span>) for the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF results, so some deviation from the hydrogenic systems</p></li>
<li><p>The relativistic shifts for MO energies and <span class="math notranslate nohighlight">\(\Delta\)</span>SCF IP:s are almost identical, with a discrepancy that increases with <span class="math notranslate nohighlight">\(Z\)</span> from 0.00 to 0.31 eV. Performing similar calculations with <span class="math notranslate nohighlight">\(\Delta\)</span>CCSD is expected to yield very similar values, such that the scalar relativistic effects for the 1s MO of the second and third row can be estimated from MO energies</p></li>
</ol>
</section>
<section id="for-spectra-xas">
<h4>For spectra (XAS)<a class="headerlink" href="#for-spectra-xas" title="Permalink to this headline">#</a></h4>
<p>For spectrum calculations, scalar relativistic effects can be included merely by using an appropriate Hamiltonian for the SCF calculation, as here illustrated for the X-ray absorption spectrum of water:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_xyz</span>
<span class="c1"># using a decontracted basis set to better describe contracted relativistic 1s</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;unc-6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform non-relativistic restricted SCF and CVS-ADC(2) calculations</span>
<span class="n">scf_nr</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_nr</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_nr</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Perform relativistic restricted SCF and CVS-ADC(2) calculations</span>
<span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">()</span>
<span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_rel</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_rel</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># Relativistic and non-relativistc spectra with custom broadening</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_nr</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_nr</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">534</span><span class="p">,</span> <span class="mi">542</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_rel</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rel</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">534</span><span class="p">,</span> <span class="mi">542</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Non-relativistic&quot;</span><span class="p">,</span> <span class="s2">&quot;Scalar relativistic&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-adc-rel">
<a class="reference internal image-reference" href="../_images/adc_rel.svg"><img alt="../_images/adc_rel.svg" height="207" src="../_images/adc_rel.svg" width="414" /></a>
</figure>
<p>We see that the spectrum is shifted upwards by <span class="math notranslate nohighlight">\(\sim\)</span>0.38 eV, due to the increase in core-electron binding energy. The same approach can be used for including these effects also for X-ray emission spectrum  calculations.</p>
</section>
</section>
<section id="spin-orbit-coupling">
<h3>Spin-orbit coupling<a class="headerlink" href="#spin-orbit-coupling" title="Permalink to this headline">#</a></h3>
<p>Including the spin-orbit effects is more complicated, and can either be</p>
<ul class="simple">
<li><p>Included by using 4-component relativistic theory, where they do not need to explicitly addressed</p></li>
<li><p>Included in a non-relativistic approach through a perturbative scheme, or through some <em>ad hoc</em> correction</p></li>
</ul>
<p>At the present stage, including spin-orbit effects is beyond the scope of this tutorial.</p>
</section>
</section>
<section id="basis-set-considerations">
<span id="sec-xray-topics-basis"></span><h2>Basis set considerations<a class="headerlink" href="#basis-set-considerations" title="Permalink to this headline">#</a></h2>
<p>The basis set requirements of X-ray spectrum calculations depend on which spectroscopy is considered</p>
<ul class="simple">
<li><p>XPS and XES probe occupied states, and thus need a good description of those</p></li>
<li><p>XAS and RIXS probe excited states, and thus need an improved description of this region</p></li>
</ul>
<p>In all cases the relaxation due to the creation of a core-hole needs to be accommodated, which yields requirements of reasonable flexibility of the core and inner valence region. This is not usually the case for standard basis sets, as they are typically constructed with valence properties in mind and thus have a minimal or close to minimal description of the core region. A number of approaches for improving such valence-focused basis sets have been developed by:</p>
<ol class="simple">
<li><p>Augmenting the Dunning basis sets with core-polarizing functions, <em>e.g.</em> cc-pV<em>n</em>Z <span class="math notranslate nohighlight">\(\rightarrow\)</span> cc-pCV<em>n</em>Z</p></li>
<li><p>Adding extra flexibility by performing full or partial decontraction, such as</p>
<ol class="simple">
<li><p>Decontracting 1s of the probed element (<em>e.g.</em> u6-311++G**, which is based on 6-311++G**)</p></li>
<li><p>Fully decontracting the basis set (<em>e.g.</em> un6-311++G**, which is based on 6-311++G**)</p></li>
</ol>
</li>
<li><p>Using basis functions from the next element, as inspired by the <span class="math notranslate nohighlight">\(Z+1\)</span> approximation</p></li>
</ol>
<p>As an illustration, we consider the IP of water with different basis sets and levels of theory</p>
<p><em>Toggle for u6-311G**, un6-311G**, and 6-311G** (Z+1) basis sets.</em></p>
<div class="toggle docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span>

<span class="n">u6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">un6311gss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      9.628370               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      2.853320               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">z6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  0.00189515</span>
<span class="s1">   1297.230                  0.0143859</span>
<span class="s1">    299.2960                 0.0707320</span>
<span class="s1">     87.37710                0.2400010</span>
<span class="s1">     25.67890                0.5947970</span>
<span class="s1">      3.740040               0.2808020</span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">O    S</span>
<span class="s1">  11427.10                   0.00180093</span>
<span class="s1">   1722.350                  0.0137419</span>
<span class="s1">    395.7460                 0.0681334</span>
<span class="s1">    115.1390                 0.2333250</span>
<span class="s1">     33.60260                0.5890860</span>
<span class="s1">      4.919010               0.2995050</span>
<span class="s1">O    SP</span>
<span class="s1">     55.44410                0.114536               0.0354609</span>
<span class="s1">     12.63230                0.920512               0.237451</span>
<span class="s1">      3.717560              -0.00337804             0.820458</span>
<span class="s1">O    SP</span>
<span class="s1">      1.165450               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.321892               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.750                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Investigated basis sets</span>
<span class="n">basis_sets</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;6-311G**&quot;</span><span class="p">,</span>
    <span class="n">u6311gss</span><span class="p">,</span>
    <span class="n">un6311gss</span><span class="p">,</span>
    <span class="n">z6311gss</span><span class="p">,</span>
    <span class="s2">&quot;cc-pVDZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pCVDZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pVTZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pCVTZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pVQZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pCVQZ&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Containers for IP calculated with four different delta calculations: HF, MP2, CCSD, and B3LYP</span>
<span class="n">ip_hf</span><span class="p">,</span> <span class="n">ip_mp2</span><span class="p">,</span> <span class="n">ip_ccsd</span><span class="p">,</span> <span class="n">ip_b3lyp</span><span class="p">,</span> <span class="n">n_bas</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_sets</span><span class="p">:</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_xyz</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Unrestricted SCF calculation of neutral</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals and change population of 1s</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Unrestricted HF calculation of core-hole and appending delta_HF IP</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_hf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="c1"># CCSD calculations of neutral and core-hole and appending delta_CCSD IP</span>
    <span class="n">ccsd_res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfres</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">ccsd_ion</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_cycle</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">ip_ccsd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
    <span class="c1"># Appending delta_MP2 IP</span>
    <span class="n">ip_mp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_hf</span> <span class="o">+</span> <span class="n">ccsd_ion</span><span class="o">.</span><span class="n">emp2</span> <span class="o">-</span> <span class="p">(</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_hf</span> <span class="o">+</span> <span class="n">ccsd_res</span><span class="o">.</span><span class="n">emp2</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="c1"># Unrestricted KS-DFT calculation of neutral</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scfres</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s2">&quot;b3lyp&quot;</span>
    <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals and change population of 1s</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Unrestricted KS-DFT calculation of core-hole and appending delta_DFT IP</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scfion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s2">&quot;b3lyp&quot;</span>
    <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_b3lyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="c1"># Append basis set size</span>
    <span class="n">n_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Plot IP:s, with error as a function of basis set size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span> <span class="n">ip_hf</span><span class="p">,</span> <span class="s2">&quot;r*&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span> <span class="n">ip_mp2</span><span class="p">,</span> <span class="s2">&quot;bv&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span> <span class="n">ip_ccsd</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span> <span class="n">ip_b3lyp</span><span class="p">,</span> <span class="s2">&quot;go&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;HF&quot;</span><span class="p">,</span> <span class="s2">&quot;MP2&quot;</span><span class="p">,</span> <span class="s2">&quot;CCSD&quot;</span><span class="p">,</span> <span class="s2">&quot;B3LYP&quot;</span><span class="p">,</span> <span class="s2">&quot;Expt&quot;</span><span class="p">,</span> <span class="s2">&quot;Expt - 0.37 eV&quot;</span><span class="p">))</span>

<span class="c1"># Experimental value as a dotted line, minus relativistic effect as dashed line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">539.9</span><span class="p">,</span> <span class="mf">539.9</span><span class="p">],</span> <span class="s2">&quot;k:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mf">539.9</span> <span class="o">-</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">539.9</span> <span class="o">-</span> <span class="mf">0.37</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>

<span class="c1"># Basis set label as x-ticks</span>
<span class="n">basis_set_labels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;6-311G**&quot;</span><span class="p">,</span>
    <span class="s2">&quot;u6-311G**&quot;</span><span class="p">,</span>
    <span class="s2">&quot;un6-311G**&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6-311G** (Z+1)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pVDZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pCVDZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pVTZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pCVTZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pVQZ&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cc-pCVQZ&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span> <span class="n">basis_set_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Labels and setting x-interval</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Ionization energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The execution of which yields</p>
<figure class="align-default" id="basis-xps">
<img alt="../_images/basis_xps.svg" src="../_images/basis_xps.svg" /></figure>
<p>At the HF and KS-DFT levels of theory we see that some of the smaller basis sets have fortuitous error cancellations, such that both 6-311G** and cc-pVTZ yield results close to experimental values. However, augmenting these basis sets with more functions in the core region brings us away from experimental measurements (note that the calculations do not include relativistic effects, so the comparison would be toward experiment minus relativistic shift, <em>i.e.</em> the dashed line).</p>
<p>With MP2 and CCSD we note very similar results for the smaller basis sets, which then deviate significantly for cc-pVTZ and above. <span class="math notranslate nohighlight">\(\Delta\)</span>CCSD estimates using core-polarized cc-pVTZ and cc-pVQZ are well in line with experimental measurements. Augmenting the 6-311G** basis sets with a decontracted core region (u6-311G**) yields some improvement at a relatively low increase in computational cost, and further decontracting the full set (un6-311G**) or adding basis functions from <span class="math notranslate nohighlight">\(Z+1\)</span> (6-311G** (Z+1)) provides some additional improvement.</p>
</section>
<section id="self-interaction-error-in-dft">
<span id="sec-xray-topics-sie"></span><h2>Self-interaction error in DFT<a class="headerlink" href="#self-interaction-error-in-dft" title="Permalink to this headline">#</a></h2>
<p>For a single-electron systems the following equality should hold for the two-electron terms:</p>
<div class="math notranslate nohighlight">
\[
J[\rho] + E_{xc} [\rho] = 0.0
\]</div>
<p>This cancellation is preserved within HF theory, but for any approximate functionals in KS-DFT the equality will no longer hold, resulting in the potentially significant errors due to spurious self-interactions. Reformulated, the Coulomb self-repulsion of each electron included in the Coulomb operator is exactly canceled by the nonlocal exchange self-attraction in Hartree-Fock, but this is no longer the case when the exchange operator is replaced by an approximate exchange functional.</p>
<p>As such, KS-DFT possess a self-interaction error (SIE), which shows a strong dependence on how compact the respective MOs are. This means that the self-interaction error is significantly more influential for core properties than for valence properties, and the tendency to decontract core orbitals due to the SIE has an opposite effect on transition energies as compared to relaxation effects.</p>
<p>Let us consider the ionization energy of water, as calculated with MO energies and <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> using two different exchange-correlation functionals with variable HF exchange:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using MO energies for TDHF and TDDFT yields the same IP as when addressing core-transitions to extremely diffuse basis functions (due to the lack of relaxation), and is thus representative of the error for such XAS calculations.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Investigated HF exchange and result containers</span>
<span class="n">hf_exc</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="n">hf_blyp</span><span class="p">,</span> <span class="n">hf_pbe</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[]],</span> <span class="p">[[],</span> <span class="p">[]]</span>


<span class="k">def</span> <span class="nf">dft_delta</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">xc</span><span class="p">):</span>
    <span class="c1"># Neutral calculation</span>
    <span class="n">dft_res</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Core-hole calculation</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">dft_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">xc</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">dft_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">dft_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">dft_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">for</span> <span class="n">h_x</span> <span class="ow">in</span> <span class="n">hf_exc</span><span class="p">:</span>
    <span class="c1"># BxLYP (Slater exchange 0.08, except when HF i 1.00)</span>
    <span class="k">if</span> <span class="n">h_x</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">s_x</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s_x</span> <span class="o">=</span> <span class="mf">0.08</span>
    <span class="n">b_x</span> <span class="o">=</span> <span class="mf">1.00</span> <span class="o">-</span> <span class="n">h_x</span> <span class="o">-</span> <span class="n">s_x</span>
    <span class="n">v_e</span><span class="p">,</span> <span class="n">v_l</span> <span class="o">=</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.81</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h_x</span><span class="si">:}</span><span class="s2"> * HF + </span><span class="si">{</span><span class="n">s_x</span><span class="si">:}</span><span class="s2"> * Slater + </span><span class="si">{</span><span class="n">b_x</span><span class="si">:}</span><span class="s2"> * B88, </span><span class="si">{</span><span class="n">v_l</span><span class="si">:}</span><span class="s2"> * LYP + </span><span class="si">{</span><span class="n">v_e</span><span class="si">:}</span><span class="s2"> * VWN&quot;</span>
    <span class="n">E_mo</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">dft_delta</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
    <span class="n">hf_blyp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_mo</span><span class="p">)</span>
    <span class="n">hf_blyp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="p">)</span>
    <span class="c1"># PBEx</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">h_x</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h_x</span><span class="si">:}</span><span class="s2"> * HF + </span><span class="si">{</span><span class="n">p_x</span><span class="si">:}</span><span class="s2"> * PBE, PBE&quot;</span>
    <span class="n">E_mo</span><span class="p">,</span> <span class="n">E_delta</span> <span class="o">=</span> <span class="n">dft_delta</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
    <span class="n">hf_pbe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_mo</span><span class="p">)</span>
    <span class="n">hf_pbe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_delta</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># DFT ionization energies, including scalar relativistic shift</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_blyp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.37</span><span class="p">,</span> <span class="s2">&quot;bs--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_blyp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.37</span><span class="p">,</span> <span class="s2">&quot;ro--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_pbe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.37</span><span class="p">,</span> <span class="s2">&quot;d--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hf_pbe</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.37</span><span class="p">,</span> <span class="s2">&quot;g^--&quot;</span><span class="p">)</span>

<span class="c1"># Experimental value and legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">539.9</span><span class="p">,</span> <span class="mf">539.9</span><span class="p">],</span> <span class="s2">&quot;k-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;BxLYP ($\Delta$SCF)&quot;</span><span class="p">,</span> <span class="s2">&quot;BxLYP (MO)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;PBEx ($\Delta$SCF)&quot;</span><span class="p">,</span> <span class="s2">&quot;PBEx (MO)&quot;</span><span class="p">,</span> <span class="s2">&quot;Expt&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">1.025</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">508</span><span class="p">,</span> <span class="mf">562.0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;HF exchange [%]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Ionization energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-sie">
<a class="reference internal image-reference" href="../_images/sie.svg"><img alt="../_images/sie.svg" height="276" src="../_images/sie.svg" width="414" /></a>
</figure>
<p>We see that the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF error is quite constant between the two base functionals and amounts of HF exchange, while the MO energies strongly scale with HF exchange, but not with the base functional. The total MO error is a function of two effects:</p>
<ol class="simple">
<li><p>Lack of relaxation, which generally leads to an overestimation of IP:s and core-excitation energies</p></li>
<li><p>Self-interaction, which by contrast leads to an underestimation of these energies</p></li>
</ol>
<p>For a typical exchange-correlation functional (<span class="math notranslate nohighlight">\(\sim\)</span>20-25% HF exchange) the SIE thus dominates, and by tuning the (global) HF exchange to around 60% we achieve IP estimates in good agreement to experiment. We note that this is only acheieved by cancellation of the above two errors, and does not mean that we have an appropriate description of the core-excitation processes. Furthermore, a good exchange-correlation functional should possess good energies <em>and</em> densities, and focusing on only energies can push us away from such a goal. Nevertheless, a number of tailored functionals with good absolute energies have been constructed, tuning the HF exchange either in a global or range-separated manner. Note that the parameterization will have to depend on the spectroscopy, probed edge, and row of the periodic table, as the exact balance in relaxation terms and SIE varies.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Could add radial distribution/densities of functionals and compare to HF, and explicitly calculate the SIE</p></li>
<li><p>Can do SIE calculations similar to those in DFT section and tie to this discussion, as well as one considering relaxation</p></li>
</ul>
</div>
</section>
<section id="core-hole-localization">
<span id="sec-xray-topics-chloc"></span><h2>Core-hole localization<a class="headerlink" href="#core-hole-localization" title="Permalink to this headline">#</a></h2>
<p>For <span class="math notranslate nohighlight">\(\Delta\)</span> SCF calculations (either for estimating IP:s or as a initial state for XES), a core-hole is created at some atomic site. For many systems, this is unproblematic, but if chemically equivalent atoms are present, the MOs are delocalized over these sites. Pefrorming a straightforward <span class="math notranslate nohighlight">\(\Delta\)</span>SCF calculation will then results in a delocalized core-hole, as illustrated below for ethene:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ethene_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">C0      0.6660048050     0.0000000000    -0.0000000000</span>
<span class="s2">C1     -0.6660048050    -0.0000000000     0.0000000000</span>
<span class="s2">H       1.2278735620     0.9228358077    -0.0000000000</span>
<span class="s2">H       1.2278735620    -0.9228358077    -0.0000000000</span>
<span class="s2">H      -1.2278735620     0.9228358077     0.0000000000</span>
<span class="s2">H      -1.2278735620    -0.9228358077     0.0000000000</span>
<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">Koopman_vs_delta</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">ecp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Create pyscf mol object</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">molecule</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="k">if</span> <span class="n">ecp</span><span class="p">:</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">ecp</span> <span class="o">=</span> <span class="n">ecp</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="c1"># Perform unrestricted SCF calculation</span>
    <span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Copy molecular orbitals</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="c1"># Create 1s core-hole by setting alpha_0 population to zero</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Return MO energy and deltaSCF</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span>
    <span class="p">)</span>


<span class="c1"># All-electron calculation of IP</span>
<span class="n">delta_all</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ethene_xyz</span><span class="p">,</span> <span class="s2">&quot;unc-6-31G&quot;</span><span class="p">)</span>

<span class="c1"># IP calculation with ECP on one carbon</span>
<span class="n">delta_ecp</span> <span class="o">=</span> <span class="n">Koopman_vs_delta</span><span class="p">(</span><span class="n">ethene_xyz</span><span class="p">,</span> <span class="s2">&quot;unc-6-31G&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;C0&quot;</span><span class="p">:</span> <span class="s2">&quot;stuttgart&quot;</span><span class="p">})</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c1"># IP estimates with all-electron (delocalized core-hole)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">delta_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.11</span><span class="p">,</span> <span class="n">delta_all</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.11</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>

<span class="c1"># IP estimates with ECP (localized core-hole)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">delta_ecp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.11</span><span class="p">,</span> <span class="n">delta_ecp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.11</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span><span class="p">)</span>

<span class="c1"># Experiment and figure settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">290.80</span><span class="p">,</span> <span class="mf">290.80</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Ionization energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="s2">&quot;MO&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\Delta$SCF&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-ch-loc">
<a class="reference internal image-reference" href="../_images/ch_loc.svg"><img alt="../_images/ch_loc.svg" height="207" src="../_images/ch_loc.svg" width="345" /></a>
</figure>
<p>As can be seen, the errors from MO energies are very similar for the all-electron calculation (with a delocalized core-hole) and using ECP (delocalized core-hole). For the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF calculation, however, only approximately half the relaxation energy is accounted for using a delocalized core-hole. Such a discrepancy for delocalized calculations of IP:s has been noted previously, and it has been associated with missing correlation effects which are required to properly correct the delocalized calculation. Within a full CI scheme, delocalization will no longer be an issue (and it will capture the small shift in energy between the gerade and ungerade core-hole).</p>
<p>Moving from theory, in experiment the localizatio/delocalization of core-holes is primarily relevant for diatomic systems, as other compounds will possess vibrational effects which break the symmetry. For diatomic systems the localized/delocalized nature of the core-hole has been seen to depend on the details of the measurement, such that both can be probed [ref].</p>
<p>As such, for practical calculation we recommend that core-holes are localized for IP and XES calculations. For XAS it does not provide any issues for linear response methods (provided that both gerade and ungerade MOs are kept in the CVS space/equivalent), but for state-specific approaches this will again be an issue (<em>e.g.</em> STEX and TP-DFT).</p>
</section>
<section id="tailored-cvs">
<span id="sec-xray-topics-tailcvs"></span><h2>Tailored CVS<a class="headerlink" href="#tailored-cvs" title="Permalink to this headline">#</a></h2>
<p>For large systems, it may become relevant to tailor the CVS space such that each chemically unique atom is probed in turn. While this requires explicit consideration of each set of unique MOs separately, it serves dual purposes which can make it worth it:</p>
<ol class="simple">
<li><p>It lowers the dimensionality of the involved matrices, and thus decrease computational costs</p></li>
<li><p>The density-of-states decrease, which means that the same energy region can be resolved with a few states per unique MO, rather than having to converge a large number of eigenstates simultaneously</p></li>
</ol>
<p>While this technically does not fulfill one of foundations on which the CVS approximation is built (the MOs are not energetically well-separated), the spatial separation means that it will typically work. As an example, we consider ethene (which has delocalized MO:s) and vinylfluoride (which does not):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ethene&quot;</span><span class="p">)</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">ethene_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># Perform CVS-ADC calculations</span>
<span class="n">ethene_adc1_0</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ethene_adc1_1</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ethene_adc1_01</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">ethene_adc2_0</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ethene_adc2_1</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ethene_adc2_01</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vinylfluoride&quot;</span><span class="p">)</span>
<span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">vinyl_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># Perform CVS-ADC calculations</span>
<span class="n">vinyl_adc1_1</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">vinyl_adc1_2</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">vinyl_adc1_12</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc1</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">vinyl_adc2_1</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">vinyl_adc2_2</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">vinyl_adc2_12</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Ethene with CVS-ADC(1)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Ethene&quot;</span><span class="p">)</span>
<span class="n">ethene_adc1_0</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO #0&quot;</span><span class="p">)</span>
<span class="n">ethene_adc1_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO #1&quot;</span><span class="p">)</span>
<span class="n">ethene_adc1_01</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO:s #0-1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;CVS-ADC(1)&quot;</span><span class="p">)</span>

<span class="c1"># Vinylfluoride with CVS-ADC(1)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Vinylfluoride&quot;</span><span class="p">)</span>
<span class="n">vinyl_adc1_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO #1&quot;</span><span class="p">)</span>
<span class="n">vinyl_adc1_2</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO #2&quot;</span><span class="p">)</span>
<span class="n">vinyl_adc1_12</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;MO #1-2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Ethene with CVS-ADC(2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">ethene_adc2_0</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">ethene_adc2_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">ethene_adc2_01</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;CVS-ADC(2)&quot;</span><span class="p">)</span>

<span class="c1"># Vinylfluoride with CVS-ADC(2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">vinyl_adc2_1</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">vinyl_adc2_2</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">vinyl_adc2_12</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-adc-cvs">
<a class="reference internal image-reference" href="../_images/adc_cvs.svg"><img alt="../_images/adc_cvs.svg" height="414" src="../_images/adc_cvs.svg" width="691" /></a>
</figure>
<p>We see that considering each MO in turn works well for vinylfluoride, where the two carbon 1s are localized, but not for ethene, where they are delocalized. Including or not including fluorine here makes little difference, as that MO is both energetically and spatially well separated from the carbon 1s.</p>
<p>Note that the delocalization might not be immediatelly apparent, as just visually looking at the molecule and concluding which atoms are unique might not be sufficient. Care should be taken for larger systems, and explicitly looking at the MOs is advised. Alternatively, using ECP:s to localize the core-hole and then restricting the CVS space accordingly will avoid this issue.</p>
</section>
<section id="post-hf-on-a-non-aufbau-reference">
<span id="sec-xray-topics-nonaufbau"></span><h2>Post-HF on a non-Aufbau reference<a class="headerlink" href="#post-hf-on-a-non-aufbau-reference" title="Permalink to this headline">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Include a discussion on the potential issues in using post-HF methods for a non-<em>Aufbau</em> reference state, as can be seen by noting the MP2 energy denominator (and potential singularities, and discusses <a class="reference external" href="https://doi.org/10.26434/chemrxiv-2022-vllwh">here</a>)</p></li>
<li><p>Potentially include explicit example</p></li>
</ul>
</div>
<ol class="simple">
<li><p>Go over all permutations (aa, ab, bb), saving the highest MO index which yields denominators below 0.1 au. Just have a list of virtual indices, adding when an index is not already found there. Do this in one shot, instead of saving one virtual at a time.</p></li>
<li><p>Compare this to the (eventually) available scheme in adcc, noting that the present (simpler) scheme is likely just as useful - despite not ordering indices by how problemativ they are.</p></li>
<li><p>Calculate the ADC(2)/cc-pCVQZ spectra of ammonia, with and without frozen virtuals.</p></li>
</ol>
</section>
<section id="spurious-valence-mixing-in-xas">
<span id="sec-xray-cons-spur-val"></span><h2>Spurious valence mixing in XAS<a class="headerlink" href="#spurious-valence-mixing-in-xas" title="Permalink to this headline">#</a></h2>
<p>Within a damped response theory framwork or when performing explicit real-time propagation, a CVS-like scheme which separates core-transitions from the valence-continuum is usually not performed. If such calculations are run with an atom-centered basis set (as most are), this can then lead to spurious mixing with valence-excited states. What happens is that resonances in the valence-continuum occur close to core-excitations, leading to unphysical mixing which affects excitation energies and (more significantly) intensities. These issues occur both for methods featuring only single-excited configurations (<em>e.g.</em> TDDFT) and higher-excited configurations (<em>e.g.</em> ADC) and need to be avoided.</p>
<p>These issues have been observed for, <em>e.g.</em>, <span class="math notranslate nohighlight">\(L_{2,3}\)</span>-edge of silicon <span id="id1">[<a class="reference internal" href="refs.html#id12" title="T. Fransson, D. Burdakova, and P. Norman. K- and L-edge X-ray absorption spectrum calculations of closed-shell carbon, silicon, germanium, and sulfur compounds using damped four-component density functional response theory. Phys. Chem. Chem. Phys., 18:13591-13603, 2016. URL: https://doi.org/10.1039/C6CP00561F.">FBN16</a>, <a class="reference internal" href="refs.html#id11" title="M. Kadek, L. Konecny, B. Gao, M. Repisky, and K. Ruud. X-ray absorption resonances near L$_2,3$-edges from real-time propagation of the Dirac–Kohn–Sham density matrix. Phys. Chem. Chem. Phys., 17:22566-22570, 2015. URL: https://doi.org/10.1039/C5CP03712C.">KKG+15</a>]</span>, and are usually more common at lower energies. They can be identified by studying the amplitudes and the <span class="math notranslate nohighlight">\(t^2\)</span> values for post-HF methods, and can be avoided by chosing appropriate basis sets, freezing certain virtual orbitals, or by re-introducing the CVS approximation (or some other flavour) within the CPP/RT framework. The latter approach is recommended at least for CPP-ADC, as converging the response vectors has otherwise been seen to be difficult <span id="id2">[<a class="reference internal" href="refs.html#id46" title="D. R. Rehn, Z. Rinkevicius, M. Herbst, M. Li, X. Scheurer, M. Brand, A. L. Dempwolff, I. E. Brumboiu, T. Fransson, A. Dreuw, and P. Norman. Gator: a Python-driven program for spectroscopy simulations using correlated wave functions. WIREs Comput. Mol. Sci., 2021. URL: https://doi.org/10.1002/wcms.1528.">RRH+21</a>]</span>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="xray_analysis.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Spectrum analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="xray_large.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Larger systems</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The eChem team<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>