
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spectrum analysis &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Special aspects" href="xray_aspects.html" />
    <link rel="prev" title="Spectrum calculation" href="xray_calc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../intro.html">
   Getting started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../install.html">
     Installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics_notebook.html">
     Using Jupyter notebooks
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Electronic ground states
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/elstruct_gen.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/orbitals.html">
     Orbitals and basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/slater.html">
     Many-electron wave functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/operators.html">
     Operators and matrix elements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/reduced_density.html">
     Reduced particle densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/natural_orbitals.html">
     Natural orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/integrals.html">
     Integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/spin.html">
     Electron spin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/correlation.html">
     Electron correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dispersion.html">
     Dispersion interactions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/pt.html">
     Rayleigh–Schrödinger perturbation theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/second_quant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/wft_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/kernel_int.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dft_scf.html">
     SCF optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dft_prop.html">
     First-order properties
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Molecular structure and dynamics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/molstruct_gen.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/coordinates.html">
     Choice of coordinates
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/gradients.html">
   Gradients
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/energy_grad.html">
     Energy gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/property_grad.html">
     Property gradients
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/hessians_vib.html">
   Hessians and vibrations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/hessians.html">
     Molecular Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/vibrations.html">
     Vibrational analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/opt.html">
   Structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/opt_struct.html">
     Optimization methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/opt_gs.html">
     Ground-state structure optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/tst.html">
   Transition-state theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/tst_gen.html">
     Transition state geometry optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/impes.html">
   PES interpolation techniques
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/impes_calc.html">
     Constructing the PES by interpolation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/md.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/forcefields.html">
     Force fields
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/reparameterize.html">
     Reparameterize force fields
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/md_run.html">
     Running a simulation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spectra and properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/spectra_aspects.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/vibrot.html">
     Rovibronic states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/response.html">
     Responses to external fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/tddft.html">
   TDDFT
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_basics.html">
     Foundations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_rpa.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/mr_response.html">
   Multireference response
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/ci_response.html">
     CI response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/sa_mcscf.html">
     State-averaged MCSCF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/mclr.html">
     Multiconfigurational linear response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/mr_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/adc.html">
   ADC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_pp.html">
     Polarization propagator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_isr.html">
     Intermediate state representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_cvs.html">
     Core-valence separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_hpc.html">
     HPC-QC implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/excoupl.html">
   Exciton coupling model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/excoupl_impl.html">
     Implementation of the exciton coupling model
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../env/localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/loprop.html">
     LoProp charges and polarisabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../env/embedding.html">
   Embedding
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/nonpol_emb.html">
     Non-polarizable embedding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/pol_emb.html">
     Polarizable embedding
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/mol_struct.html">
   Molecular structure and dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/struct_vis.html">
     Molecular structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/md_vis.html">
     MD trajectories
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/opt_vib_vis.html">
     Optimization and normal modes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/elec_struct.html">
   Electronic structure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/orb_vis.html">
     Orbitals and densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/exc_vis.html">
     Excited states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/spec_prop.html">
   Spectra and properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/broadening.html">
     Spectrum broadening
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="workflow.html">
   Constructing workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_build.html">
     Building the system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_struct.html">
     Optimizing molecular structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_scf.html">
     Optimizing electronic structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_construct.html">
     Assembling a full workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv_vis.html">
   UV/vis spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_absorption.html">
     Absorption
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_fluorescence.html">
     Fluorescence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_analysis.html">
     Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vib_ir.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="vib_ir_calc.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vib_ir_raman.html">
     Raman spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vib_ir_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openshells.html">
   Open shells
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="rest_unrest.html">
     Restricted versus unrestricted
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="correlation.html">
     Static versus dynamic correlation correlation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
  <label for="toctree-checkbox-26">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_cheatsheet.html">
     Cheat sheet
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../cite.html">
   How to cite and contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/tutorials/xray_analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/kthpanor/echem"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/tutorials/xray_analysis.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/docs/tutorials/xray_analysis.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#looking-at-solution-vectors">
   Looking at solution vectors
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eigenvectors">
     Eigenvectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decomposition-of-spectra">
   Decomposition of spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-contributions">
     Atomic contributions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polarization-dependence">
     Polarization dependence
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Spectrum analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#looking-at-solution-vectors">
   Looking at solution vectors
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eigenvectors">
     Eigenvectors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decomposition-of-spectra">
   Decomposition of spectra
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#atomic-contributions">
     Atomic contributions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polarization-dependence">
     Polarization dependence
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="spectrum-analysis">
<h1>Spectrum analysis<a class="headerlink" href="#spectrum-analysis" title="Permalink to this headline">#</a></h1>
<p>For the analysis of obtained spectra we will focus on the carbon X-ray absorption spectrum of vinylfluoride, with emphasis on how the obtained spectra can be decomposed in terms of the polarization of incoming radiation, and the atomic origin of the features. Additional analysis in terms of MOs, different <a class="reference internal" href="../visualize/exc_vis.html"><span class="doc std std-doc">visualization</span></a> schemes and descriptors thereof, will be added at a later date, as well as more details on assignment. Analysis of features in X-ray emission spectra tends to be easier to interpret (fewer states, probing occupied states of relatively large energy shifts, etc.), and focus will thus here be on XAS.</p>
<p>Vinylfluride (C<span class="math notranslate nohighlight">\(_2\)</span>H<span class="math notranslate nohighlight">\(_3\)</span>F) is a fluorine-substituted ethene derivate, which possess large shifts in features for the -<strong>C</strong>HF site due to interaction with the very electronegative fluorine. This <em>chemical shift</em> is significant and a strong indicator of the local chemical environment. This can be seen by comparing the experimental spectra of ethene, vinylfluoride, and 1,1-difluoroethene:</p>
<figure class="align-default" id="expt-ethene">
<img alt="../../_images/expt_ethene.svg" src="../../_images/expt_ethene.svg" /><figcaption>
<p><span class="caption-number">Fig. 37 </span><span class="caption-text"><a class="reference external" href="https://doi.org/10.1103/PhysRevA.36.1683">Experimental</a> carbon X-ray absorption spectra of ethene and two substituted derivates. Marking position (and number of contributing carbon sites) of strong <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> transitions.</span><a class="headerlink" href="#expt-ethene" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>We see that a single substitution yields a shift of about 2 eV, and a double substitution (at the same site) of about 4 eV. The behaviour of the chemical shifts for different spectroscopies will be further deliberated on in <a class="reference internal" href="xray_exercises.html#sec-xray-ex-chem"><span class="std std-ref">exercises</span></a>.</p>
<p>Calculating the vinylfluoride spectrum using CVS-ADC(2)-x and CPP-DFT (with the B3LYP xc-functional):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 10 lowest eigenstates with CVS restriction to MOs #1-#3 (fluorine and carbon 1s)</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span>
    <span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cvs-adc2x&quot;</span><span class="p">,</span> <span class="n">singlets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have a recent version of adcc, there may be convergence issues due to a mismatch between conda and adcc. This is being looked into, and can for the moment typically be avoided by increasing the basis set size.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and calculation</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;conv_thresh&quot;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xcfun&quot;</span><span class="p">:</span> <span class="s2">&quot;b3lyp&quot;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Define spectrum region to be resolved</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">272.0</span><span class="p">,</span> <span class="mf">285.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span> <span class="o">/</span> <span class="n">au2ev</span>
<span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>

<span class="c1"># Calculate the response</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s2">&quot;damping&quot;</span><span class="p">:</span> <span class="mf">0.4</span> <span class="o">/</span> <span class="n">au2ev</span><span class="p">},</span> <span class="n">method_settings</span>
<span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">()</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>

<span class="c1"># Extract the imaginary part of the complex response function and convert to absorption cross section</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>
    <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting spectra are shown below, and look very similar (although with a large difference in absolute energy):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># CPP-DFT results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;CPP-DFT (B3LYP)&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span> <span class="mi">284</span><span class="p">)</span>

<span class="c1"># CVS-ADC(2)-x results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;CVS-ADC(2)-x&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span> <span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-vinyl-calc">
<a class="reference internal image-reference" href="../../_images/vinyl_calc.svg"><img alt="../../_images/vinyl_calc.svg" height="345" src="../../_images/vinyl_calc.svg" width="552" /></a>
</figure>
<section id="looking-at-solution-vectors">
<span id="sec-xray-anal-amp"></span><h2>Looking at solution vectors<a class="headerlink" href="#looking-at-solution-vectors" title="Permalink to this headline">#</a></h2>
<p>The solution vectors, <em>i.e.</em> the eigenvectors for eigenstate calculations and the response vectors for CPP calculations, can be plotted in order to see involved occupied and virtual MOs. This can give some insight into the different features, but easily becomes cumbersome when the density of states is high, or when the final state consists of a mix of many contributions.</p>
<section id="eigenvectors">
<h3>Eigenvectors<a class="headerlink" href="#eigenvectors" title="Permalink to this headline">#</a></h3>
<p>From the ADC calculations there is the function <code class="docutils literal notranslate"><span class="pre">state.describe_amplitudes</span></code>, which print the amplitudes using one of three formats, controlled by <code class="docutils literal notranslate"><span class="pre">index_format</span></code>. The amplitudes are then printed when above a <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> threshold. Splitting the returning string according to <code class="docutils literal notranslate"><span class="pre">state</span></code> and printing only the first two states, we get:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;From &#39;hf&#39; format, which yield MO number:&quot;</span><span class="p">)</span>
<span class="n">des_amp</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">index_format</span><span class="o">=</span><span class="s2">&quot;hf&quot;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">tmp_amp</span> <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">hf_exc1</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">hf_exc2</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First transition from &#39;adcc&#39; format, with indexing as used in adcc:&quot;</span><span class="p">)</span>
<span class="n">des_amp</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">index_format</span><span class="o">=</span><span class="s2">&quot;adcc&quot;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">tmp_amp</span> <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">adcc_exc1</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First transition from &#39;homolumo&#39; format, which use HOMO/LUMO/HOCO format:&quot;</span><span class="p">)</span>
<span class="n">des_amp</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">index_format</span><span class="o">=</span><span class="s2">&quot;homolumo&quot;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">tmp_amp</span> <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="n">homo_exc1</span> <span class="o">=</span> <span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">hf_exc1</span> <span class="o">=</span> <span class="s2">&quot;+---------------------------------------+</span><span class="se">\n</span><span class="s2">| State   1 ,      10.63675 au          |</span><span class="se">\n</span><span class="s2">+---------------------------------------+</span><span class="se">\n</span><span class="s2">|   1     -&gt;  12      a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s2">|   1     -&gt;  22      a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s2">|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |&quot;</span>
<span class="n">hf_exc2</span> <span class="o">=</span> <span class="s2">&quot;+---------------------------------------+</span><span class="se">\n</span><span class="s2">| State   1 ,      10.63675 au          |</span><span class="se">\n</span><span class="s2">+---------------------------------------+</span><span class="se">\n</span><span class="s2">|   1     -&gt;  12      a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s2">|   1     -&gt;  22      a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s2">|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |&quot;</span>
<span class="n">adcc_exc1</span> <span class="o">=</span> <span class="s2">&quot;+-------------------------------------------------------+</span><span class="se">\n</span><span class="s2">| State   1 ,      10.63675 au,      289.4407 eV        |</span><span class="se">\n</span><span class="s2">+-------------------------------------------------------+</span><span class="se">\n</span><span class="s2">| (o2  1)         -&gt; (v1  0)          a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s2">| (o2  1)         -&gt; (v1 10)          a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s2">| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     +0.149 |&quot;</span>
<span class="n">homo_exc1</span> <span class="o">=</span> <span class="s2">&quot;+-------------------------------------------------------+</span><span class="se">\n</span><span class="s2">| State   1 ,      10.63675 au,      289.4407 eV        |</span><span class="se">\n</span><span class="s2">+-------------------------------------------------------+</span><span class="se">\n</span><span class="s2">| HOCO -1         -&gt; LUMO             a -&gt;a      -0.601 |</span><span class="se">\n</span><span class="s2">| HOCO -1         -&gt; LUMO+10          a -&gt;a      -0.105 |</span><span class="se">\n</span><span class="s2">| HOMO    HOCO -1 -&gt; LUMO    LUMO     ab-&gt;ab     +0.149 |&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;From &#39;hf&#39; format, which yield MO number:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hf_exc1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hf_exc2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First transition from &#39;adcc&#39; format, with indexing as used in adcc:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adcc_exc1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">First transition from &#39;homolumo&#39; format, which use HOMO/LUMO/HOCO format:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">homo_exc1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>From &#39;hf&#39; format, which yield MO number:
+---------------------------------------+
| State   1 ,      10.63675 au          |
+---------------------------------------+
|   1     -&gt;  12      a -&gt;a      -0.601 |
|   1     -&gt;  22      a -&gt;a      -0.105 |
|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |
+---------------------------------------+
| State   1 ,      10.63675 au          |
+---------------------------------------+
|   1     -&gt;  12      a -&gt;a      -0.601 |
|   1     -&gt;  22      a -&gt;a      -0.105 |
|  11   1 -&gt;  12  12  ab-&gt;ab     +0.149 |


First transition from &#39;adcc&#39; format, with indexing as used in adcc:
+-------------------------------------------------------+
| State   1 ,      10.63675 au,      289.4407 eV        |
+-------------------------------------------------------+
| (o2  1)         -&gt; (v1  0)          a -&gt;a      -0.601 |
| (o2  1)         -&gt; (v1 10)          a -&gt;a      -0.105 |
| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     +0.149 |


First transition from &#39;homolumo&#39; format, which use HOMO/LUMO/HOCO format:
+-------------------------------------------------------+
| State   1 ,      10.63675 au,      289.4407 eV        |
+-------------------------------------------------------+
| HOCO -1         -&gt; LUMO             a -&gt;a      -0.601 |
| HOCO -1         -&gt; LUMO+10          a -&gt;a      -0.105 |
| HOMO    HOCO -1 -&gt; LUMO    LUMO     ab-&gt;ab     +0.149 |
</pre></div>
</div>
</div>
</div>
<p>From this, it is clear that the two first transitions originate from two different occupied MOs, which correspond to the -<strong>C</strong>H<span class="math notranslate nohighlight">\(_2\)</span> and -<strong>C</strong>HF atoms, respectively. The transitions are dominated by single-excitations to the LUMO and LUMO+1, with largest relaxation contributions coming from the HOMO.</p>
</section>
</section>
<section id="decomposition-of-spectra">
<h2>Decomposition of spectra<a class="headerlink" href="#decomposition-of-spectra" title="Permalink to this headline">#</a></h2>
<p>For a more visual illustration, we can plot the spectra as decomposed according to atomic contributions and polarization of absorbed radiation.</p>
<section id="atomic-contributions">
<h3>Atomic contributions<a class="headerlink" href="#atomic-contributions" title="Permalink to this headline">#</a></h3>
<p>Decomposing the spectra according to atomic contributions provides information on which core orbitals contribute to the various features. For vinylfluoride, this can be done by performing CVS calculations with tailored CVS spaces for each carbon site:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 6 lowest eigenstates with CVS restriction to MOs #2 and #3 (two carbons)</span>
<span class="n">adc_chf</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span>
    <span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cvs-adc2x&quot;</span><span class="p">,</span> <span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">adc_ch2</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span>
    <span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cvs-adc2x&quot;</span><span class="p">,</span> <span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>From which the contributions can be plotted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Spectrum from -CHF</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_chf</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_chf</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x1i</span><span class="p">,</span> <span class="n">y1i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Spectrum from -CH2</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_ch2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_ch2</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x2i</span><span class="p">,</span> <span class="n">y2i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plotting line spectra for full, area spectra for contributions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="n">y1i</span> <span class="o">+</span> <span class="n">y2i</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">y1i</span> <span class="o">+</span> <span class="n">y2i</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Full&quot;</span><span class="p">,</span> <span class="s2">&quot;-CHF&quot;</span><span class="p">,</span> <span class="s2">&quot;-CH2&quot;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span> <span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-adc-decomp">
<a class="reference internal image-reference" href="../../_images/adc_decomp.svg"><img alt="../../_images/adc_decomp.svg" height="276" src="../../_images/adc_decomp.svg" width="483" /></a>
</figure>
<p>We here clearly see the chemical shift due to fluorine-substitution.</p>
<p>This manner of decomposing the atomic contributions should be taken with some care, as it involves explicit calculation for each atomic site in turn, which:</p>
<ol class="simple">
<li><p>Can require a larger number of calculations, and care should be taken so that the studied region does contain all states of one atomic site, but not another.</p></li>
<li><p>This approach does not strictly fit with the CVS philosophy, which uses the large separation in energy and spatial extent as a basis for separation. Energy separation can now be small, and for some systems degeneracies and near-degeneracies may lead to delocalized core orbitals (see <a class="reference internal" href="xray_aspects.html#sec-xray-topics-chloc"><span class="std std-ref">here</span></a> and <a class="reference internal" href="xray_aspects.html#sec-xray-topics-tailcvs"><span class="std std-ref">here</span></a>). If so, all delocalized sites must be included in the same CVS space.</p></li>
</ol>
<p>Nevertheless, this approach has some advantages in terms of ease of analysis, as well as exhibiting lower computational cost for each calculation (albeit here requiring two calculations instead of just one).</p>
<p>An alternative to this is to perform the decomposition on the full solution vectors, as will here be done using CPP-DFT response vectors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of occupied and unoccupied (alpha) MOs</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="n">nvirt</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="o">.</span><span class="n">number_mos</span><span class="p">()</span> <span class="o">-</span> <span class="n">nocc</span>

<span class="c1"># Extract solution vectors</span>
<span class="n">solution_vecs</span> <span class="o">=</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;solutions&quot;</span><span class="p">)</span>
<span class="n">x_solution</span><span class="p">,</span> <span class="n">y_solution</span><span class="p">,</span> <span class="n">z_solution</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">x_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)])</span>
    <span class="n">y_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)])</span>
    <span class="n">z_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)])</span>
<span class="n">x_solution</span><span class="p">,</span> <span class="n">y_solution</span><span class="p">,</span> <span class="n">z_solution</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_solution</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_solution</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_solution</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Extract polarization-resolved response</span>
<span class="n">sX</span><span class="p">,</span> <span class="n">sY</span><span class="p">,</span> <span class="n">sZ</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">axx</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">ayy</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">azz</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>

<span class="c1"># Create empty object of dimension nocc (to add spectrum contributions from each occupied orbital)</span>
<span class="n">spec_comp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nocc</span><span class="p">):</span>
    <span class="n">spec_comp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>

<span class="c1"># Appending spec_comp object with decomposed response</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">z_tmp</span> <span class="o">=</span> <span class="n">z_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
        <span class="n">comp_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[</span><span class="n">occ</span> <span class="o">*</span> <span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nvirt</span><span class="p">]))</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[</span><span class="n">occ</span> <span class="o">*</span> <span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nvirt</span><span class="p">]))</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">occ</span> <span class="o">*</span> <span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nvirt</span><span class="p">]))</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[:])))</span>
        <span class="n">spec_comp</span><span class="p">[</span><span class="n">occ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_X</span> <span class="o">*</span> <span class="n">sX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">comp_Y</span> <span class="o">*</span> <span class="n">sY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">comp_Z</span> <span class="o">*</span> <span class="n">sZ</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1"># Extract contribution of two carbon atoms, as well as the full spectrum</span>
<span class="n">cont_chf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cont_ch2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">cont_full</span> <span class="o">=</span> <span class="n">sigma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Create splined spectra for each component</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">ychf</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">cont_chf</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">ych2</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">cont_ch2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">yfull</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">cont_full</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="c1"># Spectrum from the non-carbon atoms</span>
<span class="n">yrest</span> <span class="o">=</span> <span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># Plot full spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Plot components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">yrest</span> <span class="o">+</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span> <span class="o">+</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yrest</span> <span class="o">+</span> <span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span> <span class="s2">&quot;-CHF&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;-CH$_2$&quot;</span><span class="p">,</span> <span class="s2">&quot;Rest&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span> <span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-dft-decomp">
<a class="reference internal image-reference" href="../../_images/dft_decomp.svg"><img alt="../../_images/dft_decomp.svg" height="276" src="../../_images/dft_decomp.svg" width="483" /></a>
</figure>
<p>Where we again clearly see the chemical shift and different contributions.</p>
</section>
<section id="polarization-dependence">
<h3>Polarization dependence<a class="headerlink" href="#polarization-dependence" title="Permalink to this headline">#</a></h3>
<p>For structured molecular samples, the local orientation of the molecules can be studied by looking at the polarization-resolved spectra. This will not work for the gas phase, where the isotropic signal is observed, but it can provide very useful information on, <em>e.g.</em>, the orientation and structuring of self-assembly monolayers.</p>
<p>Resolving the polarization-dependence from ADC and CPP-DFT calculations is straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract excitation energies</span>
<span class="n">adc_freq</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span>

<span class="c1"># Extract Cartesian components from the ADC state (here skipping the prefactors)</span>
<span class="n">adc_sX</span><span class="p">,</span> <span class="n">adc_sY</span><span class="p">,</span> <span class="n">adc_sZ</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">)):</span>
    <span class="n">tmp_tms</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">transition_dipole_moment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">adc_sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmp_tms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmp_tms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adc_freq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">tmp_tms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Resolved spectrum region</span>
<span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">296</span>

<span class="c1"># Broadened spectra for each component</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sX</span>
<span class="n">xX</span><span class="p">,</span> <span class="n">yX</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sY</span>
<span class="n">xY</span><span class="p">,</span> <span class="n">yY</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sZ</span>
<span class="n">xZ</span><span class="p">,</span> <span class="n">yZ</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plot total spectrum (line) and Cartesian contributions (area)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span> <span class="o">+</span> <span class="n">yY</span> <span class="o">+</span> <span class="n">yZ</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span> <span class="n">yX</span> <span class="o">+</span> <span class="n">yY</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span> <span class="o">+</span> <span class="n">yY</span><span class="p">,</span> <span class="n">yX</span> <span class="o">+</span> <span class="n">yY</span> <span class="o">+</span> <span class="n">yZ</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Isotropic&quot;</span><span class="p">,</span> <span class="s2">&quot;x-pol.&quot;</span><span class="p">,</span> <span class="s2">&quot;y-pol.&quot;</span><span class="p">,</span> <span class="s2">&quot;z-pol.&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-adc-pol">
<a class="reference internal image-reference" href="../../_images/adc_pol.svg"><img alt="../../_images/adc_pol.svg" height="276" src="../../_images/adc_pol.svg" width="483" /></a>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="c1"># Extract frequencies</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Spline spectra for each Cartesian contribution</span>
<span class="n">yX</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sX</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">yY</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">yZ</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sZ</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>

<span class="c1"># Plot total spectrum (line) and Cartesian contributions (area)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Isotropic&quot;</span><span class="p">,</span> <span class="s2">&quot;x-pol.&quot;</span><span class="p">,</span> <span class="s2">&quot;y-pol.&quot;</span><span class="p">,</span> <span class="s2">&quot;z-pol.&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span> <span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="xray-dft-pol">
<a class="reference internal image-reference" href="../../_images/dft_pol.svg"><img alt="../../_images/dft_pol.svg" height="276" src="../../_images/dft_pol.svg" width="483" /></a>
</figure>
<p>We see that the first two transitions are out-of-plane, correspond to the two strong <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> excitations. As such, if the molecule is rotated in space, these two lines would provide very good probes on the angle with respect to the out-of-plane direction.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs/tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="xray_calc.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Spectrum calculation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="xray_aspects.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Special aspects</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The eChem team<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>