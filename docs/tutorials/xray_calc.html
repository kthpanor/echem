
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spectrum calculation &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Spectrum analysis" href="xray_analysis.html" />
    <link rel="prev" title="X-ray spectroscopies" href="xray.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-TX4YJ1J5XE"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-TX4YJ1J5XE');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../intro.html">
   Getting started
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../install.html">
     Installation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../basics_notebook.html">
     Using Jupyter notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../units_notation.html">
     Units and notation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Electronic ground states
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/elstruct_gen.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/orbitals.html">
     Orbitals and basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/slater.html">
     Many-electron wave functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/operators.html">
     Operators and matrix elements
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/reduced_density.html">
     Reduced particle densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/natural_orbitals.html">
     Natural orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/integrals.html">
     Integrals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/spin.html">
     Electron spin
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/correlation.html">
     Electron correlation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dispersion.html">
     Dispersion interactions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/pt.html">
     Rayleigh–Schrödinger perturbation theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/second_quant.html">
     Second quantization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/group_theory.html">
     Group theory
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../elec_struct/hartree-fock.html">
     Hartree–Fock
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../elec_struct/hf_theory.html">
       Hartree–Fock theory
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../elec_struct/hf_scf.html">
       SCF optimization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../elec_struct/hf_example.html">
       HF in VeloxChem
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/wft_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../elec_struct/dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/kernel_int.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dft_scf.html">
     SCF optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/dft_prop.html">
     First-order properties
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../elec_struct/available_xcfun.html">
     Available XC functionals
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Molecular structure and dynamics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/molstruct_gen.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/coordinates.html">
     Choice of coordinates
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/gradients.html">
   Gradients
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/energy_grad.html">
     Energy gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/property_grad.html">
     Property gradients
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/hessians_vib.html">
   Hessians and vibrations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/hessians.html">
     Molecular Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/vibrations.html">
     Vibrational analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/opt.html">
   Structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/opt_struct.html">
     Optimization methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/opt_gs.html">
     Ground-state structure optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/tst.html">
   Transition-state theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/tst_gen.html">
     Transition state geometry optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/impes.html">
   PES interpolation techniques
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/impes_calc.html">
     Constructing the PES by interpolation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../mol_struct/md.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/forcefields.html">
     Force fields
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/reparameterize.html">
     Reparameterize force fields
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../mol_struct/md_run.html">
     Running a simulation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Spectra and properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/spectra_aspects.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/vibrot.html">
     Rovibronic states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/response.html">
     Responses to external fields
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/selection_rules.html">
     Selection rules
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/tddft.html">
   TDDFT
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_basics.html">
     Foundations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_rpa.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/tddft_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/mr_response.html">
   Multireference response
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/ci_response.html">
     CI response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/sa_mcscf.html">
     State-averaged MCSCF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/mclr.html">
     Multiconfigurational linear response
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/mr_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/adc.html">
   ADC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_pp.html">
     Polarization propagator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_isr.html">
     Intermediate state representation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_cvs.html">
     Core-valence separation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_hpc.html">
     HPC-QC implementation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/adc_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../spec_prop/excoupl.html">
   Exciton coupling model
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
  <label for="toctree-checkbox-17">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../spec_prop/excoupl_impl.html">
     Implementation of the exciton coupling model
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../env/localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
  <label for="toctree-checkbox-18">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/loprop.html">
     LoProp charges and polarisabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../env/embedding.html">
   Embedding potentials
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
  <label for="toctree-checkbox-19">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/nonpol_emb.html">
     Non-polarizable embedding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../env/pol_emb.html">
     Polarizable embedding
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/mol_struct.html">
   Molecular structure and dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
  <label for="toctree-checkbox-20">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/struct_vis.html">
     Molecular structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/md_vis.html">
     MD trajectories
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/opt_vib_vis.html">
     Optimization and normal modes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/elec_struct.html">
   Electronic structure
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
  <label for="toctree-checkbox-21">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/orb_vis.html">
     Orbitals and densities
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/exc_vis.html">
     Excited states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../visualize/spec_prop.html">
   Spectra and properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
  <label for="toctree-checkbox-22">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../visualize/broadening.html">
     Spectrum broadening
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="workflow.html">
   Constructing workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
  <label for="toctree-checkbox-23">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_build.html">
     Building the system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_struct.html">
     Optimizing molecular structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_scf.html">
     Optimizing electronic structure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="wf_construct.html">
     Assembling a full workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv_vis.html">
   UV/vis spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
  <label for="toctree-checkbox-24">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_absorption.html">
     Absorption
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_fluorescence.html">
     Fluorescence
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_analysis.html">
     Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv_vis_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vib_ir.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
  <label for="toctree-checkbox-25">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="vib_ir_calc.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vib_ir_raman.html">
     Raman spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vib_ir_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="openshells.html">
   Open shells
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
  <label for="toctree-checkbox-26">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="rest_unrest.html">
     Restricted versus unrestricted
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="correlation.html">
     Static versus dynamic correlation correlation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
  <label for="toctree-checkbox-27">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_cheatsheet.html">
     Cheat sheet
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bibliography
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../cite.html">
   How to cite and contact
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/tutorials/xray_calc.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/kthpanor/echem"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/tutorials/xray_calc.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/docs/tutorials/xray_calc.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-photoemission-spectroscopy">
   X-ray photoemission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ies-from-koopmans-theorem">
     IEs from Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-maximum-overlap-method">
     The maximum overlap method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ies-from-deltascf">
     IEs from
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     SCF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-delta-textrm-scf">
     Spectra from
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-absorption-spectroscopy">
   X-ray absorption spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decoupling-from-the-valence-continuum">
     Decoupling from the valence continuum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cvs-adc">
     Spectra from CVS-ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-tddft">
     Spectra from TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cpp-dft">
     Spectra from CPP-DFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cpp-casscf">
     Spectra from CPP-CASSCF
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-emission-spectroscopy">
   X-ray emission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-adc">
     Spectra from ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sec-xray-calc-xesdft">
     Spectra from TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-ground-state-mos">
     Spectra from ground state MOs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resonant-inelastic-x-ray-scattering">
   Resonant inelastic X-ray scattering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-step-approach-with-adc">
     Two-step approach with ADC
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Spectrum calculation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-photoemission-spectroscopy">
   X-ray photoemission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ies-from-koopmans-theorem">
     IEs from Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-maximum-overlap-method">
     The maximum overlap method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ies-from-deltascf">
     IEs from
     <span class="math notranslate nohighlight">
      \(\Delta\)
     </span>
     SCF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-delta-textrm-scf">
     Spectra from
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-absorption-spectroscopy">
   X-ray absorption spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decoupling-from-the-valence-continuum">
     Decoupling from the valence continuum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cvs-adc">
     Spectra from CVS-ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-tddft">
     Spectra from TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cpp-dft">
     Spectra from CPP-DFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cpp-casscf">
     Spectra from CPP-CASSCF
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-emission-spectroscopy">
   X-ray emission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-adc">
     Spectra from ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sec-xray-calc-xesdft">
     Spectra from TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-ground-state-mos">
     Spectra from ground state MOs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resonant-inelastic-x-ray-scattering">
   Resonant inelastic X-ray scattering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-step-approach-with-adc">
     Two-step approach with ADC
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="spectrum-calculation">
<h1>Spectrum calculation<a class="headerlink" href="#spectrum-calculation" title="Permalink to this headline">#</a></h1>
<p>This section focuses on the calculation of XPS, XAS, XES, and RIXS, mainly by considering these spectroscopies at the ADC and TDDFT levels of theory. For a more general overview of the large number of methods available to determine these properties, see, <em>e.g.</em>, <span id="id1">[<a class="reference internal" href="../refs.html#id67" title="P. Norman and A. Dreuw. Simulating x-ray spectroscopies and calculating core-excited states of molecules. Chem. Rev., 118:7208-7248, 2018. URL: https://doi.org/10.1021/acs.chemrev.8b00156.">ND18</a>]</span>.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">adcc</span>
<span class="kn">import</span> <span class="nn">gator</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">multipsi</span> <span class="k">as</span> <span class="nn">mtp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">import</span> <span class="nn">py3Dmol</span> <span class="k">as</span> <span class="nn">p3d</span>

<span class="c1"># au to eV conversion factor</span>
<span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># These will be removed and included through VeloxChem</span>

<span class="k">def</span> <span class="nf">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lorentzian broadening function</span>

<span class="sd">    Call: xi,yi = lorentzian(energies, intensities, start energy,</span>
<span class="sd">                                    end energy, energy step, gamma)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">)</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">/</span> <span class="p">((</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span>

<span class="k">class</span> <span class="nc">MockTask</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ao_basis</span> <span class="o">=</span> <span class="n">basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mpi_comm</span> <span class="o">=</span> <span class="n">comm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ostream</span> <span class="o">=</span> <span class="n">ostream</span>
</pre></div>
</div>
</div>
</div>
<section id="x-ray-photoemission-spectroscopy">
<span id="sec-xray-calc-xps"></span><h2>X-ray photoemission spectroscopy<a class="headerlink" href="#x-ray-photoemission-spectroscopy" title="Permalink to this headline">#</a></h2>
<p>In XPS the photoemission of electrons is measured, yielding information on core-electron binding energies. Here we focus on the calculation of ionization energies (IEs), from which the isotropic photoemission spectrum is formed by giving each IE the same intensity and then broadening with an appropriate convolution function. It is possible to go beyond such a simple approach using Dyson orbitals, but it typically does not make much of a difference <span id="id2">[<a class="reference internal" href="../refs.html#id100" title="M. L. Vidal, A. I. Krylov, and S. Coriani. Dyson orbitals within the fc-CVS-EOM-CCSD framework: theory and application to x-ray photoelectron spectroscopy of ground and excited states. Phys. Chem. Chem. Phys., 22:2693, 2019. URL: https://doi.org/10.1039/C9CP03695D.">VKC19</a>]</span>.</p>
<section id="ies-from-koopmans-theorem">
<span id="sec-xray-calc-iekoop"></span><h3>IEs from Koopmans’ theorem<a class="headerlink" href="#ies-from-koopmans-theorem" title="Permalink to this headline">#</a></h3>
<p>A simple model for calculating ionization energies and electron affinities is by using Koopmans’ theorem, where they are estimated from the MO energies. For water, we then obtain a <span class="math notranslate nohighlight">\(1s\)</span> IE of:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">water_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;3</span>

<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Create veloxchem mol and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_16794869208920505"  style="position: relative; width: 300px; height: 200px">
        <p id="3dmolwarning_16794869208920505" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.1/3Dmol-min.js');
}

var viewer_16794869208920505 = null;
var warn = document.getElementById("3dmolwarning_16794869208920505");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_16794869208920505 = $3Dmol.createViewer(document.getElementById("3dmolviewer_16794869208920505"),{backgroundColor:"white"});
viewer_16794869208920505.zoomTo();
	viewer_16794869208920505.addModel("3\n\nO       0.0000000000     0.0000000000     0.1178336003\nH      -0.7595754146    -0.0000000000    -0.4713344012\nH       0.7595754146     0.0000000000    -0.4713344012\n","xyz");
	viewer_16794869208920505.setViewStyle({"style": "outline", "width": 0.05});
	viewer_16794869208920505.setStyle({"stick": {}, "sphere": {"scale": 0.25}});
	viewer_16794869208920505.rotate(-90,"x");
viewer_16794869208920505.render();
});
</script></div></div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_results</span> <span class="o">=</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Extract orbital energies</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;1s IE from Koopmans</span><span class="se">\&#39;</span><span class="s1"> theorem: </span><span class="si">{</span><span class="n">au2ev</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">orbital_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1"> 5.2f</span><span class="si">}</span><span class="s1"> eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1s IE from Koopmans&#39; theorem: -559.50 eV
</pre></div>
</div>
</div>
</div>
<p>This can be compared to the experimental value, which is 539.9 eV. The overestimation of almost 20 eV is due to lack of <a class="reference internal" href="xray_aspects.html#sec-xray-topics-relax"><span class="std std-ref">relaxation</span></a>, which results from the reorganization of the valence electrons in response to a reduction in screening of the nuclei. By comparison, in valence spectroscopies the change in shielding is significantly smaller, yielding far smaller errors due to the lack of relaxation.</p>
<p>An approach for including relaxation effects in IE calculations is to use the <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> approach, in which the difference in total energy between the neutral and explicitly optimized core-hole states yields estimates of core-electron binding energies.</p>
</section>
<section id="the-maximum-overlap-method">
<h3>The maximum overlap method<a class="headerlink" href="#the-maximum-overlap-method" title="Permalink to this headline">#</a></h3>
<p>In a normal SCF cycle without constraints, the core-ionized state is not possible to converge since it collapses into a lower-energy valence-ionized state. To obtain a core-hole state, an approach which avoids the convergence to the valence-hole state is needed. This can be done using several approaches, but the focus here will be on the maximum overlap method (MOM). The idea behind MOM is to run an SCF optimization with the constraint of maximizing the overlap of the orbitals to some initial guess <span id="id3">[<a class="reference internal" href="../refs.html#id3" title="P. S. Bagus and H. F. Schaefer. Direct near-Hartree–Fock calculations of the 1s hole states of NO+. J. Chem. Phys., 55:1474, 1971. URL: https://doi.org/10.1063/1.1676248.">BS71</a>, <a class="reference internal" href="../refs.html#id32" title="A. T. B. Gilbert, N. A. Besley, and P. M. W. Gill. Self-consistent field calculations of excited states using the maximum overlap method (MOM). J. Phys. Chem. A, 112:13164-13171, 2008. URL: https://doi.org/10.1021/jp801738f.">GBG08</a>, <a class="reference internal" href="../refs.html#id51" title="H. F. King, R. E. Stanton, H. Kim, R. E. Wyatt, and R. G. Parr. Corresponding orbitals and the nonorthogonality problem in molecular quantum mechanics. J. Chem. Phys., 47:1936, 1967. URL: https://doi.org/10.1063/1.1712221.">KSK+67</a>, <a class="reference internal" href="../refs.html#id60" title="P. G. Lykos and H. N. Schmeising. Maximum overlap atomic and molecular orbitals. J. Phys. Chem., 35:288, 1961. URL: https://doi.org/10.1063/1.1731901.">LS61</a>]</span>. The guess is typically taken as the converged wave function of the neutral (no core-hole) system, and new occupied orbitals at each iteration are chosen such that they overlap most with the span of old occupied orbitals. Defining the overlap matrix as</p>
<div class="math notranslate nohighlight">
\[
\textbf{O} = 
\left( \textbf{C}^{\textrm{old}} \right)^{\dagger} \textbf{SC}^{\textrm{new}}
\]</div>
<p>with <span class="math notranslate nohighlight">\(O_{ij}\)</span> being the overlap between the <span class="math notranslate nohighlight">\(i\)</span>:th old and <span class="math notranslate nohighlight">\(j\)</span>:th new orbital, and <span class="math notranslate nohighlight">\(\textbf{C}\)</span> and <span class="math notranslate nohighlight">\(\textbf{S}\)</span> are the MO coefficient matrices and basis function overlap matrix, respectively. The projections of the <span class="math notranslate nohighlight">\(j\)</span>:th new orbital onto the old space is</p>
<div class="math notranslate nohighlight">
\[
p_j = \sum_i^n O_{ij} = 
\sum_a^N (
\sum_b^N (
\sum_i^n C_{ib}^{\textrm{old}} )
S_{bc} )
C_{cj}^{\textrm{old}}
\]</div>
<p>The occupied orbitals are then selected by largest <span class="math notranslate nohighlight">\(p_j\)</span> values. The original formulation of MOM used the previous iteration as the old space, but more recent development (and what is used in VeloxChem) includes the use of the initial guess as the old space throughout - this is also referred to as initial maximum overlap method (IMOM).</p>
<p>With this, a converged core-hole wave-function is obtained with the following scheme:</p>
<ol class="simple">
<li><p>Calculate the wave-function of the original system (<em>e.g.</em> no core-hole).</p></li>
<li><p>Use this as a starting guess for a new wave-function optimization, removing an electron from the desired orbital (and potentially occupying some other virtual orbital).</p></li>
<li><p>Optimize this state using the MOM restriction.</p></li>
</ol>
<p>This scheme can consider many unstable states, including core-ionized and certain core-excited states. Some care should be observed, though:</p>
<ul class="simple">
<li><p>If excited states are considered, check that the final state is reasonably close to what is to be investigated.</p></li>
<li><p><a class="reference internal" href="xray_aspects.html#sec-xray-topics-chloc"><span class="std std-ref">Delocalized core orbitals</span></a> need to be localized, for example by employing ECPs.</p></li>
<li><p>If post-HF methods are used, the ground state calculation can attempt to (partially) fill the core-hole of the <a class="reference internal" href="xray_aspects.html#sec-xray-topics-nonaufbau"><span class="std std-ref">non-<em>Aufbau</em> reference state</span></a>, leading to a corrupt wave-function which represents an intermediate between a core-hole/valence-hole state.</p></li>
</ul>
</section>
<section id="ies-from-deltascf">
<span id="sec-xray-calc-dscf"></span><h3>IEs from <span class="math notranslate nohighlight">\(\Delta\)</span>SCF<a class="headerlink" href="#ies-from-deltascf" title="Permalink to this headline">#</a></h3>
<p>The IE of water using <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> is then computed as:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy molecule object</span>
<span class="n">mol_ion</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>

<span class="c1"># Change charge and multiplicity</span>
<span class="n">mol_ion</span><span class="o">.</span><span class="n">set_charge</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mol_ion</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Lists of occupied alpha and beta MOs</span>
<span class="n">occa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">occb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="c1"># Calculate SCF of core-ion</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfUnrestrictedDriver</span><span class="p">()</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">maximum_overlap</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">occa</span><span class="p">,</span> <span class="n">occb</span><span class="p">)</span>
<span class="n">scf_ion_results</span> <span class="o">=</span> <span class="n">scf_ion</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IE from energy difference</span>
<span class="n">hf_ie</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;HF ionization energy: </span><span class="si">{</span><span class="n">hf_ie</span><span class="w"> </span><span class="si">:</span><span class="s1"> 5.2f</span><span class="si">}</span><span class="s1"> eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HF ionization energy:  541.73 eV
</pre></div>
</div>
</div>
</div>
<p>This estimate is within 2 eV from experiment, and we can include electron correlation using MP2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mp2_gs</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Mp2Driver</span><span class="p">()</span>
<span class="n">mp2_gs</span><span class="o">.</span><span class="n">compute_conventional</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>

<span class="n">mp2_ion</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Mp2Driver</span><span class="p">()</span>
<span class="n">mp2_ion</span><span class="o">.</span><span class="n">compute_conventional</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_ion</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>

<span class="n">mp2_ie</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">((</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">+</span> <span class="n">mp2_ion</span><span class="o">.</span><span class="n">e_mp2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">+</span> <span class="n">mp2_gs</span><span class="o">.</span><span class="n">e_mp2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MP2 ionization energy: </span><span class="si">{</span><span class="n">mp2_ie</span><span class="w"> </span><span class="si">:</span><span class="s1"> 5.2f</span><span class="si">}</span><span class="s1"> eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MP2 ionization energy:  542.86 eV
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Above will be changed, as it currently is using MP2 (not UMP2).</p>
</div>
<p>Alternatively, we can consider this with KS-DFT:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform SCF calculation</span>
<span class="n">dft_gs</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xcfun&quot;</span><span class="p">:</span> <span class="s2">&quot;b3lyp&quot;</span><span class="p">}</span>
<span class="n">dft_gs</span><span class="o">.</span><span class="n">update_settings</span><span class="p">({},</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">dft_results</span> <span class="o">=</span> <span class="n">dft_gs</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate SCF of core-ion</span>
<span class="n">dft_ion</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfUnrestrictedDriver</span><span class="p">()</span>
<span class="n">dft_ion</span><span class="o">.</span><span class="n">maximum_overlap</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">occa</span><span class="p">,</span> <span class="n">occb</span><span class="p">)</span>
<span class="n">dft_ion</span><span class="o">.</span><span class="n">update_settings</span><span class="p">({},</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">dft_ion_results</span> <span class="o">=</span> <span class="n">dft_ion</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IE from energy difference</span>
<span class="n">dft_ie</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">dft_ion</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_gs</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DFT ionization energy: </span><span class="si">{</span><span class="n">dft_ie</span><span class="w"> </span><span class="si">:</span><span class="s1"> 5.2f</span><span class="si">}</span><span class="s1"> eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DFT ionization energy:  542.58 eV
</pre></div>
</div>
</div>
</div>
<p>MP2 and DFT currently bring us <em>away</em> from experiment when comparing to HF, but we note that the basis set is small and ill-suited for core properties. Using a cc-pCVTZ basis we obtain:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>method</p></th>
<th class="head"><p>IE [eV]</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HF</p></td>
<td><p>538.93</p></td>
</tr>
<tr class="row-odd"><td><p>MP2</p></td>
<td><p>540.26</p></td>
</tr>
<tr class="row-even"><td><p>B3LYP</p></td>
<td><p>539.19</p></td>
</tr>
</tbody>
</table>
<p>Thus closer to experiment for the correlated methods (note that <a class="reference internal" href="xray_aspects.html#sec-xray-topics-rel"><span class="std std-ref">scalar-relativistic effects</span></a> will shift these results upwards by <span class="math notranslate nohighlight">\(\sim\)</span>0.37 eV).</p>
</section>
<section id="spectra-from-delta-textrm-scf">
<h3>Spectra from <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span><a class="headerlink" href="#spectra-from-delta-textrm-scf" title="Permalink to this headline">#</a></h3>
<p>The X-ray photoemission spectrum can be formed by computing all relavant core-electron binding energies (IEs), giving each unique ionization equal intensity, and broadening over the result with an appropriate convolution function.</p>
<p>We here consider ethyl trifluoroacetate( (CF<span class="math notranslate nohighlight">\(_3\)</span>-CO-O-CH<span class="math notranslate nohighlight">\(_2\)</span>-CH<span class="math notranslate nohighlight">\(_3\)</span>), also known as the <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">‘ESCA’ molecule</a>, which possess very illustrative shifts in XPS features of the carbon <span class="math notranslate nohighlight">\(K\)</span>-edge due to interactions with the very electronegative oxygen and fluorine atoms. We calculate the four carbon 1s IEs with <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span>:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">esca_xyz</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;14</span>

<span class="s2">C         1.1183780041   -0.3449927563    0.0140172822</span>
<span class="s2">C         0.2599020293    0.9430366372   -0.0248385056</span>
<span class="s2">F         2.4019839124   -0.0408200726   -0.0368443870</span>
<span class="s2">F         0.8399255955   -1.1560630574   -1.0169777359</span>
<span class="s2">F         0.8945563482   -1.0267696528    1.1485539196</span>
<span class="s2">O         0.7954196415    2.0187110930    0.0011424145</span>
<span class="s2">O        -1.0675509573    0.8144007049   -0.0614767265</span>
<span class="s2">C        -1.7486063992   -0.4602333713   -0.1739210991</span>
<span class="s2">C        -3.1986940727   -0.1850294900    0.1302033614</span>
<span class="s2">H        -1.3268717284   -1.1720377773    0.5289059043</span>
<span class="s2">H        -1.6185520565   -0.8344576449   -1.1859838788</span>
<span class="s2">H        -3.3116641442    0.1959612359    1.1419001202</span>
<span class="s2">H        -3.7716619472   -1.1057672384    0.0380096706</span>
<span class="s2">H        -3.6012985602    0.5468300237   -0.5651778685            </span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Create veloxchem mol and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">esca_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div id="3dmolviewer_1679486923536892"  style="position: relative; width: 300px; height: 200px">
        <p id="3dmolwarning_1679486923536892" style="background-color:#ffcccc;color:black">You appear to be running in JupyterLab (or JavaScript failed to load for some other reason).  You need to install the 3dmol extension: <br>
        <tt>jupyter labextension install jupyterlab_3dmol</tt></p>
        </div>
<script>

var loadScriptAsync = function(uri){
  return new Promise((resolve, reject) => {
    //this is to ignore the existence of requirejs amd
    var savedexports, savedmodule;
    if (typeof exports !== 'undefined') savedexports = exports;
    else exports = {}
    if (typeof module !== 'undefined') savedmodule = module;
    else module = {}

    var tag = document.createElement('script');
    tag.src = uri;
    tag.async = true;
    tag.onload = () => {
        exports = savedexports;
        module = savedmodule;
        resolve();
    };
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});
};

if(typeof $3Dmolpromise === 'undefined') {
$3Dmolpromise = null;
  $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.1/3Dmol-min.js');
}

var viewer_1679486923536892 = null;
var warn = document.getElementById("3dmolwarning_1679486923536892");
if(warn) {
    warn.parentNode.removeChild(warn);
}
$3Dmolpromise.then(function() {
viewer_1679486923536892 = $3Dmol.createViewer(document.getElementById("3dmolviewer_1679486923536892"),{backgroundColor:"white"});
viewer_1679486923536892.zoomTo();
	viewer_1679486923536892.addModel("14\n\nC         1.1183780041   -0.3449927563    0.0140172822\nC         0.2599020293    0.9430366372   -0.0248385056\nF         2.4019839124   -0.0408200726   -0.0368443870\nF         0.8399255955   -1.1560630574   -1.0169777359\nF         0.8945563482   -1.0267696528    1.1485539196\nO         0.7954196415    2.0187110930    0.0011424145\nO        -1.0675509573    0.8144007049   -0.0614767265\nC        -1.7486063992   -0.4602333713   -0.1739210991\nC        -3.1986940727   -0.1850294900    0.1302033614\nH        -1.3268717284   -1.1720377773    0.5289059043\nH        -1.6185520565   -0.8344576449   -1.1859838788\nH        -3.3116641442    0.1959612359    1.1419001202\nH        -3.7716619472   -1.1057672384    0.0380096706\nH        -3.6012985602    0.5468300237   -0.5651778685            \n","xyz");
	viewer_1679486923536892.setViewStyle({"style": "outline", "width": 0.05});
	viewer_1679486923536892.setStyle({"stick": {}, "sphere": {"scale": 0.25}});
viewer_1679486923536892.render();
});
</script></div></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>

<span class="c1"># Copy molecule object</span>
<span class="n">mol_ion</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>

<span class="c1"># Change charge and multiplicity</span>
<span class="n">mol_ion</span><span class="o">.</span><span class="n">set_charge</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mol_ion</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">esca_ies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]:</span>
    <span class="n">occa</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">))</span>
    <span class="n">occb</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">occa</span><span class="p">)</span>
    <span class="n">occb</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfUnrestrictedDriver</span><span class="p">()</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">maximum_overlap</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">occa</span><span class="p">,</span> <span class="n">occb</span><span class="p">)</span>
    <span class="n">scf_ion_results</span> <span class="o">=</span> <span class="n">scf_ion</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
    <span class="n">hf_ie</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>
    <span class="n">esca_ies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hf_ie</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">esca_ies</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># IEs from above calculation</span>
<span class="n">esca_ies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">302.187</span><span class="p">,</span> <span class="mf">299.362</span><span class="p">,</span> <span class="mf">295.405</span><span class="p">,</span> <span class="mf">293.277</span><span class="p">]</span>

<span class="c1"># Broaden with a Lorentzian and plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">esca_ies</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">esca_ies</span><span class="p">)))</span>
<span class="c1"># Lorentzian function takes energies, intensities, energy range, step-size, and a broadening parameter</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Photon energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity [arb. units]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/xray_calc_22_0.png" src="../../_images/xray_calc_22_0.png" />
</div>
</div>
<p>For the comparison to <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">experimental measurements</a>, a cc-pVTZ basis set is selected, as augmented with additional core-polarizing functions for the carbon atoms (<em>i.e.</em> cc-pCVTZ). Theoretical spectrum shifted by 0.11 eV (to account for relativistic effects) and broadened by 0.3 eV.</p>
<figure class="align-default" id="esca-xps">
<img alt="../../_images/esca_xps.svg" src="../../_images/esca_xps.svg" /></figure>
<p>The features originate in, from low to high energy: H<span class="math notranslate nohighlight">\(_3\)</span><strong>C</strong>-, -<strong>C</strong>H<span class="math notranslate nohighlight">\(_2\)</span>-, -<strong>C</strong>O-, and -<strong>C</strong>F<span class="math notranslate nohighlight">\(_3\)</span>. We note a good agreement for the first two features, but the comparison deteriorates for higher energies. This is largely an effect of the more significant change in electronic structure imposed by the very electronegative fluorine and oxygen atoms, which the current level of theory is not capable of describing as well.</p>
</section>
</section>
<section id="x-ray-absorption-spectroscopy">
<span id="sec-xray-calc-xas"></span><h2>X-ray absorption spectroscopy<a class="headerlink" href="#x-ray-absorption-spectroscopy" title="Permalink to this headline">#</a></h2>
<p>In XAS the energy-dependent photoabsorption of the sample is measured, probing excitation of core electrons to bound or continuum states. These two different final states then provide information on unoccupied states and local chemical environment, respectively, with a prototypical spectrum of a conjugated system:</p>
<figure class="align-default" id="xafs">
<img alt="../../_images/xafs.svg" src="../../_images/xafs.svg" /></figure>
<p>We see two disctinct regions with different features and physical origins:</p>
<ul class="simple">
<li><p><strong>NEXAFS (near-edge X-ray absorption fine structure):</strong> the region in which transitions to bound states occurs (this region is also known as XANES, X-ray absorption near-edge structure).</p></li>
<li><p><strong>EXAFS (extended X-ray absorption fine structure):</strong> which consists of transitions to continuum states, as modulated by constructive or destructive interference between the emitted electron and the environment. This thus provide information on local chemical bonds.</p></li>
</ul>
<p>Included is also the position of the IE, as well assignment of typical features (<span class="math notranslate nohighlight">\(\pi^*\)</span>, Rydberg, and <span class="math notranslate nohighlight">\(\sigma^*\)</span>). Transitions to <span class="math notranslate nohighlight">\(\pi^*\)</span> states are typically low in energy and very intense, and thus easy to identify. By comparison, Rydberg states are typically weak and converge to the ionization energy, and for condensed phase they tend to be atttenuated. Finally, transitions to <span class="math notranslate nohighlight">\(\sigma^*\)</span> states can be found above the ionization energy.</p>
<p>The total spectrum is referred to as the <strong>XAFS (X-ray absorption fine structure)</strong> region. For the remainder of this tutorial we will focus on NEXAFS, for which good starting points for modeling with ADC and TDDFT can be found in <span id="id4">[<a class="reference internal" href="../refs.html#id12" title="N. A. Besley and F. A. Asmuruf. Time-dependent density functional theory calculations of the spectroscopy of core electrons. Phys. Chem. Chem. Phys., 12:12024-12039, 2010. URL: https://doi.org/10.1039/C002207A.">BA10</a>, <a class="reference internal" href="../refs.html#id67" title="P. Norman and A. Dreuw. Simulating x-ray spectroscopies and calculating core-excited states of molecules. Chem. Rev., 118:7208-7248, 2018. URL: https://doi.org/10.1021/acs.chemrev.8b00156.">ND18</a>, <a class="reference internal" href="../refs.html#id107" title="J. Wenzel, A. Holzer, M. Wormit, and A. Dreuw. Analysis and comparison of CVS-ADC approaches up to third order for the calculation of core-excited states. J. Chem. Phys., 142:214104, 2015. URL: https://doi.org/10.1063/1.4921841.">WHWD15</a>]</span>.</p>
<section id="decoupling-from-the-valence-continuum">
<span id="sec-xray-calc-cvs"></span><h3>Decoupling from the valence continuum<a class="headerlink" href="#decoupling-from-the-valence-continuum" title="Permalink to this headline">#</a></h3>
<p>A complication that arises when considering core excitations is the embedding of the core-excited states in the continuum of valence-ionized states. This means that the targetted core-excited states cannot easily be resolved with, <em>e.g.</em>, a Davidson approach, as a large number of valence-excited and -ionized states need to be converged first. A number of approaches have been developed to remove or circumvent this issue, including:</p>
<ul class="simple">
<li><p>The core-valence separation (CVS) approximation <span id="id5">[<a class="reference internal" href="../refs.html#id14" title="L. S. Cederbaum, W. Domcke, and J. Schirmer. Many-body theory of core holes. Phys. Rev. A, 22:206, 1980. URL: https://doi.org/10.1103/PhysRevA.22.206.">CDS80</a>, <a class="reference internal" href="../refs.html#id99" title="M. L. Vidal, X. Feng, E. Epifanovsky, A. I. Krylov, and S. Coriani. New and efficient equation-of-motion coupled-cluster framework for core-excited and core-ionized states. J. Chem. Theory Comput., 15:3117-3133, 2019. URL: https://doi.org/10.1021/acs.jctc.9b00039.">VFE+19</a>, <a class="reference internal" href="../refs.html#id107" title="J. Wenzel, A. Holzer, M. Wormit, and A. Dreuw. Analysis and comparison of CVS-ADC approaches up to third order for the calculation of core-excited states. J. Chem. Phys., 142:214104, 2015. URL: https://doi.org/10.1063/1.4921841.">WHWD15</a>]</span></p></li>
<li><p>Restricted energy window (which is largely a different flavour of CVS) <span id="id6">[<a class="reference internal" href="../refs.html#id59" title="K. Lopata, B. E. van Kuiken, M. Khalil, and N. Govind. Linear-response and real-time time-dependent density functional theory studies of core-level near-edge X-ray absorption. J. Chem. Theory Comput., 8:3284-3292, 2012. URL: https://doi.org/10.1021/ct3005613.">LvKKG12</a>]</span></p></li>
<li><p>Damped linear response theory, or the complex polarization propagator (CPP), where the response at arbitrary frequencies is directly probed <span id="id7">[<a class="reference internal" href="../refs.html#id23" title="U. Ekström, P. Norman, V. Carravetta, and H. Ågren. Polarization propagator for x-ray spectra. Phys. Rev. Lett., 2006. URL: 10.1103/PhysRevLett.97.143001.">EkstromNCAAgren06</a>]</span></p></li>
<li><p>Real-time propagation of the electronic structure <span id="id8">[<a class="reference internal" href="../refs.html#id59" title="K. Lopata, B. E. van Kuiken, M. Khalil, and N. Govind. Linear-response and real-time time-dependent density functional theory studies of core-level near-edge X-ray absorption. J. Chem. Theory Comput., 8:3284-3292, 2012. URL: https://doi.org/10.1021/ct3005613.">LvKKG12</a>]</span></p></li>
</ul>
<p>Alternatively, when using methods constructing explicit excited states this can be avoided by some constraint scheme, such as MOM.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Within a damped response framework and when using real-time propagation there can be <a class="reference internal" href="xray_aspects.html#sec-xray-cons-spur-val"><span class="std std-ref">spurious mixing</span></a> with valene-ionized states, which needs to be avoided.</p>
</div>
<p>The focus in this tutorial is the use of the CVS approximation and the CPP approach, with which interior eigenstates and response at arbitrary frequencies can be addressed, as illustrated below. Here we show the global spectrum of water, using the 6-311G basis set. Results obtained with ADC(1), CVS-ADC(1), ADC(2), CVS-ADC(2), and CPP-DFT. CPP-DFT results obtained using the B3LYP exchange-correlation functional and a large <span class="math notranslate nohighlight">\(\gamma\)</span> of 1 eV. ADC results are shown as bar spectra.</p>
<figure class="align-default" id="global-xray">
<img alt="../../_images/cvs_adc.svg" src="../../_images/cvs_adc.svg" /></figure>
<p>Here we see the global spectrum of water, using a rather limited basis set. Even so, ADC(1) requires more than 50 states to resolve the core-excitation region (situated at about 535 eV for water), and for ADC(2) we could only converge abot 50 states, which did not bring us to the core-excitations. With the CVS approximation we directly target the core-excitation region, albeit at the cost of introducing an error. However, this error has been shown to be relatively small (provided a reasonable basis set) and stable for ADC <span id="id9">[<a class="reference internal" href="../refs.html#id41" title="M. F. Herbst and T. Fransson. Quantifying the error of the core-valence separation approximation. J. Chem. Phys., 153:054114, 2020. URL: https://doi.org/10.1063/5.0013538.">HF20</a>]</span>, and for TDHF and TDDFT it is all but negligible. Using CPP-DFT, this error is avoided all together (although CPP-ADC has been noted to be hard to converge for core-excited state <span id="id10">[<a class="reference internal" href="../refs.html#id79" title="D. R. Rehn, Z. Rinkevicius, M. Herbst, M. Li, X. Scheurer, M. Brand, A. L. Dempwolff, I. E. Brumboiu, T. Fransson, A. Dreuw, and P. Norman. Gator: a Python-driven program for spectroscopy simulations using correlated wave functions. WIREs Comput. Mol. Sci., 2021. URL: https://doi.org/10.1002/wcms.1528.">RRH+21</a>]</span>, so here CVS-CPP-ADC might instead be used - thus reintroducing this small error).</p>
</section>
<section id="spectra-from-cvs-adc">
<span id="sec-xray-calc-cvsadc"></span><h3>Spectra from CVS-ADC<a class="headerlink" href="#spectra-from-cvs-adc" title="Permalink to this headline">#</a></h3>
<p>With CVS-ADC, the core-excitation spectrum is calculate by specifying the index of the probed core orbitals(s):</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">water_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Construct structure and basis objects</span>
<span class="n">struct</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">water_str</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_results</span> <span class="o">=</span> <span class="n">scf_gs</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 6 lowest eigenstates with CVS restriction to MO #1 (oxygen 1s)</span>
<span class="n">adc_result</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span>
    <span class="n">struct</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cvs-adc2x&quot;</span><span class="p">,</span> <span class="n">singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The results can be printed as a table, and convoluted and plotted using built-in functionalities or a custom broadening:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print information on eigenstates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_result</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Convolute using functionalities available in gator and adcc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Built-in broadening&quot;</span><span class="p">)</span>
<span class="n">adc_result</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>

<span class="c1"># Manually convoluted using excitation energies and oscillator strengths</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Custom broadening (0.5 eV)&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_result</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_result</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">533</span><span class="p">,</span> <span class="mi">543</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Photon energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cross section [au]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| cvs-adc2x                               singlet ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      19.71638      536.5099   0.0175       0.8       0.2  |
|  1       19.7967      538.6956   0.0368    0.8087    0.1913  |
|  2      20.49351      557.6567   0.0098    0.7858    0.2142  |
|  3      20.50482      557.9647   0.1007    0.8441    0.1559  |
+--------------------------------------------------------------+
</pre></div>
</div>
<img alt="../../_images/xray_calc_26_1.png" src="../../_images/xray_calc_26_1.png" />
</div>
</div>
<p>The built-in functionality uses a Lorentzian broadening with a small broadening parameter, and plots the full region which is resolved, while we might want to focus on lower-energy regions and use custom broadening schemes (as done in the lower panel). We note that high-energy features can often be a result of a discretized continuum region, as seen by the unphysically intense feature at <span class="math notranslate nohighlight">\(\sim\)</span>558 eV. A larger basis set will flatten out this region, but care should be taken for any analysis above the ionization energy.</p>
<p>Increasing the basis set to aug-cc-pCVTZ/cc-pVTZ (for oxygen and hydrogen, respectively), we obtain results in good agreement with <a class="reference external" href="https://journals.aps.org/pra/abstract/10.1103/PhysRevA.47.1136">experiment</a>. Here the theoretical spectra has been shifted by 0.37 eV (to account for relativistic effects) and broadened by 0.3 eV.</p>
<figure class="align-default" id="adc-water-xas">
<img alt="../../_images/adc_water_xas.svg" src="../../_images/adc_water_xas.svg" /></figure>
</section>
<section id="spectra-from-tddft">
<span id="sec-xray-calc-cvsdft"></span><h3>Spectra from TDDFT<a class="headerlink" href="#spectra-from-tddft" title="Permalink to this headline">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added. For now, see the <a class="reference internal" href="xray_nonstandard.html#sec-xray-cvs-vs-full"><span class="std std-ref">CVS example</span></a> in non-standard calculations.</p>
</div>
</section>
<section id="spectra-from-cpp-dft">
<span id="sec-xray-calc-cppdft"></span><h3>Spectra from CPP-DFT<a class="headerlink" href="#spectra-from-cpp-dft" title="Permalink to this headline">#</a></h3>
<p>With the complex polarization propagator (CPP), also called the damped linear response function, the absorption and dispersion spectrum can be evaluated at arbitrary energies <span id="id11">[<a class="reference internal" href="../refs.html#id66" title="P. Norman, D. M. Bishop, H. J. Aa. Jensen, and J. Oddershede. Near-resonant absorption in the time-dependent self-consistent field and multiconfigurational self-consistent field approximations. J. Chem. Phys., 115:10323-10334, 2001. URL: https://doi.org/10.1063/1.1415081.">NBJO01</a>]</span>. As such, the X-ray absorption spectrum can be directly calculated by calculating the response at X-ray photon energies. For this, we need to decide on which energy region to use, which can be estimated by, <em>e.g.</em>:</p>
<ul class="simple">
<li><p>Screening extended energy regions with large step size. This could potentially be done using a smaller basis set.</p></li>
<li><p>With a method lacking relaxation: starting the region a few eV below the IE from Koopmans’ theorem. This will not work for methods capable of including relaxation, where IEs from <span class="math notranslate nohighlight">\(\Delta\)</span>SCF could instead be considered as a first rough estimate (noting that it will work better or worse for different levels of, <em>e.g.</em>, ADC theory).</p></li>
</ul>
<p>Choosing an energy region of 514-525 eV, using a step length of 0.1 eV and a damping factor of 0.3 eV, we calculate the CPP-DFT (with the B3LYP functional) water spectrum as:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and SCF optimization</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;conv_thresh&quot;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xcfun&quot;</span><span class="p">:</span> <span class="s2">&quot;b3lyp&quot;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_result</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Define spectrum region to be resolved</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">515.0</span><span class="p">,</span> <span class="mf">525.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">/</span> <span class="n">au2ev</span>
<span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>

<span class="c1"># Calculate the response</span>
<span class="n">cpp_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">rsplinabscross</span><span class="o">.</span><span class="n">LinearAbsorptionCrossSection</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;frequencies&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s2">&quot;damping&quot;</span><span class="p">:</span> <span class="mf">0.3</span> <span class="o">/</span> <span class="n">au2ev</span><span class="p">},</span> <span class="n">method_settings</span>
<span class="p">)</span>
<span class="n">cpp_drv</span><span class="o">.</span><span class="n">init_driver</span><span class="p">()</span>
<span class="n">cpp_result</span> <span class="o">=</span> <span class="n">cpp_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>

<span class="c1"># Extract the imaginary part of the complex response function and convert to absorption cross section</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_drv</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_drv</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_drv</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s2">&quot;response_functions&quot;</span><span class="p">][(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span>
    <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Resulting spectra can be plotted as raw, or splined for smoother figures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make figure with panels of 3:1 width</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># Raw results for the full region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="s2">&quot;bx-&quot;</span><span class="p">)</span>

<span class="c1"># Raw results for a zoomed-in region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="s2">&quot;bx-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">519.5</span><span class="p">,</span> <span class="mf">520.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">))</span>

<span class="c1"># Raw and splined spectra for the full region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="s2">&quot;bx&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">),</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s2">&quot;Raw&quot;</span><span class="p">,</span> <span class="s2">&quot;Splined&quot;</span><span class="p">))</span>

<span class="c1"># Raw and splined spectra for a zoomed-in region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="s2">&quot;bx&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">519.5</span><span class="p">,</span> <span class="mf">520.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/xray_calc_32_0.png" src="../../_images/xray_calc_32_0.png" />
</div>
</div>
<p>Using broadened eigenstates, increasing the basis set size and comparing to <a class="reference external" href="https://journals.aps.org/pra/abstract/10.1103/PhysRevA.47.1136">experiment</a> we get the following, where theoretical spectrum has been shifted by 14.5 eV and broadened by 0.3 eV:</p>
<figure class="align-default" id="dft-water-xas">
<img alt="../../_images/dft_water_xas.svg" src="../../_images/dft_water_xas.svg" /></figure>
<p>As can be seen, the absolute excitation energies are significantly off, with a shift of 14.5 eV required to yield an approximate alignment to experiment. Part of this shift is due to lack of relativistic effects (~0.37 eV), and a small discrepancy can be expected due to the use of a limited basis set, but the main part of the error is due to two effects:</p>
<ol class="simple">
<li><p>Lack of <a class="reference internal" href="xray_aspects.html#sec-xray-topics-relax"><span class="std std-ref">relaxation</span></a>, which yields a final state too high in energy and thus shifts the theoretical spectra upwards in energy.</p></li>
<li><p>The self-interaction error (<a class="reference internal" href="xray_aspects.html#sec-xray-topics-sie"><span class="std std-ref">SIE</span></a>), which yields an erroneous self-repulsion of the dense core orbitals, and results in too low core-excitation energies.</p></li>
</ol>
<p>For B3LYP, the combined effect of these two errors results in too low transition energies, meaning that the SIE dominates. By changing the amount of HF exchange, this balance will shift and the error eventually becomes positive.</p>
<p>Despite this large absolute error, the TDDFT spectrum is in reasonable agreement with experiment once it has been shifted. In general, different xc-functionals <a class="reference internal" href="xray_rec.html#sec-xray-precision"><span class="std std-ref">can exhibit</span></a> good precision (relative errors), despite poor accuracy (absolute errors), such that a constant shift in energy can be applied.</p>
</section>
<section id="spectra-from-cpp-casscf">
<h3>Spectra from CPP-CASSCF<a class="headerlink" href="#spectra-from-cpp-casscf" title="Permalink to this headline">#</a></h3>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">OrbSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">space</span><span class="o">.</span><span class="n">CASOrb</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">])</span>

<span class="n">mcscf_drv</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">McscfDriver</span><span class="p">()</span>
<span class="n">mcscf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>

<span class="n">mcscf_cpp</span> <span class="o">=</span> <span class="n">mtp</span><span class="o">.</span><span class="n">Mclr_CPPsolver2</span><span class="p">()</span>
<span class="n">mcscf_cpp</span><span class="o">.</span><span class="n">set_damping</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">mcscf_cpp</span><span class="o">.</span><span class="n">set_frequency_range</span><span class="p">(</span><span class="mi">540</span><span class="p">,</span><span class="mi">550</span><span class="p">,</span><span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">rspdict</span> <span class="o">=</span> <span class="n">mcscf_cpp</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">mcscf_drv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mcscf_cpp</span><span class="o">.</span><span class="n">produce_plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/xray_calc_36_0.png" src="../../_images/xray_calc_36_0.png" />
</div>
</div>
</section>
</section>
<section id="x-ray-emission-spectroscopy">
<span id="sec-xray-calc-xes"></span><h2>X-ray emission spectroscopy<a class="headerlink" href="#x-ray-emission-spectroscopy" title="Permalink to this headline">#</a></h2>
<p>Following the creation of a core-hole, the system will rapidly (<span class="math notranslate nohighlight">\(\sim\)</span>fs) decay to a valence-hole or valence-excited state, depending on whether the system is core-ionized or core-excited. These two different intermediate states  are probed when the X-ray pulse is in resonance (excited regime) or not (ionized regime), yielding resonant/non-resonant X-ray emission spectroscopy. This section will focus on the latter, with the former following in the <a class="reference internal" href="#sec-xray-calc-rixs"><span class="std std-ref">next section</span></a>.</p>
<p>In the decay process the system gains large amounts of energy which need to be discarded, as can occur by emission of high-energy photons (fluorescence) or high-lying electrons (Auger), with relative probability depending on edge and element. For the <em>K</em>-edge the relative probabilities follow the following trends, with figure taken from <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Auger_xray_wiki_in_png_format.png">wikipedia.org</a>:</p>
<figure class="align-default" id="auger-vs-fluorescent">
<img alt="../../_images/auger_vs_fluorescent.png" src="../../_images/auger_vs_fluorescent.png" />
</figure>
<p>Auger decay dominates for light elements, which has impact on both our ability of obtaining well-resolved spectra for these elements, as well as the impact of X-ray damage on biological matter.</p>
<p>In non-resonant XES we measure the fluorescent decay of core-ionized states, through which we probe the (element-specific) nature of the local chemical environment. For light elements, the valence space is probed directly, but for heavier elements we obtain a number of different decay channels from the valence region and the outer core region. These lines vary considerably in energy, intensity, and sensitivity to local environment <span id="id12">[<a class="reference internal" href="../refs.html#id53" title="J. K. Kowalska, F. A. Lima, C. J. Pollock, J. A. Rees, and S. DeBeer. A practical guide to high-resolution x-ray spectroscopic measurements and their applications in bioinorganic chemistry. Isr. J. Chem., 56:803-815, 2016. URL: https://doi.org/10.1002/ijch.201600037.">KLP+16</a>]</span>:</p>
<ol class="simple">
<li><p>The <span class="math notranslate nohighlight">\(2p \rightarrow 1s\)</span> (<span class="math notranslate nohighlight">\(K\alpha_1\)</span> and <span class="math notranslate nohighlight">\(K\alpha_2\)</span>) lines are most intense (due to the large overlap) and of lowest energy, and relatively insensitive to the valence region</p></li>
<li><p>The <span class="math notranslate nohighlight">\(3p \rightarrow 1s\)</span> (<span class="math notranslate nohighlight">\(K\beta ' \)</span> and <span class="math notranslate nohighlight">\(K\beta_{1,3}\)</span>) lines are higher in energy and more sensitive to the local environment than <span class="math notranslate nohighlight">\(K\alpha\)</span>, but about an order of magnitude weaker.</p></li>
<li><p>Transitions from the ligand MOs (<span class="math notranslate nohighlight">\(K\beta '' \)</span> and <span class="math notranslate nohighlight">\(K\beta_{2,5}\)</span>), or valence-to-core (VtC), yield the weakest, highest-energy features, which are the most sensitive to the local environment</p></li>
</ol>
<p>This tutorial focuses on spectra of light elements, as modelled by ground state DFT, TDDFT, and ADC. Good starting points for learning about such modeling techniques can be found in <span id="id13">[<a class="reference internal" href="../refs.html#id11" title="N. A. Besley. Modeling of the spectroscopy of core electrons with density functional theory. WIREs Comput. Mol. Sci, 2021. URL: https://doi.org/10.1002/wcms.1527.">Bes21</a>, <a class="reference internal" href="../refs.html#id12" title="N. A. Besley and F. A. Asmuruf. Time-dependent density functional theory calculations of the spectroscopy of core electrons. Phys. Chem. Chem. Phys., 12:12024-12039, 2010. URL: https://doi.org/10.1039/C002207A.">BA10</a>, <a class="reference internal" href="../refs.html#id29" title="T. Fransson and A. Dreuw. Simulating x-ray emission spectroscopy with algebraic diagrammatic construction schemes for the polarization propagator. J. Chem. Theory Comput., 15:546-556, 2019. URL: https://doi.org/10.1021/acs.jctc.8b01046.">FD19</a>]</span>.</p>
<section id="spectra-from-adc">
<span id="sec-xray-calc-xesadc"></span><h3>Spectra from ADC<a class="headerlink" href="#spectra-from-adc" title="Permalink to this headline">#</a></h3>
<p>One approach for considering X-ray emission spectra is to converge a core-hole state and use this core-ionized system as the reference state for a normal excited state calculation <span id="id14">[<a class="reference internal" href="../refs.html#id12" title="N. A. Besley and F. A. Asmuruf. Time-dependent density functional theory calculations of the spectroscopy of core electrons. Phys. Chem. Chem. Phys., 12:12024-12039, 2010. URL: https://doi.org/10.1039/C002207A.">BA10</a>, <a class="reference internal" href="../refs.html#id29" title="T. Fransson and A. Dreuw. Simulating x-ray emission spectroscopy with algebraic diagrammatic construction schemes for the polarization propagator. J. Chem. Theory Comput., 15:546-556, 2019. URL: https://doi.org/10.1021/acs.jctc.8b01046.">FD19</a>]</span>. The core-decay transitions are then the first negative eigenstates of the system, such that a standard Davidson calculation can be run on top of this reference state.</p>
<p>Considering water with ADC(2), the oxygen X-ray emission spectrum is calculated as:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently considering double-core-hole, as adcc cannot yet use an unrestricted SCF from VeloxChem.</p>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create veloxchem mol and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-311G&quot;</span><span class="p">)</span>

<span class="c1"># Perform SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_result</span> <span class="o">=</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Copy molecule object</span>
<span class="n">mol_ion</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">molecule</span><span class="p">)</span>

<span class="c1"># Change charge and multiplicity</span>
<span class="n">mol_ion</span><span class="o">.</span><span class="n">set_charge</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mol_ion</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Lists of occupied alpha and beta MOs</span>
<span class="n">occa</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">occb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="c1"># Calculate SCF of core-ion</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">maximum_overlap</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">,</span> <span class="n">occa</span><span class="p">,</span> <span class="n">occb</span><span class="p">)</span>
<span class="n">scf_ion_result</span> <span class="o">=</span> <span class="n">scf_ion</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># IE from energy difference</span>
<span class="n">hf_ie</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_gs</span><span class="o">.</span><span class="n">get_scf_energy</span><span class="p">())</span>

<span class="c1"># Set up mock task for adcc</span>
<span class="n">task</span> <span class="o">=</span> <span class="n">MockTask</span><span class="p">(</span><span class="n">mol_ion</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_ion</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">scf_ion</span><span class="o">.</span><span class="n">ostream</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">task</span> <span class="o">=</span> <span class="n">task</span>

<span class="c1"># Four lowest (negative) eigenstates</span>
<span class="n">adc_xes</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There may be convergence issues if you include transitions of very different types, <em>e.g.</em> when resolving transitions into the core and out to the unoccupied valence region simultaneously. As such, the number of required states should not be too high.</p>
</div>
<p>The results can be printed as a table, and convoluted and plotted using built-in functionalities or a custom broadening. Note that the eigenvalues are negative, and a sign change is thus appropriate when constructing the spectra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print information on eigenstates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Convolute using functionalities available in gator and adcc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Built-in broadening [note negative energies]&quot;</span><span class="p">)</span>
<span class="n">adc_xes</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>

<span class="c1"># Convoluted using information on excitation energies and oscillator strengths</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Custom broadening&quot;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_xes</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xes</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">598</span><span class="p">,</span> <span class="mi">603</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Photon energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cross section [au]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| adc2                                        any ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0     -22.20632     -604.2647   0.0000    0.9644   0.03563  |
|  1     -22.15933      -602.986   0.0000    0.9622   0.03785  |
|  2     -22.09183     -601.1495   0.1612    0.9588   0.04123  |
|  3     -22.04624     -599.9086   0.1409    0.9561   0.04391  |
+--------------------------------------------------------------+
</pre></div>
</div>
<img alt="../../_images/xray_calc_40_1.png" src="../../_images/xray_calc_40_1.png" />
</div>
</div>
<p>Using a cc-pCVTZ/cc-pVTZ basis set and comparing to <a class="reference external" href="https://aip.scitation.org/doi/10.1063/1.3702644">experiment</a>, where theoretical spectrum shifted by 0.37 eV (to account for relativistic effects) and broadened by 0.3 eV:</p>
<figure class="align-default" id="adc-water-xes">
<img alt="../../_images/adc_water_xes.svg" src="../../_images/adc_water_xes.svg" /></figure>
<p>While the broadening between the different lines is noticeably different, it is clear that the energy spacing and integrated intensities of the features are in good agreement with experiment. The theoretical spectrum is obtained at the ADC(2) level of theory, which has been seen to yield better absolute energies than ADC(2)-x and ADC(3/2) (for XES) <span id="id15">[<a class="reference internal" href="../refs.html#id29" title="T. Fransson and A. Dreuw. Simulating x-ray emission spectroscopy with algebraic diagrammatic construction schemes for the polarization propagator. J. Chem. Theory Comput., 15:546-556, 2019. URL: https://doi.org/10.1021/acs.jctc.8b01046.">FD19</a>]</span>.</p>
</section>
<section id="sec-xray-calc-xesdft">
<span id="id16"></span><h3>Spectra from TDDFT<a class="headerlink" href="#sec-xray-calc-xesdft" title="Permalink to this headline">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</section>
<section id="spectra-from-ground-state-mos">
<span id="sec-xray-calc-xesmos"></span><h3>Spectra from ground state MOs<a class="headerlink" href="#spectra-from-ground-state-mos" title="Permalink to this headline">#</a></h3>
<p>While we have previously seen that Koopmans’ theorem is in significant disagreement with experimental ionization energies (due to lack of relaxation), it has been noted that the <em>relative</em> position of the (valence) MO energies can still be quite reasonable <span id="id17">[<a class="reference internal" href="../refs.html#id11" title="N. A. Besley. Modeling of the spectroscopy of core electrons with density functional theory. WIREs Comput. Mol. Sci, 2021. URL: https://doi.org/10.1002/wcms.1527.">Bes21</a>]</span>. As such, a computationally simple approach for modeling X-ray emission spectra has been developed, in which transition energies are estimated from:</p>
<div class="math notranslate nohighlight">
\[
\Delta E = \epsilon_v - \epsilon_c
\]</div>
<p><em>i.e.</em> from the difference in ground state MO energies. The intensities are taken to be proportional to the transition dipole moment:</p>
<div class="math notranslate nohighlight">
\[
f \propto | \langle \phi_i | \hat{\mu} | \phi_c \rangle | ^2
\]</div>
<p>This independent-particle picture method is very attractive in its simplicity, requiring only a single ground state calculation and the construction of a number of transition dipole moments in order to construct the full spectrum. However, the absolute energies are significantly off, and any differences in relaxation between the different channels will not be accounted for, and multichannel and many-body effects are neglected. Nevertheless, this approach has been noted to yield good (relative) agreement to experimental measurements, and it is capable of considering even massive molecular systems.</p>
<p>The calculation of an emission spectra thus requires the calculation of the ground state and of all relevant transition dipole moments:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule and basis objects</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">from_xyz_string</span><span class="p">(</span><span class="n">water_xyz</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF settings and calculation</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;conv_thresh&quot;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xcfun&quot;</span><span class="p">:</span> <span class="s2">&quot;b3lyp&quot;</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span> <span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_result</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract orbital energies and number of occupied MOs</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">]</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Occupied MO energies:&quot;</span><span class="p">,</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">orbital_energies</span><span class="p">[:</span><span class="n">nocc</span><span class="p">])</span>

<span class="c1"># Define probed core MO and calculate energy differences</span>
<span class="n">n_core</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">energy_diff</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n_mo</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_mo</span> <span class="o">!=</span> <span class="n">n_core</span><span class="p">:</span>
        <span class="n">energy_diff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span> <span class="o">*</span> <span class="p">(</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">n_mo</span><span class="p">]</span> <span class="o">-</span> <span class="n">orbital_energies</span><span class="p">[</span><span class="n">n_core</span><span class="p">]))</span>

<span class="c1"># Extract MO coefficients</span>
<span class="n">mo_C</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span>

<span class="c1"># Load drivers for transition dipole moment</span>
<span class="n">dipole_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ElectricDipoleIntegralsDriver</span><span class="p">()</span>

<span class="c1"># Calculated transition dipole moments and convert to MO basis</span>
<span class="n">dipole_matrices</span> <span class="o">=</span> <span class="n">dipole_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">x_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">x_to_numpy</span><span class="p">()</span>
<span class="n">x_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mo_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x_ao</span><span class="p">,</span> <span class="n">mo_C</span><span class="p">))</span>
<span class="n">y_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">y_to_numpy</span><span class="p">()</span>
<span class="n">y_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mo_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">y_ao</span><span class="p">,</span> <span class="n">mo_C</span><span class="p">))</span>
<span class="n">z_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">z_to_numpy</span><span class="p">()</span>
<span class="n">z_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">mo_C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">z_ao</span><span class="p">,</span> <span class="n">mo_C</span><span class="p">))</span>

<span class="c1"># Construct oscillator strengths</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n_mo</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_mo</span> <span class="o">!=</span> <span class="n">n_core</span><span class="p">:</span>
        <span class="n">x_tmp</span><span class="p">,</span> <span class="n">y_tmp</span><span class="p">,</span> <span class="n">z_tmp</span> <span class="o">=</span> <span class="n">x_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span> <span class="n">n_mo</span><span class="p">],</span> <span class="n">y_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span> <span class="n">n_mo</span><span class="p">],</span> <span class="n">z_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span> <span class="n">n_mo</span><span class="p">]</span>
        <span class="n">xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">)</span>
        <span class="n">yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">)</span>
        <span class="n">zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">)</span>
        <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_tmp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y_tmp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z_tmp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Occupied MO energies: [-520.65709503  -27.6878928   -14.39952882   -9.70377531   -7.94952958]
</pre></div>
</div>
</div>
</div>
<p>The results can be printed as a table, and convoluted and plotted using a custom broadening. We here focus on the high-energy features:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print results as a table</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Energy   Osc. str.   x-component   y-component   z-component&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_diff</span><span class="p">)):</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">energy_diff</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">  </span><span class="si">{:8.5f}</span><span class="s2">     </span><span class="si">{:8.5f}</span><span class="s2">      </span><span class="si">{:8.5f}</span><span class="s2">      </span><span class="si">{:8.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Plot X-ray emission spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">energy_diff</span><span class="p">,</span> <span class="n">sigma</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Photon energy [eV]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity [arb. units]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">504</span><span class="p">,</span> <span class="mi">514</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy   Osc. str.   x-component   y-component   z-component
492.969   0.00022     -0.00000      -0.00000      -0.01478
506.258   0.00238      0.04878      -0.00000       0.00000
510.953   0.00255      0.00000      -0.00000       0.05050
512.708   0.00342     -0.00000       0.05848       0.00000
</pre></div>
</div>
<img alt="../../_images/xray_calc_46_1.png" src="../../_images/xray_calc_46_1.png" />
</div>
</div>
<p>Using a cc-pCVTZ/cc-pVTZ basis set and comparing to experiment <span id="id18">[<a class="reference internal" href="../refs.html#id105" title="L. Weinhardt, A. Benkert, F. Meyer, M. Blum, R. G. Wilks, W. Yang, M. Bär, F. Reinert, and C. Heske. Nuclear dynamics and spectator effects in resonant inelastic soft x-ray scattering of gas-phase water molecules. J. Chem. Phys., 136:144311, 2012. URL: https://doi.org/10.1063/1.3702644.">WBM+12</a>]</span>, where theoretical spectrum shifted by 15.5 eV and broadened by 0.3 eV:</p>
<figure class="align-default" id="overlap-water-xes">
<img alt="../../_images/overlap_water_xes.svg" src="../../_images/overlap_water_xes.svg" /></figure>
<p>The resulting spectrum has poor absolute energies, but the relative agreement to experiment is quite impressive.</p>
</section>
</section>
<section id="resonant-inelastic-x-ray-scattering">
<span id="sec-xray-calc-rixs"></span><h2>Resonant inelastic X-ray scattering<a class="headerlink" href="#resonant-inelastic-x-ray-scattering" title="Permalink to this headline">#</a></h2>
<p>We will here focus on calculating the electronic part of the RIXS plane, and skip cases where one is more interested in probing vibrational modes.</p>
<section id="two-step-approach-with-adc">
<span id="sec-xray-calc-2stepadc"></span><h3>Two-step approach with ADC<a class="headerlink" href="#two-step-approach-with-adc" title="Permalink to this headline">#</a></h3>
<p>An approximate treatment of the RIXS plane can be achieved by considering it as a two-step process <span id="id19">[<a class="reference internal" href="../refs.html#id26" title="A. E. A. Fouda, G. I. Purnell, and N. A. Besley. Simulation of ultra-fast dynamics effects in resonant inelastic x-ray scattering of gas-phase water. J. Chem. Theory Comput., 14:2586-2595, 2018. URL: https://doi.org/10.1021/acs.jctc.8b00211.">FPB18</a>]</span>, with:</p>
<ol class="simple">
<li><p>A core-excitation as modeled like a normal X-ray absorption spectrum</p></li>
<li><p>A core-decay process from the core-hole system with an electron put in each relevant final state probed in (1), modeled as a (non-resonant) X-ray emission spectrum</p></li>
</ol>
<p>The RIXS plane is then constructed from the above absorption and emission energies, with the RIXS intensity from the multiplication of the two respective oscillator strengths.</p>
<p>Note that this approach is an approximation, as it disregards potentially important detuning effects. In the example given below we also ignore the coupling between the polarization of the incoming and outgoing photons. Furthermore, the calculation requires the convergence of core-excited states, which is much trickier than core-ionized, and will likely only work for the first few core-excited states. Finally, depending on how the intermediate core-excited state is constructed, issues with spin-contamination can become highly influential.</p>
<p>Nevertheless, the scheme is quite easy to understand, and introducing core-excited dynamics is relatively straightforward. As such, we here illustrate how the RIXS plane of water can be constructed. First, calculate the X-ray absorption spectrum, as well as the emission spectra with a core-excited reference state:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is to be updated, once adcc can import an UHF object from VeloxChem.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pyscf mol object</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="n">water_xyz</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s2">&quot;6-31G&quot;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform restricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Calculate X-ray absorption spectrum</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_gs</span><span class="p">,</span> <span class="n">n_singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Perform unrestricted SCF calculation</span>
<span class="n">scf_gs</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_gs</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Calculate resonant X-ray emission spectrum</span>
<span class="c1">#   for states where the core-electron is moved to LUMO or LUMO+1</span>
<span class="n">adc_rxes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
    <span class="c1"># Copy molecular orbitals</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_gs</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="c1"># Move 1s electron to LUMO / LUMO+1</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="c1"># Perform unrestricted SCF calculation with MOM constraint</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Calculate resonant X-ray emission spectrum</span>
    <span class="n">adc_rxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>Now the correct combinations of transition energies and intensities need to be calculated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">adc_rixs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Probing LUMO and LUMO+1</span>
<span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="c1"># From XAS calculation</span>
    <span class="n">E_xas</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="n">I_xas</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="c1"># From XES calculation</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_rxes</span><span class="p">[</span><span class="n">indx</span><span class="p">])):</span>
        <span class="n">E_xes</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">I_xes</span> <span class="o">=</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">adc_rixs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">E_xas</span><span class="p">,</span> <span class="n">E_xes</span><span class="p">,</span> <span class="n">I_xas</span> <span class="o">*</span> <span class="n">I_xes</span><span class="p">])</span>
</pre></div>
</div>
<p>And the RIXS plane can then be plotted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot absorption spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span>

<span class="c1"># Plot emission specta, with vertical shift from absorbed energy</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="c1"># LUMO</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">+</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># LUMO+1</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rxes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">+</span> <span class="n">au2ev</span> <span class="o">*</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Plot RIXS plane, here with marker size scaling with intensity</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adc_rixs</span><span class="p">)):</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">adc_rixs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10000</span> <span class="o">*</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># Zooming in to region spanned by XAS and XES projections</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">519</span><span class="p">,</span> <span class="mi">530</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">536</span><span class="p">,</span> <span class="mi">544</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default" id="adc-2st-rixs">
<img alt="../../_images/adc_2st_rixs.svg" src="../../_images/adc_2st_rixs.svg" /></figure>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs/tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="xray.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">X-ray spectroscopies</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="xray_analysis.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Spectrum analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The eChem team<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>