
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Configuration interaction &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Hartree–Fock" href="scf-response.html" />
    <link rel="prev" title="Exact states" href="exact-response.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="uv-vis.html">
   UV/vis absorption/emission
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="uv-vis_rec.html">
     Recommendations
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="ir.html">
     IR spectroscopy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="raman.html">
     Raman spectroscopy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="xray.html">
   X-ray spectroscopies
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_calc.html">
     Spectrum calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_analysis.html">
     Spectrum analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_aspects.html">
     Special aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_large.html">
     Larger systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_nonstandard.html">
     Non-standard calculations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_rec.html">
     Recommendations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="xray_exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mcscf.html">
     Multiconfigurational methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kernel_integration.html">
     Kernel integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="dft_scf.html">
     SCF optimization of a closed-shell state
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradients.html">
     Gradients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hessians.html">
     Hessians and vibrations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="structopt.html">
   Molecular structure optimization
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="gsstructopt.html">
     Ground state structure optimization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="impes.html">
   Potential Energy Surfaces by Interpolation
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="md_ffs.html">
     Force field parameterization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_setup.html">
     Ensembles and time integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_run.html">
     Running a simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="md_biased.html">
     Biased molecular dynamics
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     Hartree–Fock
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tddft.html">
     TDDFT
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="localprop.html">
   Localized properties
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="esp.html">
     ESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="resp.html">
     RESP charges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="loprop.html">
     LoProp charges and polarizabilities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Structure and orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-excited.html">
   Visualizing excited states
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="refs.html">
   References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/ci-response.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kthpanor/echem"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kthpanor/echem/issues/new?title=Issue%20on%20page%20%2Fdocs/ci-response.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kthpanor/echem/master?urlpath=tree/docs/docs/ci-response.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#full-ci">
   Full CI
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#truncated-ci-response">
   Truncated CI response
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mcscf-and-state-averaging">
   MCSCF and state-averaging
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="configuration-interaction">
<h1>Configuration interaction<a class="headerlink" href="#configuration-interaction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="full-ci">
<h2>Full CI<a class="headerlink" href="#full-ci" title="Permalink to this headline">¶</a></h2>
<p>As we saw in the previous section, for an exact state, we have the formula:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  \langle \langle \hat{\Omega}; \hat{V}^{\omega} \rangle
  \rangle  = -
  \frac{1}{\hbar} \sum_{n&gt;0} \left[
  \frac{\langle 0 | \hat{\Omega}  | n \rangle 
	\langle n | \hat{V}^{\omega} | 0 \rangle }
       {\omega_{n0}-\omega}
+
  \frac{\langle 0 | \hat{V}^{\omega}  | n \rangle 
	\langle n | \hat{\Omega} | 0 \rangle }
       {\omega_{n0}+\omega} \right] .
\end{equation*}\]</div>
<p>For example, in the case of a molecule iradiating by light, we are interested in computing the polarizability <span class="math notranslate nohighlight">\(\alpha_{\alpha\beta}(-\omega; \omega)\)</span>, corresponding to the response with <span class="math notranslate nohighlight">\(\hat{\Omega} = \hat{\mu}_\alpha\)</span> and <span class="math notranslate nohighlight">\(\hat{V}^\omega = - \hat{\mu}_\beta\)</span>. Looking more precisely at the isotropic component, <span class="math notranslate nohighlight">\(\bar\alpha (-\omega; \omega) = \frac{1}{3} \sum_\alpha \alpha_{\alpha\alpha} (-\omega; \omega)\)</span>, we obtain:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  \bar\alpha (-\omega; \omega) = \frac{2}{3} \sum_{n&gt;0} \sum_\alpha \frac{ \omega_{n0} \langle 0 | \hat{\mu}_\alpha  | n \rangle^2 }{ \omega_{n0}^2 - \omega^2 }
\end{equation*}\]</div>
<p>We now define the oscillator strength <span class="math notranslate nohighlight">\(f_n\)</span> for a transition <span class="math notranslate nohighlight">\(0 \rightarrow n\)</span> as:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  f_n =  \frac{2}{3} \sum_\alpha \omega_{n0} \langle 0 | \hat{\mu}_\alpha  | n \rangle^2
\end{equation*}\]</div>
<p>such that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
  \bar\alpha (-\omega; \omega) =  \sum_{n&gt;0}  \frac{ fn }{ \omega_{n0}^2 - \omega^2 }
\end{equation*}\]</div>
<p>Those formulas can be applied directly for a configuration interaction wavefunction, where it is easy to get the excited state energies simply by obtaining additional roots in the diagonalization of the Hamiltonian. We then only need to compute the matrix element <span class="math notranslate nohighlight">\(\langle 0 | \hat{\mu}_\alpha  | n \rangle\)</span>. In second quantization, the dipole operator can be written:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\hat{\mu}_{\alpha} = \sum_{pq} \mu_{\alpha pq} \hat{a}_p^\dagger \hat{a}_q .
\end{equation*}\]</div>
<p>We thus need to compute the matrix <span class="math notranslate nohighlight">\(\gamma\)</span>, with elements <span class="math notranslate nohighlight">\( \gamma_{pq} =\langle 0 |\hat{a}_p^\dagger \hat{a}_q | n \rangle\)</span>, which is called the transition density matrix, and contract it with the dipole moment integrals.</p>
<p>Let’s apply these for fullCI of a water molecule:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">multipsi</span> <span class="k">as</span> <span class="nn">mtp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Warning * Environment variable OMP_NUM_THREADS not set.
* Warning * Setting OMP_NUM_THREADS to 4.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mf">4e61304338</span><span class="n">bf</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">multipsi</span> <span class="k">as</span> <span class="nn">mtp</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;multipsi&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the 5 lowest states of water using full CI</span>

<span class="n">mol_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">mol_str</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31g&quot;</span><span class="p">)</span>

<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">()</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="n">space</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">MolSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">space</span><span class="o">.</span><span class="n">CAS</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span> <span class="c1">#FullCI with frozen 1s orbital</span>

<span class="n">nstates</span><span class="o">=</span><span class="mi">5</span>
<span class="n">cidrv</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">CIDriver</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">space</span><span class="p">)</span>
<span class="n">cidrv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">nstates</span><span class="p">)</span>

<span class="n">CIVecs</span><span class="o">=</span><span class="n">cidrv</span><span class="o">.</span><span class="n">vecs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                            Self Consistent Field Driver Setup                                            
                                           ====================================                                           
                                                                                                                          
                   Wave Function Model             : Spin-Restricted Hartree-Fock                                         
                   Initial Guess Model             : Superposition of Atomic Densities                                    
                   Convergence Accelerator         : Two Level Direct Inversion of Iterative Subspace                     
                   Max. Number of Iterations       : 50                                                                   
                   Max. Number of Error Vectors    : 10                                                                   
                   Convergence Threshold           : 1.0e-06                                                              
                   ERI Screening Scheme            : Cauchy Schwarz + Density                                             
                   ERI Screening Mode              : Dynamic                                                              
                   ERI Screening Threshold         : 1.0e-12                                                              
                   Linear Dependence Threshold     : 1.0e-06                                                              
                                                                                                                          
* Info * Nuclear repulsion energy: 9.1561447194 a.u.                                                                      
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
* Info * SAD initial guess computed in 0.00 sec.                                                                          
                                                                                                                          
* Info * Starting Reduced Basis SCF calculation...                                                                        
* Info * ...done. SCF energy in reduced basis set: -75.983870205311 a.u. Time: 0.14 sec.                                  
                                                                                                                          
* Info * Overlap matrix computed in 0.00 sec.                                                                             
                                                                                                                          
* Info * Kinetic energy matrix computed in 0.00 sec.                                                                      
                                                                                                                          
* Info * Nuclear potential matrix computed in 0.00 sec.                                                                   
                                                                                                                          
* Info * Orthogonalization matrix computed in 0.00 sec.                                                                   
                                                                                                                          
                                                                                                                          
               Iter. | Hartree-Fock Energy | Energy Change | Gradient Norm | Max. Gradient | Density Change               
               --------------------------------------------------------------------------------------------               
                  1       -75.983870373952    0.0000000000      0.00006826      0.00001638      0.00000000                
                  2       -75.983870375702   -0.0000000017      0.00002636      0.00000475      0.00006304                
                  3       -75.983870375765   -0.0000000001      0.00000396      0.00000061      0.00000524                
                  4       -75.983870375769   -0.0000000000      0.00000029      0.00000008      0.00000296                
                                                                                                                          
* Info * SCF tensors written to file: scf.tensors.h5                                                                      
                                                                                                                          
               *** SCF converged in 4 iterations. Time: 0.11 sec.                                                         
                                                                                                                          
               Spin-Restricted Hartree-Fock:                                                                              
               -----------------------------                                                                              
               Total Energy                       :      -75.9838703758 a.u.                                              
               Electronic Energy                  :      -85.1400150952 a.u.                                              
               Nuclear Repulsion Energy           :        9.1561447194 a.u.                                              
               ------------------------------------                                                                       
               Gradient Norm                      :        0.0000002874 a.u.                                              
                                                                                                                          
                                                                                                                          
               Ground State Information                                                                                   
               ------------------------                                                                                   
               Charge of Molecule            :  0.0                                                                       
               Multiplicity (2S+1)           :  1.0                                                                       
               Magnetic Quantum Number (M_S) :  0.0                                                                       
                                                                                                                          
                                                                                                                          
                                                 Spin Restricted Orbitals                                                 
                                                 ------------------------                                                 
                                                                                                                          
               Molecular Orbital No.   1:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:  -20.56128 a.u.                                                                    
               (   1 O   1s  :    -1.00)                                                                                  
                                                                                                                          
               Molecular Orbital No.   2:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -1.35434 a.u.                                                                    
               (   1 O   1s  :     0.21) (   1 O   2s  :    -0.47) (   1 O   3s  :    -0.48)                              
                                                                                                                          
               Molecular Orbital No.   3:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.70774 a.u.                                                                    
               (   1 O   1p+1:    -0.51) (   1 O   2p+1:    -0.27) (   2 H   1s  :     0.26)                              
               (   3 H   1s  :    -0.26)                                                                                  
                                                                                                                          
               Molecular Orbital No.   4:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.56024 a.u.                                                                    
               (   1 O   2s  :     0.18) (   1 O   3s  :     0.31) (   1 O   1p0 :     0.55)                              
               (   1 O   2p0 :     0.40)                                                                                  
                                                                                                                          
               Molecular Orbital No.   5:                                                                                 
               --------------------------                                                                                 
               Occupation: 2.0 Energy:   -0.50122 a.u.                                                                    
               (   1 O   1p-1:    -0.64) (   1 O   2p-1:    -0.51)                                                        
                                                                                                                          
               Molecular Orbital No.   6:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.20280 a.u.                                                                    
               (   1 O   3s  :     1.17) (   1 O   1p0 :    -0.23) (   1 O   2p0 :    -0.48)                              
               (   2 H   2s  :    -0.99) (   3 H   2s  :    -0.99)                                                        
                                                                                                                          
               Molecular Orbital No.   7:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    0.29874 a.u.                                                                    
               (   1 O   1p+1:     0.34) (   1 O   2p+1:     0.82) (   2 H   2s  :     1.38)                              
               (   3 H   2s  :    -1.38)                                                                                  
                                                                                                                          
               Molecular Orbital No.   8:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    1.05548 a.u.                                                                    
               (   1 O   2p+1:    -0.74) (   2 H   1s  :    -0.97) (   2 H   2s  :     0.50)                              
               (   3 H   1s  :     0.97) (   3 H   2s  :    -0.50)                                                        
                                                                                                                          
               Molecular Orbital No.   9:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    1.16442 a.u.                                                                    
               (   1 O   1p-1:    -0.96) (   1 O   2p-1:     1.04)                                                        
                                                                                                                          
               Molecular Orbital No.  10:                                                                                 
               --------------------------                                                                                 
               Occupation: 0.0 Energy:    1.18237 a.u.                                                                    
               (   1 O   2s  :     0.26) (   1 O   3s  :    -0.18) (   1 O   1p0 :    -0.67)                              
               (   1 O   2p0 :     0.22) (   2 H   1s  :    -0.84) (   2 H   2s  :     0.55)                              
               (   3 H   1s  :    -0.84) (   3 H   2s  :     0.55)                                                        
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 1
Number of active orbitals:              12
Number of virtual orbitals:             0

    This is a CASSCF wavefunction: CAS(8,12)

          CI expansion:
          -------------
Number of determinants:      122760



        CI Iterations
        -------------

Iteration   Average energy      Time
     1        -75.70818500   0:00:00
     2        -75.79312782   0:00:00
     3        -75.79986118   0:00:00
     4        -75.80050854   0:00:00
     5        -75.80056538   0:00:00
     6        -75.80057423   0:00:00
     7        -75.80057513   0:00:00
     8        -75.80057529   0:00:01
     9        -75.80057533   0:00:00
    10        -75.80057534   0:00:00
    11        -75.80057534   0:00:00
Convergence reached in 11 iterations

        Final results
        -------------

* State 1
- Energy: -76.12020540305298
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.98825 1.98065 1.97145 1.96801 0.02821 0.02666 0.01813 0.01218 0.00310
 0.00222 0.00063 0.00050]

* State 2
- Energy: -75.8096766326332
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.98999 0.99416 1.97826 1.96500 0.03529 0.99612 0.00679 0.00969 0.00360
 0.00263 0.00250 0.99612]

* State 3
- Energy: -75.72755706157517
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.98934 0.99423 1.96858 1.97697 0.99438 0.03496 0.00671 0.01152 0.00381
 0.00220 0.01394 0.00335]

* State 4
- Energy: -75.7168248247486
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.98622 1.98084 0.84833 1.95656 0.04126 0.01163 0.01796 0.00636 0.00283
 0.00240 0.00360 0.01163]

* State 5
- Energy: -75.62861277592349
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.98447 1.98207 1.01098 1.95661 0.97797 0.04117 0.01636 0.00643 0.00370
 0.00204 0.01380 0.00441]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>

<span class="c1">#Get the molecular orbitals within the active space</span>
<span class="n">C</span><span class="o">=</span><span class="n">space</span><span class="o">.</span><span class="n">getMOAct</span><span class="p">()</span>

<span class="c1">#Compute dipole integrals in AO basis</span>
<span class="n">dipole_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ElectricDipoleIntegralsDriver</span><span class="p">()</span>
<span class="n">dipole_mats</span> <span class="o">=</span> <span class="n">dipole_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">dipole</span><span class="o">=</span><span class="p">[</span><span class="n">dipole_mats</span><span class="o">.</span><span class="n">x_to_numpy</span><span class="p">(),</span><span class="n">dipole_mats</span><span class="o">.</span><span class="n">y_to_numpy</span><span class="p">(),</span><span class="n">dipole_mats</span><span class="o">.</span><span class="n">z_to_numpy</span><span class="p">()]</span>

<span class="c1">#Transform to MO basis</span>
<span class="n">dipole_mo</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">icomp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">dipole_mo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pq,pt,qu-&gt;tu&#39;</span><span class="p">,</span> <span class="n">dipole</span><span class="p">[</span><span class="n">icomp</span><span class="p">],</span> <span class="n">C</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
    

<span class="c1">#Initialize the CIHam class to compute the transition densities.</span>
<span class="n">expansion</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">CIExpansion</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
<span class="n">Ham</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">CIHam</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">expansion</span><span class="p">)</span>
        
<span class="c1">#Compute all 0-&gt;n transitions</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nstates</span><span class="p">):</span>
    <span class="n">dE</span><span class="o">=</span><span class="n">CIVecs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">energy</span><span class="o">-</span><span class="n">CIVecs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">energy</span>
    <span class="n">tden</span><span class="o">=</span><span class="n">Ham</span><span class="o">.</span><span class="n">get1den</span><span class="p">(</span><span class="n">CIVecs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">CIVecs</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="c1">#Transition density matrix</span>
    <span class="n">dx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">tden</span><span class="p">,</span><span class="n">dipole_mo</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#&lt;0|x|n&gt;</span>
    <span class="n">dy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">tden</span><span class="p">,</span><span class="n">dipole_mo</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#&lt;0|y|n&gt;</span>
    <span class="n">dz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">tden</span><span class="p">,</span><span class="n">dipole_mo</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">#&lt;0|z|n&gt;</span>
    <span class="n">F</span><span class="o">=</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">dE</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="n">dy</span><span class="o">*</span><span class="n">dy</span><span class="o">+</span><span class="n">dz</span><span class="o">*</span><span class="n">dz</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Excitation 0-&gt;&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot; energy:&quot;</span><span class="p">,</span><span class="n">dE</span><span class="o">*</span><span class="n">au2ev</span><span class="p">,</span><span class="s2">&quot;eV oscillator strength:&quot;</span><span class="p">,</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Excitation 0-&gt; 1  energy: 8.449918235997995 eV oscillator strength: 0.013189367950821679
Excitation 0-&gt; 2  energy: 10.684505582212472 eV oscillator strength: 4.810363952783399e-27
Excitation 0-&gt; 3  energy: 10.976544621143681 eV oscillator strength: 0.11535380248475297
Excitation 0-&gt; 4  energy: 13.376916731574683 eV oscillator strength: 0.11498821812125111
</pre></div>
</div>
</div>
</div>
<p>We thus obtain 3 visible transitions and one dark state (near-zero dipole oscillator strength). We obtain the exact same result by using the built-in class of multipsi:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SI</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">InterState</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">CIVecs</span><span class="p">)</span>
<span class="n">DipOsc</span><span class="o">=</span><span class="n">SI</span><span class="o">.</span><span class="n">diposc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       2        8.44992        1.31893680e-02
     1       4       10.97654        1.15353802e-01
     1       5       13.37692        1.14988218e-01
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="truncated-ci-response">
<h2>Truncated CI response<a class="headerlink" href="#truncated-ci-response" title="Permalink to this headline">¶</a></h2>
<p>While they do not qualify as “exact state”, the response equations for truncated CI are the same as the exact case above. One can thus, in principle, obtain a hierarchy of method from CIS to fullCI. However, the excitation energies do not necessarily improve from order to order. Let us demonstrate this on the water example.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nstates</span><span class="o">=</span><span class="mi">5</span>
<span class="n">Energies</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="n">nstates</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c1">#nstates-1 transitions for CIS, CISD, CISDT and CISDTQ and FCI</span>
<span class="n">Energies</span><span class="p">[</span><span class="mi">4</span><span class="p">,:]</span><span class="o">=</span><span class="n">au2ev</span><span class="o">*</span><span class="n">DipOsc</span><span class="p">[</span><span class="s1">&#39;energies&#39;</span><span class="p">]</span> <span class="c1">#Save the FullCI result</span>
<span class="c1">#CIS to CISDTQ</span>
<span class="k">for</span> <span class="n">exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">space</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">MolSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
    <span class="n">space</span><span class="o">.</span><span class="n">CI</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>

    <span class="n">cidrv</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">CIDriver</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">space</span><span class="p">)</span>
    <span class="n">cidrv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">nstates</span><span class="p">)</span>

    <span class="n">SI</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">InterState</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">cidrv</span><span class="o">.</span><span class="n">vecs</span><span class="p">)</span>
    <span class="n">DipOsc</span><span class="o">=</span><span class="n">SI</span><span class="o">.</span><span class="n">diposc</span><span class="p">()</span>
    
    <span class="n">Energies</span><span class="p">[</span><span class="n">exc</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">au2ev</span><span class="o">*</span><span class="n">DipOsc</span><span class="p">[</span><span class="s1">&#39;energies&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 0
Number of active orbitals:              13
Number of virtual orbitals:             0

    This is a GASSCF wavefunction
           
         Cumulated   Min cumulated    Max cumulated 
 Space    orbitals      occupation       occupation
     1           5               9               10
     2          13              10               10


          CI expansion:
          -------------
Number of determinants:      41



        CI Iterations
        -------------

Iteration   Average energy      Time
     1        -75.64268289   0:00:00
Convergence reached in 1 iterations

        Final results
        -------------

* State 1
- Energy: -75.98387037576907
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[2.00000 2.00000 2.00000 2.00000 2.00000 0.00000 0.00000 0.00000 0.00000
 -0.00000 -0.00000 -0.00000 -0.00000]

* State 2
- Energy: -75.63914731810543
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.00003 1.99997 2.00000 2.00000 2.00000 -0.00000 0.00000 -0.00000 0.00000
 -0.00000 0.00003 0.00000 -0.00000]

* State 3
- Energy: -75.56833156634576
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.00003 2.00000 2.00000 2.00000 1.99997 -0.00000 0.00000 0.00000 0.00000
 -0.00000 0.00003 -0.00000 0.99997]

* State 4
- Energy: -75.54906538448644
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99696 1.02031 1.99959 2.00000 1.98314 0.00000 0.00041 -0.00000 0.00000
 -0.00000 0.00304 0.00000 0.01686]

* State 5
- Energy: -75.47299981142227
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[2.00000 1.02878 1.99995 2.00000 1.97127 -0.00000 0.00000 0.00000 0.00005
 -0.00000 0.00000 0.02873 0.97122]

List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       2        9.38039        1.46952832e-02
     1       4       11.83165        1.20872107e-01
     1       5       13.90150        1.04462232e-01

          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 0
Number of active orbitals:              13
Number of virtual orbitals:             0

    This is a GASSCF wavefunction
           
         Cumulated   Min cumulated    Max cumulated 
 Space    orbitals      occupation       occupation
     1           5               8               10
     2          13              10               10


          CI expansion:
          -------------
Number of determinants:      1141



        CI Iterations
        -------------

Iteration   Average energy      Time
     1        -75.70806791   0:00:00
     2        -75.73984712   0:00:00
     3        -75.74103507   0:00:00
     4        -75.74106383   0:00:00
     5        -75.74106487   0:00:00
     6        -75.74106491   0:00:00
     7        -75.74106491   0:00:00
Convergence reached in 7 iterations

        Final results
        -------------

* State 1
- Energy: -76.11428504000868
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.98981 1.98359 1.97574 1.97266 0.02407 0.02277 0.01542 0.01054
 0.00268 0.00195 0.00046 0.00034]

* State 2
- Energy: -75.73536042873035
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99999 1.99829 0.99907 1.99600 1.99111 0.01175 0.99382 0.00147 0.00171
 0.00118 0.00082 0.00035 0.00444]

* State 3
- Energy: -75.65422331203949
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99999 1.99830 0.99900 1.99144 1.99450 0.99166 0.01389 0.00154 0.00149
 0.00117 0.00047 0.00575 0.00080]

* State 4
- Energy: -75.64380953048887
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99999 1.99572 1.99582 1.12820 1.97557 0.02644 0.00508 0.00379 0.00180
 0.00142 0.00091 0.00051 0.00508]

* State 5
- Energy: -75.55764625373158
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99999 1.99559 1.99775 1.02428 1.96495 0.96819 0.03596 0.00190 0.00164
 0.00182 0.00039 0.00618 0.00134]

List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       2       10.31106        1.55311283e-02
     1       4       12.80229        1.24886531e-01
     1       5       15.14691        1.13754266e-01

          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 0
Number of active orbitals:              13
Number of virtual orbitals:             0

    This is a GASSCF wavefunction
           
         Cumulated   Min cumulated    Max cumulated 
 Space    orbitals      occupation       occupation
     1           5               7               10
     2          13              10               10


          CI expansion:
          -------------
Number of determinants:      12901



        CI Iterations
        -------------

Iteration   Average energy      Time
     1        -75.70818500   0:00:00
     2        -75.78792055   0:00:00
     3        -75.79280129   0:00:00
     4        -75.79307568   0:00:00
     5        -75.79309789   0:00:00
     6        -75.79309968   0:00:00
     7        -75.79309982   0:00:01
     8        -75.79309984   0:00:01
Convergence reached in 8 iterations

        Final results
        -------------

* State 1
- Energy: -76.11528163460542
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.98961 1.98329 1.97496 1.97170 0.02475 0.02336 0.01561 0.01071
 0.00289 0.00208 0.00060 0.00047]

* State 2
- Energy: -75.80089791834502
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.99160 0.99537 1.98190 1.97004 0.03026 0.99592 0.00554 0.00820
 0.00318 0.00238 0.00236 0.99592]

* State 3
- Energy: -75.71977984057024
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.99112 0.99537 1.97322 1.98000 0.99428 0.03031 0.00552 0.00953
 0.00338 0.00197 0.01222 0.00311]

* State 4
- Energy: -75.70825329002014
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.98806 1.98432 0.86226 1.96048 0.03723 0.01015 0.01466 0.00542
 0.00263 0.00217 0.00348 0.01015]

* State 5
- Energy: -75.62128649487032
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.98667 1.98542 1.01390 1.95751 0.97601 0.04017 0.01330 0.00547
 0.00341 0.00187 0.01214 0.00418]

List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       2        8.55482        1.33010579e-02
     1       4       11.07581        1.15374334e-01
     1       5       13.44229        1.11748073e-01

          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 0
Number of active orbitals:              13
Number of virtual orbitals:             0

    This is a GASSCF wavefunction
           
         Cumulated   Min cumulated    Max cumulated 
 Space    orbitals      occupation       occupation
     1           5               6               10
     2          13              10               10


          CI expansion:
          -------------
Number of determinants:      74991



        CI Iterations
        -------------

Iteration   Average energy      Time
     1        -75.70818500   0:00:01
     2        -75.79401156   0:00:01
     3        -75.79984012   0:00:01
     4        -75.80033568   0:00:01
     5        -75.80037556   0:00:01
     6        -75.80038084   0:00:02
     7        -75.80038135   0:00:01
     8        -75.80038144   0:00:01
     9        -75.80038146   0:00:01
    10        -75.80038146   0:00:01
Convergence reached in 10 iterations

        Final results
        -------------

* State 1
- Energy: -76.12095047070139
- S^2   : -0.02  (multiplicity = 1.0 )
- Natural orbitals
[1.99996 1.98833 1.98080 1.97165 1.96822 0.02803 0.02649 0.01800 0.01210
 0.00308 0.00221 0.00062 0.00049]

* State 2
- Energy: -75.80920379756212
- S^2   : -0.03  (multiplicity = 0.9 )
- Natural orbitals
[1.99996 1.99042 0.99448 1.97925 1.96632 0.03405 0.99598 0.00646 0.00935
 0.00351 0.00257 0.00243 0.99598]

* State 3
- Energy: -75.72711711630095
- S^2   : -0.03  (multiplicity = 0.9 )
- Natural orbitals
[1.99996 1.98983 0.99453 1.96973 1.97787 0.99421 0.03390 0.00639 0.01098
 0.00372 0.00215 0.01349 0.00324]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* State 4
- Energy: -75.71636077185792
- S^2   : -0.03  (multiplicity = 0.9 )
- Natural orbitals
[1.99996 1.98673 1.98175 0.84882 1.95766 0.04028 0.01128 0.01709 0.00609
 0.00280 0.00235 0.00348 0.01128]

* State 5
- Energy: -75.62827516483067
- S^2   : -0.03  (multiplicity = 0.9 )
- Natural orbitals
[1.99996 1.98505 1.98294 1.01138 1.95740 0.97777 0.04055 0.01554 0.00616
 0.00364 0.00200 0.01335 0.00427]

List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       2        8.48306        1.32413930e-02
     1       4       11.00945        1.15401259e-01
     1       5       13.40638        1.14952882e-01
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Convergence of excitation energies&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Energies</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0-&gt;1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Energies</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0-&gt;2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Energies</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0-&gt;3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">Energies</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;0-&gt;4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ci-response_8_0.png" src="../_images/ci-response_8_0.png" />
</div>
</div>
<p>As we can see, we do not have a clear convergence towards the fullCI result. In particular, CISD is actually worse than CIS. The reason for this is that CIS has a more even-handed treatment of the ground and excited states than CISD. In CIS, due to the Brillouin theorem, the ground state does not improve with the inclusion of single excitations, but the single excitations are needed to generate the dominant configuration for the (singly) excited states. Both ground and excited states are thus treated at a mean-field (HF) level.</p>
<p>However, in CISD, the ground state contains double excitation, and thus dynamical correlation, while the excited states would need up to triple excitations to both generate the singly-excited dominant configuration and correlating double excitations on top. There is an unbalance, the ground state being described more accurately than the excited states, leading to too high excitation energies. Adding the triple excitations bring correlation also for excited states, which brings the result closer to the final FullCI result, and in this simple case is essentially converged.</p>
<p>For this reason, while CIS is used (and as we can see in the next section, is actually related to HF response), the other truncated CIs are not.</p>
</div>
<div class="section" id="mcscf-and-state-averaging">
<h2>MCSCF and state-averaging<a class="headerlink" href="#mcscf-and-state-averaging" title="Permalink to this headline">¶</a></h2>
<p>As for truncated CI, the exact state response formulas also apply to multiconfigurational CI. The method can thus create all excited states that arise from excitations within the active space. This can also be used as an approximation for a MCSCF response, neglecting thus the orbital part of the response.</p>
<p>Let us try it on our water case. We’ll use an active space including the 2 pairs of O-H <span class="math notranslate nohighlight">\(\sigma\)</span> and <span class="math notranslate nohighlight">\(\sigma^*\)</span> (4 electrons in 4 orbitals). However, since the main excitation also involves the oxygen lone pair, we add this orbital too, for a total CAS(6,5).</p>
<p>First, we try the intuitive concept of first optimizing the CASSCF wavefunction for the ground state, and then applying CASCI response with the 5 states.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">MolSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">space</span><span class="o">.</span><span class="n">CAS</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#3 O_2p and 2 H_1s</span>
<span class="c1"># CASSCF calculation</span>
<span class="n">mcscf_drv</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">McscfDriver</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">space</span><span class="p">)</span>
<span class="n">mcscf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># CASCI excitation energies</span>
<span class="n">cidrv</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">CIDriver</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">space</span><span class="p">)</span>
<span class="n">cidrv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">nstates</span><span class="p">)</span>

<span class="c1"># Transition properties</span>
<span class="n">SI</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">InterState</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">cidrv</span><span class="o">.</span><span class="n">vecs</span><span class="p">)</span>
<span class="n">DipOsc</span><span class="o">=</span><span class="n">SI</span><span class="o">.</span><span class="n">diposc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 2
Number of active orbitals:              5
Number of virtual orbitals:             6

    This is a CASSCF wavefunction: CAS(6,5)

          CI expansion:
          -------------
Number of determinants:      55



        MCSCF Iterations
        ----------------

  Iter.     Avg. energy   E. change   CI iter     Time
     1    -75.99131203     0.0e+00         1    0:00:00
     2    -76.02029147    -2.9e-02         1    0:00:00
     3    -76.03531673    -1.5e-02         1    0:00:00
     4    -76.03737797    -2.1e-03         1    0:00:00
     5    -76.03388978     3.5e-03         1    0:00:00
     6    -76.03749627    -3.6e-03         1    0:00:00
     7    -76.03768282    -1.9e-04         1    0:00:00
     8    -76.03778429    -1.0e-04         1    0:00:00
     9    -76.03782523    -4.1e-05         1    0:00:00
    10    -76.03783611    -1.1e-05         1    0:00:00
    11    -76.03783879    -2.7e-06         1    0:00:00
    12    -76.03784128    -2.5e-06         1    0:00:00
    13    -76.03783858     2.7e-06         1    0:00:00
    14    -76.03784276    -4.2e-06         1    0:00:00
    15    -76.03784306    -3.0e-07         1    0:00:00
    16    -76.03784323    -1.7e-07         1    0:00:00
    17    -76.03784152     1.7e-06         1    0:00:00
    18    -76.03783939     2.1e-06         1    0:00:00
    19    -76.03784324    -3.8e-06         1    0:00:00
    20    -76.03784329    -5.1e-08         1    0:00:00
    21    -76.03784332    -2.8e-08         1    0:00:00
    22    -76.03784334    -1.2e-08         1    0:00:00
Convergence reached in 22 iterations

        Final results
        -------------

* State 1
- Energy: -76.03784333519637
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99931 1.97806 1.97495 0.02400 0.02368]

Total MCSCF time: 00:00:00

          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 2
Number of active orbitals:              5
Number of virtual orbitals:             6

    This is a CASSCF wavefunction: CAS(6,5)

          CI expansion:
          -------------
Number of determinants:      55



        CI Iterations
        -------------

Iteration   Average energy      Time
     1        -75.35803411   0:00:00
Convergence reached in 1 iterations

        Final results
        -------------

* State 1
- Energy: -76.03784333519637
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99931 1.97806 1.97495 0.02400 0.02368]

* State 2
- Energy: -75.35352351021717
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.00000 1.97467 1.98958 1.00238 0.03337]

* State 3
- Energy: -75.34944371078305
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.00000 1.99202 1.97077 0.03398 1.00322]

* State 4
- Energy: -75.05965055004434
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99901 1.91840 1.06450 0.08407 0.93403]

* State 5
- Energy: -74.98970944073103
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.97827 1.60804 1.38476 0.60898 0.41994]

List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       3       18.73231        4.72890209e-04
     1       4       26.61798        3.18812631e-01
     1       5       28.52118        2.44616095e-02
</pre></div>
</div>
</div>
</div>
<p>As we can see, the result is very disappointing, very far from the fullCI result, and even from the CIS result. The reason for that is the orbitals. The orbitals were optimized for the ground state, and not for the excited states. In particular, in this case, the <span class="math notranslate nohighlight">\(\sigma^*\)</span> orbitals are optimal to describe correlation in the O-H bonds, but not for the electronic excitation.</p>
<p>Ideally, we would want each state to have its own orbitals, which a full MCSCF response will provide. However, there is a way to improve the result without including the orbital response. The concept is to use only one orbital set, but to make these orbitals a “compromise” between the needs of the ground state and that of the excited states. The way to do this is to construct a “state-average” (SA), that is optimize the orbitals to minimize the average energy of all states.</p>
<p>Doing this requires only a trivial modification of the code, namely the CI part of the MCSCF includes all states (here 5) and then the MCSCF energy is replaced by the average energy of all states and the CI densities are replaced by the average density of all states.</p>
<p>Let’s see it in practice:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">MolSpace</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="p">)</span>
<span class="n">space</span><span class="o">.</span><span class="n">CAS</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#3 O_2p and 2 H_1s</span>
<span class="c1"># CASSCF calculation</span>
<span class="n">mcscf_drv</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">McscfDriver</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">space</span><span class="p">)</span>
<span class="n">mcscf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#5 states included already in the MCSCF.</span>

<span class="c1"># Transition properties</span>
<span class="n">SI</span><span class="o">=</span><span class="n">mtp</span><span class="o">.</span><span class="n">InterState</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">mcscf_drv</span><span class="o">.</span><span class="n">CIVecs</span><span class="p">)</span>
<span class="n">DipOsc</span><span class="o">=</span><span class="n">SI</span><span class="o">.</span><span class="n">diposc</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Active space definition:
          ------------------------
Number of inactive (occupied) orbitals: 2
Number of active orbitals:              5
Number of virtual orbitals:             6

    This is a CASSCF wavefunction: CAS(6,5)

          CI expansion:
          -------------
Number of determinants:      55



        MCSCF Iterations
        ----------------

  Iter.     Avg. energy   E. change   CI iter     Time
     1    -75.65535803     0.0e+00         1    0:00:00
     2    -75.68291688    -2.8e-02         1    0:00:00
     3    -75.68588116    -3.0e-03         1    0:00:00
     4    -75.68604031    -1.6e-04         1    0:00:00
     5    -75.68605103    -1.1e-05         1    0:00:00
     6    -75.68605142    -3.9e-07         1    0:00:00
     7    -75.68605144    -2.3e-08         1    0:00:00
Convergence reached in 7 iterations

        Final results
        -------------

* State 1
- Energy: -75.98214063234049
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99958 1.99146 1.98461 0.01560 0.00875]

* State 2
- Energy: -75.70439826829552
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.00000 1.99722 1.98783 0.01583 0.99913]

* State 3
- Energy: -75.62068890054752
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.00000 1.99411 1.99499 0.99764 0.01325]

* State 4
- Energy: -75.60257638013466
- S^2   : -0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99968 0.77387 1.96066 0.04213 1.22365]

* State 5
- Energy: -75.52045303807107
- S^2   : 0.00  (multiplicity = 1.0 )
- Natural orbitals
[1.99956 1.01895 1.97487 0.97610 0.03052]

Total MCSCF time: 00:00:00

List of oscillator strengths greather than 1e-10

  From     to       Energy (eV)    Oscillator strength
     1       2        7.55775        1.18262119e-02
     1       4       10.32847        1.10110309e-01
     1       5       12.56316        1.49177932e-01
</pre></div>
</div>
</div>
</div>
<p>The result is now significantly closer to the converged fullCI result, and in particular in this case a little better than CIS.</p>
<p>Because of its simplicity and its reasonable accuracy, SA-MCSCF is one of the most frequently used technique to compute properties at the MCSCF level.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="exact-response.html" title="previous page">Exact states</a>
    <a class='right-next' id="next-link" href="scf-response.html" title="next page">Hartree–Fock</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The eChem team<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>