
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>X-ray spectroscopies &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="General aspects" href="elecstruct-general.html" />
    <link rel="prev" title="Multi-photon interactions" href="nlo.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="uv-vis.html">
   UV/vis absorption/emission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transmetal.html">
   Transition metals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nlo.html">
   Multi-photon interactions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   X-ray spectroscopies
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradhess.html">
     Gradients and Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="structopt.html">
   Molecular structure optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conint.html">
   Conical intersection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     SCF states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Molecular orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/xray.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdocs/xray.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/docs/xray.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-photoemission-spectroscopy">
   X-ray photoemission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-koopmans-theorem">
     From Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maximum-overlap-method-mom">
     Maximum overlap method (MOM)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-total-energy-differences">
     From total energy differences
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xps-of-the-esca-molecule">
     XPS of the ‘ESCA’ molecule
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-absorption-spectroscopy">
   X-ray absorption spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decoupling-from-valence-continuum">
     Decoupling from valence continuum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adc-eigenstates">
     ADC eigenstates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tddft-eigenstates">
     TDDFT eigenstates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tddft-damped-response-function">
     TDDFT damped response function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uracil-in-solution">
     Uracil in solution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maybe-massive-system-with-dft">
     Maybe: massive system with DFT
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-emission-spectroscopy">
   X-ray emission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decay-from-core-hole-reference">
     Decay from core-hole reference
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overlap-model">
     Overlap model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maybe-uracil-in-solution">
     Maybe: uracil in solution
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maybe-valence-to-core-xes">
     Maybe valence-to-core XES
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Maybe: massive system with DFT
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resonant-inelastic-x-ray-scattering">
   Resonant inelastic X-ray scattering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#coupling-to-molecular-dynamics">
   Coupling to molecular dynamics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xas">
     XAS
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#amplitudes">
       Amplitudes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#atomic-contributions">
       Atomic contributions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#polarization">
       Polarization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comparison-between-adc-and-dft">
       Comparison between ADC and DFT
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-interaction-error-in-dft">
   Self-interaction error in DFT
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relativity">
   Relativity
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-relativistic-effects">
     Scalar relativistic effects
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shift-in-ip">
       Shift in IP
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shift-in-xas">
       Shift in XAS
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#shift-in-xes">
       Shift in XES
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spin-orbit-coupling">
     Spin-orbit coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relaxation">
   Relaxation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-adc">
     In ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-tddft">
     In TDDFT
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basis-set-considerations">
   Basis set considerations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes">
   Notes
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="x-ray-spectroscopies">
<h1>X-ray spectroscopies<a class="headerlink" href="#x-ray-spectroscopies" title="Permalink to this headline">¶</a></h1>
<p>Tuning the photon energy to the X-ray regime, processes involving the transition of core electrons can be probed, providing measurements which are very sensitive to elements and local environment [refs: norman18, bergmann17]. Here we will discuss the modeling of four such spectroscopies, as illustrated in <a class="reference internal" href="#xray-processes"><span class="std std-numref">Fig. 1</span></a>:</p>
<ul class="simple">
<li><p>In <a class="reference external" href="#x-ray-photoemission-spectroscopy">X-ray photoemission spectroscopy (XPS)</a> the photoionization of the molecular system is probed, yielding insight into <em>occupied</em> states.</p></li>
<li><p>In <a class="reference external" href="#x-ray-absorption-spectroscopy">X-ray absorption spectroscopy (XAS)</a> the transition of core electrons to occupied or continuum states is probed, providing information on <em>unoccupied</em> states or the <em>local environment</em>.</p></li>
<li><p>In <a class="reference external" href="#x-ray-emission-spectroscopy">X-ray emission spectroscopy (XES)</a> the fluorescent decay of higher-lying electrons into a previously prepared core-hole is measured, yielding information on <em>occupied</em> states.</p></li>
<li><p>In <a class="reference external" href="#resonant-inelastic-x-ray-scattering">resonant inelastic X-ray scattering (RIXS)</a> (also termed resonant X-ray emission spectroscopy, or resonant (X-ray) Raman spectroscopy), the core-excitation and subsequent fluorescent decay is measured, yielding information on both <em>occupied</em> and <em>unoccupied</em> states, including the ability of probing (local) <em>vibrational modes</em>.</p></li>
</ul>
<div class="figure align-default" id="xray-processes">
<img alt="../_images/processes.svg" src="../_images/processes.svg" /><p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Involved processes.</span><a class="headerlink" href="#xray-processes" title="Permalink to this image">¶</a></p>
</div>
<p>The element-specificity of these techniques arise from the significant differences in excitation energies, as illustrated in <a class="reference internal" href="#edges-elements"><span class="std std-numref">Fig. 2</span></a>. Here the linear attenuation coefficient for four noble gases (left), and carbon to neon (right) are shown, with the former including labels for the origin of each set of features. We see that there are typically significant energy differences between the various absorption features, which then enables us to focus on particular elements and edges by tuning the probe to specific photon energies.</p>
<div class="figure align-default" id="edges-elements">
<img alt="../_images/edges_elements.svg" src="../_images/edges_elements.svg" /><p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Linear attenuation coefficient for the noble gases and carbon to neon, in order to show element specificity. Noble gas panel also labeling features. Data extracted from <a class="reference external" href="https://www.nist.gov/pml/x-ray-form-factor-attenuation-and-scattering-tables">NIST</a>.</span><a class="headerlink" href="#edges-elements" title="Permalink to this image">¶</a></p>
</div>
<p>Modeling these processes are complicated by a number of factors, such as</p>
<ul class="simple">
<li><p>Strong <a class="reference external" href="#relaxation">relaxation effects</a>, arising from the significant change in shielding of the nuclear charge arising from the creation/annihilation of a core-hole.</p></li>
<li><p>Potentially significant impact from <a class="reference external" href="#relativity">relativistic effects</a>, with the strong potential experienced by the core electrons yielding large shifts when going from a non-relativistic framework. In addition, spin-orbit coupling split degeneracies in, e.g., <span class="math notranslate nohighlight">\(2p\)</span> (the <span class="math notranslate nohighlight">\(L_{2,3}\)</span>-edge), necessitating at least an approximate inclusion of such couplings.</p></li>
<li><p>Core-excitation and -ionization processes are <a class="reference external" href="#decoupling-from-valence-continuum">embedded in a continumm of valence-ionized states</a>, making the application of, e.g., a standard Davidson approach for resolving eigenstates unsuitable.</p></li>
<li><p>For higher photon energies the contribution of <em>quadruple-allowed</em> states enables transitions which are electric-dipole forbidden.</p></li>
<li><p>Computational chemistry commonly considers valence properties, and meaning that, e.g., standard <a class="reference external" href="#basis-set-considerations">basis sets</a> are not as suitable for core processes.</p></li>
</ul>
<p>This tutorial will discuss the modeling of XPS, XAS, XES, and RIXS, following which analysis methods and some of the issued mentioned above will be considered in some detail.</p>
<div class="cell tag_remove-output tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading modules and defining broadening functions</span>

<span class="c1"># standard Python modules and functions</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="c1"># QC software suites and functionalities</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">cc</span>
<span class="kn">import</span> <span class="nn">gator</span>
<span class="kn">import</span> <span class="nn">adcc</span>
<span class="kn">from</span> <span class="nn">veloxchem.rsplinabscross</span> <span class="kn">import</span> <span class="n">LinearAbsorptionCrossSection</span>

<span class="c1"># for vlx</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<span class="n">silent_ostream</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># conversion factor</span>
<span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>

<span class="c1"># broadening functions</span>
<span class="k">def</span> <span class="nf">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="x-ray-photoemission-spectroscopy">
<h2>X-ray photoemission spectroscopy<a class="headerlink" href="#x-ray-photoemission-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>In XPS the photoemission of electrons is measured, yielding information on binding energies of core orbitals. Here we focus on the calculation of ionization potentials (IP:s), from which the isotropic photoemission spectrum is formed by giving each IP the same intensity and then broadening with a function. Can go beyond that using Dyson orbitals, but it doesn’t make much of a difference [ref].</p>
<div class="section" id="from-koopmans-theorem">
<h3>From Koopmans’ theorem<a class="headerlink" href="#from-koopmans-theorem" title="Permalink to this headline">¶</a></h3>
<p>A simple model for estimating ionization potentials and electron affinities is from Koopmans’ theorem, where it is calculated from the MO energies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># water structure from MP2/cc-pVTZ</span>
<span class="n">water</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># SCF calculation</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>
<span class="n">scf_drv</span>  <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Extract orbital energies</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1s IP from the Koopmans theorem:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">orbital_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1s IP from the Koopmans theorem: -559.501
</pre></div>
</div>
</div>
</div>
<p>This is to be compared to the experimental value, which is 539.9 eV. The overestimation of almost 20 eV is due to lack of <span class="xref myst">relaxation</span>, which results from the reorganization of the valence electrons in response to a reduction of screening of the nuclei. By comparison, little influence due to the removal of a HOMO electron is expected, yielding far better agreement to experiment for these processes. An approach for including the relaxation effects in the calculation of IP:s is to use the <span class="math notranslate nohighlight">\(\Delta\)</span>SCF approach, in which the difference in total energy between the neutral and a core-hole system estimated.</p>
</div>
<div class="section" id="maximum-overlap-method-mom">
<h3>Maximum overlap method (MOM)<a class="headerlink" href="#maximum-overlap-method-mom" title="Permalink to this headline">¶</a></h3>
<p>In order to do this, a core-hole state need to be converged, as can be done using, e.g. the maximum overlap approach [refs:]. Other alternatives, such as… [refs]</p>
<p>With the MOM approach, the eigenvalue equation</p>
<div class="amsmath math notranslate nohighlight" id="equation-4d42ef7e-641c-4963-8588-fcfe95cd141f">
<span class="eqno">(1)<a class="headerlink" href="#equation-4d42ef7e-641c-4963-8588-fcfe95cd141f" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\textbf{FC}^{\textrm{new}} = 
\textbf{SC}^{\textrm{new}} \epsilon
\end{equation}\]</div>
<p>is considered. Chosing to overlap the most with the span</p>
<div class="amsmath math notranslate nohighlight" id="equation-e74a6b35-c357-4990-8623-6425a501e542">
<span class="eqno">(2)<a class="headerlink" href="#equation-e74a6b35-c357-4990-8623-6425a501e542" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\textbf{O} = 
\left( \textbf{C} \right)^{\dagger} \textbf{SC}^{\textrm{new}}
\end{equation}\]</div>
<p>Can converge unstable situations, such as core-hole states.</p>
<p>Note potential instabilities for post-HF on core-hole (and excited states as well).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We currently use <code class="docutils literal notranslate"><span class="pre">pyscf</span></code> for the illustrations involving core-holes, as VeloxChem lacks MOM (for now).</p>
</div>
</div>
<div class="section" id="from-total-energy-differences">
<h3>From total energy differences<a class="headerlink" href="#from-total-energy-differences" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build mol-object and perform ground state SCF</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">scf_res</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy wave function information and change occupancy of alpha1 to 0 (core-hole)</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Perform wave function calculation with the MOM restriction</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># IP from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()),</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827192  &lt;S^2&gt; = 6.3362648e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.scf.uhf.UHF&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.0754789470864  &lt;S^2&gt; = 0.76257805  2S+1 = 2.0125387
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ionization potential: 541.735 eV
</pre></div>
</div>
</div>
</div>
<p>This estimate is now within 2 eV from experiment, and we can include correlation using MP2 on top of this SCF wave function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run MP2 on neutral and core-hole wave functions</span>
<span class="n">mp_res</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">scf_res</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mp_ion</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># IP from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">mp_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">mp_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>E(UMP2) = -76.113048395549  E_corr = -0.129178012829719
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>E(UMP2) = -56.1523709631034  E_corr = -0.0768920160169646
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ionization potential: 543.158 eV
</pre></div>
</div>
</div>
</div>
<p>As well as use KS-DFT:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SCF calculation with unrestricted KS-DFT</span>
<span class="n">dft_res</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">dft_res</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
<span class="n">dft_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Create core-hole in alpha1</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># SCF with core-hole</span>
<span class="n">dft_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">dft_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">dft_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">dft_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># IP from difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">dft_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()),</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -76.3480474320837  &lt;S^2&gt; = 2.550582e-11  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.dft.uks.UKS&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ionization potential: 542.473 eV
</pre></div>
</div>
</div>
</div>
<p>MP2 and DFT currently brings us <strong>away</strong> from experiment, but we note that the basis set is small and ill suited for core properties. Using a cc-pCVTZ basis we instead obtain:</p>
<ul class="simple">
<li><p>HF: 538.929 eV</p></li>
<li><p>MP2: 540.257 eV</p></li>
<li><p>B3LYP: 539.192 eV</p></li>
</ul>
<p><em>i.e.</em> closer to experiment for the correlated methods (note that scalar-relativistic effects will shift these results upwards by <span class="math notranslate nohighlight">\(\sim\)</span>0.37 eV).</p>
</div>
<div class="section" id="xps-of-the-esca-molecule">
<h3>XPS of the ‘ESCA’ molecule<a class="headerlink" href="#xps-of-the-esca-molecule" title="Permalink to this headline">¶</a></h3>
<p>The X-ray photoemission spectrum can now be formed by calculating all relavant core-electron binding energies (IP:s), give each unique ionization equal intensity, and broaden over the result with a lorentzian or gaussian convolution formula. The choice of broadening depends on the dominant broadening effect (lifetime of excited/ionized state, experimental resolution, etc), but we will here focus on pure lorentzian broadening.</p>
<p>We here consider ethyl trifluoroacetate( (CF<span class="math notranslate nohighlight">\(_3\)</span>-CO-O-CH<span class="math notranslate nohighlight">\(_2\)</span>-CH<span class="math notranslate nohighlight">\(_3\)</span>), also known as the <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">‘ESCA’ molecule</a>, which possess very illustrative shifts in XPS features (IP:s) of the carbon <span class="math notranslate nohighlight">\(K\)</span>-edge due to interactions with the very electronegative oxygen and fluorine atoms.</p>
<p>Calculating the four carbon 1s IP:s is done with <span class="math notranslate nohighlight">\(\Delta\)</span>SCF:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">esca</span>   <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">C         1.1183780041   -0.3449927563    0.0140172822</span>
<span class="s1">C         0.2599020293    0.9430366372   -0.0248385056</span>
<span class="s1">F         2.4019839124   -0.0408200726   -0.0368443870</span>
<span class="s1">F         0.8399255955   -1.1560630574   -1.0169777359</span>
<span class="s1">F         0.8945563482   -1.0267696528    1.1485539196</span>
<span class="s1">O         0.7954196415    2.0187110930    0.0011424145</span>
<span class="s1">O        -1.0675509573    0.8144007049   -0.0614767265</span>
<span class="s1">C        -1.7486063992   -0.4602333713   -0.1739210991</span>
<span class="s1">C        -3.1986940727   -0.1850294900    0.1302033614</span>
<span class="s1">H        -1.3268717284   -1.1720377773    0.5289059043</span>
<span class="s1">H        -1.6185520565   -0.8344576449   -1.1859838788</span>
<span class="s1">H        -3.3116641442    0.1959612359    1.1419001202</span>
<span class="s1">H        -3.7716619472   -1.1057672384    0.0380096706</span>
<span class="s1">H        -3.6012985602    0.5468300237   -0.5651778685            </span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># Create mol object and perform neutral SCF calculation</span>
<span class="n">mol_esca</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol_esca</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">esca</span><span class="p">;</span> <span class="n">mol_esca</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;STO-3G&#39;</span>
<span class="n">mol_esca</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">scf_esca</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol_esca</span><span class="p">)</span>
<span class="n">scf_esca</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform core-hole calculation for each carbon atom (MOs 5-8) and append SCF IPs to a list</span>
<span class="n">esca_ips</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i_mo</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_esca</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_esca</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_mo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">ion_tmp</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol_esca</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_tmp</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">ion_tmp</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">esca_ips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ion_tmp</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_esca</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    
<span class="c1"># Broaden with a Lorentzian and plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">esca_ips</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">esca_ips</span><span class="p">)))</span>
<span class="c1"># Call Lorentzian broadening with x-data, y-data, lower x-lim, upper x-lim, xstep, and broadening gamma</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -594.32069026359  &lt;S^2&gt; = 1.6621939e-08  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -583.365537674046  &lt;S^2&gt; = 0.76705671  2S+1 = 2.0169846
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF not converged.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF energy = -583.447978406353 after 50 cycles  &lt;S^2&gt; = 0.76803912  2S+1 = 2.0179585
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -583.561134582533  &lt;S^2&gt; = 0.76454928  2S+1 = 2.0144967
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -583.615548638302  &lt;S^2&gt; = 0.75826809  2S+1 = 2.0082511
</pre></div>
</div>
<img alt="../_images/xray_11_6.png" src="../_images/xray_11_6.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some convergence issues, largely relating to the minimal basis set used. These issues disappear for more suitable basis set selections.</p>
</div>
<p>For illustration purposes, we also broaden with a gaussian (note that FWHM <span class="math notranslate nohighlight">\(= \gamma = 2\sqrt{2\ln{2}} \sigma\)</span>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_13_0.png" src="../_images/xray_13_0.png" />
</div>
</div>
<p>For the comparison to <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">experiment</a> a cc-pVTZ basis set is selected, augmented with additional core-polarizing functions for the carbon atoms (i.e. cc-pCVTZ):</p>
<div class="figure align-default" id="esca-xps">
<img alt="../_images/esca_xps.svg" src="../_images/esca_xps.svg" /><p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">X-ray photoemission of ESCA. Shifted by 0.11 eV and broadened by 0.3 eV.</span><a class="headerlink" href="#esca-xps" title="Permalink to this image">¶</a></p>
</div>
<p>The features originate in, from low to high energy: -CH<span class="math notranslate nohighlight">\(_3\)</span>, -CH<span class="math notranslate nohighlight">\(_2\)</span>-, -CO-, and CF<span class="math notranslate nohighlight">\(_3\)</span>. We note a good agreement for the first two features, but the comparison deteriorates for higher energies. This is largely an effect of the more significant change in electronic structure imposed by the very electronegative fluorine and oxygen atoms, which HF is not capable of describing as well.</p>
</div>
</div>
<div class="section" id="x-ray-absorption-spectroscopy">
<h2>X-ray absorption spectroscopy<a class="headerlink" href="#x-ray-absorption-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>In XAS the energy-dependent photoabsorption of the sample is measured, probing excitation of core electrons to bound or continuum states. These two different final states then provide information on unoccupied states and local chemical environment,r espectively, with a prototypical spectrum of a conjugated system as below:</p>
<div class="figure align-default" id="xafs">
<img alt="../_images/xafs.svg" src="../_images/xafs.svg" /><p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Prototypical X-ray absorption spectrum of a conjugated system.</span><a class="headerlink" href="#xafs" title="Permalink to this image">¶</a></p>
</div>
<p>Above the spectrum we see the distinction of the various spectrum region, consisting of</p>
<ul class="simple">
<li><p><strong>XAFS (X-ray absorption fine structure):</strong> consisting of excitations to both types of final states.</p></li>
<li><p><strong>NEXAFS (near-edge X-ray absorption fine structure:</strong> the region in which transitions to bound states is probed (this region is also known as XANES, X-ray absorption near-edge structure)</p></li>
<li><p><strong>EXAFS (extended X-ray absorption fine structure):</strong> which consists of transitions to continuum states, which is modulated by constructive or destructive interference between the emitted electron and the environment. This thus provide information on local chemical bonds.</p></li>
</ul>
<p>Included in the illustraction is also the ionization potential, above which the oscillatory pattern due to interference with the environment is initiated, and assignment of typical features (<span class="math notranslate nohighlight">\(\pi^*\)</span>, Rydberg, and <span class="math notranslate nohighlight">\(\sigma^*\)</span>). Transitions to <span class="math notranslate nohighlight">\(\pi^*\)</span> states are typically low in energy and very intense, and thus easy to identify. Rydberg states are typically weak and converge to the ionization potential. Transitions to <span class="math notranslate nohighlight">\(\sigma^*\)</span> final states can be abive the ionization potential.</p>
<div class="section" id="decoupling-from-valence-continuum">
<h3>Decoupling from valence continuum<a class="headerlink" href="#decoupling-from-valence-continuum" title="Permalink to this headline">¶</a></h3>
<p>A complication that arise when considering core excitations is the embedding of the core-excited states into the continuum of valence-ionized states. A number of approaches have been developed to remove this issue, including:</p>
<ul class="simple">
<li><p>The core-valence separation (CVS) approximation</p></li>
<li><p>Restricted energy window, which share some with CVS</p></li>
<li><p>CPP</p></li>
<li><p>Real-time propagation</p></li>
<li></li>
</ul>
<p>Furthermore, approaches for constructing explicit excited states are available,</p>
<p>In order to calculate</p>
<div class="figure align-default" id="cvs-adc">
<img alt="../_images/cvs_adc.svg" src="../_images/cvs_adc.svg" /><p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Global spectrum of water, using the 6-311G basis set. ADC(1) results resolving all 70 states in this basis.</span><a class="headerlink" href="#cvs-adc" title="Permalink to this image">¶</a></p>
</div>
<p>Error of the CVS approach</p>
</div>
<div class="section" id="adc-eigenstates">
<h3>ADC eigenstates<a class="headerlink" href="#adc-eigenstates" title="Permalink to this headline">¶</a></h3>
<p>References to CVS approach and CVS error.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>
<span class="n">adc_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 5 iterations.
Total Energy: -75.9838703827 au
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                        Algebraic Diagrammatic Construction (ADC)                                         
                                       ===========================================                                        
                                                                                                                          
                               ADC method                   : cvs-adc2x                                                   
                               Number of Singlet States     : 6                                                           
                               CVS-ADC, Core Orbital Space  : 1                                                           
                               Convergence threshold        : 1.0e-06                                                     
                                                                                                                          
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8        1.4139  132ms  [20.2703591  20.30081833 20.86977783 20.91121538 21.10647287 21.17210948]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    16       0.05362  242ms  [19.72495595 19.80691971 20.50881003 20.51569995 20.52445863 20.72564039]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    24      0.014469  382ms  [19.71673653 19.79707767 20.49577445 20.50503434 20.50804158 20.63850304]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    32      0.001267  489ms  [19.7163907  19.79671165 20.49373728 20.5048402  20.50629326 20.62964464]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    40    0.00011958  562ms  [19.71637581 19.79669987 20.49353413 20.50482663 20.5061769  20.62883056]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    16    2.2907e-05  790ms  [19.7163753  19.79669916 20.49351327 20.5048247  20.50617017 20.62875659]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    24    8.2765e-06  604ms  [19.71637527 19.79669907 20.49350809 20.50482387 20.50616886 20.62873498]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    32    3.7389e-06  739ms  [19.71637527 19.79669907 20.49350766 20.50482376 20.50616868 20.62872992]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9    40     5.189e-07  556ms  [19.71637527 19.79669907 20.49350744 20.50482375 20.50616863 20.62872822]
=== Converged ===
    Number of matrix applies:    72
    Total solver time:             4s 553ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                                  ADC Summary of Results                                                  
                                                 ------------------------                                                 
                                                                                                                          
                             +--------------------------------------------------------------+                             
                             | cvs-adc2x                               singlet ,  converged |                             
                             +--------------------------------------------------------------+                             
                             |  #        excitation energy     osc str    |v1|^2    |v2|^2  |                             
                             |          (au)           (eV)                                 |                             
                             |  0      19.71638      536.5099   0.0175    0.8001    0.1999  |                             
                             |  1       19.7967      538.6956   0.0368    0.8087    0.1913  |                             
                             |  2      20.49351      557.6567   0.0098    0.7858    0.2142  |                             
                             |  3      20.50482      557.9647   0.1007    0.8441    0.1559  |                             
                             |  4      20.50617      558.0013   0.0881     0.835     0.165  |                             
                             |  5      20.62873      561.3363   0.0104    0.7926    0.2074  |                             
                             +--------------------------------------------------------------+                             
                                                                                                                          
                                          End of ADC calculation. All went well!                                          
                                                                                                                          
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">adc_res</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using inbuilt routines:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">adc_res</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Or, constructing the spectra explicitly for the low-energy region:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_res</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_res</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">543</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| cvs-adc2x                               singlet ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      19.71638      536.5099   0.0175    0.8001    0.1999  |
|  1       19.7967      538.6956   0.0368    0.8087    0.1913  |
|  2      20.49351      557.6567   0.0098    0.7858    0.2142  |
|  3      20.50482      557.9647   0.1007    0.8441    0.1559  |
|  4      20.50617      558.0013   0.0881     0.835     0.165  |
|  5      20.62873      561.3363   0.0104    0.7926    0.2074  |
+--------------------------------------------------------------+

Using inbuilt routines:
</pre></div>
</div>
<img alt="../_images/xray_17_1.png" src="../_images/xray_17_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Or, constructing the spectra explicitly for the low-energy region:
</pre></div>
</div>
<img alt="../_images/xray_17_3.png" src="../_images/xray_17_3.png" />
</div>
</div>
<p>Compared to experiment with aug-cc-pCVTZ/cc-pVTZ (oxygen and hydrogen, respectively):</p>
<div class="figure align-default" id="adc-water-xas">
<img alt="../_images/adc_water_xas.svg" src="../_images/adc_water_xas.svg" /><p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">CVS-ADC(2)-x versus experiment. Shifted by 0.37 and broadened by 0.4eV.</span><a class="headerlink" href="#adc-water-xas" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="tddft-eigenstates">
<h3>TDDFT eigenstates<a class="headerlink" href="#tddft-eigenstates" title="Permalink to this headline">¶</a></h3>
<p>For discussion of self-interaction error - see <a class="reference external" href="#self-interaction-error-in-dft">below</a>.</p>
</div>
<div class="section" id="tddft-damped-response-function">
<h3>TDDFT damped response function<a class="headerlink" href="#tddft-damped-response-function" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_level&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">);</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">514.0</span><span class="p">,</span><span class="mf">525.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span><span class="p">;</span> <span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">au2ev</span><span class="p">}</span>
                                         <span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span> <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">));</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Splined&#39;</span><span class="p">,</span><span class="s1">&#39;CPP-DFT&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_21_0.png" src="../_images/xray_21_0.png" />
</div>
</div>
<p>Using aug-cc-pCVTZ and compared to experiment</p>
<div class="figure align-default" id="dft-water-xas">
<img alt="../_images/dft_water_xas.svg" src="../_images/dft_water_xas.svg" /><p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">CPP-DFT (B3LYP) versus experiment. DFT results shifted. FWHM 0.4 eV. Currently aug-cc-pVDZ - <strong>change to aug-cc-pCVTZ/cc-pVTZ</strong>.</span><a class="headerlink" href="#dft-water-xas" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this is a todo</p>
</div>
<p>plt.figure(figsize=(5,4)); plt.subplot(211)
x = np.arange(min(au2ev<em>freqs),max(au2ev</em>freqs),0.01)
y = interp1d(au2ev<em>freqs, sigma, kind=’cubic’)
plt.plot(x,y(x));plt.plot(au2ev</em>freqs,sigma,’x’)
plt.xlim((516,524)); plt.yticks([]); plt.legend((‘Splined’,’CPP-DFT’))
plt.subplot(212)
data = np.loadtxt(‘../img/xray/water_xas.dat’); x,y = [],[]
for data_tmp in data: x.append(data_tmp[0]), y.append(data_tmp[1])
plt.plot(x,y); plt.xlim((531,539)); plt.yticks([]); plt.legend((‘Experiment’,’’))
plt.show()</p>
</div>
<div class="section" id="uracil-in-solution">
<h3>Uracil in solution<a class="headerlink" href="#uracil-in-solution" title="Permalink to this headline">¶</a></h3>
<p>CVS-ADC and CPP-DFT</p>
<ol class="simple">
<li><p>Tailored CVS spaces</p></li>
<li><p>Gas phase</p></li>
<li><p>Polarizable embedding</p></li>
</ol>
</div>
<div class="section" id="maybe-massive-system-with-dft">
<h3>Maybe: massive system with DFT<a class="headerlink" href="#maybe-massive-system-with-dft" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="x-ray-emission-spectroscopy">
<h2>X-ray emission spectroscopy<a class="headerlink" href="#x-ray-emission-spectroscopy" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>maybe illustration: Augen/fluorescent yield</p></li>
</ul>
<div class="section" id="decay-from-core-hole-reference">
<h3>Decay from core-hole reference<a class="headerlink" href="#decay-from-core-hole-reference" title="Permalink to this headline">¶</a></h3>
<p>Water (vs expt)</p>
<ol class="simple">
<li><p>ADC(2)</p></li>
<li><p>TDDFT</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">();</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_xes</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827192  &lt;S^2&gt; = 6.3398176e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.0754789470864  &lt;S^2&gt; = 0.76257805  2S+1 = 2.0125387
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     8       0.77768   1.9s  [-19.29082067 -19.19940205 -18.96181907 -18.3637012 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    16     0.0010764  329ms  [-19.44427093 -19.36689642 -19.16826546 -18.57947501]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    24    4.4301e-07  365ms  [-19.44429764 -19.3669284  -19.16831914 -18.57954987]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             2s 561ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using inbuilt functionalities, noticing the negative energies&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">adc_xes</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Flipping the x-axis and focusing on the high-energy features:&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">518</span><span class="p">,</span><span class="mi">532</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using inbuilt functionalities, noticing the negative energies
</pre></div>
</div>
<img alt="../_images/xray_26_1.png" src="../_images/xray_26_1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Flipping the x-axis and focusing on the high-energy features:
</pre></div>
</div>
<img alt="../_images/xray_26_3.png" src="../_images/xray_26_3.png" />
</div>
</div>
<p>Using cc-pCVTZ/cc-pVTZ and compared to experiment</p>
<div class="figure align-default" id="adc-water-xes">
<img alt="../_images/adc_water_xes.svg" src="../_images/adc_water_xes.svg" /><p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">ADC(2) versus experiment. Shifted by 0.37 and broadened by 0.3 eV.</span><a class="headerlink" href="#adc-water-xes" title="Permalink to this image">¶</a></p>
</div>
<p>And for TDDFT</p>
</div>
<div class="section" id="overlap-model">
<h3>Overlap model<a class="headerlink" href="#overlap-model" title="Permalink to this headline">¶</a></h3>
<p>Water (vs expt)</p>
<ol class="simple">
<li><p>DFT</p></li>
</ol>
<p>Energy from</p>
<div class="amsmath math notranslate nohighlight" id="equation-0cfbd491-3f34-47f6-a455-856426661d23">
<span class="eqno">(3)<a class="headerlink" href="#equation-0cfbd491-3f34-47f6-a455-856426661d23" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\Delta E = \epsilon_v - \epsilon_c
\end{equation}\]</div>
<p>and intensities from</p>
<div class="amsmath math notranslate nohighlight" id="equation-eb1e4cda-650e-4a8f-b7f0-b49f2c31c14f">
<span class="eqno">(4)<a class="headerlink" href="#equation-eb1e4cda-650e-4a8f-b7f0-b49f2c31c14f" title="Permalink to this equation">¶</a></span>\[\begin{equation}
f \propto \left| \langle \phi_i \left| \hat{\mu} \right| \phi_c \rangle \right| ^2
\end{equation}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_level&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">);</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Occupied orbital energies:&#39;</span><span class="p">,</span><span class="n">au2ev</span><span class="o">*</span><span class="n">orbital_energies</span><span class="p">[:</span><span class="n">nocc</span><span class="p">])</span>

<span class="n">core</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">overlap_energy</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">virt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">virt</span> <span class="o">!=</span> <span class="n">core</span><span class="p">:</span>
        <span class="n">overlap_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">virt</span><span class="p">]</span><span class="o">-</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">core</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Occupied orbital energies: [-520.65710171  -27.68789317  -14.39952915   -9.70377587   -7.9495301 ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Focusing on high-energy features&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">overlap_energy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">overlap_energy</span><span class="p">)))</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="nb">max</span><span class="p">(</span><span class="n">overlap_energy</span><span class="p">)</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">overlap_energy</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Focusing on high-energy features
</pre></div>
</div>
<img alt="../_images/xray_31_1.png" src="../_images/xray_31_1.png" />
</div>
</div>
<p>using cc-pCVTZ and compared to experiment</p>
<div class="figure align-default" id="overlap-water-xes">
<img alt="../_images/overlap_water_xes.svg" src="../_images/overlap_water_xes.svg" /><p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">foo</span><a class="headerlink" href="#overlap-water-xes" title="Permalink to this image">¶</a></p>
</div>
<p>plt.figure(figsize=(5,4)); plt.subplot(211)
x,y = overlap_energy, np.ones((len(overlap_energy)))
xi,yi = lorentzian(x,y,min(x)-5,max(x)+5,0.01,0.5); plt.plot(xi,yi)
plt.xlim((max(overlap_energy)-9,max(overlap_energy)+2)); plt.yticks([]); plt.legend((‘DFT overlap’,’’))
plt.subplot(212)
data = np.loadtxt(‘../img/xray/water_xes.dat’); x,y = [],[]
for data_tmp in data: x.append(data_tmp[0]), y.append(data_tmp[1])
plt.plot(x,y); plt.xlim((518,529)); plt.yticks([]); plt.legend((‘Experiment’,’’))
plt.show()</p>
</div>
<div class="section" id="maybe-uracil-in-solution">
<h3>Maybe: uracil in solution<a class="headerlink" href="#maybe-uracil-in-solution" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Gas phase</p></li>
<li><p>Environment with PE</p></li>
</ol>
</div>
<div class="section" id="maybe-valence-to-core-xes">
<h3>Maybe valence-to-core XES<a class="headerlink" href="#maybe-valence-to-core-xes" title="Permalink to this headline">¶</a></h3>
<p>Suitable TM-complex with minimal static correlation</p>
<ol class="simple">
<li><p>Overlap</p></li>
<li><p>TDDFT?</p></li>
</ol>
</div>
<div class="section" id="id1">
<h3>Maybe: massive system with DFT<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="resonant-inelastic-x-ray-scattering">
<h2>Resonant inelastic X-ray scattering<a class="headerlink" href="#resonant-inelastic-x-ray-scattering" title="Permalink to this headline">¶</a></h2>
<p>Water.</p>
<ol class="simple">
<li><p>2-step model</p></li>
<li><p>DKH</p></li>
</ol>
</div>
<div class="section" id="coupling-to-molecular-dynamics">
<h2>Coupling to molecular dynamics<a class="headerlink" href="#coupling-to-molecular-dynamics" title="Permalink to this headline">¶</a></h2>
<p>Some system…</p>
<ol class="simple">
<li><p>Dynamics + XAS</p></li>
<li><p>Dynamics + XES</p></li>
<li><p>Inclusion of environment?</p></li>
<li><p>Core-hole dynamics with some model?</p></li>
</ol>
</div>
<div class="section" id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="xas">
<h3>XAS<a class="headerlink" href="#xas" title="Permalink to this headline">¶</a></h3>
<p>Vinylfluoride. CVS-ADC and CPP-DFT.</p>
<p><strong>First:</strong> Calculate with CVS-ADC and CPP-DFT</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl</span>   <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># SCF</span>
<span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;STO-3G&#39;</span><span class="p">)</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># CVS space with three lowest</span>
<span class="n">adc_full</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 5 iterations.
Total Energy: -174.5316847142 au
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                        Algebraic Diagrammatic Construction (ADC)                                         
                                       ===========================================                                        
                                                                                                                          
                               ADC method                   : cvs-adc2x                                                   
                               Number of Singlet States     : 10                                                          
                               CVS-ADC, Core Orbital Space  : 1 2 3                                                       
                               Convergence threshold        : 1.0e-06                                                     
                                                                                                                          
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1    18       0.66368  371ms  [10.79556251 10.86083216 11.05848331 11.07029194 11.10293276 11.17549456
 11.25552281]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    36       0.20768  829ms  [10.53613915 10.61719282 10.81762471 10.85781897 10.92328311 10.98976267
 11.00779365]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    54      0.063995   1.1s  [10.52659545 10.60373295 10.79470139 10.8352191  10.89675294 10.91278772
 10.95586287]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    72      0.013737   1.3s  [10.52634778 10.60329747 10.79380103 10.83383819 10.89565996 10.90626357
 10.95005239]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    90      0.045045   1.5s  [10.52633803 10.60328555 10.79376335 10.83373354 10.89562432 10.90532901
 10.94935032]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    36     0.0079751   1.3s  [10.52633759 10.60328483 10.79376127 10.83372522 10.89562169 10.90523793
 10.94921546]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    54     0.0013228   1.1s  [10.52633755 10.60328468 10.793761   10.83372433 10.89562132 10.90522562
 10.94919037]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    72    0.00019889   1.3s  [10.52633755 10.60328467 10.79376099 10.83372426 10.89562129 10.90522412
 10.9491877 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9    90    2.0341e-05   1.5s  [10.52633755 10.60328467 10.79376099 10.83372425 10.89562128 10.90522399
 10.94918741]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10    36    2.6617e-06   1.3s  [10.52633755 10.60328467 10.79376099 10.83372425 10.89562128 10.90522398
 10.94918739]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11    54    5.4338e-07   1.0s  [10.52633755 10.60328467 10.79376099 10.83372425 10.89562128 10.90522398
 10.94918739]
=== Converged ===
    Number of matrix applies:    198
    Total solver time:            12s 581ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                                  ADC Summary of Results                                                  
                                                 ------------------------                                                 
                                                                                                                          
                             +--------------------------------------------------------------+                             
                             | cvs-adc2x                               singlet ,  converged |                             
                             +--------------------------------------------------------------+                             
                             |  #        excitation energy     osc str    |v1|^2    |v2|^2  |                             
                             |          (au)           (eV)                                 |                             
                             |  0      10.52634      286.4362   0.0549    0.7824    0.2176  |                             
                             |  1      10.60328      288.5301   0.0577    0.7637    0.2363  |                             
                             |  2      10.79376      293.7132   0.0273    0.7758    0.2242  |                             
                             |  3      10.83372      294.8007   0.0609    0.8144    0.1856  |                             
                             |  4      10.89562       296.485   0.0323    0.8391    0.1609  |                             
                             |  5      10.90522      296.7463   0.0209    0.7334    0.2666  |                             
                             |  6      10.94919      297.9426   0.0228    0.7931    0.2069  |                             
                             |  7      10.99523      299.1954   0.0015   0.02016    0.9798  |                             
                             |  8      11.03133      300.1778   0.0010   0.02074    0.9793  |                             
                             |  9      11.04421      300.5282   0.0131     0.689     0.311  |                             
                             +--------------------------------------------------------------+                             
                                                                                                                          
                                          End of ADC calculation. All went well!                                          
                                                                                                                          
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># CPP-DFT calculation. Note different energy. Comparison to expt below.</span>
</pre></div>
</div>
</div>
</div>
<p>Discuss chemical shifts.</p>
<p>Now, lets look at various analysis tools.</p>
<p>Can study the amplitudes involved in adc calculations using the <code class="docutils literal notranslate"><span class="pre">state.describe_amplitudes</span></code> function, which takes as input <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> which controls minimum amplitude to be printed, and the format using <code class="docutils literal notranslate"><span class="pre">index_format</span></code>, which takes three different forms. Splitting the resulting returning string according to <code class="docutils literal notranslate"><span class="pre">state</span></code> and printing the results for the first two states, we obtain:</p>
<div class="section" id="amplitudes">
<h4>Amplitudes<a class="headerlink" href="#amplitudes" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">hf</span><span class="se">\&#39;</span><span class="s1"> format, which yield MO number:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_full</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;hf&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">adcc</span><span class="se">\&#39;</span><span class="s1"> format, which indexing as used in adcc:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_full</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;adcc&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">homolumo</span><span class="se">\&#39;</span><span class="s1"> format, which using HOMO/LUMO/HOCO format:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_full</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;homolumo&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>From &#39;hf&#39; format, which yield MO number:
+-----------------------------------+
| State   1 ,      10.60328 au      |
+-----------------------------------+
|  1    -&gt; 12     a -&gt;a      -0.618 |
| 11  1 -&gt; 12 12  ab-&gt;ab     -0.193 |
+-----------------------------------+
| State   2 ,      10.79376 au      |
+-----------------------------------+
|  2    -&gt; 13     a -&gt;a      -0.616 |
| 11  2 -&gt; 12 13  ab-&gt;ab     +0.133 |
| 11  2 -&gt; 12 13  aa-&gt;aa     +0.116 |

From &#39;adcc&#39; format, which indexing as used in adcc:
+-------------------------------------------------------+
| State   1 ,      10.60328 au,      288.5301 eV        |
+-------------------------------------------------------+
| (o2  1)         -&gt; (v1  0)          a -&gt;a      -0.618 |
| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     -0.193 |
+-------------------------------------------------------+
| State   2 ,      10.79376 au,      293.7132 eV        |
+-------------------------------------------------------+
| (o2  2)         -&gt; (v1  1)          a -&gt;a      -0.616 |
| (o1  8) (o2  2) -&gt; (v1  0) (v1  1)  ab-&gt;ab     +0.133 |
| (o1  8) (o2  2) -&gt; (v1  0) (v1  1)  aa-&gt;aa     +0.116 |

From &#39;homolumo&#39; format, which using HOMO/LUMO/HOCO format:
+---------------------------------------------------+
| State   1 ,      10.60328 au,      288.5301 eV    |
+---------------------------------------------------+
| HOCO-1        -&gt; LUMO           a -&gt;a      -0.618 |
| HOMO   HOCO-1 -&gt; LUMO   LUMO    ab-&gt;ab     -0.193 |
+---------------------------------------------------+
| State   2 ,      10.79376 au,      293.7132 eV    |
+---------------------------------------------------+
| HOCO          -&gt; LUMO+1         a -&gt;a      -0.616 |
| HOMO   HOCO   -&gt; LUMO   LUMO+1  ab-&gt;ab     +0.133 |
| HOMO   HOCO   -&gt; LUMO   LUMO+1  aa-&gt;aa     +0.116 |
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="atomic-contributions">
<h4>Atomic contributions<a class="headerlink" href="#atomic-contributions" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ADC space discussion elsewhere</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">plt.figure(figsize=(6,4))</span>
<span class="sd">x,y = au2ev*adc_full.excitation_energy, adc_full.oscillator_strength</span>
<span class="sd">xi,yi = lorentzian(x,y,285,300,0.01,0.5); plt.plot(xi,yi)</span>
<span class="sd">x,y = au2ev*adc_chf.excitation_energy, adc_chf.oscillator_strength</span>
<span class="sd">xi,yi = lorentzian(x,y,285,300,0.01,0.5); plt.plot(xi,yi)</span>
<span class="sd">x,y = au2ev*adc_ch2.excitation_energy, adc_ch2.oscillator_strength</span>
<span class="sd">xi,yi = lorentzian(x,y,285,300,0.01,0.5); plt.plot(xi,yi)</span>
<span class="sd">plt.legend((&#39;Fluorine and carbons&#39;,&#39;-CHF&#39;,&#39;-CH2&#39;),loc=&#39;upper left&#39;,fontsize=8)</span>
<span class="sd">plt.xlim((285,297))</span>
<span class="sd">plt.show()</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;\nplt.figure(figsize=(6,4))\nx,y = au2ev*adc_full.excitation_energy, adc_full.oscillator_strength\nxi,yi = lorentzian(x,y,285,300,0.01,0.5); plt.plot(xi,yi)\nx,y = au2ev*adc_chf.excitation_energy, adc_chf.oscillator_strength\nxi,yi = lorentzian(x,y,285,300,0.01,0.5); plt.plot(xi,yi)\nx,y = au2ev*adc_ch2.excitation_energy, adc_ch2.oscillator_strength\nxi,yi = lorentzian(x,y,285,300,0.01,0.5); plt.plot(xi,yi)\nplt.legend((&#39;Fluorine and carbons&#39;,&#39;-CHF&#39;,&#39;-CH2&#39;),loc=&#39;upper left&#39;,fontsize=8)\nplt.xlim((285,297))\nplt.show()\n&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adc_chf</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">adc_ch2</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                        Algebraic Diagrammatic Construction (ADC)                                         
                                       ===========================================                                        
                                                                                                                          
                               ADC method                   : cvs-adc2x                                                   
                               Number of Singlet States     : 4                                                           
                               CVS-ADC, Core Orbital Space  : 2                                                           
                               Convergence threshold        : 1.0e-06                                                     
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     6       0.32663  132ms  [10.86089969 11.05861391 11.17551693 11.38077554]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    12       0.10666  163ms  [10.61723896 10.85785137 11.00772384 11.23466861]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    18      0.051857  198ms  [10.60376707 10.83524668 10.95659469 11.14005445]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    24     0.0097457  230ms  [10.60331911 10.8338788  10.95032122 11.06474463]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    30      0.003439  241ms  [10.60330706 10.83377076 10.94949297 11.04952999]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    12     0.0032205  237ms  [10.60330629 10.83375741 10.94929023 11.04369198]
  7    18     0.0029367  193ms  [10.60330614 10.8337551  10.94922111 11.03674139]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    24    0.00095608  222ms  [10.60330613 10.83375487 10.94920785 11.03362283]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9    30    0.00029649  265ms  [10.60330613 10.83375484 10.94920459 11.03203514]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10    12    8.6485e-05  224ms  [10.60330613 10.83375483 10.94920421 11.03167828]
 11    18    0.00010066  199ms  [10.60330613 10.83375483 10.9492041  11.03148874]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 12    24    2.9719e-05  238ms  [10.60330613 10.83375483 10.94920407 11.03138095]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 13    30    6.9235e-06  262ms  [10.60330613 10.83375483 10.94920406 11.03134506]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 14    12    1.4935e-06  214ms  [10.60330613 10.83375483 10.94920406 11.03133843]
 15    18    4.4218e-07  177ms  [10.60330613 10.83375483 10.94920406 11.03133623]
=== Converged ===
    Number of matrix applies:    90
    Total solver time:             3s 220ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                                  ADC Summary of Results                                                  
                                                 ------------------------                                                 
                                                                                                                          
                             +--------------------------------------------------------------+                             
                             | cvs-adc2x                               singlet ,  converged |                             
                             +--------------------------------------------------------------+                             
                             |  #        excitation energy     osc str    |v1|^2    |v2|^2  |                             
                             |          (au)           (eV)                                 |                             
                             |  0      10.60331      288.5307   0.0568    0.7637    0.2363  |                             
                             |  1      10.83375      294.8015   0.0595    0.8145    0.1855  |                             
                             |  2       10.9492       297.943   0.0230    0.7931    0.2069  |                             
                             |  3      11.03134       300.178   0.0009    0.0207    0.9793  |                             
                             +--------------------------------------------------------------+                             
                                                                                                                          
                                          End of ADC calculation. All went well!                                          
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                        Algebraic Diagrammatic Construction (ADC)                                         
                                       ===========================================                                        
                                                                                                                          
                               ADC method                   : cvs-adc2x                                                   
                               Number of Singlet States     : 4                                                           
                               CVS-ADC, Core Orbital Space  : 3                                                           
                               Convergence threshold        : 1.0e-06                                                     
                                                                                                                          
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     6       0.36949  156ms  [10.79563886 11.07023139 11.10295022 11.25567067]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    12      0.054972  255ms  [10.53618443 10.81767172 10.92333568 10.99020619]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    18     0.0045679  300ms  [10.52662741 10.79471015 10.89677942 10.91278488]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    24    0.00071312  385ms  [10.52637493 10.79383844 10.89568946 10.9063137 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    30    0.00014048  330ms  [10.52636473 10.79379891 10.89564712 10.90539127]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    12    2.1954e-05  567ms  [10.52636428 10.79379676 10.89564422 10.90527894]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    18    4.7578e-06  419ms  [10.52636425 10.79379648 10.89564369 10.9052578 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    24    9.7131e-07  384ms  [10.52636425 10.79379646 10.89564355 10.90525355]
=== Converged ===
    Number of matrix applies:    48
    Total solver time:             2s 827ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                                                                                                                          
                                                  ADC Summary of Results                                                  
                                                 ------------------------                                                 
                                                                                                                          
                             +--------------------------------------------------------------+                             
                             | cvs-adc2x                               singlet ,  converged |                             
                             +--------------------------------------------------------------+                             
                             |  #        excitation energy     osc str    |v1|^2    |v2|^2  |                             
                             |          (au)           (eV)                                 |                             
                             |  0      10.52636       286.437   0.0558    0.7824    0.2176  |                             
                             |  1       10.7938      293.7142   0.0286    0.7758    0.2242  |                             
                             |  2      10.89564      296.4856   0.0318    0.8391    0.1609  |                             
                             |  3      10.90525      296.7471   0.0207    0.7334    0.2666  |                             
                             +--------------------------------------------------------------+                             
                                                                                                                          
                                          End of ADC calculation. All went well!                                          
                                                                                                                          
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resolving core contributions using different eigenstates&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_chf</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_chf</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x1i</span><span class="p">,</span><span class="n">y1i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_ch2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_ch2</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x2i</span><span class="p">,</span><span class="n">y2i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span><span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="s1">&#39;-CH2&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">282</span><span class="p">,</span><span class="mi">297</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resolving core contributions using different eigenstates
</pre></div>
</div>
<img alt="../_images/xray_45_1.png" src="../_images/xray_45_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAYBE: the same using the full-space eigenvectors&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compare these two approaches!&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Could come from looking more into the eigenstates, or by just splitting the describe_amplitude results...&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAYBE: the same using the full-space eigenvectors
Compare these two approaches!
Could come from looking more into the eigenstates, or by just splitting the describe_amplitude results...
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">vinyl</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;STO-3G&quot;</span><span class="p">)</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_level&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">);</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">270.0</span><span class="p">,</span><span class="mf">282.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span><span class="p">;</span> <span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">au2ev</span><span class="p">}</span>
                                         <span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span> <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">));</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Splined&#39;</span><span class="p">,</span><span class="s1">&#39;CPP-DFT&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_48_0.png" src="../_images/xray_48_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="n">nvirt</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="o">.</span><span class="n">number_mos</span><span class="p">()</span> <span class="o">-</span> <span class="n">nocc</span>
<span class="n">spec_comp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">solution_vecs</span> <span class="o">=</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;solutions&#39;</span><span class="p">)</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">x_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)]);</span> <span class="n">y_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)]);</span> <span class="n">z_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">x_solution</span><span class="p">,</span><span class="n">x_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_solution</span><span class="p">)</span>
<span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nocc</span><span class="p">):</span> <span class="n">spec_comp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">z_tmp</span> <span class="o">=</span> <span class="n">z_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nocc</span><span class="p">):</span>
        <span class="n">comp_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[:])))</span>
        <span class="n">spec_comp</span><span class="p">[</span><span class="n">occ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_X</span><span class="o">*</span><span class="n">sX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Y</span><span class="o">*</span><span class="n">sY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Z</span><span class="o">*</span><span class="n">sZ</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">mo1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">mo2</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">mo_rest</span> <span class="o">=</span> <span class="n">spec_comp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">mo_rest</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">spec_comp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

        
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y1</span>    <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">mo1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yrest</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">mo_rest</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yrest</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yrest</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yrest</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span><span class="s1">&#39;MO #1&#39;</span><span class="p">,</span><span class="s1">&#39;Rest&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">49</span><span class="o">-</span><span class="n">fb0b2e308921</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>         <span class="n">comp_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[:])))</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>         <span class="n">comp_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[:])))</span>
<span class="ne">---&gt; </span><span class="mi">24</span>         <span class="n">spec_comp</span><span class="p">[</span><span class="n">occ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_X</span><span class="o">*</span><span class="n">sX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Y</span><span class="o">*</span><span class="n">sY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Z</span><span class="o">*</span><span class="n">sZ</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="n">mo1</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="ne">IndexError</span>: list index out of range
</pre></div>
</div>
</div>
</div>
<p>We see that</p>
<ul class="simple">
<li><p>The first two states corresponds to transitions from two different MOs, which here corresponds to CHF and CH2</p></li>
<li><p>The transitions are dominated to two different virtuals</p></li>
</ul>
</div>
<div class="section" id="polarization">
<h4>Polarization<a class="headerlink" href="#polarization" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Polarization&#39;</span><span class="p">)</span>
<span class="n">prefactor</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">sX</span><span class="p">,</span><span class="n">sY</span><span class="p">,</span><span class="n">sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">adc_full</span><span class="o">.</span><span class="n">excitation_energy</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)):</span>
    <span class="n">tmp_tms</span> <span class="o">=</span> <span class="n">adc_full</span><span class="o">.</span><span class="n">transition_dipole_moment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">freq</span><span class="p">,</span> <span class="n">sX</span>
<span class="n">xX</span><span class="p">,</span><span class="n">yX</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">285</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">freq</span><span class="p">,</span> <span class="n">sY</span>
<span class="n">xY</span><span class="p">,</span><span class="n">yY</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">285</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">freq</span><span class="p">,</span> <span class="n">sZ</span>
<span class="n">xZ</span><span class="p">,</span><span class="n">yZ</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">285</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span><span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">285</span><span class="p">,</span><span class="mi">297</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Polarization
</pre></div>
</div>
<img alt="../_images/xray_51_1.png" src="../_images/xray_51_1.png" />
</div>
</div>
<p>This can be done for CPP-DFT, taking the water calculation from above as an example.</p>
<p>Polarization:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sX</span><span class="p">,</span><span class="n">sY</span><span class="p">,</span><span class="n">sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">axx</span> <span class="o">/</span> <span class="mf">137.035999</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="n">sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">ayy</span> <span class="o">/</span> <span class="mf">137.035999</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
    <span class="n">sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">azz</span> <span class="o">/</span> <span class="mf">137.035999</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">yX</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sX</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yY</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yZ</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sZ</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_53_0.png" src="../_images/xray_53_0.png" />
</div>
</div>
<p>And atomic:</p>
<p>…which is of course only one atom…</p>
<p>The decomposition for vinylfluoride yields</p>
</div>
<div class="section" id="comparison-between-adc-and-dft">
<h4>Comparison between ADC and DFT<a class="headerlink" href="#comparison-between-adc-and-dft" title="Permalink to this headline">¶</a></h4>
<p>One figure - ADC and TDDFT, atomic and polarization</p>
<div class="figure align-default" id="vinyl-decomp">
<img alt="../_images/vinyl_decomp.svg" src="../_images/vinyl_decomp.svg" /><p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">foo</span><a class="headerlink" href="#vinyl-decomp" title="Permalink to this image">¶</a></p>
</div>
<p>Visualization and descriptors (?)</p>
</div>
</div>
</div>
<div class="section" id="self-interaction-error-in-dft">
<h2>Self-interaction error in DFT<a class="headerlink" href="#self-interaction-error-in-dft" title="Permalink to this headline">¶</a></h2>
<p>For a single-electron systems the following equality should hold for the two-electron terms:</p>
<div class="math notranslate nohighlight">
\[
J[\rho] + E_{xc} [\rho] = 0.0
\]</div>
<p>This cancellation is achieved for, e.g. Hartree–Fock theory, but for any approximate functionals in DFT it will instead result in an erronous contribution to the energy. DFT-based methods generally suffer from self-interaction error (SIE), which corresponds to the sum of Coulomb and exchange self-interactions that remain because of the use of approximate exchange functionals. In more detail, the Coulomb self-repulsion of each electron included in the Coulomb operator is exactly canceled by the nonlocal exchange self-attraction in Hartree–Fock theory, but this is no longer the case when the exchange operator is replaced by an approximate exchange functional.</p>
<ul class="simple">
<li><p>Radial distribution or something for functionals? Calculate error?</p></li>
</ul>
</div>
<div class="section" id="relativity">
<h2>Relativity<a class="headerlink" href="#relativity" title="Permalink to this headline">¶</a></h2>
<p>Total relativistic and correlation corrections as a function of Z</p>
<div class="section" id="scalar-relativistic-effects">
<h3>Scalar relativistic effects<a class="headerlink" href="#scalar-relativistic-effects" title="Permalink to this headline">¶</a></h3>
<div class="section" id="shift-in-ip">
<h4>Shift in IP<a class="headerlink" href="#shift-in-ip" title="Permalink to this headline">¶</a></h4>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">,</span> <span class="n">rel_mo</span><span class="p">,</span> <span class="n">rel_delta</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   0.0  0.0  0.0&#39;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">();</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">struct</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-ccpvdz&#39;</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">rel_mo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">27.2114</span><span class="o">*</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">ion_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span>  <span class="n">ion_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ion_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span>     <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_rel</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span>     <span class="n">ion_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">rel_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">27.2114</span><span class="o">*</span><span class="p">((</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">ion_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -2.85516047724517  &lt;S^2&gt; = 8.8817842e-16  2S+1 = 1
converged SCF energy = -2.85525304501806  &lt;S^2&gt; = -8.8817842e-16  2S+1 = 1
converged SCF energy = -1.99426858617921  &lt;S^2&gt; = 0.75  2S+1 = 2
converged SCF energy = -1.99436880481929  &lt;S^2&gt; = 0.75  2S+1 = 2
converged SCF energy = -14.5723376313364  &lt;S^2&gt; = -1.3322676e-15  2S+1 = 1
converged SCF energy = -14.5748455751004  &lt;S^2&gt; = -1.7763568e-15  2S+1 = 1
converged SCF energy = -10.0357274640245  &lt;S^2&gt; = 0.75629212  2S+1 = 2.0062823
converged SCF energy = -10.0378218682236  &lt;S^2&gt; = 0.75630468  2S+1 = 2.0062948
converged SCF energy = -37.596291563267  &lt;S^2&gt; = 0  2S+1 = 1
converged SCF energy = -37.6112425609769  &lt;S^2&gt; = 1.7763568e-15  2S+1 = 1
converged SCF energy = -26.6586016324337  &lt;S^2&gt; = 0.75725115  2S+1 = 2.0072381
converged SCF energy = -26.6699783724446  &lt;S^2&gt; = 0.75726738  2S+1 = 2.0072542
converged SCF energy = -74.665428938125  &lt;S^2&gt; = 4.4408921e-16  2S+1 = 1
converged SCF energy = -74.717502069482  &lt;S^2&gt; = 8.8817842e-16  2S+1 = 1
converged SCF energy = -54.5945032394038  &lt;S^2&gt; = 0.75658425  2S+1 = 2.0065734
converged SCF energy = -54.632827234564  &lt;S^2&gt; = 0.75660276  2S+1 = 2.0065919
converged SCF energy = -128.488775570938  &lt;S^2&gt; = 7.1054274e-15  2S+1 = 1
converged SCF energy = -128.62541537372  &lt;S^2&gt; = -4.4408921e-15  2S+1 = 1
converged SCF energy = -96.5516222970474  &lt;S^2&gt; = 0.75578137  2S+1 = 2.005773
converged SCF energy = -96.6510283847189  &lt;S^2&gt; = 0.75580087  2S+1 = 2.0057925
converged SCF energy = -199.608297084141  &lt;S^2&gt; = -8.8817842e-15  2S+1 = 1
converged SCF energy = -199.914940213906  &lt;S^2&gt; = -1.7763568e-15  2S+1 = 1
converged SCF energy = -151.491503261379  &lt;S^2&gt; = 0.75303231  2S+1 = 2.00303
converged SCF energy = -151.717159175501  &lt;S^2&gt; = 0.75305441  2S+1 = 2.0030521
converged SCF energy = -288.787205052154  &lt;S^2&gt; = -5.3290705e-15  2S+1 = 1
converged SCF energy = -289.390917359355  &lt;S^2&gt; = 3.5527137e-15  2S+1 = 1
converged SCF energy = -220.963046126516  &lt;S^2&gt; = 0.75243322  2S+1 = 2.0024317
converged SCF energy = -221.408449536242  &lt;S^2&gt; = 0.75245636  2S+1 = 2.0024549
converged SCF energy = -397.413437578762  &lt;S^2&gt; = -1.7763568e-15  2S+1 = 1
converged SCF energy = -398.496590616452  &lt;S^2&gt; = -5.3290705e-15  2S+1 = 1
converged SCF energy = -306.488275279816  &lt;S^2&gt; = 0.75212654  2S+1 = 2.0021254
converged SCF energy = -307.289416362877  &lt;S^2&gt; = 0.75215123  2S+1 = 2.0021501
converged SCF energy = -526.799865309821  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
converged SCF energy = -528.611698214501  &lt;S^2&gt; = 1.7763568e-15  2S+1 = 1
converged SCF energy = -409.378251604582  &lt;S^2&gt; = 0.75188904  2S+1 = 2.0018881
converged SCF energy = -410.722091098659  &lt;S^2&gt; = 0.75191517  2S+1 = 2.0019143
</pre></div>
</div>
</div>
</div>
<p>yielding</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">rel_mo</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">rel_delta</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;From MO energies&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;From $\Delta$SCF&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Atomic number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relativistic effects [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_60_0.png" src="../_images/xray_60_0.png" />
</div>
</div>
</div>
<div class="section" id="shift-in-xas">
<h4>Shift in XAS<a class="headerlink" href="#shift-in-xas" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># non-relativistic</span>
<span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_nr</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_nr</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># relativistic</span>
<span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_rel</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_rel</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783229
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    10        2.7777  640ms  [20.276 20.312 20.861 20.922 20.93 ]
  2    20      0.035824  561ms  [19.729 19.811 20.31  20.405 20.498]
  3    30    4.1402e-05  581ms  [19.724 19.807 20.306 20.4   20.498]
=== Converged ===
    Number of matrix applies:    30
    Total solver time:             1s 818ms
converged SCF energy = -76.0403950942686
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    10        2.7842  505ms  [20.29  20.327 20.876 20.937 20.945]
  2    20      0.036027  537ms  [19.743 19.825 20.325 20.419 20.513]
  3    30    4.1677e-05  648ms  [19.738 19.821 20.32  20.414 20.512]
=== Converged ===
    Number of matrix applies:    30
    Total solver time:             1s 746ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">adc_nr</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-relativistic&#39;</span><span class="p">)</span>
<span class="n">adc_rel</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Relativistic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy shift of the first feature:&#39;</span><span class="p">,</span>
      <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">adc_rel</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">adc_nr</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_63_0.png" src="../_images/xray_63_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy shift of the first feature: 0.38 eV
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="shift-in-xes">
<h4>Shift in XES<a class="headerlink" href="#shift-in-xes" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># non-relativistic</span>
<span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ion_nr</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">ion_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_nr</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span><span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># relativistic (can reuse the non-relativistic SCF start)</span>
<span class="n">ion_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_rel</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">ion_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_rel</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">ion_rel</span><span class="p">,</span><span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783204  &lt;S^2&gt; = 8.9066532e-12  2S+1 = 1
converged SCF energy = -56.1707263747173  &lt;S^2&gt; = 0.76785148  2S+1 = 2.0177725
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8        7.5126   2.1s  [-19.076 -18.983 -18.741 -18.153]
  2    16      0.045812  386ms  [-19.393 -19.319 -19.131 -18.544]
  3    24    2.6332e-05  366ms  [-19.394 -19.32  -19.133 -18.546]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             2s 861ms
converged SCF energy = -56.2081331115692  &lt;S^2&gt; = 0.76789584  2S+1 = 2.0178165
Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8        7.5482   2.1s  [-19.09  -18.996 -18.754 -18.165]
  2    16      0.046112  601ms  [-19.407 -19.333 -19.146 -18.557]
  3    24    2.6698e-05  425ms  [-19.408 -19.334 -19.147 -18.558]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:             3s 177ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">adc_nr</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-relativistic&#39;</span><span class="p">)</span>
<span class="n">adc_rel</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Relativistic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy shift of the first feature:&#39;</span><span class="p">,</span>
      <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">adc_rel</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">adc_nr</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_66_0.png" src="../_images/xray_66_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy shift of the first feature: 0.39 eV
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="spin-orbit-coupling">
<h3>Spin-orbit coupling<a class="headerlink" href="#spin-orbit-coupling" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="relaxation">
<h2>Relaxation<a class="headerlink" href="#relaxation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="in-adc">
<h3>In ADC<a class="headerlink" href="#in-adc" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="in-tddft">
<h3>In TDDFT<a class="headerlink" href="#in-tddft" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Radial distribution: Z, Z with hole, Z+1</p></li>
<li><p>Total density: formaldehyde</p></li>
<li><p>Maybe: visualization of effects for XAS and XES</p></li>
</ol>
<div class="figure align-default" id="relax-form">
<img alt="../_images/relax_form.svg" src="../_images/relax_form.svg" /><p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">foo</span><a class="headerlink" href="#relax-form" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="basis-set-considerations">
<h2>Basis set considerations<a class="headerlink" href="#basis-set-considerations" title="Permalink to this headline">¶</a></h2>
<p>The basis set requirements of X-ray spectrum calculations will depend strongly on which spectroscopy</p>
<ul class="simple">
<li><p>XPS and XES probes occupied states, and thus need a good description of those</p></li>
<li><p>XAS and RIXS probes excited states, and thus need an improved description also of this region</p></li>
</ul>
<p>However, in both cases the relaxation due to the creation of a core-hole need to be enabled, which yield requirements of reasonable flexibility of the core and inner valence region. This is not typically the case, as most studies deals with valence electron and thus have a minimal or close to minimal description of the core region.</p>
<p>A number of approaches for improving the basis sets have been developed:</p>
<ol class="simple">
<li><p>Augment the Dunning basis sets with core-polarizing functions, e.g. cc-pV<em>n</em>Z <span class="math notranslate nohighlight">\(\rightarrow\)</span> cc-pCV<em>n</em>Z</p></li>
<li><p>Adding extra flexibility by performing full or partial decontraction, e.g.</p>
<ol class="simple">
<li><p>u6-311++G** is 6-311++G** with decontracted 1s function of the probed element</p></li>
<li><p>un-6-311++G** is a fully decontracted 6-311++G** basis set</p></li>
</ol>
</li>
<li><p>Use basis functions from the next element, is inspired by the equvalent core/Z+1 approximation</p></li>
</ol>
<p>Here we focus on the basis set effects for calculations of the IP of water, and we encourage the interested reader to do the same excercise for XES, as well as for XAS (where the augmentation of diffuse functions also need to be considered).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">un6311gss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      9.628370               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      2.853320               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">z6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  0.00189515</span>
<span class="s1">   1297.230                  0.0143859</span>
<span class="s1">    299.2960                 0.0707320</span>
<span class="s1">     87.37710                0.2400010</span>
<span class="s1">     25.67890                0.5947970</span>
<span class="s1">      3.740040               0.2808020</span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">O    S</span>
<span class="s1">  11427.10                   0.00180093</span>
<span class="s1">   1722.350                  0.0137419</span>
<span class="s1">    395.7460                 0.0681334</span>
<span class="s1">    115.1390                 0.2333250</span>
<span class="s1">     33.60260                0.5890860</span>
<span class="s1">      4.919010               0.2995050</span>
<span class="s1">O    SP</span>
<span class="s1">     55.44410                0.114536               0.0354609</span>
<span class="s1">     12.63230                0.920512               0.237451</span>
<span class="s1">      3.717560              -0.00337804             0.820458</span>
<span class="s1">O    SP</span>
<span class="s1">      1.165450               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.321892               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.750                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Exotic version of basis sets found above</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">basis_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6-311G**&#39;</span><span class="p">,</span><span class="n">u6311gss</span><span class="p">,</span><span class="n">un6311gss</span><span class="p">,</span><span class="n">z6311gss</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVTZ&#39;</span><span class="p">,</span><span class="s1">&#39;cc-pVQZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVQZ&#39;</span><span class="p">]</span>
<span class="n">ip_hf</span><span class="p">,</span> <span class="n">ip_mp2</span><span class="p">,</span> <span class="n">ip_ccsd</span><span class="p">,</span> <span class="n">ip_b3lyp</span><span class="p">,</span> <span class="n">n_bas</span> <span class="o">=</span> <span class="p">[],[],[],[],[]</span>
<span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_sets</span><span class="p">:</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">();</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_hf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="n">ccsd_res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfres</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">();</span> <span class="n">ccsd_ion</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_cycle</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">ip_ccsd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
    <span class="n">ip_mp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_hf</span><span class="o">+</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">emp2</span><span class="o">-</span><span class="p">(</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_hf</span><span class="o">+</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">emp2</span><span class="p">)))</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scfres</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">;</span> <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">scfion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">;</span> <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_b3lyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="n">n_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">basis_set_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;u6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;un6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;6-311G** (Z+1)&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVTZ&#39;</span><span class="p">,</span><span class="s1">&#39;cc-pVQZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVQZ&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_hf</span><span class="p">,</span><span class="s1">&#39;r*&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_mp2</span><span class="p">,</span><span class="s1">&#39;bv&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_ccsd</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_b3lyp</span><span class="p">,</span><span class="s1">&#39;go&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">],[</span><span class="mf">539.9</span><span class="p">,</span><span class="mf">539.9</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">],[</span><span class="mf">539.9</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">539.9</span><span class="o">-</span><span class="mf">0.3</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ionization potential [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;HF&#39;</span><span class="p">,</span><span class="s1">&#39;MP2&#39;</span><span class="p">,</span><span class="s1">&#39;CCSD&#39;</span><span class="p">,</span><span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span><span class="s1">&#39;Expt&#39;</span><span class="p">,</span><span class="s1">&#39;Expt - 0.3 eV&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">basis_set_labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;basis_xps.svg&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The execution of which yields</p>
<div class="figure align-default" id="basis-xps">
<img alt="../_images/basis_xps.svg" src="../_images/basis_xps.svg" /><p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">foo</span><a class="headerlink" href="#basis-xps" title="Permalink to this image">¶</a></p>
</div>
<p>On the y-axis we see the basis set labels, with order and position determined by the number of basis functions.</p>
<p>We see that…</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title">An optional title</p>
<p>My margin content</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Not included (yet)</strong></p>
<ul class="simple">
<li><p>SO-coupling</p></li>
<li><p>beyond electrinc-dipole approximation</p></li>
<li><p>multireference methods</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>

<span class="n">mol_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">C        0.00000000    0.00000000    0.00000000</span>
<span class="s2">O        0.00000000    0.00000000    1.43</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">mol_str</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;sto-3g&quot;</span><span class="p">)</span>

<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overlap matrix:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>

<span class="c1"># not available</span>
<span class="c1">#print(&#39;Available basis sets for carbon:\n&#39;, vlx.MolecularBasis.get_avail_basis(&#39;C&#39;))</span>

<span class="n">kin_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">KineticEnergyIntegralsDriver</span><span class="p">()</span>
<span class="n">T_ao</span> <span class="o">=</span> <span class="n">kin_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ai, ab, bj -&gt; ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">T_ao</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>

<span class="n">npot_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">NuclearPotentialIntegralsDriver</span><span class="p">()</span>
<span class="n">V_ao</span> <span class="o">=</span> <span class="o">-</span><span class="n">npot_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ai, ab, bj -&gt; ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">V_ao</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>

<span class="c1"># core Hamiltonian</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">V</span>

<span class="n">h_aver</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ii&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">[:</span><span class="n">nocc</span><span class="p">,:</span><span class="n">nocc</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Expectation value of one-electron Hamiltonian:&#39;</span><span class="p">,</span> <span class="n">h_aver</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="mi">25</span><span class="n">fdf50abce5</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">kin_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">KineticEnergyIntegralsDriver</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">T_ao</span> <span class="o">=</span> <span class="n">kin_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ai, ab, bj -&gt; ij&#39;</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">T_ao</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">npot_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">NuclearPotentialIntegralsDriver</span><span class="p">()</span>

<span class="ne">TypeError</span>: __init__(): incompatible constructor arguments. The following argument types are supported:
<span class="g g-Whitespace">    </span><span class="mi">1</span><span class="o">.</span> <span class="n">veloxchem</span><span class="o">.</span><span class="n">veloxchemlib</span><span class="o">.</span><span class="n">KineticEnergyIntegralsDriver</span><span class="p">(</span><span class="n">arg0</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span>

<span class="n">Invoked</span> <span class="k">with</span><span class="p">:</span> 
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="nlo.html" title="previous page">Multi-photon interactions</a>
    <a class='right-next' id="next-link" href="elecstruct-general.html" title="next page">General aspects</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The eChem team<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>