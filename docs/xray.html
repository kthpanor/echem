
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>X-ray spectroscopies &#8212; Computational Chemistry from  Laptop to HPC</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="General aspects" href="elecstruct-general.html" />
    <link rel="prev" title="Multi-photon interactions" href="nlo.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Computational Chemistry from  Laptop to HPC</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Getting started
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tutorials and workflows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="uv-vis.html">
   UV/vis absorption/emission
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="reactivity.html">
   Catalysis and reactivity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dichroism.html">
   Optical activity and dichroism
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vibrational.html">
   Vibrational spectroscopies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="transmetal.html">
   Transition metals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="magnetic.html">
   Magnetic resonances
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nlo.html">
   Multi-photon interactions
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   X-ray spectroscopies
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Electronic structure theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="elecstruct-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="orbitals.html">
     Orbitals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="basis.html">
     Basis sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="slater.html">
     Slater determinants
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="secondquant.html">
     Second quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="wft.html">
   Wave function theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="wft-general.html">
     General aspects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="hartree-fock.html">
     Hartree–Fock theory
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ci.html">
     Configuration interaction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mp2.html">
     Møller–Plesset
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="dft.html">
   Density functional theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="hohenberg.html">
     Hohenberg–Kohn theorems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="kohn-sham.html">
     Kohn–Sham method
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Potential energy surfaces
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="pes-general.html">
   General aspects
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="coordinates.html">
     Choice of coordinates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="gradhess.html">
     Gradients and Hessians
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="forcefields.html">
     Force fields
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="structopt.html">
   Molecular structure optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tst.html">
   Transition-state theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="conint.html">
   Conical intersection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="moldyn.html">
   Molecular dynamics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Properties
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="response.html">
   Response theory
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="exact-response.html">
     Exact states
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scf-response.html">
     SCF states
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="adc.html">
   Algebraic diagrammatic construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="excoupl.html">
   Exciton coupling model
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Environment
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="pe.html">
   Polarizable embedding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Visualization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="visual-orbitals.html">
   Molecular orbitals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="visual-densities.html">
   Reduced particle densities
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/xray.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdocs/xray.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/docs/xray.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-photoemission-spectroscopy">
   X-ray photoemission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ip-s-from-koopmans-theorem">
     IP:s from Koopmans’ theorem
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-maximum-overlap-method-mom">
     The maximum overlap method (MOM)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ip-s-from-delta-textrm-scf">
     IP:s from
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-delta-textrm-scf">
     Spectra from
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-approaches">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-absorption-spectroscopy">
   X-ray absorption spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decoupling-transitions-from-the-valence-continuum">
     Decoupling transitions from the valence continuum
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cvs-adc-eigenstates">
     Spectra from CVS-ADC eigenstates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-tddft-eigenstates">
     Spectra from TDDFT eigenstates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-cpp-dft">
     Spectra from CPP-DFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#x-ray-emission-spectroscopy">
   X-ray emission spectroscopy
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-adc">
     Spectra from ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-tddft">
     Spectra from TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spectra-from-ground-state-mo-s">
     Spectra from ground state MO:s
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#resonant-inelastic-x-ray-scattering">
   Resonant inelastic X-ray scattering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-step-approach-with-adc">
     Two-step approach with ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-step-approach-with-tddft">
     Two-step approach with TDDFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dirac-kramer-heisenberg-with-adc">
     Dirac-Kramer-Heisenberg with ADC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     Other approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#amplitudes">
     Amplitudes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decomposition-of-spectra">
     Decomposition of spectra
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#atomic-contributions">
       Atomic contributions
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#polarization-dependence">
       Polarization dependence
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualization">
     Visualization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#descriptors">
     Descriptors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#larger-systems">
   Larger systems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#valence-to-core-xes">
     Valence-to-core XES
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xas-of-uracil">
     XAS of uracil
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#xes-of-uracil">
     XES of uracil
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coupling-to-molecular-dynamics">
     Coupling to molecular dynamics
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#transient-x-ray-spectroscopy">
   Transient X-ray spectroscopy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-interaction-error-in-dft">
   Self-interaction error in DFT
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relativity">
   Relativity
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scalar-relativistic-effects">
     Scalar relativistic effects
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-ionization-potentials">
       For ionization potentials
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#for-spectra-xas">
       For spectra (XAS)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spin-orbit-coupling">
     Spin-orbit coupling
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relaxation">
   Relaxation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-with-delta-textrm-scf-methods">
     Including with
     <span class="math notranslate nohighlight">
      \(\Delta\textrm{SCF}\)
     </span>
     methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-for-wave-function-methods">
     Including for wave function methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#including-for-dft-based-methods">
     Including for DFT-based methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basis-set-considerations">
   Basis set considerations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#general-recommendations">
   General recommendations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#precision-versus-accuracy">
     <em>
      Precision
     </em>
     versus
     <em>
      accuracy
     </em>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#electronic-stucture-method">
     Electronic stucture method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basis-set-selection">
     Basis set selection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#relativistic-effects">
     Relativistic effects
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notes">
   Notes
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="x-ray-spectroscopies">
<h1>X-ray spectroscopies<a class="headerlink" href="#x-ray-spectroscopies" title="Permalink to this headline">¶</a></h1>
<p>Tuning the photon energy to the X-ray regime, processes involving the transition of core electrons can be probed, providing measurements which are very sensitive to elements and local environment [norman18, bergmann17, bookhaven]. Here we will discuss the modeling of four such spectroscopies, as illustrated in <a class="reference internal" href="#xray-processes"><span class="std std-numref">Fig. 1</span></a>:</p>
<div class="figure align-default" id="xray-processes">
<img alt="../_images/processes.svg" src="../_images/processes.svg" /><p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Electronic processes involved in the X-ray sectroscopies discussed in this tutorial.</span><a class="headerlink" href="#xray-processes" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p>In <a class="reference external" href="#x-ray-photoemission-spectroscopy">X-ray photoemission spectroscopy (XPS)</a> the photoionization of the molecular system is probed, yielding insight into <em>occupied states</em>.</p></li>
<li><p>In <a class="reference external" href="#x-ray-absorption-spectroscopy">X-ray absorption spectroscopy (XAS)</a> the transition of core electrons to occupied or continuum states is probed, providing information on <em>unoccupied states</em> or the <em>local chemical environment</em>.</p></li>
<li><p>In <a class="reference external" href="#x-ray-emission-spectroscopy">X-ray emission spectroscopy (XES)</a> the fluorescent decay of higher-lying electrons into a previously prepared core-hole is measured, yielding information on <em>occupied states</em>.</p></li>
<li><p>In <a class="reference external" href="#resonant-inelastic-x-ray-scattering">resonant inelastic X-ray scattering (RIXS)</a> (also termed resonant X-ray emission spectroscopy, or resonant X-ray Raman spectroscopy), the core-excitation and subsequent fluorescent decay is measured, yielding information on both <em>occupied and unoccupied states</em>, including the ability of probing <em>(local) vibrational modes</em>.</p></li>
</ul>
<p>The element-specificity of these techniques arise from the significant differences in the energy of core orbital energies (and thus in excitation/fluorescence energies), as illustrated in <a class="reference internal" href="#edges-elements"><span class="std std-numref">Fig. 2</span></a>:</p>
<div class="figure align-default" id="edges-elements">
<img alt="../_images/edges_elements.svg" src="../_images/edges_elements.svg" /><p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Linear attenuation coefficient for the noble gases and carbon to neon. Data extracted from <a class="reference external" href="https://www.nist.gov/pml/x-ray-form-factor-attenuation-and-scattering-tables">NIST</a>.</span><a class="headerlink" href="#edges-elements" title="Permalink to this image">¶</a></p>
</div>
<p>Here the linear attenuation coefficient for four noble gases (left), and carbon to neon (right) are shown, with the former including labels for the origin of each set of edge/set of features (using the Siegbahn notation with <span class="math notranslate nohighlight">\(n=1,2,3,...\)</span> labeled <span class="math notranslate nohighlight">\(K, L, M, ...\)</span>). We see that there are significant energy differences between the various absorption features, which then enables us to focus on particular elements and edges by tuning photon energies.</p>
<p>Modeling these processes are complicated by a number of factors, such as:</p>
<ul class="simple">
<li><p>Strong <a class="reference external" href="#relaxation">relaxation effects</a>, arising from the significant change in shielding of the nuclear charge arising from the creation/annihilation of a core-hole.</p></li>
<li><p>Potentially significant impact from <a class="reference external" href="#relativity">relativity</a>, with the strong potential experienced by the core electrons yielding large shifts due to (scalar) relativistic effects. In addition, spin-orbit coupling split degeneracies in, e.g., <span class="math notranslate nohighlight">\(2p\)</span> (the <span class="math notranslate nohighlight">\(L_{2,3}\)</span>-edge), necessitating at least an approximate inclusion of such effects for these edges.</p></li>
<li><p>Core-excitation and -ionization processes are <a class="reference external" href="#decoupling-from-valence-continuum">embedded in a continumm of valence-ionized states</a>, making the application of, e.g., a standard Davidson approach for resolving eigenstates unsuitable.</p></li>
<li><p>For higher photon energies the contribution of <em>multipole-allowed</em> states enables transitions which are electric-dipole forbidden.</p></li>
<li><p>Computational chemistry more often is concerned with valence properties, meaning that standard <a class="reference external" href="#basis-set-considerations">basis sets</a> (among others) are tailored for core-transition processes.</p></li>
<li><p>For DFT method there are substantial influences due to the <a class="reference external" href="#self-interaction-error-in-dft">self-interaction error</a>, which are strong due to the compact nature of core orbitals.</p></li>
</ul>
<p>This tutorial will now discuss the calculation of these X-ray spectra, focusing on how this is achieved using TDDFT and ADC. Following illustrations of how the processes can be modeled, basic analysis schemes and some the issues raised above will be considered in some detail.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>Could</em> split the notebook into several smaller notebooks (<em>e.g.</em> ‘calculate’, ‘analysis’, ‘special topics’, ‘large systems’, ‘recommendations’)</p>
</div>
<div class="cell tag_remove-output tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># loading modules and defining broadening functions</span>

<span class="c1"># standard Python modules and functions</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># QC software suites and functionalities</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span><span class="p">,</span> <span class="n">cc</span>
<span class="kn">import</span> <span class="nn">veloxchem</span> <span class="k">as</span> <span class="nn">vlx</span>
<span class="kn">import</span> <span class="nn">gator</span>
<span class="kn">import</span> <span class="nn">adcc</span>
<span class="kn">from</span> <span class="nn">veloxchem.rsplinabscross</span> <span class="kn">import</span> <span class="n">LinearAbsorptionCrossSection</span>

<span class="c1"># for vlx</span>
<span class="n">silent_ostream</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">OutputStream</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>

<span class="c1"># au to eV conversion factor</span>
<span class="n">au2ev</span> <span class="o">=</span> <span class="mf">27.211386</span>

<span class="c1"># broadening functions, called with</span>
<span class="c1">#         (energies, intensities, start energy, end energy, energy step, broadening)</span>
<span class="k">def</span> <span class="nf">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>

<span class="k">def</span> <span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">xstep</span><span class="p">);</span> <span class="n">yi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">xi</span><span class="p">,</span><span class="n">yi</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="x-ray-photoemission-spectroscopy">
<h2>X-ray photoemission spectroscopy<a class="headerlink" href="#x-ray-photoemission-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>In XPS the photoemission of electrons is measured, yielding information on core-electron binding energies. Here we focus on the calculation of ionization potentials (IP:s), from which the isotropic photoemission spectrum is formed by giving each IP the same intensity and then broadening with a function. Can go beyond that using Dyson orbitals, but it typically doesn’t make much of a difference [refs: Dyson, difference]. For more details on the modeling of these processes with ADC and TDDFT, good starting points include [XPS with ADC/TDDFT].</p>
<div class="section" id="ip-s-from-koopmans-theorem">
<h3>IP:s from Koopmans’ theorem<a class="headerlink" href="#ip-s-from-koopmans-theorem" title="Permalink to this headline">¶</a></h3>
<p>A simple model for estimating ionization potentials and electron affinities is from Koopmans’ theorem, where it is calculated from the MO energies. For water, we obtain a 1s IP estimate of:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">water</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">O       0.0000000000     0.0000000000     0.1178336003</span>
<span class="s2">H      -0.7595754146    -0.0000000000    -0.4713344012</span>
<span class="s2">H       0.7595754146     0.0000000000    -0.4713344012</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># SCF calculation</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>
<span class="n">scf_drv</span>  <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Extract orbital energies</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1s IP from the Koopmans theorem:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">orbital_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1s IP from the Koopmans theorem: -559.5
</pre></div>
</div>
</div>
</div>
<p>This can be compared to the experimental value, which is 539.9 eV. The overestimation of almost 20 eV is due to lack of <span class="xref myst">relaxation</span>, which results from the reorganization of the valence electrons in response to a reduction in screening of the nuclei. By comparison, in valence spectroscopies the change in shielding is significantly smaller, yielding a far smaller error due to the lack of relaxation for, e.g., calculation of HOMO IP:s or LUMO EA:s.</p>
<p>An approach for including relaxation effects IP calculations is to instead use the <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> approach, in which the difference in total energy between the neutral and a core-hole system yields estimates of core-electron binding energies.</p>
</div>
<div class="section" id="the-maximum-overlap-method-mom">
<h3>The maximum overlap method (MOM)<a class="headerlink" href="#the-maximum-overlap-method-mom" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Improve this section.</p>
</div>
<p>In order to do this, a core-hole state need to be converged, as can be done using a number of methods including…[refs] We will here focus on the use of the maximum overlap method (MOM) [refs], using which a wave function optimization is restricted to contain the maximum overlap to the previous electronic structure. This is done by considering the  eigenvalue equation</p>
<div class="amsmath math notranslate nohighlight" id="equation-bb70559c-11ec-4d6d-81bc-4c579b4f939c">
<span class="eqno">(1)<a class="headerlink" href="#equation-bb70559c-11ec-4d6d-81bc-4c579b4f939c" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\textbf{FC}^{\textrm{new}} = 
\textbf{SC}^{\textrm{new}} \epsilon
\end{equation}\]</div>
<p>We then chose to overlap the most with the span</p>
<div class="amsmath math notranslate nohighlight" id="equation-47c511d6-6679-4a23-98f4-48f451680b38">
<span class="eqno">(2)<a class="headerlink" href="#equation-47c511d6-6679-4a23-98f4-48f451680b38" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\textbf{O} = 
\left( \textbf{C} \right)^{\dagger} \textbf{SC}^{\textrm{new}}
\end{equation}\]</div>
<p>A core-hole wave function can then be converged by:</p>
<ol class="simple">
<li><p>Calculating the wave function of the system lacking a core-hole.</p></li>
<li><p>Use above wave function as a starting guess for a new wave function optimization, removing an electron from desired core orbital.</p></li>
<li><p>Optimizing this state using the MOM restriction.</p></li>
</ol>
<p>This can then converge many unstable states, including core-ionized states and some core-excited states. Some care should observed, though:</p>
<ul class="simple">
<li><p>If excited states are considered, check that the final state is reasonable.</p></li>
<li><p>Systems with delocalized core orbitals need to be localized, for example by employing ECP:s [refs].</p></li>
<li><p>If post-HF methods are used, the ground state calculation can attempt to (partially) fill the core-hole, leading to a corrupt wave function which represents some intermediate between a core-hole/valence-hole state [refs].</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We currently use <code class="docutils literal notranslate"><span class="pre">pyscf</span></code> for the calculations involving explicit core-holes, as VeloxChem lacks MOM (for now).</p>
</div>
</div>
<div class="section" id="ip-s-from-delta-textrm-scf">
<h3>IP:s from <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span><a class="headerlink" href="#ip-s-from-delta-textrm-scf" title="Permalink to this headline">¶</a></h3>
<p>The IP of water using <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> is calculated ass:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build mol-object and perform ground state SCF with pyscf</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">scf_res</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Copy wave function information and change occupancy of alpha1 to 0 (i.e. prepare the core-hole)</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Perform wave function calculation with the MOM restriction</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Resulting IP from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scf_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827193  &lt;S^2&gt; = 6.3327121e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.0754789470864  &lt;S^2&gt; = 0.76257805  2S+1 = 2.0125387
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ionization potential: 541.73 eV
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.scf.uhf.UHF&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>This estimate is within 2 eV from experiment, and we can include electron correlation using MP2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run MP2 on neutral and core-hole wave functions</span>
<span class="n">mp_res</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">scf_res</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">mp_ion</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># IP from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">mp_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">mp_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>E(UMP2) = -76.113048395549  E_corr = -0.129178012829707
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>E(UMP2) = -56.1523709631034  E_corr = -0.0768920160169645
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ionization potential: 543.16 eV
</pre></div>
</div>
</div>
</div>
<p>And we can also use KS-DFT:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SCF calculation with unrestricted KS-DFT</span>
<span class="n">dft_res</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">dft_res</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
<span class="n">dft_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Prepare core-hole</span>
<span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># SCF with core-hole</span>
<span class="n">dft_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">dft_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">dft_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">dft_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># IP from energy difference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ionization potential:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">dft_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -76.3480474320838  &lt;S^2&gt; = 2.5506708e-11  2S+1 = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwritten attributes  get_occ  of &lt;class &#39;pyscf.dft.uks.UKS&#39;&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.412542119436  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ionization potential: 542.47 eV
</pre></div>
</div>
</div>
</div>
<p>MP2 and DFT currently brings us <strong>away</strong> from experiment, but we note that the basis set is small and ill suited for core properties. Using a cc-pCVTZ basis we obtain:</p>
<ul class="simple">
<li><p>HF: 538.93 eV</p></li>
<li><p>MP2: 540.26 eV</p></li>
<li><p>B3LYP: 539.19 eV</p></li>
</ul>
<p><em>i.e.</em> closer to experiment for the correlated methods (note that scalar-relativistic effects will shift these results upwards by <span class="math notranslate nohighlight">\(\sim\)</span>0.37 eV).</p>
</div>
<div class="section" id="spectra-from-delta-textrm-scf">
<h3>Spectra from <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span><a class="headerlink" href="#spectra-from-delta-textrm-scf" title="Permalink to this headline">¶</a></h3>
<p>The X-ray photoemission spectrum can be formed by calculating all relavant core-electron binding energies (IP:s), give each unique ionization equal intensity, and broaden over the result with a lorentzian or gaussian convolution formula. The choice of broadening depends on the dominant broadening effect (lifetime of excited/ionized state, experimental resolution, <em>etc</em>), but we will here focus on pure lorentzian broadening.</p>
<p>We here consider ethyl trifluoroacetate( (CF<span class="math notranslate nohighlight">\(_3\)</span>-CO-O-CH<span class="math notranslate nohighlight">\(_2\)</span>-CH<span class="math notranslate nohighlight">\(_3\)</span>), also known as the <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">‘ESCA’ molecule</a>, which possess very illustrative shifts in XPS features (IP:s) of the carbon <span class="math notranslate nohighlight">\(K\)</span>-edge due to interactions with the very electronegative oxygen and fluorine atoms. We calculate the four carbon 1s IP:s with <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span>:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">esca</span>   <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">C         1.1183780041   -0.3449927563    0.0140172822</span>
<span class="s1">C         0.2599020293    0.9430366372   -0.0248385056</span>
<span class="s1">F         2.4019839124   -0.0408200726   -0.0368443870</span>
<span class="s1">F         0.8399255955   -1.1560630574   -1.0169777359</span>
<span class="s1">F         0.8945563482   -1.0267696528    1.1485539196</span>
<span class="s1">O         0.7954196415    2.0187110930    0.0011424145</span>
<span class="s1">O        -1.0675509573    0.8144007049   -0.0614767265</span>
<span class="s1">C        -1.7486063992   -0.4602333713   -0.1739210991</span>
<span class="s1">C        -3.1986940727   -0.1850294900    0.1302033614</span>
<span class="s1">H        -1.3268717284   -1.1720377773    0.5289059043</span>
<span class="s1">H        -1.6185520565   -0.8344576449   -1.1859838788</span>
<span class="s1">H        -3.3116641442    0.1959612359    1.1419001202</span>
<span class="s1">H        -3.7716619472   -1.1057672384    0.0380096706</span>
<span class="s1">H        -3.6012985602    0.5468300237   -0.5651778685            </span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># Create mol object and perform neutral SCF calculation</span>
<span class="n">mol_esca</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol_esca</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">esca</span><span class="p">;</span> <span class="n">mol_esca</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;STO-3G&#39;</span>
<span class="n">mol_esca</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">scf_esca</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol_esca</span><span class="p">)</span>
<span class="n">scf_esca</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform core-hole calculation for each carbon atom (MOs 5-8) and append SCF IPs to a list</span>
<span class="n">esca_ips</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i_mo</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_esca</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_esca</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i_mo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">ion_tmp</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol_esca</span><span class="p">)</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_tmp</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">ion_tmp</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">esca_ips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ion_tmp</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scf_esca</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -594.320690263599  &lt;S^2&gt; = 1.6621925e-08  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -583.365537674068  &lt;S^2&gt; = 0.76705671  2S+1 = 2.0169846
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF not converged.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF energy = -583.447978411548 after 50 cycles  &lt;S^2&gt; = 0.76802737  2S+1 = 2.0179469
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -583.561134582545  &lt;S^2&gt; = 0.76454928  2S+1 = 2.0144967
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -583.615548638313  &lt;S^2&gt; = 0.75826809  2S+1 = 2.0082511
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some convergence issues for the above calculation, largely relating to the minimal basis set used. These issues disappear for more flexible basis set.</p>
</div>
<p>The spectrum is formed by giving each IP equal weight and broadening with a lorentzian and a gaussian, for which FWHM <span class="math notranslate nohighlight">\(= \gamma \)</span> and FWHM <span class="math notranslate nohighlight">\( 2\sqrt{2\ln{2}} \sigma\)</span>, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># Broadening with a lorentzian, with FWHM = 0.4 eV</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lorentzian broadening&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">esca_ips</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">esca_ips</span><span class="p">)))</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">*</span><span class="mf">0.4</span><span class="p">)</span>
<span class="c1"># Broadening with a gaussian, with FWHM = 0.4 eV</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gaussian broadening&#39;</span><span class="p">)</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))));</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_13_0.png" src="../_images/xray_13_0.png" />
</div>
</div>
<p>For the comparison to <a class="reference external" href="https://doi.org/10.1016/j.elspec.2012.05.009">experiment</a> a cc-pVTZ basis set is selected, augmented with additional core-polarizing functions for the carbon atoms (i.e. cc-pCVTZ):</p>
<div class="figure align-default" id="esca-xps">
<img alt="../_images/esca_xps.svg" src="../_images/esca_xps.svg" /><p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Carbon 1s XPS of ESCA, comparing <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> results to experiment. Theoretical spectrum shifted by 0.11 eV (to account for relativistic effects) and broadened by 0.3 eV.</span><a class="headerlink" href="#esca-xps" title="Permalink to this image">¶</a></p>
</div>
<p>The features originate in, from low to high energy: -CH<span class="math notranslate nohighlight">\(_3\)</span>, -CH<span class="math notranslate nohighlight">\(_2\)</span>-, -CO-, and CF<span class="math notranslate nohighlight">\(_3\)</span>. We note a good agreement for the first two features, but the comparison deteriorates for higher energies. This is largely an effect of the more significant change in electronic structure imposed by the very electronegative fluorine and oxygen atoms, which the current level of theory is not capable of describing as well as the other features.</p>
</div>
<div class="section" id="other-approaches">
<h3>Other approaches<a class="headerlink" href="#other-approaches" title="Permalink to this headline">¶</a></h3>
<p>Brief discussion - IP-ADC, IP-CCSD, …</p>
</div>
</div>
<div class="section" id="x-ray-absorption-spectroscopy">
<h2>X-ray absorption spectroscopy<a class="headerlink" href="#x-ray-absorption-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>In XAS the energy-dependent photoabsorption of the sample is measured, probing excitation of core electrons to bound or continuum states. These two different final states then provide information on unoccupied states and local chemical environment, espectively, with a prototypical spectrum of a conjugated system:</p>
<div class="figure align-default" id="xafs">
<img alt="../_images/xafs.svg" src="../_images/xafs.svg" /><p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Prototypical X-ray absorption spectrum of a conjugated system.</span><a class="headerlink" href="#xafs" title="Permalink to this image">¶</a></p>
</div>
<p>Above the spectrum we see the distinction of the various spectrum regions, consisting of:</p>
<ul class="simple">
<li><p><strong>NEXAFS (near-edge X-ray absorption fine structure:</strong> the region in which transitions to bound states is probed (this region is also known as XANES, X-ray absorption near-edge structure).</p></li>
<li><p><strong>EXAFS (extended X-ray absorption fine structure):</strong> which consists of transitions to continuum states, which is modulated by constructive or destructive interference between the emitted electron and the environment. This thus provide information on local chemical bonds.</p></li>
<li><p><strong>XAFS (X-ray absorption fine structure):</strong> spanning both regions.</p></li>
</ul>
<p>For the remainder of this tutorial we will focus on NEXAFS, with more details for modeling this process found in [wenzel, besley, fransson]. Discussions on modeling EXAFS can be found, e.g., in [exafs].</p>
<p>Included in <a class="reference internal" href="#xafs"><span class="std std-numref">Fig. 4</span></a> is also the position of the IP, above which the oscillatory pattern due to interference with the environment is initiated, and assignment of typical features (<span class="math notranslate nohighlight">\(\pi^*\)</span>, Rydberg, and <span class="math notranslate nohighlight">\(\sigma^*\)</span>). Transitions to <span class="math notranslate nohighlight">\(\pi^*\)</span> states are typically low in energy and very intense, and thus easy to identify. Rydberg states are typically weak and converge to the ionization potential. Finally, transitions to <span class="math notranslate nohighlight">\(\sigma^*\)</span> states can be found above the ionization potential.</p>
<div class="section" id="decoupling-transitions-from-the-valence-continuum">
<h3>Decoupling transitions from the valence continuum<a class="headerlink" href="#decoupling-transitions-from-the-valence-continuum" title="Permalink to this headline">¶</a></h3>
<p>A complication that arise when considering core excitations is the embedding of the core-excited states into the continuum of valence-ionized states. A number of approaches have been developed to remove this issue, including:</p>
<ul class="simple">
<li><p>The core-valence separation (CVS) approximation [schirmer, wenzel, coriani]</p></li>
<li><p>Restricted energy window, which share some common ideas with CVS [rew-tddft]</p></li>
<li><p>Using the complex polarization propagator (CPP), where the response at arbitrary frequencies is directly probed [norman]</p></li>
<li><p>Real-time propagation of the electronic structure [rt-methods]</p></li>
<li><p>Methods which construct explicit excited states [refs]</p></li>
</ul>
<p>The focus in this tutorial is the use of the CVS approximation and the CPP approach, with which interior eigenstates/response at arbitrary frequencies can be directly address:</p>
<div class="figure align-default" id="cvs-adc">
<img alt="../_images/cvs_adc.svg" src="../_images/cvs_adc.svg" /><p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Global spectrum of water, using the 6-311G basis set. Results obtained with ADC(1), CVS-ADC(1), ADC(2), CVS-ADC(2), and CPP-DFT. CPP-DFT results obtained using the B3LYP exchange-correlation functional and a large <span class="math notranslate nohighlight">\(\gamma\)</span> of 1 eV.</span><a class="headerlink" href="#cvs-adc" title="Permalink to this image">¶</a></p>
</div>
<p>Here we see the global spectrum of water, using a rather limited basis set. Even so, ADC(1) requires more than 50 states to resolved the core-excitation region (situated at about 535 eV for water), and for ADC(2) 50 states brings us only to about 50 eV. With the CVS approximation we directly target the core-excitation region, but it should be noted that this also introduces a small error. However, this error has been shown to be relatively small (provided a reasonable basis set) and stable for <a class="reference external" href="https://doi.org/10.1063/5.0013538">ADC</a>, and for TDHF and TDDFT it is all but negligible. Using CPP-DFT, the error is avoided all together.</p>
</div>
<div class="section" id="spectra-from-cvs-adc-eigenstates">
<h3>Spectra from CVS-ADC eigenstates<a class="headerlink" href="#spectra-from-cvs-adc-eigenstates" title="Permalink to this headline">¶</a></h3>
<p>With CVS-ADC, the core-excitation spectra are calculate by specifying the index of the probed core orbitals(s):</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct molecule reference object and perform SCF calculation </span>
<span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the 6 lowest eigenstates with CVS restriction to MO #1 (oxygen 1s)</span>
<span class="n">adc_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 4 iterations.
Total Energy: -75.9838703827 au
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1     8        1.4139  112ms  [20.27036 20.30082 20.86978 20.91122 21.10647 21.17211]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    16       0.05362  216ms  [19.72496 19.80692 20.50881 20.5157  20.52446 20.72564]
  3    24      0.014469  192ms  [19.71674 19.79708 20.49577 20.50503 20.50804 20.6385 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    32      0.001267  236ms  [19.71639 19.79671 20.49374 20.50484 20.50629 20.62964]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5    40    0.00011958  265ms  [19.71638 19.7967  20.49353 20.50483 20.50618 20.62883]
=== Restart ===
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6    16    2.2907e-05  300ms  [19.71638 19.7967  20.49351 20.50482 20.50617 20.62876]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  7    24    8.2765e-06  264ms  [19.71638 19.7967  20.49351 20.50482 20.50617 20.62874]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8    32    3.7389e-06  268ms  [19.71638 19.7967  20.49351 20.50482 20.50617 20.62873]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  9    40     5.189e-07  263ms  [19.71638 19.7967  20.49351 20.50482 20.50617 20.62873]
=== Converged ===
    Number of matrix applies:    72
    Total solver time:             2s 149ms
</pre></div>
</div>
</div>
</div>
<p>The resuls can be printed as a table, or convoluted and plotted using built-in functionalities or a custom broadening:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print information on eigenstates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_res</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># Convolute using functionalities available in gator and adcc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Built-in broadening&#39;</span><span class="p">)</span>
<span class="n">adc_res</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="c1"># Convoluted using information on excitation energies and oscillator strengths</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Custom broadening&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_res</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_res</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">543</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| cvs-adc2x                               singlet ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      19.71638      536.5099   0.0175    0.8001    0.1999  |
|  1       19.7967      538.6956   0.0368    0.8087    0.1913  |
|  2      20.49351      557.6567   0.0098    0.7858    0.2142  |
|  3      20.50482      557.9647   0.1007    0.8441    0.1559  |
|  4      20.50617      558.0013   0.0881     0.835     0.165  |
|  5      20.62873      561.3363   0.0104    0.7926    0.2074  |
+--------------------------------------------------------------+
</pre></div>
</div>
<img alt="../_images/xray_17_1.png" src="../_images/xray_17_1.png" />
</div>
</div>
<p>The built-in functionality uses a small default broadening (which can be changed) and plots the full region which is resolved, while we might want to focus on lower-energy and larger broadenings (as done in the lower panel). We note that high-energy features can often be a result of a discretized continuum region, as seen by the unphysically intense feature at 558 eV. A larger basis set will flatten out this region, but care should be taken for any analysis of it [refs].</p>
<p>Increasing the basis set to aug-cc-pCVTZ/cc-pVTZ (for oxygen and hydrogen, respectively), we obtain results in good agreement to experiment:</p>
<div class="figure align-default" id="adc-water-xas">
<img alt="../_images/adc_water_xas.svg" src="../_images/adc_water_xas.svg" /><p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">CVS-ADC(2)-x calculation of the oxygen X-ray absorption spectrum of gaseous water, as compared to experiment. Theoretical spectra has been shifted by 0.37 eV (to account for relativistic effects) and broadened by 0.4 eV.</span><a class="headerlink" href="#adc-water-xas" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="spectra-from-tddft-eigenstates">
<h3>Spectra from TDDFT eigenstates<a class="headerlink" href="#spectra-from-tddft-eigenstates" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="spectra-from-cpp-dft">
<h3>Spectra from CPP-DFT<a class="headerlink" href="#spectra-from-cpp-dft" title="Permalink to this headline">¶</a></h3>
<p>With the complex polarization propagator (CPP), also called the damped linear response function, the absorption and dispersion spectrum can be evaluated at arbitrary energies. With this, the X-ray absorption spectrum using KS-DFT can then be directly calculated.</p>
<p>For this, we just need to decide on which energy/frequency region to use, which can be estimated by, e.g.</p>
<ul class="simple">
<li><p>Screen more extended energy regions with low step length. This could potentially be done using a smaller basis set.</p></li>
<li><p>With a method lacking relaxation: start the region a few eV below the IP from Koopmans’ theorem. This will not work for methods capable of including relaxation, where IP:s from <span class="math notranslate nohighlight">\(\Delta\)</span>SCF could instead be considered as a first rough estimate (noting that it will work better or worse for different levels of, e.g., ADC theory).</p></li>
</ul>
<p>Choosing an energy region of 514-525 eV, using a step length of 0.1 eV and a damping factor of 0.3 eV, we calculate the CPP-DFT (B3LYP) water spectrum as:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule object</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>

<span class="c1"># SCF  settings and calculation</span>
<span class="n">scf_drv</span>         <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>    <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_level&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Calculate the response at desired frequencies</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">515.0</span><span class="p">,</span><span class="mf">525.0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span><span class="p">;</span> <span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">au2ev</span><span class="p">},</span>
                                        <span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>

<span class="c1"># Extract the imaginary part of the complex response function and convert to absorption cross section</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span> <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Resulting spectra can be plotted as raw or splined, for smoother figures:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make figure with panels of 3:1 width</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 

<span class="c1"># Raw results for full region</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx-&#39;</span><span class="p">)</span>

<span class="c1"># Raw results for zoomed in</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">519.5</span><span class="p">,</span><span class="mf">520.5</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.10</span><span class="p">))</span>

<span class="c1"># Raw and splined spectra</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Raw&#39;</span><span class="p">,</span><span class="s1">&#39;Splined&#39;</span><span class="p">))</span>

<span class="c1"># Zoomed in</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mf">519.5</span><span class="p">,</span><span class="mf">520.5</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_22_0.png" src="../_images/xray_22_0.png" />
</div>
</div>
<p>Increasing the basis set size and comparing to [experiment] we get:</p>
<div class="figure align-default" id="dft-water-xas">
<img alt="../_images/dft_water_xas.svg" src="../_images/dft_water_xas.svg" /><p class="caption"><span class="caption-number">Fig. 7 </span><span class="caption-text">CPP-DFT (B3LYP) X-ray absorption spectrum of water, as compared to experiment. Theoretical spectra shifted by 14.5 eV and broadened by 0.4 eV. Currently aug-cc-pVDZ..</span><a class="headerlink" href="#dft-water-xas" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Change above to aug-cc-pCVTZ/cc-pVTZ.</p>
</div>
<p>As can be seen, the absolute excitation energies are significantly of, with a shift of 14.5 eV required to yield an approximate alignment to experiment. Part of this shift is due to lack of relativistic effects (~0.37 eV), and a small discrepancy can be expected due to the use of a limited basis set, but the main part of the error is due to two different effects:</p>
<ol class="simple">
<li><p>Lack of <a class="reference external" href="#relaxation">relaxation</a>, which yield a final state too high in energy and thus shift theoretical spectra upwards in energy.</p></li>
<li><p>The <a class="reference external" href="#self-interaction-error-in-dft">self-interaction error</a>, which yield an erroneous self-repulsion of the dense core orbitals, and results in too low core-excitation energies.</p></li>
</ol>
<p>For B3LYP the total effect of these two errors leads to too low transition energies, meaning that the SIE dominates. By changing the amount of HF exchange this balance will shift and the error eventually becomes positive.</p>
<p>Nevertheless, the obtained CPP-DFT spectrum is in reasonable agreement with experiment once it has been shifted.</p>
</div>
<div class="section" id="id1">
<h3>Other approaches<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Brief discussion - state-specific, CC, MR, …</p>
</div>
</div>
<div class="section" id="x-ray-emission-spectroscopy">
<h2>X-ray emission spectroscopy<a class="headerlink" href="#x-ray-emission-spectroscopy" title="Permalink to this headline">¶</a></h2>
<p>Following the creatying of a core-hole, the system will rapidly (<span class="math notranslate nohighlight">\(\sim\)</span>fs) decay to a valence-hole or valence-excited satte, depending on whether the system is core-ionized or core-excited. These two different intermediate states  are probed when the X-ray pulse is in non-resonant (ionized) or resonant (excited regime), yieldig non-resonant/resonant X-ray emission spectroscopy. This section will focus on the former, with the latter following in the next section.</p>
<p>In the decay process the system gain large amounts of energy which need to be discarded, which can occur by emission of high-energy photon (fluorescence) or higher-lying electron (Auger), with relative probability depending on edge and element. For the <em>K</em>-edge the relative probabilities follow:</p>
<div class="figure align-default" id="auger-vs-fluorescent">
<img alt="../_images/auger_vs_fluorescent.png" src="../_images/auger_vs_fluorescent.png" />
<p class="caption"><span class="caption-number">Fig. 8 </span><span class="caption-text">Fluorescence and Auger electron yields as a function of atomic number for <em>K</em>-edge core-holes. <a class="reference external" href="https://commons.wikimedia.org/wiki/File:Auger_xray_wiki_in_png_format.png">Published</a> under CC BY-SA 4.0.</span><a class="headerlink" href="#auger-vs-fluorescent" title="Permalink to this image">¶</a></p>
</div>
<p>As can be seen, Auger decay dominates for light elements, which has impact on both our ability of obtaining well-resolved spectra for these elements, as well as the impact of X-ray damage on biological matter.</p>
<p>In non-resonant XES we then probe the radiative decay of core-ionized states, through which we can probe the (element-specific) nature of the local chemical environment. For light elements the valence space is probed directly, but for heavier elements we obtain a number of different decay channels from the valence region and the outer core region. These lines vary considerably in energy, intensity, and information content [refs]:</p>
<ol class="simple">
<li><p>The <span class="math notranslate nohighlight">\(2p \rightarrow 1s\)</span> (<span class="math notranslate nohighlight">\(K\alpha_1\)</span> and <span class="math notranslate nohighlight">\(K\alpha_2\)</span>) is the most intense (due to the large overlap) and of lowest energy, and is relatively insensitive to the valence region.</p></li>
<li><p>The <span class="math notranslate nohighlight">\(3p \rightarrow 1s\)</span> (<span class="math notranslate nohighlight">\(K\beta ' \)</span> and <span class="math notranslate nohighlight">\(K\beta_{1,3}\)</span>) is about an order of magnitude weaker and of higher energy, but more sensitive to the environment.</p></li>
<li><p>Transitions from the ligand MO:s (<span class="math notranslate nohighlight">\(K\beta '' \)</span> and <span class="math notranslate nohighlight">\(K\beta_{2,5}\)</span>), or valence-to-core (VtC), is the weakest, high-energy features which is most sensitive to the local environment.</p></li>
</ol>
<p>The discussion in this tutorial will focus on spectra of lighter elements, as can be modelled with DFT and ADC theory. A good starting point for such calculations include [XPS with ADC/TDDFT].</p>
<div class="section" id="spectra-from-adc">
<h3>Spectra from ADC<a class="headerlink" href="#spectra-from-adc" title="Permalink to this headline">¶</a></h3>
<p>One approach for considering X-ray emission spectra is to converge the core-hole state (as above for <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span>) and use this core-ionized system as the reference state. The core-decay transition then are the first negative eigenstates of the systemn, such that a standard Davidson calculation can be run on top.</p>
<p>Considering water with ADC(2), the oxygen X-ray emission spectrum is calculated as:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct molecule object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># Perform neutral SCF calculation</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Use above SCF as starting guess, removing core electron and converging with MOM constraint</span>
<span class="n">mo0</span>        <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="n">occ0</span>       <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
<span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
<span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># Perform ADC calculation</span>
<span class="n">adc_xes</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827193  &lt;S^2&gt; = 6.3389294e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.0754789470864  &lt;S^2&gt; = 0.76257805  2S+1 = 2.0125387
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     8       0.77768  215ms  [-19.29082 -19.1994  -18.96182 -18.3637 ]
  2    16     0.0010764   91ms  [-19.44427 -19.3669  -19.16827 -18.57948]
  3    24    4.4301e-07  109ms  [-19.4443  -19.36693 -19.16832 -18.57955]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:           423.341ms
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There will be some convergence issues if including transitions from very different types, <em>e.g.</em> resolving transitions into the core and out to the unoccupied valence region simultaneously. As such, the number of resolved states should remain somewhat limited.</p>
</div>
<p>The resuls can be printed as a table, or convoluted and plotted using built-in functionalities or a custom broadening. Note that the eigenvalues are negative, and a sing change is appropriate when constructing the spectra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print information on eigenstates</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="c1"># Convolute using functionalities available in gator and adcc</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Built-in broadening [note negative energies]&#39;</span><span class="p">)</span>
<span class="n">adc_xes</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">()</span>
<span class="c1"># Convoluted using information on excitation energies and oscillator strengths</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Custom broadening&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xes</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xes</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">519</span><span class="p">,</span><span class="mi">531</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| adc2                                        any ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      -19.4443     -529.1063   0.0568    0.9548    0.0452  |
|  1     -19.36693      -527.001   0.0458    0.9503   0.04966  |
|  2     -19.16832     -521.5965   0.0419    0.9376   0.06245  |
|  3     -18.57955     -505.5753   0.0031    0.9335   0.06655  |
+--------------------------------------------------------------+
</pre></div>
</div>
<img alt="../_images/xray_27_1.png" src="../_images/xray_27_1.png" />
</div>
</div>
<p>Using cc-pCVTZ/cc-pVTZ and comparing to experiment:</p>
<div class="figure align-default" id="overlap-water-xes">
<img alt="../_images/overlap_water_xes.svg" src="../_images/overlap_water_xes.svg" /><p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">ADC(2) water X-ray emission spectrum, as compared to experiment. Theoretical spectra shifted by 0.37 eV (to account for relativistic effects) and broadened by 0.3 eV.</span><a class="headerlink" href="#overlap-water-xes" title="Permalink to this image">¶</a></p>
</div>
<p>While the broadening between the different lines is noticably different, it is clear that the energy spacing and integrated intensities of the features are in good agreement with experiment. Note that the theoretical spectrum is obtained at the ADC(2) level of theory, which has been <a class="reference external" href="https://doi.org/10.1021/acs.jctc.8b01046">shown</a> to be in better agreement than ADC(2)-x and ADC(3/2) for XES.</p>
</div>
<div class="section" id="spectra-from-tddft">
<h3>Spectra from TDDFT<a class="headerlink" href="#spectra-from-tddft" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="spectra-from-ground-state-mo-s">
<h3>Spectra from ground state MO:s<a class="headerlink" href="#spectra-from-ground-state-mo-s" title="Permalink to this headline">¶</a></h3>
<p>While we have previously seen that Koopmans’ theorem is in significant disagreement with experimental ionization potentials (due to lack of relaxation), it has been noted that the <strong>relative</strong> position of the (valence) MO energies can still be quite reasonable. As such, a computationally very simple approach for modeling X-ray emission spectra has been utilized [refs], in which transition energies are estimated from</p>
<div class="amsmath math notranslate nohighlight" id="equation-440e9221-8849-4d3b-bdc2-4f36a6319ba6">
<span class="eqno">(3)<a class="headerlink" href="#equation-440e9221-8849-4d3b-bdc2-4f36a6319ba6" title="Permalink to this equation">¶</a></span>\[\begin{equation}
\Delta E = \epsilon_v - \epsilon_c
\end{equation}\]</div>
<p><em>i.e.</em> the difference in ground state MO energies. The intensities are taken to be proportional to the dipole moment:</p>
<div class="amsmath math notranslate nohighlight" id="equation-44d1d2f2-0cc1-4714-a003-cfc7f11faca5">
<span class="eqno">(4)<a class="headerlink" href="#equation-44d1d2f2-0cc1-4714-a003-cfc7f11faca5" title="Permalink to this equation">¶</a></span>\[\begin{equation}
f \propto \left| \langle \phi_i \left| \hat{\mu} \right| \phi_c \rangle \right| ^2
\end{equation}\]</div>
<p>This method is very attractive in its simplicity, requiring only a single ground state calculation and the construction of some dipole moments for a full spectrum calculation. However, the absolute energies will be significantly off, and any differences in relaxation between the different channels will not be included.</p>
<p>Nevertheless, this approach has been noted to yield good (relative) agreement to experimental measurements, and it is very capable of considering even massive molecular systems [refs]. The calculation of it then requires two steps:</p>
<ul class="simple">
<li><p>The calculation of ground state wave function and constructing transition energies from MO energy differences:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SCF calculation</span>
<span class="n">scf_drv</span>          <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>     <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_level&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>

<span class="c1"># Extract orbital energies and number of occupied MOs</span>
<span class="n">orbital_energies</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
<span class="n">nocc</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Occupied MO energies:&#39;</span><span class="p">,</span><span class="n">au2ev</span><span class="o">*</span><span class="n">orbital_energies</span><span class="p">[:</span><span class="n">nocc</span><span class="p">])</span>

<span class="c1"># Define probed core MO(s) and calculate energy differences</span>
<span class="n">n_core</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">overlap_energy</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n_mo</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_mo</span> <span class="o">!=</span> <span class="n">n_core</span><span class="p">:</span>
        <span class="n">overlap_energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">n_mo</span><span class="p">]</span><span class="o">-</span><span class="n">orbital_energies</span><span class="p">[</span><span class="n">n_core</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Occupied MO energies: [-520.6571   -27.68789  -14.39953   -9.70378   -7.94953]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>The calculation of dipole moments between the occupied states:</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load required functionalities</span>
<span class="n">dipole_drv</span>      <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ElectricDipoleIntegralsDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
<span class="n">dipole_matrices</span> <span class="o">=</span> <span class="n">dipole_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="c1"># MO coefficients</span>

<span class="c1"># Calculated dipole moments and convert to MO basis</span>
<span class="n">x_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">x_to_numpy</span><span class="p">();</span> <span class="n">x_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x_ao</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
<span class="n">y_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">y_to_numpy</span><span class="p">();</span> <span class="n">y_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">y_ao</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
<span class="n">z_ao</span> <span class="o">=</span> <span class="n">dipole_matrices</span><span class="o">.</span><span class="n">z_to_numpy</span><span class="p">();</span> <span class="n">z_mo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">z_ao</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>

<span class="c1"># Calculate transition dipole moments and square modulus</span>
<span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">osc_str</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
<span class="k">for</span> <span class="n">n_mo</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n_mo</span> <span class="o">!=</span> <span class="n">n_core</span><span class="p">:</span>
        <span class="n">x_tmp</span><span class="p">,</span><span class="n">y_tmp</span><span class="p">,</span><span class="n">z_tmp</span> <span class="o">=</span> <span class="n">x_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span><span class="n">n_mo</span><span class="p">],</span><span class="n">y_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span><span class="n">n_mo</span><span class="p">],</span><span class="n">z_mo</span><span class="p">[</span><span class="n">n_core</span><span class="p">,</span><span class="n">n_mo</span><span class="p">]</span>
        <span class="n">xx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">);</span> <span class="n">yy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">);</span> <span class="n">zz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">)</span>
        <span class="n">osc_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_tmp</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y_tmp</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z_tmp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From this we get the stick spectrum, which is printed with its decomposition. Further, it can be convoluted with a lorentzian, here focusing on the high-energy features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy   Osc. str.   x-component   y-component   z-component&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">overlap_energy</span><span class="p">)):</span>
    <span class="n">e</span><span class="p">,</span><span class="n">os</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">overlap_energy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">osc_str</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">zz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">  </span><span class="si">{:8.5f}</span><span class="s1">     </span><span class="si">{:8.5f}</span><span class="s1">      </span><span class="si">{:8.5f}</span><span class="s1">      </span><span class="si">{:8.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">os</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">overlap_energy</span><span class="p">,</span><span class="n">osc_str</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">504</span><span class="p">,</span><span class="mi">514</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy   Osc. str.   x-component   y-component   z-component
492.969   0.00022     -0.00000      -0.00000      -0.01478
506.258   0.00238     -0.04878       0.00000      -0.00000
510.953   0.00255      0.00000       0.00000       0.05050
512.708   0.00342     -0.00000      -0.05848       0.00000
</pre></div>
</div>
<img alt="../_images/xray_34_1.png" src="../_images/xray_34_1.png" />
</div>
</div>
<p>Using cc-pCVTZ/cc-pVTZ and comparing to experiment</p>
<div class="figure align-default" id="id2">
<img alt="../_images/overlap_water_xes.svg" src="../_images/overlap_water_xes.svg" /><p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">DFT (B3LYP) overlap X-ray emission spectrum of water, as compared to experiment. Theoretical spectra shifted to approximately align the high-energy feature, and broadened by 0.3 eV.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The resulting spectrum is quite off in energy, but the relative agreement to experiment is quite impressive.</p>
</div>
<div class="section" id="id3">
<h3>Other approaches<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Brief discussion - CC, …</p>
</div>
</div>
<div class="section" id="resonant-inelastic-x-ray-scattering">
<h2>Resonant inelastic X-ray scattering<a class="headerlink" href="#resonant-inelastic-x-ray-scattering" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>To be added.</p></li>
<li><p>One-step versus two-step.</p></li>
</ul>
</div>
<p>Here focus on the electronic part of he RIXS plane.</p>
<div class="section" id="two-step-approach-with-adc">
<h3>Two-step approach with ADC<a class="headerlink" href="#two-step-approach-with-adc" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct molecule object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="c1"># Perform neutral SCF calculation</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">scf_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="c1"># XAS</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_res</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">adc_rixs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
    <span class="n">mo0</span>        <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
    <span class="n">occ0</span>       <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">)</span>
    <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">scf_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">)</span>
    <span class="n">scf_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">adc_rixs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adcc</span><span class="o">.</span><span class="n">adc2</span><span class="p">(</span><span class="n">scf_ion</span><span class="p">,</span> <span class="n">n_states</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9838703827192  &lt;S^2&gt; = 6.3380412e-12  2S+1 = 1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     8        1.6222  132ms  [20.26123 20.31993 20.32303 20.3465  20.77599]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    16      0.059729  121ms  [19.77471 19.80231 19.84312 19.87819 20.53739]
  3    24     0.0025223  123ms  [19.75719 19.78334 19.84056 19.86586 20.53732]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4    32    0.00064877  137ms  [19.75657 19.78237 19.84025 19.86585 20.53732]
  5    38    2.0368e-05  132ms  [19.75644 19.78212 19.84025 19.86585 20.53732]
=== Converged ===
    Number of matrix applies:    38
    Total solver time:           656.056ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -56.2454489455331  &lt;S^2&gt; = 1.0207474  2S+1 = 2.2545486
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     8        1.1162  574ms  [-19.30599 -19.24639 -19.04163 -18.913  ]
  2    16     0.0057426  139ms  [-19.6867  -19.4057  -19.31526 -19.13746]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    24    3.5025e-07  180ms  [-19.68757 -19.40573 -19.31551 -19.13752]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:           903.237ms
converged SCF energy = -56.1667062608724  &lt;S^2&gt; = 1.0169051  2S+1 = 2.2511376
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting adc2  Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1     8        1.3615  427ms  [-19.41097 -19.23524 -19.11652 -18.75294]
  2    16     0.0048587   85ms  [-19.76425 -19.39654 -19.30097 -19.13251]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    24    2.9966e-07  123ms  [-19.76496 -19.39657 -19.30101 -19.13354]
=== Converged ===
    Number of matrix applies:    24
    Total solver time:           643.407ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| cvs-adc2                                    any ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0      19.75644         537.6   0.0000    0.8488    0.1512  |
|  1      19.78212      538.2988   0.0166    0.8393    0.1607  |
|  2      19.84025      539.8806   0.0000    0.8617    0.1383  |
|  3      19.86585      540.5773   0.0356    0.8518    0.1482  |
|  4      20.53732       558.849   0.0000    0.9255   0.07451  |
+--------------------------------------------------------------+
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| adc2                                        any ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0     -19.68757      -535.726   0.0114    0.8589    0.1411  |
|  1     -19.40573     -528.0569   0.0557    0.9523   0.04766  |
|  2     -19.31551     -525.6018   0.0414    0.9357   0.06431  |
|  3     -19.13752     -520.7586   0.0393    0.9311   0.06889  |
+--------------------------------------------------------------+
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+--------------------------------------------------------------+
| adc2                                        any ,  converged |
+--------------------------------------------------------------+
|  #        excitation energy     osc str    |v1|^2    |v2|^2  |
|          (au)           (eV)                                 |
|  0     -19.76496     -537.8318   0.0227    0.8732    0.1268  |
|  1     -19.39657     -527.8077   0.0547    0.9519   0.04808  |
|  2     -19.30101     -525.2072   0.0429    0.9443   0.05568  |
|  3     -19.13354       -520.65   0.0347    0.9039   0.09609  |
+--------------------------------------------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span><span class="n">xi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">+</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="o">+</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="c1"># LUMO</span>
<span class="n">indx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">f1xas</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
<span class="n">f1xes</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f1int</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f2xas</span> <span class="o">=</span> <span class="n">f1xas</span>
<span class="n">f2xes</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">f2int</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f1xes</span><span class="p">,</span><span class="n">f1xas</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10000</span><span class="o">*</span><span class="n">f1int</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f2xes</span><span class="p">,</span><span class="n">f2xas</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10000</span><span class="o">*</span><span class="n">f2int</span><span class="p">)</span>
<span class="c1"># LUMO+1</span>
<span class="n">indx</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">f1xas</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
<span class="n">f1xes</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f1int</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f2xas</span> <span class="o">=</span> <span class="n">f1xas</span>
<span class="n">f2xes</span> <span class="o">=</span> <span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">f2int</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">*</span><span class="n">adc_rixs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">oscillator_strength</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f1xes</span><span class="p">,</span><span class="n">f1xas</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10000</span><span class="o">*</span><span class="n">f1int</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f2xes</span><span class="p">,</span><span class="n">f2xas</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10000</span><span class="o">*</span><span class="n">f2int</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">535</span><span class="p">,</span><span class="mi">543</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">519</span><span class="p">,</span><span class="mi">530</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Emission&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Absorption&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_39_0.png" src="../_images/xray_39_0.png" />
</div>
</div>
</div>
<div class="section" id="two-step-approach-with-tddft">
<h3>Two-step approach with TDDFT<a class="headerlink" href="#two-step-approach-with-tddft" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="dirac-kramer-heisenberg-with-adc">
<h3>Dirac-Kramer-Heisenberg with ADC<a class="headerlink" href="#dirac-kramer-heisenberg-with-adc" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To be added.</p>
</div>
</div>
<div class="section" id="id4">
<h3>Other approaches<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Overlap approach…?</p>
</div>
</div>
<div class="section" id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<p>For the analysis of obtained spectra we will focus on the carbon X-ray absorption spectrum of vinylfluoride. Some analysis on the water X-ray emission spectrum will also be included, but as XES is generally easier to analyse (fewer states, unoccupied state of relatively different energies, etc), focus will be on XAS.</p>
<p>Vinulfluride (C<span class="math notranslate nohighlight">\(_2\)</span>H<span class="math notranslate nohighlight">\(_3\)</span>F) is a singly-substituted ethene derivate, which possess large shifts in features for the -CHF site, due to interaction with the very electronegative fluorine. This <em>chemical shift</em> is significant and a strong indicator of the local chemical environment. This can be seen in the [experimental spectra] of ethene, vinylfluoride, and 1,1-difluoroethene:</p>
<div class="figure align-default" id="expt-ethene">
<img alt="../_images/expt_ethene.svg" src="../_images/expt_ethene.svg" /><p class="caption"><span class="caption-number">Fig. 11 </span><span class="caption-text">Carbon X-ray absorption spectra of ethene and two substituted derivates. Marking position (and number of contributing carbon sites) of two <span class="math notranslate nohighlight">\(1s \rightarrow \pi^{\ast}\)</span> transitions.</span><a class="headerlink" href="#expt-ethene" title="Permalink to this image">¶</a></p>
</div>
<p>The position (and number of) <span class="math notranslate nohighlight">\(\pi^{\ast}\)</span>-resonances are labelled, and we see that a single substitution yield a shift of about 2 eV, and double susbtitution (at the same site) of about 4 eV.</p>
<p>Calculating the vinylfluoride spectrum using CVS-ADC(2)-x:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vinyl</span>   <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"> C     0.000000    -0.246412    -1.271068</span>
<span class="s2"> C     0.000000     0.457081    -0.154735</span>
<span class="s2"> F     0.000000    -0.119195     1.052878</span>
<span class="s2"> H     0.000000     0.272328    -2.210194</span>
<span class="s2"> H     0.000000    -1.319906    -1.249847</span>
<span class="s2"> H     0.000000     1.530323    -0.095954</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># SCF calculation</span>
<span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>

<span class="c1"># CVS space with three lowest MOs</span>
<span class="n">adc_xas</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 7 iterations.
Total Energy: -176.8261179747 au
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1    20           inf  601ms  [-1.22142e+161 -1.22142e+161 -1.20145e+161 -2.51113e+150 -1.13819e+150
 -2.02225e+149 -2.00610e+149]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  2    28           inf  681ms  [-3.19323e+163 -3.19323e+163 -8.02990e+162 -8.02990e+162 -1.37803e+161
 -7.87475e+159 -7.87475e+159]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  3    36           inf  777ms  [-6.69290e+165 -6.69290e+165 -6.33970e+164 -5.54582e+164 -5.54582e+164
 -9.33084e+163 -9.33084e+163]
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ArpackNoConvergence</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="mi">95</span><span class="n">a6854a0133</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> 
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># CVS space with three lowest MOs</span>
<span class="ne">---&gt; </span><span class="mi">16</span> <span class="n">adc_xas</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="nn">~/.local/lib/python3.6/site-packages/gator-0.0-py3.6.egg/gator/gatorutils.py</span> in <span class="ni">run_adc</span><span class="nt">(mol, basis, scf_drv, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> 
<span class="g g-Whitespace">    </span><span class="mi">149</span>     <span class="n">task</span> <span class="o">=</span> <span class="n">MockTask</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">150</span>     <span class="k">return</span> <span class="n">adc_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">scf_drv</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

<span class="nn">~/.local/lib/python3.6/site-packages/gator-0.0-py3.6.egg/gator/adcdriver.py</span> in <span class="ni">compute</span><span class="nt">(self, task, scf_drv, verbose)</span>
<span class="g g-Whitespace">    </span><span class="mi">301</span>                                        <span class="n">frozen_core</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adc_frozen_core</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">302</span>                                        <span class="n">frozen_virtual</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adc_frozen_virtual</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">303</span>                                        <span class="n">conv_tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adc_tol</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span> 
<span class="g g-Whitespace">    </span><span class="mi">305</span>                 <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>

<span class="nn">~/.local/lib/python3.6/site-packages/adcc/workflow.py</span> in <span class="ni">run_adc</span><span class="nt">(data_or_matrix, n_states, kind, conv_tol, eigensolver, guesses, n_guesses, n_guesses_doubles, output, core_orbitals, frozen_core, frozen_virtual, method, n_singlets, n_triplets, n_spin_flip, **solverargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">195</span>         <span class="n">matrix</span><span class="p">,</span> <span class="n">n_states</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">guesses</span><span class="o">=</span><span class="n">guesses</span><span class="p">,</span> <span class="n">n_guesses</span><span class="o">=</span><span class="n">n_guesses</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">196</span>         <span class="n">n_guesses_doubles</span><span class="o">=</span><span class="n">n_guesses_doubles</span><span class="p">,</span> <span class="n">conv_tol</span><span class="o">=</span><span class="n">conv_tol</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">output</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">197</span>         <span class="n">eigensolver</span><span class="o">=</span><span class="n">eigensolver</span><span class="p">,</span> <span class="o">**</span><span class="n">solverargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">198</span>     <span class="n">exstates</span> <span class="o">=</span> <span class="n">ExcitedStates</span><span class="p">(</span><span class="n">diagres</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span>     <span class="n">exstates</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>

<span class="nn">~/.local/lib/python3.6/site-packages/adcc/workflow.py</span> in <span class="ni">diagonalise_adcmatrix</span><span class="nt">(matrix, n_states, kind, eigensolver, guesses, n_guesses, n_guesses_doubles, conv_tol, output, **solverargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span>                            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span>                            <span class="n">explicit_symmetrisation</span><span class="o">=</span><span class="n">explicit_symmetrisation</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">399</span>                            <span class="o">**</span><span class="n">solverargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span> 
<span class="g g-Whitespace">    </span><span class="mi">401</span> 

<span class="nn">~/.local/lib/python3.6/site-packages/adcc/solver/davidson.py</span> in <span class="ni">jacobi_davidson</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span> <span class="k">def</span> <span class="nf">jacobi_davidson</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>     <span class="k">return</span> <span class="n">eigsh</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">preconditioner</span><span class="o">=</span><span class="n">JacobiPreconditioner</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">407</span>                  <span class="n">preconditioning_method</span><span class="o">=</span><span class="s2">&quot;Davidson&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">408</span> 
<span class="g g-Whitespace">    </span><span class="mi">409</span> 

<span class="nn">~/.local/lib/python3.6/site-packages/adcc/solver/davidson.py</span> in <span class="ni">eigsh</span><span class="nt">(matrix, guesses, n_ep, max_subspace, conv_tol, which, max_iter, callback, preconditioner, preconditioning_method, debug_checks, residual_min_norm, explicit_symmetrisation)</span>
<span class="g g-Whitespace">    </span><span class="mi">399</span>                         <span class="n">debug_checks</span><span class="o">=</span><span class="n">debug_checks</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span>                         <span class="n">residual_min_norm</span><span class="o">=</span><span class="n">residual_min_norm</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">401</span>                         <span class="n">explicit_symmetrisation</span><span class="o">=</span><span class="n">explicit_symmetrisation</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="k">return</span> <span class="n">state</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span> 

<span class="nn">~/.local/lib/python3.6/site-packages/adcc/solver/davidson.py</span> in <span class="ni">davidson_iterations</span><span class="nt">(matrix, state, max_subspace, max_iter, n_ep, is_converged, which, callback, preconditioner, preconditioning_method, debug_checks, residual_min_norm, explicit_symmetrisation)</span>
<span class="g g-Whitespace">    </span><span class="mi">182</span>                 <span class="c1"># TODO Maybe use previous vectors somehow</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span>                 <span class="n">v0</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">--&gt; </span><span class="mi">184</span>                 <span class="n">rvals</span><span class="p">,</span> <span class="n">rvecs</span> <span class="o">=</span> <span class="n">sla</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">Ass</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">n_block</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">,</span> <span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">185</span> 
<span class="g g-Whitespace">    </span><span class="mi">186</span>         <span class="k">with</span> <span class="n">state</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="s2">&quot;residuals&quot;</span><span class="p">):</span>

<span class="nn">~/.local/lib/python3.6/site-packages/scipy/sparse/linalg/eigen/arpack/arpack.py</span> in <span class="ni">eigsh</span><span class="nt">(A, k, M, sigma, which, v0, ncv, maxiter, tol, return_eigenvectors, Minv, OPinv, mode)</span>
<span class="g g-Whitespace">   </span><span class="mi">1685</span>     <span class="k">with</span> <span class="n">_ARPACK_LOCK</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1686</span>         <span class="k">while</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1687</span>             <span class="n">params</span><span class="o">.</span><span class="n">iterate</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1688</span> 
<span class="g g-Whitespace">   </span><span class="mi">1689</span>         <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">return_eigenvectors</span><span class="p">)</span>

<span class="nn">~/.local/lib/python3.6/site-packages/scipy/sparse/linalg/eigen/arpack/arpack.py</span> in <span class="ni">iterate</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span>                 <span class="k">pass</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>             <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">571</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_raise_no_convergence</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span>                 <span class="k">raise</span> <span class="n">ArpackError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span> <span class="n">infodict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterate_infodict</span><span class="p">)</span>

<span class="nn">~/.local/lib/python3.6/site-packages/scipy/sparse/linalg/eigen/arpack/arpack.py</span> in <span class="ni">_raise_no_convergence</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span>             <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span>             <span class="n">k_ok</span> <span class="o">=</span> <span class="mi">0</span>
<span class="ne">--&gt; </span><span class="mi">377</span>         <span class="k">raise</span> <span class="n">ArpackNoConvergence</span><span class="p">(</span><span class="n">msg</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_iter</span><span class="p">,</span> <span class="n">k_ok</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">),</span> <span class="n">ev</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">378</span> 
<span class="g g-Whitespace">    </span><span class="mi">379</span> 

<span class="ne">ArpackNoConvergence</span>: ARPACK error -1: No convergence (451 iterations, 17/20 eigenvectors converged)
</pre></div>
</div>
</div>
</div>
<p>And with CPP-DFT (B3LYP):</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">molecule</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">Molecule</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">vinyl</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;angstrom&#39;</span><span class="p">)</span>
<span class="n">basis</span>    <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">MolecularBasis</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="s2">&quot;6-31G&quot;</span><span class="p">)</span>
<span class="n">scf_drv</span> <span class="o">=</span> <span class="n">vlx</span><span class="o">.</span><span class="n">ScfRestrictedDriver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">scf_settings</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conv_thresh&#39;</span><span class="p">:</span> <span class="mf">1.0e-6</span><span class="p">}</span>
<span class="n">method_settings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xcfun&#39;</span><span class="p">:</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">,</span> <span class="s1">&#39;grid_level&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">scf_drv</span><span class="o">.</span><span class="n">update_settings</span><span class="p">(</span><span class="n">scf_settings</span><span class="p">,</span><span class="n">method_settings</span><span class="p">);</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">)</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">272.0</span><span class="p">,</span><span class="mf">285.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span><span class="o">/</span><span class="n">au2ev</span><span class="p">;</span> <span class="n">freqs_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">]</span>
<span class="n">cpp_prop</span> <span class="o">=</span> <span class="n">LinearAbsorptionCrossSection</span><span class="p">({</span><span class="s1">&#39;frequencies&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">freqs_str</span><span class="p">),</span> <span class="s1">&#39;damping&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="o">/</span><span class="n">au2ev</span><span class="p">}</span>
                                         <span class="p">,</span><span class="n">method_settings</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">init_driver</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span> <span class="n">ostream</span><span class="o">=</span><span class="n">silent_ostream</span><span class="p">)</span>
<span class="n">cpp_prop</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">scf_tensors</span><span class="p">)</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">alpha_bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">axx</span> <span class="o">+</span> <span class="n">ayy</span> <span class="o">+</span> <span class="n">azz</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span> <span class="n">sigma</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">alpha_bar</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The resulting spectra are shown below, and look quite similar (although with a large difference in absolute energy):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CPP-DFT (B3LYP)&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;CVS-ADC(2)-x&#39;</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">xi</span><span class="p">,</span><span class="n">yi</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span><span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_45_0.png" src="../_images/xray_45_0.png" />
</div>
</div>
<div class="section" id="amplitudes">
<h3>Amplitudes<a class="headerlink" href="#amplitudes" title="Permalink to this headline">¶</a></h3>
<p>For eigenstates we can study the amplitudes of the eigenvectors to see the contributions in the different excited states. For CPP, a similar analysis on response vectors can be conducted, but this might be made more difficult if th density of states is high and the mixing of cointributions to the response at investigated frequencies is thus significant.</p>
<p>Fro the ADC calculations there is a function <code class="docutils literal notranslate"><span class="pre">state.describe_amplitudes</span></code>, which print the amplitudes using one of three formats, controlled by <code class="docutils literal notranslate"><span class="pre">index_format</span></code>. The amplitudes are printed when above a <code class="docutils literal notranslate"><span class="pre">tolerance</span></code> threshold, and splitting the returning string according to <code class="docutils literal notranslate"><span class="pre">state</span></code> and printing the first two states, we get:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;From </span><span class="se">\&#39;</span><span class="s1">hf</span><span class="se">\&#39;</span><span class="s1"> format, which yield MO number:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;hf&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">adcc</span><span class="se">\&#39;</span><span class="s1"> format, with indexing as used in adcc:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;adcc&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">()</span>


<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First transition from </span><span class="se">\&#39;</span><span class="s1">homolumo</span><span class="se">\&#39;</span><span class="s1"> format, which using HOMO/LUMO/HOCO format:&#39;</span><span class="p">)</span>
<span class="n">des_amp</span>    <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">describe_amplitudes</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">index_format</span><span class="o">=</span><span class="s1">&#39;homolumo&#39;</span><span class="p">)</span>
<span class="n">split_line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="n">tmp_amp</span>    <span class="o">=</span> <span class="n">des_amp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">split_line</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmp_amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>From &#39;hf&#39; format, which yield MO number:
+---------------------------------------+
| State   1 ,      10.63675 au          |
+---------------------------------------+
|   1     -&gt;  12      a -&gt;a      +0.601 |
|   1     -&gt;  22      a -&gt;a      -0.105 |
|  11   1 -&gt;  12  12  ab-&gt;ab     -0.149 |
+---------------------------------------+
| State   2 ,      10.69912 au          |
+---------------------------------------+
|   2     -&gt;  13      a -&gt;a        -0.5 |
|   2     -&gt;  15      a -&gt;a      +0.273 |
|   2     -&gt;  14      a -&gt;a       -0.22 |


First transition from &#39;adcc&#39; format, with indexing as used in adcc:
+-------------------------------------------------------+
| State   1 ,      10.63675 au,      289.4407 eV        |
+-------------------------------------------------------+
| (o2  1)         -&gt; (v1  0)          a -&gt;a      +0.601 |
| (o2  1)         -&gt; (v1 10)          a -&gt;a      -0.105 |
| (o1  8) (o2  1) -&gt; (v1  0) (v1  0)  ab-&gt;ab     -0.149 |


First transition from &#39;homolumo&#39; format, which using HOMO/LUMO/HOCO format:
+-------------------------------------------------------+
| State   1 ,      10.63675 au,      289.4407 eV        |
+-------------------------------------------------------+
| HOCO -1         -&gt; LUMO             a -&gt;a      +0.601 |
| HOCO -1         -&gt; LUMO+10          a -&gt;a      -0.105 |
| HOMO    HOCO -1 -&gt; LUMO    LUMO     ab-&gt;ab     -0.149 |
</pre></div>
</div>
</div>
</div>
<p>From this, it is clear that the two first transitions originates in two different MOs, which corresponds to the -CH<span class="math notranslate nohighlight">\(_2\)</span> and -CHF atoms, respectively. The transitions are dominated by single-excitations to the LUMO and LUMO+1, with largest relaxation contributions coming from the HOMO.</p>
</div>
<div class="section" id="decomposition-of-spectra">
<h3>Decomposition of spectra<a class="headerlink" href="#decomposition-of-spectra" title="Permalink to this headline">¶</a></h3>
<p>For a more visual illustration, we can plot the spectra as decomposed according to atomic contributions and polarization of incoming radiation.</p>
<div class="section" id="atomic-contributions">
<h4>Atomic contributions<a class="headerlink" href="#atomic-contributions" title="Permalink to this headline">¶</a></h4>
<p>Decomposing according to atomic contributions provides information on which core orbitals that contribute to which features. For vinylfluoride, this can be done by performing CVS calculations with tailored CVS spaces for each carbon site:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span>  <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecule</span><span class="p">(</span><span class="n">vinyl</span><span class="p">)</span>
<span class="n">basis</span>   <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">get_molecular_basis</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="s1">&#39;6-31G&#39;</span><span class="p">)</span>
<span class="n">scf_res</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_scf</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">)</span>
<span class="n">adc_chf</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">adc_ch2</span> <span class="o">=</span> <span class="n">gator</span><span class="o">.</span><span class="n">run_adc</span><span class="p">(</span><span class="n">struct</span><span class="p">,</span><span class="n">basis</span><span class="p">,</span><span class="n">scf_res</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cvs-adc2x&#39;</span><span class="p">,</span><span class="n">singlets</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SCF converged in 7 iterations.
Total Energy: -176.8261179602 au
                                                                                                                          
                                        Algebraic Diagrammatic Construction (ADC)                                         
                                       ===========================================                                        
                                                                                                                          
                               ADC method                   : cvs-adc2x                                                   
                               Number of Singlet States     : 6                                                           
                               CVS-ADC, Core Orbital Space  : 2                                                           
                               Convergence threshold        : 1.0e-06                                                     
                                                                                                                          
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    12       0.83779  363ms  [10.95566726 11.09723173 11.22363262 11.38716475 11.45152996 11.46601874]
  2    24        0.2046  654ms  [10.65380288 10.80467648 10.83594988 10.92569049 11.03253872 11.14745754]
  3    36      0.010306  769ms  [10.63808994 10.78045883 10.81247902 10.84957006 10.93904758 11.01133284]
  4    48     0.0013397  989ms  [10.63691445 10.77791559 10.81035773 10.84602802 10.93142281 11.00480161]
  5    60     0.0001776   1.1s  [10.63683717 10.77744923 10.81011882 10.8455034  10.93044828 11.00389063]
=== Restart ===
  6    24    5.7686e-05  920ms  [10.63683012 10.7774054  10.81009624 10.84544999 10.93033759 11.00374539]
  7    36    3.3654e-05  782ms  [10.63682842 10.7773967  10.81009167 10.84543763 10.93029998 11.00366411]
  8    48    1.3715e-05   1.0s  [10.63682822 10.7773952  10.81009101 10.84543576 10.9302912  11.00363115]
  9    60    3.1896e-06   1.2s  [10.6368282  10.77739496 10.8100909  10.84543533 10.93028896 11.00361892]
=== Restart ===
 10    24     1.101e-06  965ms  [10.6368282  10.77739494 10.81009089 10.84543527 10.93028857 11.0036166 ]
 11    36    3.4414e-07  952ms  [10.6368282  10.77739493 10.81009089 10.84543525 10.93028841 11.00361564]
=== Converged ===
    Number of matrix applies:    132
    Total solver time:             9s 735ms
                                                                                                                          
                                                  ADC Summary of Results                                                  
                                                 ------------------------                                                 
                                                                                                                          
                             +--------------------------------------------------------------+                             
                             | cvs-adc2x                               singlet ,  converged |                             
                             +--------------------------------------------------------------+                             
                             |  #        excitation energy     osc str    |v1|^2    |v2|^2  |                             
                             |          (au)           (eV)                                 |                             
                             |  0      10.63683      289.4428   0.0487    0.7516    0.2484  |                             
                             |  1      10.77739      293.2679   0.0424    0.7806    0.2194  |                             
                             |  2      10.81009      294.1576   0.0161    0.7733    0.2267  |                             
                             |  3      10.84544      295.1193   0.0002    0.7127    0.2873  |                             
                             |  4      10.93029      297.4283   0.0123    0.7286    0.2714  |                             
                             |  5      11.00362      299.4236   0.0266    0.7326    0.2674  |                             
                             +--------------------------------------------------------------+                             
                                                                                                                          
                                          End of ADC calculation. All went well!                                          
                                                                                                                          
                                                                                                                          
                                        Algebraic Diagrammatic Construction (ADC)                                         
                                       ===========================================                                        
                                                                                                                          
                               ADC method                   : cvs-adc2x                                                   
                               Number of Singlet States     : 6                                                           
                               CVS-ADC, Core Orbital Space  : 3                                                           
                               Convergence threshold        : 1.0e-06                                                     
                                                                                                                          
Starting cvs-adc2x singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    12        0.8629  361ms  [10.90478791 11.13511328 11.15327844 11.28450985 11.33440607 11.38128693]
  2    24      0.077857  661ms  [10.57187957 10.7280176  10.7500245  10.81481915 10.87551659 10.9573124 ]
  3    36     0.0044438  803ms  [10.55787715 10.70107989 10.72117402 10.76300132 10.83029624 10.92823133]
  4    48    0.00056429   1.0s  [10.55669808 10.69941992 10.71948514 10.7602098  10.82771657 10.92598866]
  5    60    7.2353e-05   1.1s  [10.5566053  10.6992194  10.71934404 10.75990483 10.82730706 10.92563592]
=== Restart ===
  6    24    1.1689e-05  924ms  [10.5566006  10.69920579 10.71933511 10.75988552 10.82726614 10.92560287]
  7    36    2.4098e-06  822ms  [10.5566001  10.69920363 10.71933397 10.75988254 10.82725725 10.92559496]
  8    48    5.8518e-07  987ms  [10.55660007 10.69920335 10.71933387 10.75988224 10.82725581 10.92559339]
=== Converged ===
    Number of matrix applies:    96
    Total solver time:             6s 718ms
                                                                                                                          
                                                  ADC Summary of Results                                                  
                                                 ------------------------                                                 
                                                                                                                          
                             +--------------------------------------------------------------+                             
                             | cvs-adc2x                               singlet ,  converged |                             
                             +--------------------------------------------------------------+                             
                             |  #        excitation energy     osc str    |v1|^2    |v2|^2  |                             
                             |          (au)           (eV)                                 |                             
                             |  0       10.5566      287.2597   0.0391    0.7614    0.2386  |                             
                             |  1       10.6992      291.1402   0.0170    0.7614    0.2386  |                             
                             |  2      10.71933      291.6879   0.0133    0.7777    0.2223  |                             
                             |  3      10.75988      292.7913   0.0004    0.7255    0.2745  |                             
                             |  4      10.82726      294.6246   0.0268    0.7568    0.2432  |                             
                             |  5      10.92559      297.3005   0.0038    0.7614    0.2386  |                             
                             +--------------------------------------------------------------+                             
                                                                                                                          
                                          End of ADC calculation. All went well!                                          
                                                                                                                          
</pre></div>
</div>
</div>
</div>
<p>From which the spectra can be decomposed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># Spectrum from -CHF </span>
<span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_chf</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_chf</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x1i</span><span class="p">,</span><span class="n">y1i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Spectrum from -CH2</span>
<span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_ch2</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">,</span> <span class="n">adc_ch2</span><span class="o">.</span><span class="n">oscillator_strength</span>
<span class="n">x2i</span><span class="p">,</span><span class="n">y2i</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="mi">280</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plotting line spectra for full, area spectra for contributions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span><span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2i</span><span class="p">,</span> <span class="n">y1i</span><span class="p">,</span> <span class="n">y1i</span><span class="o">+</span><span class="n">y2i</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Full&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="s1">&#39;-CH2&#39;</span><span class="p">),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">284</span><span class="p">,</span><span class="mi">296</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_51_0.png" src="../_images/xray_51_0.png" />
</div>
</div>
<p>This manner of decomposing the atomic contributions should be taken with some care, as it involves explicit calculation of all atomic sites, which:</p>
<ol class="simple">
<li><p>Requires a larger number of calculations, and care should be taken so that a region in which some states (e.g. for -CHF) are converged into, but not other (e.g. -CH<span class="math notranslate nohighlight">\(_2\)</span>).</p></li>
<li><p>Does not strictly fit with the CVS philosophy, which uses the large separation in energy and spatial extend as a basis for separation. Energy separation can now be rather small, and for some systems degeneracies and near-degeneracies may lead to delocalized core orbitals. If so, all delocalized sites must be included in the same CVS space.</p></li>
</ol>
<p>Nevertheless, the lower computational cost per calculation of doing this decomposition may make it worth it.</p>
<p>Alternatively, using the full space eigenvectors, we can perform a decomposition as…</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do full space eigenvector decomposition and compare to above.</p>
<ul class="simple">
<li><p>Either learn how eigenstates are constructed, or just split and divide describe_amplitude results.</p></li>
</ul>
</div>
<p>Performing the same analysis with CPP-DFT, we decompose the solution vectors:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of occupied and unoccupied (alpha) MOs</span>
<span class="n">nocc</span>  <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">number_of_alpha_electrons</span><span class="p">()</span>
<span class="n">nvirt</span> <span class="o">=</span> <span class="n">scf_drv</span><span class="o">.</span><span class="n">mol_orbs</span><span class="o">.</span><span class="n">number_mos</span><span class="p">()</span> <span class="o">-</span> <span class="n">nocc</span>

<span class="c1"># Extract solution vectors</span>
<span class="n">solution_vecs</span> <span class="o">=</span> <span class="n">cpp_prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;solutions&#39;</span><span class="p">)</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">x_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
    <span class="n">y_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
    <span class="n">z_solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solution_vecs</span><span class="p">[(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)])</span>
<span class="n">x_solution</span><span class="p">,</span><span class="n">y_solution</span><span class="p">,</span><span class="n">z_solution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_solution</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_solution</span><span class="p">)</span>

<span class="c1"># Extract polarization-resolved response</span>
<span class="n">sX</span><span class="p">,</span><span class="n">sY</span><span class="p">,</span><span class="n">sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">axx</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">ayy</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">azz</span> <span class="o">=</span> <span class="o">-</span><span class="n">cpp_prop</span><span class="o">.</span><span class="n">rsp_property</span><span class="p">[</span><span class="s1">&#39;response_functions&#39;</span><span class="p">][(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">w</span><span class="p">)]</span><span class="o">.</span><span class="n">imag</span>
    <span class="n">sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">axx</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">ayy</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>
    <span class="n">sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">azz</span> <span class="o">/</span> <span class="mf">137.035999</span><span class="p">)</span>

<span class="c1"># Create empty object of dimension nocc (to add spectrum for each occupied)</span>
<span class="n">spec_comp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nocc</span><span class="p">):</span> <span class="n">spec_comp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    
<span class="c1"># Appending spec_comp object with decomposed response</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
    <span class="n">x_tmp</span> <span class="o">=</span> <span class="n">x_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">y_tmp</span> <span class="o">=</span> <span class="n">y_solution</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">z_tmp</span> <span class="o">=</span> <span class="n">z_solution</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">occ</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nocc</span><span class="p">):</span>
        <span class="n">comp_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">x_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y_tmp</span><span class="p">[:])))</span>
        <span class="n">comp_Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[</span><span class="n">occ</span><span class="o">*</span><span class="n">nvirt</span> <span class="p">:</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nvirt</span><span class="p">])))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">z_tmp</span><span class="p">[:])))</span>
        <span class="n">spec_comp</span><span class="p">[</span><span class="n">occ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">comp_X</span><span class="o">*</span><span class="n">sX</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Y</span><span class="o">*</span><span class="n">sY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">comp_Z</span><span class="o">*</span><span class="n">sZ</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1"># Extract contribution of two carbon atoms</span>
<span class="n">cont_chf</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">cont_ch2</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">spec_comp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">cont_full</span> <span class="o">=</span> <span class="n">sigma</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># Create splines spectra for each component</span>
<span class="n">x</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">ychf</span>  <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_chf</span><span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">ych2</span>  <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_ch2</span><span class="p">,</span>  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yfull</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">cont_full</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="c1"># Spectrum from the non-carbon atoms</span>
<span class="n">yrest</span> <span class="o">=</span> <span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># Plot full spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yfull</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Plot components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yrest</span><span class="o">+</span><span class="n">ych2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">ychf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yrest</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span><span class="s1">&#39;-CHF&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;-CH$_2$&#39;</span><span class="p">,</span><span class="s1">&#39;Rest&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_53_0.png" src="../_images/xray_53_0.png" />
</div>
</div>
<p>We see that the first two features corresponds to transitions from two different MOs, which here are to -CH<span class="math notranslate nohighlight">\(_2\)</span> and -CHF.</p>
</div>
<div class="section" id="polarization-dependence">
<h4>Polarization dependence<a class="headerlink" href="#polarization-dependence" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Discuss the possibilities of using polarization-sensitive measurements for investigating local structure.</p></li>
</ul>
<p>Resolving the Cartesian components of the response vectors is quite straightforward, with ADC:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract Cartesian components from ADC state (here skipping the prefactors)</span>
<span class="n">adc_sX</span><span class="p">,</span><span class="n">adc_sY</span><span class="p">,</span><span class="n">adc_sZ</span> <span class="o">=</span> <span class="p">[],[],[]</span>
<span class="n">adc_freq</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">excitation_energy</span>
<span class="n">indx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">adc_freq</span><span class="p">:</span>
    <span class="n">tmp_tms</span> <span class="o">=</span> <span class="n">adc_xas</span><span class="o">.</span><span class="n">transition_dipole_moment</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="n">adc_sX</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">adc_sZ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">tmp_tms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># Broadened spectra for each component</span>
<span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span> <span class="o">=</span> <span class="mi">284</span><span class="p">,</span><span class="mi">296</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sX</span>
<span class="n">xX</span><span class="p">,</span><span class="n">yX</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sY</span>
<span class="n">xY</span><span class="p">,</span><span class="n">yY</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span>   <span class="o">=</span> <span class="n">au2ev</span><span class="o">*</span><span class="n">adc_freq</span><span class="p">,</span> <span class="n">adc_sZ</span>
<span class="n">xZ</span><span class="p">,</span><span class="n">yZ</span> <span class="o">=</span> <span class="n">lorentzian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="c1"># Plot it</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span><span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xX</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="p">,</span> <span class="n">yX</span><span class="o">+</span><span class="n">yY</span><span class="o">+</span><span class="n">yZ</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_55_0.png" src="../_images/xray_55_0.png" />
</div>
</div>
<p>And for CPP-DFT:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">),</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">yX</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sX</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yY</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">yZ</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="n">freqs</span><span class="p">,</span> <span class="n">sZ</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">yX</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">yZ</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Isotropic&#39;</span><span class="p">,</span><span class="s1">&#39;x-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;y-pol.&#39;</span><span class="p">,</span><span class="s1">&#39;z-pol.&#39;</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="mi">272</span><span class="p">,</span><span class="mi">284</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_57_0.png" src="../_images/xray_57_0.png" />
</div>
</div>
<p>We see that the first two transitions are out-of-plane, being <span class="math notranslate nohighlight">\(\pi^{\ast}\)</span>.</p>
<p>Using a larger basis set of aug-cc-pCVT/cc-pVTZ and comparing to experiment, we obtain:</p>
<div class="figure align-default" id="vinyl-decomp">
<img alt="../_images/vinyl_decomp.svg" src="../_images/vinyl_decomp.svg" /><p class="caption"><span class="caption-number">Fig. 12 </span><span class="caption-text">ADC and TDDFT, atomic and polarization</span><a class="headerlink" href="#vinyl-decomp" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fix this.</p>
</div>
<p>Looks pretty good - compares well. Maybe improves with CAM-B3LYP (or evem CAM100%-B3LYP), so could potentially change that further down the line.</p>
</div>
</div>
<div class="section" id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Could add, e.g.,</p>
<ul class="simple">
<li><p>Electron/hole densities</p></li>
<li><p>Attachment/detachment densities</p>
<ul>
<li><p>Compare to electron/hole - relaxation</p></li>
</ul>
</li>
<li><p>NTO:s?</p></li>
<li><p>MOs?</p></li>
</ul>
</div>
</div>
<div class="section" id="descriptors">
<h3>Descriptors<a class="headerlink" href="#descriptors" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Could add, e.g.,</p>
<ul class="simple">
<li><p>Electron/hole sizes etc</p></li>
<li><p>Attachment/detachment sizes etc</p></li>
<li><p>v2, R, …</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="larger-systems">
<h2>Larger systems<a class="headerlink" href="#larger-systems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="valence-to-core-xes">
<h3>Valence-to-core XES<a class="headerlink" href="#valence-to-core-xes" title="Permalink to this headline">¶</a></h3>
<p>Suitable TM-complex with minimal static correlation</p>
<ol class="simple">
<li><p>Overlap</p></li>
<li><p>TDDFT(?)</p></li>
<li><p>ADC?</p></li>
</ol>
</div>
<div class="section" id="xas-of-uracil">
<h3>XAS of uracil<a class="headerlink" href="#xas-of-uracil" title="Permalink to this headline">¶</a></h3>
<p>Maybe uracil or similar:</p>
<ol class="simple">
<li><p>Tailor CVS space for ADC (‘cost-saving measures’)</p></li>
<li><p>Gas phase spectra</p></li>
<li><p>Spectra with PE</p></li>
</ol>
<p>Might include massive system with DFT as well.</p>
</div>
<div class="section" id="xes-of-uracil">
<h3>XES of uracil<a class="headerlink" href="#xes-of-uracil" title="Permalink to this headline">¶</a></h3>
<p>Maybe uracil again.</p>
<ol class="simple">
<li><p>Gas phase</p></li>
<li><p>Environment with PE</p></li>
</ol>
<p>Could potentially consider some massive system - TDDFT versus overlap.</p>
</div>
<div class="section" id="coupling-to-molecular-dynamics">
<h3>Coupling to molecular dynamics<a class="headerlink" href="#coupling-to-molecular-dynamics" title="Permalink to this headline">¶</a></h3>
<p>Some system…</p>
<ol class="simple">
<li><p>Dynamics + XAS</p></li>
<li><p>Dynamics + XES</p></li>
<li><p>Inclusion of environment?</p></li>
<li><p>Core-hole dynamics with some model?</p></li>
</ol>
</div>
</div>
<div class="section" id="transient-x-ray-spectroscopy">
<h2>Transient X-ray spectroscopy<a class="headerlink" href="#transient-x-ray-spectroscopy" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Longer-term goal.</p>
<ul class="simple">
<li><p>Two-step approach</p></li>
<li><p>Coupling</p></li>
</ul>
</div>
</div>
<div class="section" id="self-interaction-error-in-dft">
<h2>Self-interaction error in DFT<a class="headerlink" href="#self-interaction-error-in-dft" title="Permalink to this headline">¶</a></h2>
<p>For a single-electron systems the following equality should hold for the two-electron terms:</p>
<div class="math notranslate nohighlight">
\[
J[\rho] + E_{xc} [\rho] = 0.0
\]</div>
<p>This cancellation is achieved for, e.g. Hartree–Fock theory, but for any approximate functionals in DFT it will instead result in an erronous contribution to the energy. DFT-based methods generally suffer from self-interaction error (SIE), which corresponds to the sum of Coulomb and exchange self-interactions that remain because of the use of approximate exchange functionals. In more detail, the Coulomb self-repulsion of each electron included in the Coulomb operator is exactly canceled by the nonlocal exchange self-attraction in Hartree–Fock theory, but this is no longer the case when the exchange operator is replaced by an approximate exchange functional.</p>
<p>Consider the ionization potential of water, as calculated with MO energy and <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span>. Former a reasonable representative of IP from TDDFT XAS calculation.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare molecule object</span>
<span class="n">mol</span>       <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">();</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;6-31G&#39;</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># HF exchange and creating result containers</span>
<span class="n">hf_exc</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
<span class="n">hf_blyp</span><span class="p">,</span><span class="n">hf_pbe</span> <span class="o">=</span> <span class="p">[[],[]],</span> <span class="p">[[],[]]</span>

<span class="k">for</span> <span class="n">h_x</span> <span class="ow">in</span> <span class="n">hf_exc</span><span class="p">:</span>
    <span class="c1">###### BxLYP (Slater exchange 0.08, except when HF i 1.00)</span>
    <span class="k">if</span> <span class="n">h_x</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span> <span class="n">s_x</span> <span class="o">=</span> <span class="mf">0.00</span>
    <span class="k">else</span><span class="p">:</span>          <span class="n">s_x</span> <span class="o">=</span> <span class="mf">0.08</span> 
    <span class="n">b_x</span>      <span class="o">=</span> <span class="mf">1.00</span> <span class="o">-</span> <span class="n">h_x</span> <span class="o">-</span> <span class="n">s_x</span>
    <span class="n">v_e</span><span class="p">,</span> <span class="n">v_l</span> <span class="o">=</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.81</span>
    <span class="c1"># Neutral calculation</span>
    <span class="n">dft_res</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">h_x</span><span class="si">:}</span><span class="s1"> * HF + </span><span class="si">{</span><span class="n">s_x</span><span class="si">:}</span><span class="s1"> * Slater + </span><span class="si">{</span><span class="n">b_x</span><span class="si">:}</span><span class="s1"> * B88, </span><span class="si">{</span><span class="n">v_l</span><span class="si">:}</span><span class="s1"> * LYP + </span><span class="si">{</span><span class="n">v_e</span><span class="si">:}</span><span class="s1"> * VWN&#39;</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Core-hole calculation</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">dft_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">HF_X</span><span class="si">:}</span><span class="s1"> * HF + </span><span class="si">{</span><span class="n">LDA_X</span><span class="si">:}</span><span class="s1"> * LDA + </span><span class="si">{</span><span class="n">B88_X</span><span class="si">:}</span><span class="s1"> * B88, </span><span class="si">{</span><span class="n">LYP_C</span><span class="si">:}</span><span class="s1"> * LYP + </span><span class="si">{</span><span class="n">VWN_C</span><span class="si">:}</span><span class="s1"> * VWN&#39;</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">dft_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">dft_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Extract results</span>
    <span class="n">hf_blyp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">dft_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="n">hf_blyp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">###### PBEx</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">h_x</span>
    <span class="c1"># Neutral calculation</span>
    <span class="n">dft_res</span>    <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">h_x</span><span class="si">:}</span><span class="s1"> * HF + </span><span class="si">{</span><span class="n">p_x</span><span class="si">:}</span><span class="s1"> * PBE, PBE&#39;</span>
    <span class="n">dft_res</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Core-hole calculation</span>
    <span class="n">mo0</span>  <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span>  <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">dft_ion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
    <span class="n">dft_ion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">h_x</span><span class="si">:}</span><span class="s1"> * HF + </span><span class="si">{</span><span class="n">p_x</span><span class="si">:}</span><span class="s1"> * PBE, PBE&#39;</span>
    <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">dft_ion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">dft_ion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="c1"># Extract results</span>
    <span class="n">hf_pbe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">dft_ion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">dft_res</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="n">hf_pbe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">au2ev</span><span class="o">*</span><span class="n">dft_res</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -76.3570352138422  &lt;S^2&gt; = 9.876544e-13  2S+1 = 1
converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
converged SCF energy = -76.2984404502067  &lt;S^2&gt; = 6.9277917e-13  2S+1 = 1
converged SCF energy = -56.3921764305246  &lt;S^2&gt; = 0.75419443  2S+1 = 2.00419
converged SCF energy = -76.3458605029087  &lt;S^2&gt; = 1.9799273e-11  2S+1 = 1
converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
converged SCF energy = -76.3012084721052  &lt;S^2&gt; = 3.3217873e-12  2S+1 = 1
converged SCF energy = -56.3896010586894  &lt;S^2&gt; = 0.7552122  2S+1 = 2.0052054
converged SCF energy = -76.3352647255066  &lt;S^2&gt; = 1.375966e-11  2S+1 = 1
converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
converged SCF energy = -76.304577252447  &lt;S^2&gt; = 2.9345415e-11  2S+1 = 1
converged SCF energy = -56.3873473076527  &lt;S^2&gt; = 0.75643162  2S+1 = 2.0064213
converged SCF energy = -76.325199834941  &lt;S^2&gt; = 1.0948575e-11  2S+1 = 1
converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
converged SCF energy = -76.3084953868845  &lt;S^2&gt; = 7.4606987e-12  2S+1 = 1
converged SCF energy = -56.3853783589998  &lt;S^2&gt; = 0.75788093  2S+1 = 2.0078655
converged SCF energy = -76.3853635207931  &lt;S^2&gt; = 1.0879209e-10  2S+1 = 1
converged SCF energy = -56.4125421194361  &lt;S^2&gt; = 0.75441021  2S+1 = 2.0044054
converged SCF energy = -76.3129197258739  &lt;S^2&gt; = 2.0952129e-12  2S+1 = 1
converged SCF energy = -56.3836609608719  &lt;S^2&gt; = 0.75959312  2S+1 = 2.0095702
</pre></div>
</div>
</div>
</div>
<p>With results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">hf_blyp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bs--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">hf_blyp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ro--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">hf_pbe</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;d--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hf_exc</span><span class="p">,</span><span class="n">hf_pbe</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;g^--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">],[</span><span class="mf">539.9</span><span class="p">,</span><span class="mf">539.9</span><span class="p">],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="sa">r</span><span class="s1">&#39;BxLYP ($\Delta$SCF)&#39;</span><span class="p">,</span><span class="s1">&#39;BxLYP (Koopmans</span><span class="se">\&#39;</span><span class="s1">)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;PBEx ($\Delta$SCF)&#39;</span><span class="p">,</span><span class="s1">&#39;PBEx (Koopmans</span><span class="se">\&#39;</span><span class="s1">)&#39;</span><span class="p">,</span><span class="s1">&#39;Expt&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.025</span><span class="p">,</span><span class="mf">1.025</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">508</span><span class="p">,</span><span class="mf">562.</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;HF exchange [%]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ionization potential [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_64_0.png" src="../_images/xray_64_0.png" />
</div>
</div>
<p>As can be seen, the IP error from MO energies (which scales as the XAS error) does not appreciably depend on the functional, save for HF exchange.</p>
<ul class="simple">
<li><p>Radial distribution for functionals?</p></li>
<li><p>Calculate SIE?</p></li>
</ul>
</div>
<div class="section" id="relativity">
<h2>Relativity<a class="headerlink" href="#relativity" title="Permalink to this headline">¶</a></h2>
<p>Total relativistic and correlation corrections as a function of Z</p>
<p>not additive with correlation</p>
<div class="section" id="scalar-relativistic-effects">
<h3>Scalar relativistic effects<a class="headerlink" href="#scalar-relativistic-effects" title="Permalink to this headline">¶</a></h3>
<div class="section" id="for-ionization-potentials">
<h4>For ionization potentials<a class="headerlink" href="#for-ionization-potentials" title="Permalink to this headline">¶</a></h4>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="p">,</span> <span class="n">rel_mo</span><span class="p">,</span> <span class="n">rel_delta</span><span class="p">,</span> <span class="n">rel_e</span> <span class="o">=</span> <span class="p">[],[],[],[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">struct</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;   0.0  0.0  0.0&#39;</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">();</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">struct</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-ccpvdz&#39;</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">rel_mo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">27.2114</span><span class="o">*</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">ion_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_nr</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span>  <span class="n">ion_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ion_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span>     <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">ion_rel</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span>     <span class="n">ion_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">rel_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">27.2114</span><span class="o">*</span><span class="p">((</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">ion_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_nr</span><span class="o">.</span><span class="n">e_tot</span><span class="p">)))</span>
    <span class="n">rel_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">27.2114</span><span class="o">*</span><span class="p">(</span><span class="n">ion_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="o">-</span><span class="n">scf_rel</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -2.85516047724517  &lt;S^2&gt; = 1.3322676e-15  2S+1 = 1
converged SCF energy = -2.85525304501235  &lt;S^2&gt; = 1.110223e-15  2S+1 = 1
converged SCF energy = -1.99426858617921  &lt;S^2&gt; = 0.75  2S+1 = 2
converged SCF energy = -1.99436880481848  &lt;S^2&gt; = 0.75  2S+1 = 2
converged SCF energy = -14.5723376313364  &lt;S^2&gt; = 0  2S+1 = 1
converged SCF energy = -14.5748455751041  &lt;S^2&gt; = -1.3322676e-15  2S+1 = 1
converged SCF energy = -10.0357274640245  &lt;S^2&gt; = 0.75629212  2S+1 = 2.0062823
converged SCF energy = -10.0378218682322  &lt;S^2&gt; = 0.75630468  2S+1 = 2.0062948
converged SCF energy = -37.596291563267  &lt;S^2&gt; = 8.8817842e-16  2S+1 = 1
converged SCF energy = -37.6112425609782  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
converged SCF energy = -26.6586016324333  &lt;S^2&gt; = 0.75725116  2S+1 = 2.0072381
SCF not converged.
SCF energy = -26.6699783724615 after 50 cycles  &lt;S^2&gt; = 0.75726851  2S+1 = 2.0072553
converged SCF energy = -74.665428938125  &lt;S^2&gt; = -5.3290705e-15  2S+1 = 1
converged SCF energy = -74.7175020694568  &lt;S^2&gt; = 5.3290705e-15  2S+1 = 1
converged SCF energy = -54.5945032394038  &lt;S^2&gt; = 0.75658425  2S+1 = 2.0065734
converged SCF energy = -54.632827234573  &lt;S^2&gt; = 0.75660276  2S+1 = 2.0065919
converged SCF energy = -128.488775570938  &lt;S^2&gt; = -2.6645353e-15  2S+1 = 1
converged SCF energy = -128.625415373727  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
converged SCF energy = -96.5516222970474  &lt;S^2&gt; = 0.75578137  2S+1 = 2.005773
converged SCF energy = -96.6510283847277  &lt;S^2&gt; = 0.75580087  2S+1 = 2.0057925
converged SCF energy = -199.608297084141  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
converged SCF energy = -199.914940213925  &lt;S^2&gt; = 5.3290705e-15  2S+1 = 1
converged SCF energy = -151.491503261379  &lt;S^2&gt; = 0.75303231  2S+1 = 2.00303
converged SCF energy = -151.717159175497  &lt;S^2&gt; = 0.75305441  2S+1 = 2.0030521
converged SCF energy = -288.787205052154  &lt;S^2&gt; = 1.7763568e-15  2S+1 = 1
converged SCF energy = -289.390917359485  &lt;S^2&gt; = -4.4408921e-15  2S+1 = 1
converged SCF energy = -220.963046126516  &lt;S^2&gt; = 0.75243322  2S+1 = 2.0024317
converged SCF energy = -221.408449536373  &lt;S^2&gt; = 0.75245636  2S+1 = 2.0024549
converged SCF energy = -397.413437578762  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
converged SCF energy = -398.496590616317  &lt;S^2&gt; = -7.1054274e-15  2S+1 = 1
converged SCF energy = -306.488275279816  &lt;S^2&gt; = 0.75212654  2S+1 = 2.0021254
converged SCF energy = -307.289416362766  &lt;S^2&gt; = 0.75215123  2S+1 = 2.0021501
converged SCF energy = -526.799865309822  &lt;S^2&gt; = 0  2S+1 = 1
converged SCF energy = -528.611698214493  &lt;S^2&gt; = -3.5527137e-15  2S+1 = 1
converged SCF energy = -409.378251604582  &lt;S^2&gt; = 0.75188904  2S+1 = 2.0018881
converged SCF energy = -410.72209109867  &lt;S^2&gt; = 0.75191517  2S+1 = 2.0019143
</pre></div>
</div>
</div>
</div>
<p>yielding</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">rel_mo</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">rel_delta</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;From MO energies&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;From $\Delta$SCF&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Atomic number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relativistic effects [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rel_mo</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rel_e</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rel_delta</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rel_e</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Atomic number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relativistic effects [</span><span class="si">% o</span><span class="s1">f total energy]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_68_0.png" src="../_images/xray_68_0.png" />
</div>
</div>
</div>
<div class="section" id="for-spectra-xas">
<h4>For spectra (XAS)<a class="headerlink" href="#for-spectra-xas" title="Permalink to this headline">¶</a></h4>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;unc-6-31G&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># non-relativistic</span>
<span class="n">scf_nr</span>  <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf_nr</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_nr</span>  <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_nr</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># relativistic</span>
<span class="n">scf_rel</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">x2c1e</span><span class="p">();</span> <span class="n">scf_rel</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="n">adc_rel</span> <span class="o">=</span> <span class="n">adcc</span><span class="o">.</span><span class="n">cvs_adc2</span><span class="p">(</span><span class="n">scf_rel</span><span class="p">,</span><span class="n">n_singlets</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">core_orbitals</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>converged SCF energy = -75.9890271783229
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/thomas/pkg/adcc/adcc/backends/__init__.py:48: UserWarning: Could not check host program psi4 minimal version, since __version__ tag not found. Proceeding anyway.
  &quot;&quot;.format(module)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    10        2.7777  716ms  [20.27588296 20.31155183 20.86140432 20.92171887 20.92996834]
  2    20      0.035824  780ms  [19.72872545 19.81092766 20.31040554 20.40470691 20.49837544]
  3    30    4.1402e-05   1.1s  [19.72388013 19.80673445 20.3057139  20.39997868 20.49772007]
=== Converged ===
    Number of matrix applies:    30
    Total solver time:             2s 702ms
converged SCF energy = -76.0403950942123
Starting cvs-adc2 singlet Jacobi-Davidson ...
Niter n_ss  max_residual  time  Ritz values
  1    10        2.7842  483ms  [20.29049204 20.32651304 20.87612706 20.93658562 20.9451677 ]
  2    20      0.036027  388ms  [19.74278629 19.82524258 20.32473443 20.41889866 20.51251234]
  3    30    4.1677e-05  555ms  [19.73792472 19.82102908 20.32001931 20.41414446 20.51185242]
=== Converged ===
    Number of matrix applies:    30
    Total solver time:             1s 458ms
</pre></div>
</div>
</div>
</div>
<p>with results:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">adc_nr</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-relativistic&#39;</span><span class="p">)</span>
<span class="n">adc_rel</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Relativistic&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy shift of the first feature:&#39;</span><span class="p">,</span>
      <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">adc_rel</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">adc_nr</span><span class="o">.</span><span class="n">excitation_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">2</span><span class="p">),</span><span class="s1">&#39;eV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/xray_72_0.png" src="../_images/xray_72_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Energy shift of the first feature: 0.38 eV
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="spin-orbit-coupling">
<h3>Spin-orbit coupling<a class="headerlink" href="#spin-orbit-coupling" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Will not be able to illustrate for a while, but maybe insert short discussion.</p>
</div>
</div>
</div>
<div class="section" id="relaxation">
<h2>Relaxation<a class="headerlink" href="#relaxation" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Radial distribution: Z, Z with hole, Z+1</p></li>
<li><p>Total density: formaldehyde</p></li>
<li><p>Maybe: visualization of effects for XAS and XES</p></li>
</ol>
<div class="figure align-default" id="relax-form">
<img alt="../_images/relax_form.svg" src="../_images/relax_form.svg" /><p class="caption"><span class="caption-number">Fig. 13 </span><span class="caption-text">foo</span><a class="headerlink" href="#relax-form" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="relax-processes">
<img alt="../_images/relax_processes.svg" src="../_images/relax_processes.svg" /><p class="caption"><span class="caption-number">Fig. 14 </span><span class="caption-text">foo</span><a class="headerlink" href="#relax-processes" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="including-with-delta-textrm-scf-methods">
<h3>Including with <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> methods<a class="headerlink" href="#including-with-delta-textrm-scf-methods" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Illustrative calculations.</p>
</div>
</div>
<div class="section" id="including-for-wave-function-methods">
<h3>Including for wave function methods<a class="headerlink" href="#including-for-wave-function-methods" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Maybe relaxation versus v2, or so.</p>
</div>
</div>
<div class="section" id="including-for-dft-based-methods">
<h3>Including for DFT-based methods<a class="headerlink" href="#including-for-dft-based-methods" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not sure anything can really be said.</p>
</div>
</div>
</div>
<div class="section" id="basis-set-considerations">
<h2>Basis set considerations<a class="headerlink" href="#basis-set-considerations" title="Permalink to this headline">¶</a></h2>
<p>The basis set requirements of X-ray spectrum calculations will depend strongly on which spectroscopy</p>
<ul class="simple">
<li><p>XPS and XES probes occupied states, and thus need a good description of those</p></li>
<li><p>XAS and RIXS probes excited states, and thus need an improved description also of this region</p></li>
</ul>
<p>However, in both cases the relaxation due to the creation of a core-hole need to be enabled, which yield requirements of reasonable flexibility of the core and inner valence region. This is not typically the case, as most studies deals with valence electron and thus have a minimal or close to minimal description of the core region.</p>
<p>A number of approaches for improving the basis sets have been developed:</p>
<ol class="simple">
<li><p>Augment the Dunning basis sets with core-polarizing functions, e.g. cc-pV<em>n</em>Z <span class="math notranslate nohighlight">\(\rightarrow\)</span> cc-pCV<em>n</em>Z</p></li>
<li><p>Adding extra flexibility by performing full or partial decontraction, e.g.</p>
<ol class="simple">
<li><p>u6-311++G** is 6-311++G** with decontracted 1s function of the probed element</p></li>
<li><p>un-6-311++G** is a fully decontracted 6-311++G** basis set</p></li>
</ol>
</li>
<li><p>Use basis functions from the next element, is inspired by the equvalent core/Z+1 approximation</p></li>
</ol>
<p>Here we focus on the basis set effects for calculations of the IP of water, and we encourage the interested reader to do the same excercise for XES, as well as for XAS (where the augmentation of diffuse functions also need to be considered).</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">un6311gss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">   1297.230                  1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">    299.2960                 1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     87.37710                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">     25.67890                1.000000 </span>
<span class="s1">O    S</span>
<span class="s1">      3.740040               1.000000 </span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      9.628370               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      2.853320               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
<span class="n">z6311gss</span>  <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="n">gto</span><span class="o">.</span><span class="n">basis</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">O    S</span>
<span class="s1">   8588.500                  0.00189515</span>
<span class="s1">   1297.230                  0.0143859</span>
<span class="s1">    299.2960                 0.0707320</span>
<span class="s1">     87.37710                0.2400010</span>
<span class="s1">     25.67890                0.5947970</span>
<span class="s1">      3.740040               0.2808020</span>
<span class="s1">O    SP</span>
<span class="s1">     42.11750                0.113889               0.0365114</span>
<span class="s1">      9.628370               0.920811               0.237153</span>
<span class="s1">      2.853320              -0.00327447             0.819702</span>
<span class="s1">O    SP</span>
<span class="s1">      0.905661               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.255611               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.292                  1.000000</span>
<span class="s1">O    S</span>
<span class="s1">  11427.10                   0.00180093</span>
<span class="s1">   1722.350                  0.0137419</span>
<span class="s1">    395.7460                 0.0681334</span>
<span class="s1">    115.1390                 0.2333250</span>
<span class="s1">     33.60260                0.5890860</span>
<span class="s1">      4.919010               0.2995050</span>
<span class="s1">O    SP</span>
<span class="s1">     55.44410                0.114536               0.0354609</span>
<span class="s1">     12.63230                0.920512               0.237451</span>
<span class="s1">      3.717560              -0.00337804             0.820458</span>
<span class="s1">O    SP</span>
<span class="s1">      1.165450               1.000000               1.000000</span>
<span class="s1">O    SP</span>
<span class="s1">      0.321892               1.000000               1.000000</span>
<span class="s1">O    D</span>
<span class="s1">      1.750                  1.000000</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-311G**&#39;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Exotic version of basis sets found above</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">basis_sets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6-311G**&#39;</span><span class="p">,</span><span class="n">u6311gss</span><span class="p">,</span><span class="n">un6311gss</span><span class="p">,</span><span class="n">z6311gss</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVTZ&#39;</span><span class="p">,</span><span class="s1">&#39;cc-pVQZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVQZ&#39;</span><span class="p">]</span>
<span class="n">ip_hf</span><span class="p">,</span> <span class="n">ip_mp2</span><span class="p">,</span> <span class="n">ip_ccsd</span><span class="p">,</span> <span class="n">ip_b3lyp</span><span class="p">,</span> <span class="n">n_bas</span> <span class="o">=</span> <span class="p">[],[],[],[],[]</span>
<span class="k">for</span> <span class="n">basis</span> <span class="ow">in</span> <span class="n">basis_sets</span><span class="p">:</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">();</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom</span>  <span class="o">=</span> <span class="n">water</span><span class="p">;</span> <span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="n">basis</span>
    <span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_hf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="n">ccsd_res</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfres</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">();</span> <span class="n">ccsd_ion</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">UCCSD</span><span class="p">(</span><span class="n">scfion</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">max_cycle</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">ip_ccsd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_tot</span> <span class="o">-</span> <span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_tot</span><span class="p">))</span>
    <span class="n">ip_mp2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">e_hf</span><span class="o">+</span><span class="n">ccsd_ion</span><span class="o">.</span><span class="n">emp2</span><span class="o">-</span><span class="p">(</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">e_hf</span><span class="o">+</span><span class="n">ccsd_res</span><span class="o">.</span><span class="n">emp2</span><span class="p">)))</span>
    <span class="n">scfres</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scfres</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">;</span> <span class="n">scfres</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">mo0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">);</span> <span class="n">occ0</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">);</span> <span class="n">occ0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">scfion</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">);</span> <span class="n">scf</span><span class="o">.</span><span class="n">addons</span><span class="o">.</span><span class="n">mom_occ</span><span class="p">(</span><span class="n">scfion</span><span class="p">,</span> <span class="n">mo0</span><span class="p">,</span> <span class="n">occ0</span><span class="p">);</span> <span class="n">scfion</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="s1">&#39;b3lyp&#39;</span><span class="p">;</span> <span class="n">scfion</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
    <span class="n">ip_b3lyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">au2ev</span><span class="o">*</span><span class="p">(</span><span class="n">scfion</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()</span> <span class="o">-</span> <span class="n">scfres</span><span class="o">.</span><span class="n">energy_tot</span><span class="p">()))</span>
    <span class="n">n_bas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scfres</span><span class="o">.</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">basis_set_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;u6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;un6-311G**&#39;</span><span class="p">,</span><span class="s1">&#39;6-311G** (Z+1)&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVDZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pVTZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVTZ&#39;</span><span class="p">,</span><span class="s1">&#39;cc-pVQZ&#39;</span><span class="p">,</span> <span class="s1">&#39;cc-pCVQZ&#39;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_hf</span><span class="p">,</span><span class="s1">&#39;r*&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_mp2</span><span class="p">,</span><span class="s1">&#39;bv&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_ccsd</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">ip_b3lyp</span><span class="p">,</span><span class="s1">&#39;go&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">],[</span><span class="mf">539.9</span><span class="p">,</span><span class="mf">539.9</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">],[</span><span class="mf">539.9</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">539.9</span><span class="o">-</span><span class="mf">0.3</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="nb">min</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">n_bas</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ionization potential [eV]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;HF&#39;</span><span class="p">,</span><span class="s1">&#39;MP2&#39;</span><span class="p">,</span><span class="s1">&#39;CCSD&#39;</span><span class="p">,</span><span class="s1">&#39;B3LYP&#39;</span><span class="p">,</span><span class="s1">&#39;Expt&#39;</span><span class="p">,</span><span class="s1">&#39;Expt - 0.3 eV&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">n_bas</span><span class="p">,</span><span class="n">basis_set_labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;basis_xps.svg&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The execution of which yields</p>
<div class="figure align-default" id="basis-xps">
<img alt="../_images/basis_xps.svg" src="../_images/basis_xps.svg" /><p class="caption"><span class="caption-number">Fig. 15 </span><span class="caption-text">foo</span><a class="headerlink" href="#basis-xps" title="Permalink to this image">¶</a></p>
</div>
<p>On the y-axis we see the basis set labels, with order and position determined by the number of basis functions.</p>
<p>We see that…</p>
</div>
<div class="section" id="general-recommendations">
<h2>General recommendations<a class="headerlink" href="#general-recommendations" title="Permalink to this headline">¶</a></h2>
<p>What follows are some general suggestions for practical calculations, which is naturally an  incomplete list with some of the Authors biases unavoidably being included. Consider this as a hopefully helpful guide,but not more than that.</p>
<div class="section" id="precision-versus-accuracy">
<h3><em>Precision</em> versus <em>accuracy</em><a class="headerlink" href="#precision-versus-accuracy" title="Permalink to this headline">¶</a></h3>
<p>Because of the many difficulties in modeling X-ray spectra (relativity, relaxation, self-interaction, high energies…), even very sophisticated (and expensive!) methods often struggles in getting good <em>absolute</em> energies. These cannot be expected to be as good as for valence excitations. I argue that the focus should be more on properly reproducing <em>relative</em> rather than <em>absolute</em> trends, which can be formulated as focusing on  precision over accuracy, where</p>
<ul class="simple">
<li><p>Accuracy correspond to the deviation from the absolute energies and intensities, or the systematic error.</p></li>
<li><p>Precision focus on the reproducability of relative energies and intensities, or (relative) error distribution.</p></li>
</ul>
<p>We have [shown] that good accuracy does not nedessarily correspond to as good precision, and our philosophy is that obtaining good trends and relative errors is sufficient for prectical studies (provided we have some idea of the source of the absolute error, and good reasons to think that it will noit differ between the systems). Absolute errors can then be corrected by a mere absolute shift in energy.</p>
</div>
<div class="section" id="electronic-stucture-method">
<h3>Electronic stucture method<a class="headerlink" href="#electronic-stucture-method" title="Permalink to this headline">¶</a></h3>
<p>Single determinant wave function methods can include relaxation by the use of (at least) doubly excited configurations. These methods tend to yield relatively consistent description of the processes, and are thus recommended to be used for (at least) controls. Due to the cost, however, they are often unviable for larger systems. Families and recommendations include:</p>
<ul class="simple">
<li><p>Coupled cluster</p>
<ul>
<li><p>CCSD has been noted to yield consistent results for XAS and XES, and</p></li>
<li><p>CC3 has been seen to improve the XAS results, and can be used in a multilayer manner</p></li>
<li><p>If computational cost is a concern, CC2 has been seen to work quite well</p></li>
</ul>
</li>
<li><p>Algebraic-diagrammatic construction scheme</p>
<ul>
<li><p>ADC(2) yields superiour results for XES, and works quite well for the valence states in XAS (the shift to higher-lying features are likely to be compressed, however).</p></li>
<li><p>ADC(2)-x has been noted to yield best results for XAS, despite being quite unsuitable for valence excitations. This has been identified as a result of balancing effects for capturing the strong relaxation effects in XAS.</p></li>
<li><p>ADC(3/2) has been noted to yield a poorer description of both XAS and XES, despite its higher level of theory and higher computational cost. <em>However</em>, for X-ray emission spectra of systems in an environment, double-excitations may interfer with the emission states for ADC(2) and ADC(2)-x. ADC(3/2) will then be most suitable.</p></li>
</ul>
</li>
</ul>
<p>With TDDFT (or CPP-DFT), the exchange-correlation functional depends on the edge and the element, as the exact balance of relaxation and self-interaction varies significantly. Good absolute energies are often obtained by balancing the error of the lack of relaxation versus the self-interaction, which is achieved by changing the amount of HF exchange. Focusing on the second row we have seen that:</p>
<ul class="simple">
<li><p>CAM-B3LYP (potentially using 100% asymptotic HF) has been seen to yield good relative energies (precision), but poor absolute energies (accuracy). Intensitites are also quite good, so a mere absolute shift often yield good agreement with experiment.</p></li>
<li><p>SRC2-R1 is from a family of short-range correlated functionals, formulated for good absolute XAS energies.</p></li>
</ul>
<p>If static correlation becomes substantial, methods based on a single Slater determinant reference will become unsuitable. ADC will be worst off, on account of the MP reference, with CC being slightly more successful for these cases. Spin-flip ADC and CC can improve the situation for certain few-reference systems. TDDFT will be a bit more capable of considering these cases. However, systems with strong static correlation should be studied carefully, and multi-reference methods are likely the safest way forward. Need to know which active space to choose, etc.</p>
<p>Transition-metal complexes can have strong static correlation, which would aim to multi-reference methods. For some cases ADC or CC works quite well - just check it. Furthermore, TM complexes can need (spin-orbit) relativistic effects, and quadruple-allowed transition can become substantial.</p>
<p>Other methods, such as… can also be used.</p>
</div>
<div class="section" id="basis-set-selection">
<h3>Basis set selection<a class="headerlink" href="#basis-set-selection" title="Permalink to this headline">¶</a></h3>
<p>As previously [discussed], standard basis set often include a minimal, or close to minimal, basis set for the core region, as computational chemistry commonly focus on the valence electrons. For core spectroscopies this region thus often need to be augmented by some method, which may include decontracting core basis functions, including core-polarizing functions, augmenting the basis set with basis functions for <span class="math notranslate nohighlight">\(Z++1\)</span> or <span class="math notranslate nohighlight">\(Z+1/2\)</span>, or some other method. It can be noted, however, that this augmentation is not necissary for high precision, provided that the lacking description of the core region yield similar errors for different states and/or atomic sites.</p>
<p>Nevertheless, my general recommendation would be to use cc-pCVTZ for the atoms probed, and cc-pVTZ for the remaining atoms. Dunning basis set 6-311G** has also been seen to perform quite well, and the core basis functions can here be decontracted for u6-311G**. Hydrogen atoms and atoms away from the probed core orbitals can likely be dropped to a double-<span class="math notranslate nohighlight">\(\zeta\)</span> desciption. A double-<span class="math notranslate nohighlight">\(\zeta\)</span> (<em>e.g.</em> cc-pVDZ/cc-pCVDZ or 6-31G*/u6-31G*) can be used with some care for larger systems and more approximate methods.</p>
<ul class="simple">
<li><p><strong>XPS:</strong> If some <span class="math notranslate nohighlight">\(\Delta\textrm{SCF}\)</span> method is used, a flexible description of the core and valence region</p></li>
<li><p><strong>XAS:</strong> Probes unoccupied states, and thus need to be augmented to describe this region. For the valence-type final states it is likely to be sufficient to add more diffuse functions, <em>i.e.</em> aug-cc-pCVTZ or 6-311++G**. Adding the Dunning diffuse functions are likely not necessary for hydrogen. Furthermore, if Rydberg/mixed-Rydberg states are to be studied, augmentation with additional diffuse function can be necessary.</p></li>
<li><p><strong>XES:</strong> Shares requirements with XPS.</p></li>
<li><p><strong>RIXS:</strong> Probes both the occupied and unoccupied states, and thus need a good (and balanced) description of both. The recommendations for XAS and XES can thus be considered to transfer over to this spectroscopy.</p></li>
</ul>
<p>Note that for heavier atoms the core region contains several shells. As the core-polarizing functions are formulated to capture core-valence correlation, it will then more efficiently augment the outer, rather than the inner, core region. AS such, additional (inner) core basis functions would be needed for approaching the BSL of these atoms. Still, with the discussion of precision above, the weak interaction between the inner core and valence region means that core-polarization may anyway just yield an absolute error correction.</p>
</div>
<div class="section" id="relativistic-effects">
<h3>Relativistic effects<a class="headerlink" href="#relativistic-effects" title="Permalink to this headline">¶</a></h3>
<p>If the <em>K</em>-edge is considered, scalar relativistic effects are only needed, as can be done with X2C or Douglas-Kroll-Hess. Alternatively, it is often sufficient to just add an absolute scalar shift in energy for a non-relativistic calculation (such a shift is likely needed anyway, as absolute energies are notoriously hard to reproduce). This absolute shift can be estimated by simple MO energy calculations, as shown [above].</p>
<p>If <em>l&gt;0</em> is to be considered, spin-orbit splitting effects will potentially be substantial. Including this can be done with…</p>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title">Margin</p>
<p>This is how it would look.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Not included (yet)</strong></p>
<ul class="simple">
<li><p>SO-coupling</p></li>
<li><p>beyond electrinc-dipole approximation</p></li>
<li><p>multireference methods</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="nlo.html" title="previous page">Multi-photon interactions</a>
    <a class='right-next' id="next-link" href="elecstruct-general.html" title="next page">General aspects</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The eChem team<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>